{"ast":null,"code":"var _jsxFileName = \"/Users/gustsantos/Desktop/initucastt/frontend/src/pages/JourneyBuilder.jsx\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\n// frontend/src/pages/JourneyBuilder.jsx\nimport React, { useCallback, useEffect, useMemo, useRef, useState } from 'react';\nimport ReactFlow, { Background, Controls, MiniMap, addEdge, useEdgesState, useNodesState, MarkerType, Handle, Position } from 'reactflow';\nimport 'reactflow/dist/style.css';\nimport Papa from 'papaparse';\nimport { saveAs } from 'file-saver';\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst PIN_SIZE = 14;\nconst DND_TYPE = 'application/reactflow';\nconst SNAP = [16, 16];\n\n// ---------- helpers ----------\nconst uid = p => `${p}_${Date.now()}_${Math.floor(Math.random() * 9999)}`;\nconst slug = s => String(s || '').trim().toLowerCase().replace(/\\s+/g, '_').replace(/[^\\w]/g, '_').replace(/_+/g, '_');\nconst defaultDataForType = type => {\n  switch (type) {\n    case 'message':\n      return {\n        label: 'Mensagem',\n        channel: 'whatsapp',\n        mode: 'text',\n        text: ''\n      };\n    case 'api':\n      return {\n        label: 'API Call',\n        method: 'GET',\n        url: '',\n        headers: '{}',\n        body: '{}',\n        mappings: [],\n        lastResponse: ''\n      };\n    case 'code':\n      return {\n        label: 'Code',\n        code: '// return { nova_variavel: 123 };'\n      };\n    case 'audience':\n      return {\n        headers: [],\n        rows: [],\n        mapping: {},\n        phoneKey: ''\n      };\n    case 'delay':\n      return {\n        label: 'Delay',\n        mode: 'relative',\n        amount: 1,\n        unit: 'hours',\n        until: '',\n        untilLocal: ''\n      };\n    case 'end':\n      return {};\n    default:\n      return {};\n  }\n};\n\n// ---------- node shells ----------\nconst NodeShell = ({\n  title,\n  subtitle,\n  selected,\n  children\n}) => /*#__PURE__*/_jsxDEV(\"div\", {\n  style: {\n    background: '#fff',\n    border: selected ? '2px solid #2563eb' : '1px solid #e5e7eb',\n    borderRadius: 12,\n    width: 320,\n    boxShadow: '0 2px 8px rgba(0,0,0,.06)'\n  },\n  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      padding: '12px 14px',\n      borderBottom: '1px solid #f1f5f9'\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        fontWeight: 700,\n        color: '#0f172a'\n      },\n      children: title\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 63,\n      columnNumber: 7\n    }, this), subtitle ? /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        fontSize: 12,\n        color: '#64748b'\n      },\n      children: subtitle\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 64,\n      columnNumber: 19\n    }, this) : null]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 62,\n    columnNumber: 5\n  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      padding: 12\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 66,\n    columnNumber: 5\n  }, this)]\n}, void 0, true, {\n  fileName: _jsxFileName,\n  lineNumber: 53,\n  columnNumber: 3\n}, this);\n_c = NodeShell;\nconst EndNode = ({\n  selected\n}) => /*#__PURE__*/_jsxDEV(NodeShell, {\n  title: \"End\",\n  subtitle: \"t\\xE9rmino do fluxo\",\n  selected: selected,\n  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      fontSize: 12,\n      color: '#475569'\n    },\n    children: \"N\\xF3 terminal. S\\xF3 recebe conex\\xF5es.\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 72,\n    columnNumber: 5\n  }, this), /*#__PURE__*/_jsxDEV(Handle, {\n    type: \"target\",\n    position: Position.Left,\n    id: \"in\",\n    style: {\n      background: '#6b7280',\n      width: PIN_SIZE,\n      height: PIN_SIZE,\n      border: '2px solid #fff'\n    }\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 73,\n    columnNumber: 5\n  }, this)]\n}, void 0, true, {\n  fileName: _jsxFileName,\n  lineNumber: 71,\n  columnNumber: 3\n}, this);\n_c2 = EndNode;\nconst MessageNode = ({\n  data,\n  selected\n}) => /*#__PURE__*/_jsxDEV(NodeShell, {\n  title: data.label || 'Mensagem',\n  subtitle: `Canal: ${String(data.channel || 'whatsapp').toUpperCase()} • Tipo: ${data.mode || 'text'}`,\n  selected: selected,\n  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      fontSize: 12,\n      color: '#475569'\n    },\n    children: \"Conte\\xFAdo configur\\xE1vel no painel ao lado.\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 84,\n    columnNumber: 5\n  }, this), /*#__PURE__*/_jsxDEV(Handle, {\n    type: \"target\",\n    position: Position.Left,\n    id: \"in\",\n    style: {\n      background: '#6b7280',\n      width: PIN_SIZE,\n      height: PIN_SIZE,\n      border: '2px solid #fff'\n    }\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 85,\n    columnNumber: 5\n  }, this), /*#__PURE__*/_jsxDEV(Handle, {\n    type: \"source\",\n    position: Position.Right,\n    id: \"out\",\n    style: {\n      background: '#16a34a',\n      width: PIN_SIZE,\n      height: PIN_SIZE,\n      border: '2px solid #fff'\n    }\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 87,\n    columnNumber: 5\n  }, this)]\n}, void 0, true, {\n  fileName: _jsxFileName,\n  lineNumber: 79,\n  columnNumber: 3\n}, this);\n_c3 = MessageNode;\nconst ApiNode = ({\n  selected\n}) => /*#__PURE__*/_jsxDEV(NodeShell, {\n  title: \"API Call\",\n  selected: selected,\n  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      fontSize: 12,\n      color: '#475569'\n    },\n    children: \"Configure m\\xE9todo/URL no painel ao lado. Salva vari\\xE1veis via mapeamentos.\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 94,\n    columnNumber: 5\n  }, this), /*#__PURE__*/_jsxDEV(Handle, {\n    type: \"target\",\n    position: Position.Left,\n    id: \"in\",\n    style: {\n      background: '#6b7280',\n      width: PIN_SIZE,\n      height: PIN_SIZE,\n      border: '2px solid #fff'\n    }\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 97,\n    columnNumber: 5\n  }, this), /*#__PURE__*/_jsxDEV(Handle, {\n    type: \"source\",\n    position: Position.Right,\n    id: \"out\",\n    style: {\n      background: '#16a34a',\n      width: PIN_SIZE,\n      height: PIN_SIZE,\n      border: '2px solid #fff'\n    }\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 99,\n    columnNumber: 5\n  }, this)]\n}, void 0, true, {\n  fileName: _jsxFileName,\n  lineNumber: 93,\n  columnNumber: 3\n}, this);\n_c4 = ApiNode;\nconst CodeNode = ({\n  selected\n}) => /*#__PURE__*/_jsxDEV(NodeShell, {\n  title: \"Code\",\n  subtitle: \"JS custom\",\n  selected: selected,\n  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      fontSize: 12,\n      color: '#475569'\n    },\n    children: \"Cole seu JS no painel ao lado. Deve retornar um objeto de vari\\xE1veis.\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 106,\n    columnNumber: 5\n  }, this), /*#__PURE__*/_jsxDEV(Handle, {\n    type: \"target\",\n    position: Position.Left,\n    id: \"in\",\n    style: {\n      background: '#6b7280',\n      width: PIN_SIZE,\n      height: PIN_SIZE,\n      border: '2px solid #fff'\n    }\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 107,\n    columnNumber: 5\n  }, this), /*#__PURE__*/_jsxDEV(Handle, {\n    type: \"source\",\n    position: Position.Right,\n    id: \"out\",\n    style: {\n      background: '#16a34a',\n      width: PIN_SIZE,\n      height: PIN_SIZE,\n      border: '2px solid #fff'\n    }\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 109,\n    columnNumber: 5\n  }, this)]\n}, void 0, true, {\n  fileName: _jsxFileName,\n  lineNumber: 105,\n  columnNumber: 3\n}, this);\n_c5 = CodeNode;\nconst AudienceNode = ({\n  selected\n}) => /*#__PURE__*/_jsxDEV(NodeShell, {\n  title: \"Audi\\xEAncia\",\n  subtitle: \"CSV \\u2192 vari\\xE1veis\",\n  selected: selected,\n  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      fontSize: 12,\n      color: '#475569'\n    },\n    children: \"Fa\\xE7a upload e mapeie colunas no painel ao lado.\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 116,\n    columnNumber: 5\n  }, this), /*#__PURE__*/_jsxDEV(Handle, {\n    type: \"source\",\n    position: Position.Right,\n    id: \"out\",\n    style: {\n      background: '#16a34a',\n      width: PIN_SIZE,\n      height: PIN_SIZE,\n      border: '2px solid #fff'\n    }\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 117,\n    columnNumber: 5\n  }, this)]\n}, void 0, true, {\n  fileName: _jsxFileName,\n  lineNumber: 115,\n  columnNumber: 3\n}, this);\n_c6 = AudienceNode;\nconst DelayNode = ({\n  data = {},\n  selected\n}) => {\n  var _data$amount;\n  const subtitle = data.mode === 'until' ? `até ${data.until ? new Date(data.until).toLocaleString() : '—'}` : `+ ${(_data$amount = data.amount) !== null && _data$amount !== void 0 ? _data$amount : 1} ${data.unit || 'hours'}`;\n  return /*#__PURE__*/_jsxDEV(NodeShell, {\n    title: \"Delay\",\n    subtitle: subtitle,\n    selected: selected,\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        fontSize: 12,\n        color: '#475569'\n      },\n      children: \"Espera antes de seguir para o pr\\xF3ximo n\\xF3.\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 129,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Handle, {\n      type: \"target\",\n      position: Position.Left,\n      id: \"in\",\n      style: {\n        background: '#6b7280',\n        width: PIN_SIZE,\n        height: PIN_SIZE,\n        border: '2px solid #fff'\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 130,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Handle, {\n      type: \"source\",\n      position: Position.Right,\n      id: \"out\",\n      style: {\n        background: '#16a34a',\n        width: PIN_SIZE,\n        height: PIN_SIZE,\n        border: '2px solid #fff'\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 132,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 128,\n    columnNumber: 5\n  }, this);\n};\n\n// ---------- side panel widgets ----------\n_c7 = DelayNode;\nfunction AudiencePanel({\n  node,\n  patchNode,\n  inputStyle,\n  label,\n  slugFn\n}) {\n  _s();\n  const d = node.data || {};\n  const [headers, setHeaders] = useState(d.headers || []);\n  const [rows, setRows] = useState(d.rows || []);\n  const [mapping, setMapping] = useState(d.mapping || {});\n  const [phoneKey, setPhoneKey] = useState(d.phoneKey || '');\n  useEffect(() => {\n    setHeaders(d.headers || []);\n    setRows(d.rows || []);\n    setMapping(d.mapping || {});\n    setPhoneKey(d.phoneKey || '');\n  }, [node.id]);\n  const onFile = e => {\n    var _e$target$files;\n    const f = (_e$target$files = e.target.files) === null || _e$target$files === void 0 ? void 0 : _e$target$files[0];\n    if (!f) return;\n    Papa.parse(f, {\n      header: true,\n      skipEmptyLines: true,\n      complete: res => {\n        const hs = res.meta.fields || Object.keys(res.data[0] || {});\n        const guess = {};\n        hs.forEach(h => guess[h] = slugFn(h));\n        const pk = hs.find(h => /phone|telefone|celular|numero|n[uú]mero/i.test(h)) || '';\n        setHeaders(hs);\n        setRows(res.data.slice(0, 5));\n        setMapping(guess);\n        setPhoneKey(pk);\n      }\n    });\n  };\n  const saveMap = () => {\n    if (!phoneKey) {\n      alert('Escolha a coluna de telefone.');\n      return;\n    }\n    patchNode(node.id, {\n      headers,\n      rows,\n      mapping,\n      phoneKey\n    });\n    alert('Mapeamento salvo.');\n  };\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [label('Arquivo CSV'), /*#__PURE__*/_jsxDEV(\"input\", {\n      type: \"file\",\n      accept: \".csv\",\n      onChange: onFile\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 184,\n      columnNumber: 7\n    }, this), headers.length > 0 && /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [label('Coluna de telefone'), /*#__PURE__*/_jsxDEV(\"select\", {\n        style: inputStyle,\n        value: phoneKey,\n        onChange: e => setPhoneKey(e.target.value),\n        children: [/*#__PURE__*/_jsxDEV(\"option\", {\n          value: \"\",\n          children: \"\\u2014 selecione \\u2014\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 190,\n          columnNumber: 13\n        }, this), headers.map(h => /*#__PURE__*/_jsxDEV(\"option\", {\n          value: h,\n          children: h\n        }, h, false, {\n          fileName: _jsxFileName,\n          lineNumber: 191,\n          columnNumber: 33\n        }, this))]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 189,\n        columnNumber: 11\n      }, this), label('Mapeamento (coluna → variável)'), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          display: 'grid',\n          gridTemplateColumns: '1fr 20px 1fr',\n          gap: 8,\n          maxHeight: 200,\n          overflow: 'auto'\n        },\n        children: headers.map(h => /*#__PURE__*/_jsxDEV(React.Fragment, {\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              alignSelf: 'center',\n              fontSize: 13\n            },\n            children: h\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 198,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              textAlign: 'center',\n              color: '#94a3b8'\n            },\n            children: \"\\u2192\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 199,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            style: inputStyle,\n            value: mapping[h] || '',\n            placeholder: slugFn(h),\n            onChange: e => setMapping(m => ({\n              ...m,\n              [h]: slugFn(e.target.value)\n            }))\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 200,\n            columnNumber: 17\n          }, this)]\n        }, h, true, {\n          fileName: _jsxFileName,\n          lineNumber: 197,\n          columnNumber: 15\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 195,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"btn\",\n        onClick: saveMap,\n        style: {\n          marginTop: 10\n        },\n        children: \"Salvar mapeamento\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 210,\n        columnNumber: 11\n      }, this), rows.length > 0 && /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [label('Amostra (5 primeiras linhas)'), /*#__PURE__*/_jsxDEV(\"pre\", {\n          style: {\n            background: '#f8fafc',\n            border: '1px solid #e2e8f0',\n            borderRadius: 8,\n            padding: 10,\n            fontSize: 12,\n            maxHeight: 160,\n            overflow: 'auto'\n          },\n          children: JSON.stringify(rows, null, 2)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 215,\n          columnNumber: 15\n        }, this)]\n      }, void 0, true), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          fontSize: 12,\n          color: '#64748b',\n          marginTop: 8\n        },\n        children: [\"Dica: ap\\xF3s salvar, use as vari\\xE1veis com \", /*#__PURE__*/_jsxDEV(\"code\", {\n          children: '{{minha_variavel}}'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 224,\n          columnNumber: 53\n        }, this), \".\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 223,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true)]\n  }, void 0, true);\n}\n\n// ---------- main page ----------\n_s(AudiencePanel, \"Gvd8UhRxqXlUdrrpexXFfFXUeMs=\");\n_c8 = AudiencePanel;\nexport default function JourneyBuilder() {\n  _s2();\n  // audience inicial (sem Start)\n  const [nodes, setNodes, onNodesChange] = useNodesState([{\n    id: 'audience_start',\n    type: 'audience',\n    position: {\n      x: 140,\n      y: 180\n    },\n    data: defaultDataForType('audience'),\n    selectable: true\n  }]);\n  const [edges, setEdges, onEdgesChange] = useEdgesState([]);\n  const nodesRef = useRef(nodes);\n  useEffect(() => {\n    nodesRef.current = nodes;\n  }, [nodes]);\n\n  // flow id & name\n  const [flowId, setFlowId] = useState(null);\n  const [flowName, setFlowName] = useState('Novo Flow');\n  useEffect(() => {\n    const sp = new URLSearchParams(window.location.search);\n    const id = sp.get('id');\n    if (!id) return;\n    setFlowId(id);\n    fetch(`/api/journeys/${id}`).then(r => r.ok ? r.json() : Promise.reject()).then(f => {\n      if (Array.isArray(f.nodes) && Array.isArray(f.edges)) {\n        setNodes(f.nodes);\n        setEdges(f.edges);\n        if (f.name) setFlowName(f.name);\n      }\n    }).catch(() => {\n      const raw = localStorage.getItem(id);\n      if (raw) {\n        try {\n          const f = JSON.parse(raw);\n          if (Array.isArray(f.nodes) && Array.isArray(f.edges)) {\n            setNodes(f.nodes);\n            setEdges(f.edges);\n            if (f.name) setFlowName(f.name);\n          }\n        } catch {}\n      }\n    });\n  }, [setEdges, setNodes]);\n\n  // seleção & drawer\n  const [selectedId, setSelectedId] = useState(null);\n  const selectedNode = useMemo(() => nodes.find(n => n.id === selectedId), [nodes, selectedId]);\n  const showSide = Boolean(selectedNode);\n\n  // templates Twilio\n  const [templates, setTemplates] = useState([]);\n  useEffect(() => {\n    fetch('/api/templates/list').then(r => r.json()).then(data => setTemplates(data.contents || [])).catch(() => setTemplates([]));\n  }, []);\n\n  // patch helper\n  const patchNode = useCallback((id, patch) => {\n    setNodes(nds => nds.map(n => n.id === id ? {\n      ...n,\n      data: {\n        ...n.data,\n        ...patch\n      }\n    } : n));\n  }, [setNodes]);\n\n  // 1 saída por nó\n  const onConnect = useCallback(params => {\n    setEdges(eds => {\n      const filtered = eds.filter(e => e.source !== params.source);\n      return addEdge({\n        ...params,\n        type: 'smoothstep',\n        style: {\n          stroke: '#0f172a'\n        },\n        markerEnd: {\n          type: MarkerType.ArrowClosed,\n          color: '#0f172a'\n        }\n      }, filtered);\n    });\n  }, [setEdges]);\n  const onSelectionChange = useCallback(({\n    nodes: ns\n  }) => {\n    var _ns$0$id, _ns$;\n    setSelectedId((_ns$0$id = ns === null || ns === void 0 ? void 0 : (_ns$ = ns[0]) === null || _ns$ === void 0 ? void 0 : _ns$.id) !== null && _ns$0$id !== void 0 ? _ns$0$id : null);\n  }, []);\n\n  // criar nós (usado pelo DnD)\n  const addNodeOfType = (type, position = {\n    x: 360,\n    y: 240\n  }) => {\n    const id = uid(type);\n    setNodes(nds => nds.concat({\n      id,\n      type,\n      position,\n      data: defaultDataForType(type)\n    }));\n\n    // auto-conecta Audiência -> novo nó se a audiência ainda não tem saída\n    setEdges(eds => {\n      const audience = nodesRef.current.find(n => n.type === 'audience');\n      const hasAudienceOut = audience ? eds.some(e => e.source === audience.id) : false;\n      if (audience && !hasAudienceOut && type !== 'audience') {\n        return addEdge({\n          id: uid('e'),\n          source: audience.id,\n          sourceHandle: 'out',\n          target: id,\n          type: 'smoothstep',\n          style: {\n            stroke: '#0f172a'\n          },\n          markerEnd: {\n            type: MarkerType.ArrowClosed,\n            color: '#0f172a'\n          }\n        }, eds);\n      }\n      return eds;\n    });\n  };\n  const duplicateSelected = () => {\n    if (!selectedNode) return;\n    const id = uid(selectedNode.type);\n    setNodes(nds => nds.concat({\n      ...selectedNode,\n      id,\n      position: {\n        x: selectedNode.position.x + 40,\n        y: selectedNode.position.y + 40\n      },\n      selected: false\n    }));\n  };\n  const removeNode = id => {\n    setEdges(eds => eds.filter(e => e.source !== id && e.target !== id));\n    setNodes(nds => nds.filter(n => n.id !== id));\n    if (selectedId === id) setSelectedId(null);\n  };\n\n  // salvar flow\n  const handleSaveFlow = async () => {\n    let name = flowName || 'Novo Flow';\n    if (!flowId && (!name || name === 'Novo Flow')) {\n      const entered = window.prompt('Dê um nome para este flow:', name);\n      if (entered && entered.trim()) {\n        name = entered.trim();\n        setFlowName(name);\n      }\n    }\n    const payload = {\n      id: flowId || 'flow_' + Date.now(),\n      name,\n      nodes,\n      edges,\n      updatedAt: new Date().toISOString()\n    };\n    try {\n      const url = flowId ? `/api/journeys/${flowId}` : '/api/journeys';\n      const method = flowId ? 'PUT' : 'POST';\n      const res = await fetch(url, {\n        method,\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(payload)\n      });\n      if (!res.ok) throw new Error('no backend');\n      const saved = await res.json();\n      alert('Flow salvo no backend!');\n      if (!flowId && saved !== null && saved !== void 0 && saved.id) {\n        window.history.replaceState(null, '', `/journeys/builder?id=${saved.id}`);\n        setFlowId(saved.id);\n      }\n    } catch {\n      localStorage.setItem(payload.id, JSON.stringify(payload));\n      alert('Flow salvo no navegador.');\n      if (!flowId) {\n        window.history.replaceState(null, '', `/journeys/builder?id=${payload.id}`);\n        setFlowId(payload.id);\n      }\n    }\n  };\n\n  // import/export\n  const fileRef = useRef(null);\n  const onImportClick = () => {\n    var _fileRef$current;\n    return (_fileRef$current = fileRef.current) === null || _fileRef$current === void 0 ? void 0 : _fileRef$current.click();\n  };\n  const onImportFile = e => {\n    var _e$target$files2;\n    const f = (_e$target$files2 = e.target.files) === null || _e$target$files2 === void 0 ? void 0 : _e$target$files2[0];\n    if (!f) return;\n    const reader = new FileReader();\n    reader.onload = () => {\n      try {\n        const json = JSON.parse(String(reader.result || '{}'));\n        if (Array.isArray(json.nodes) && Array.isArray(json.edges)) {\n          setNodes(json.nodes);\n          setEdges(json.edges);\n          if (json.id) setFlowId(json.id);\n          if (json.name) setFlowName(json.name);\n          alert('Flow importado.');\n        } else {\n          alert('Arquivo inválido.');\n        }\n      } catch (err) {\n        alert('Falha ao importar: ' + ((err === null || err === void 0 ? void 0 : err.message) || 'erro'));\n      }\n    };\n    reader.readAsText(f);\n    e.target.value = '';\n  };\n  const onExport = () => {\n    const data = {\n      id: flowId || 'flow_unsaved',\n      name: flowName || 'Novo Flow',\n      nodes,\n      edges,\n      exportedAt: new Date().toISOString()\n    };\n    const blob = new Blob([JSON.stringify(data, null, 2)], {\n      type: 'application/json;charset=utf-8'\n    });\n    saveAs(blob, `${slug(data.name || 'flow')}.json`);\n  };\n\n  // ---- Drag & Drop (palette → canvas) ----\n  const wrapperRef = useRef(null);\n  const [rfInstance, setRfInstance] = useState(null);\n  const onDragStart = (event, nodeType) => {\n    event.dataTransfer.setData(DND_TYPE, nodeType);\n    event.dataTransfer.effectAllowed = 'move';\n  };\n  const onDragOver = useCallback(event => {\n    event.preventDefault();\n    event.dataTransfer.dropEffect = 'move';\n  }, []);\n  const onDrop = useCallback(event => {\n    event.preventDefault();\n    const type = event.dataTransfer.getData(DND_TYPE);\n    if (!type || !rfInstance || !wrapperRef.current) return;\n    const bounds = wrapperRef.current.getBoundingClientRect();\n    const position = rfInstance.project({\n      x: event.clientX - bounds.left,\n      y: event.clientY - bounds.top\n    });\n    addNodeOfType(type, position);\n  }, [rfInstance]);\n\n  // ---- Context Menu (right-click no nó) ----\n  const [ctx, setCtx] = useState({\n    open: false,\n    x: 0,\n    y: 0,\n    nodeId: null,\n    nodeType: null\n  });\n  const onNodeContextMenu = (evt, node) => {\n    evt.preventDefault();\n    setSelectedId(node.id);\n    setCtx({\n      open: true,\n      x: evt.clientX,\n      y: evt.clientY,\n      nodeId: node.id,\n      nodeType: node.type\n    });\n  };\n  const closeCtx = () => setCtx({\n    open: false,\n    x: 0,\n    y: 0,\n    nodeId: null,\n    nodeType: null\n  });\n  const renameCtx = () => {\n    var _n$data;\n    const n = nodes.find(x => x.id === ctx.nodeId);\n    if (!n) return;\n    const curr = ((_n$data = n.data) === null || _n$data === void 0 ? void 0 : _n$data.label) || '';\n    const name = window.prompt('Novo nome do nó:', curr);\n    if (name !== null) patchNode(n.id, {\n      label: name\n    });\n    closeCtx();\n  };\n  const duplicateCtx = () => {\n    const n = nodes.find(x => x.id === ctx.nodeId);\n    if (n) {\n      const copy = {\n        ...n,\n        id: uid(n.type),\n        position: {\n          x: n.position.x + 40,\n          y: n.position.y + 40\n        },\n        selected: false\n      };\n      setNodes(nds => nds.concat(copy));\n    }\n    closeCtx();\n  };\n  const resetCtx = () => {\n    const n = nodes.find(x => x.id === ctx.nodeId);\n    if (n) patchNode(n.id, defaultDataForType(n.type));\n    closeCtx();\n  };\n  const deleteCtx = () => {\n    if (ctx.nodeId) removeNode(ctx.nodeId);\n    closeCtx();\n  };\n\n  // ---- Auto-layout (horizontal por níveis) ----\n  const autoLayout = () => {\n    const nm = new Map(nodes.map(n => [n.id, n]));\n    const children = new Map(nodes.map(n => [n.id, []]));\n    const indeg = new Map(nodes.map(n => [n.id, 0]));\n    edges.forEach(e => {\n      if (children.has(e.source)) children.get(e.source).push(e.target);\n      if (indeg.has(e.target)) indeg.set(e.target, (indeg.get(e.target) || 0) + 1);\n    });\n\n    // nós de entrada (preferindo audiência)\n    const audiences = nodes.filter(n => n.type === 'audience');\n    let starts = audiences.filter(n => (indeg.get(n.id) || 0) === 0);\n    if (starts.length === 0) starts = audiences.length ? [audiences[0]] : nodes.filter(n => (indeg.get(n.id) || 0) === 0);\n    if (starts.length === 0 && nodes.length) starts = [nodes[0]];\n    const level = new Map();\n    const q = [...starts];\n    starts.forEach(s => level.set(s.id, 0));\n    while (q.length) {\n      const cur = q.shift();\n      const L = level.get(cur.id) || 0;\n      (children.get(cur.id) || []).forEach(t => {\n        if (!level.has(t)) {\n          level.set(t, L + 1);\n          q.push(nm.get(t));\n        }\n      });\n    }\n\n    // coloca não visitados também\n    nodes.forEach(n => {\n      if (!level.has(n.id)) level.set(n.id, 0);\n    });\n    const byLevel = {};\n    nodes.forEach(n => {\n      const L = level.get(n.id) || 0;\n      if (!byLevel[L]) byLevel[L] = [];\n      byLevel[L].push(n.id);\n    });\n    const DX = 360,\n      DY = 150,\n      X0 = 140,\n      Y0 = 150;\n    const newNodes = nodes.map(n => {\n      const L = level.get(n.id) || 0;\n      const siblings = byLevel[L] || [];\n      const idx = siblings.indexOf(n.id);\n      return {\n        ...n,\n        position: {\n          x: X0 + L * DX,\n          y: Y0 + idx * DY\n        }\n      };\n    });\n    setNodes(newNodes);\n  };\n\n  // ---- atalhos de teclado ----\n  useEffect(() => {\n    const handler = e => {\n      const target = e.target;\n      const tag = target && target.tagName || '';\n      const typing = tag === 'INPUT' || tag === 'TEXTAREA' || (target === null || target === void 0 ? void 0 : target.isContentEditable);\n      if ((e.key === 'Delete' || e.key === 'Backspace') && !typing) {\n        if (selectedNode) {\n          e.preventDefault();\n          removeNode(selectedNode.id);\n        }\n      }\n      if ((e.metaKey || e.ctrlKey) && e.key.toLowerCase() === 'd') {\n        e.preventDefault();\n        if (selectedNode) duplicateSelected();\n      }\n      if ((e.metaKey || e.ctrlKey) && e.key.toLowerCase() === 's') {\n        e.preventDefault();\n        handleSaveFlow();\n      }\n      if ((e.metaKey || e.ctrlKey) && e.key.toLowerCase() === 'l') {\n        e.preventDefault();\n        autoLayout();\n      }\n    };\n    document.addEventListener('keydown', handler);\n    return () => document.removeEventListener('keydown', handler);\n  }, [selectedNode, handleSaveFlow]); // eslint-disable-line\n\n  // node types\n  const nodeTypes = useMemo(() => ({\n    end: EndNode,\n    message: MessageNode,\n    api: ApiNode,\n    code: CodeNode,\n    audience: AudienceNode,\n    delay: DelayNode\n  }), []);\n\n  // ---------- side panel ----------\n  const inputStyle = {\n    width: '100%',\n    border: '1px solid #cbd5e1',\n    borderRadius: 8,\n    padding: '10px 12px'\n  };\n  const small = {\n    fontSize: 12,\n    color: '#475569',\n    marginBottom: 6\n  };\n  const label = t => /*#__PURE__*/_jsxDEV(\"div\", {\n    style: small,\n    children: t\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 583,\n    columnNumber: 24\n  }, this);\n  const panelWrap = {\n    background: '#fff',\n    borderLeft: '1px solid #e5e7eb',\n    height: '100%',\n    padding: 16\n  };\n  const TemplatesOptions = ({\n    value,\n    onChange\n  }) => /*#__PURE__*/_jsxDEV(\"select\", {\n    value: value || '',\n    onChange: e => onChange(e.target.value),\n    style: inputStyle,\n    children: [/*#__PURE__*/_jsxDEV(\"option\", {\n      value: \"\",\n      children: \"\\u2014 none \\u2014\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 589,\n      columnNumber: 7\n    }, this), templates.map(t => /*#__PURE__*/_jsxDEV(\"option\", {\n      value: t.sid,\n      children: t.friendly_name || t.sid\n    }, t.sid, false, {\n      fileName: _jsxFileName,\n      lineNumber: 590,\n      columnNumber: 29\n    }, this))]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 588,\n    columnNumber: 5\n  }, this);\n  const PropertiesPanel = () => {\n    if (!selectedNode) return null;\n    const n = selectedNode;\n    if (n.type === 'message') {\n      var _Object$values$;\n      const d = n.data || {};\n      const found = d.templateSid ? templates.find(t => t.sid === d.templateSid) : null;\n      const firstTypeBody = found ? ((_Object$values$ = Object.values(found.types || {})[0]) === null || _Object$values$ === void 0 ? void 0 : _Object$values$.body) || '' : '';\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        style: panelWrap,\n        children: [label('Label'), /*#__PURE__*/_jsxDEV(\"input\", {\n          style: inputStyle,\n          value: d.label || '',\n          onChange: e => patchNode(n.id, {\n            label: e.target.value\n          })\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 605,\n          columnNumber: 11\n        }, this), label('Canal'), /*#__PURE__*/_jsxDEV(\"select\", {\n          style: inputStyle,\n          value: d.channel || 'whatsapp',\n          onChange: e => patchNode(n.id, {\n            channel: e.target.value\n          }),\n          children: [/*#__PURE__*/_jsxDEV(\"option\", {\n            value: \"whatsapp\",\n            children: \"WhatsApp\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 609,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n            value: \"sms\",\n            children: \"SMS\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 610,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 608,\n          columnNumber: 11\n        }, this), label('Mode'), /*#__PURE__*/_jsxDEV(\"select\", {\n          style: inputStyle,\n          value: d.mode || 'text',\n          onChange: e => patchNode(n.id, {\n            mode: e.target.value\n          }),\n          children: [/*#__PURE__*/_jsxDEV(\"option\", {\n            value: \"text\",\n            children: \"Text\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 615,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n            value: \"rich\",\n            children: \"Rich (text + image + buttons)\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 616,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 614,\n          columnNumber: 11\n        }, this), label('Pick a Twilio template (optional)'), /*#__PURE__*/_jsxDEV(TemplatesOptions, {\n          value: d.templateSid,\n          onChange: val => patchNode(n.id, {\n            templateSid: val\n          })\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 620,\n          columnNumber: 11\n        }, this), found && /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: [label('Template preview'), /*#__PURE__*/_jsxDEV(\"textarea\", {\n            readOnly: true,\n            rows: 6,\n            style: {\n              ...inputStyle,\n              fontFamily: 'monospace'\n            },\n            value: firstTypeBody\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 625,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true), label('Text'), /*#__PURE__*/_jsxDEV(\"textarea\", {\n          rows: 8,\n          style: inputStyle,\n          value: d.text || '',\n          onChange: e => patchNode(n.id, {\n            text: e.target.value\n          }),\n          placeholder: \"Ol\\xE1 {{nome}}!\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 630,\n          columnNumber: 11\n        }, this), d.mode === 'rich' && /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: [label('Media URL'), /*#__PURE__*/_jsxDEV(\"input\", {\n            style: inputStyle,\n            value: d.mediaUrl || '',\n            onChange: e => patchNode(n.id, {\n              mediaUrl: e.target.value\n            }),\n            placeholder: \"https://...\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 635,\n            columnNumber: 15\n          }, this), label('Buttons (JSON opcional)'), /*#__PURE__*/_jsxDEV(\"textarea\", {\n            rows: 6,\n            style: inputStyle,\n            value: d.buttonsJson || '',\n            onChange: e => patchNode(n.id, {\n              buttonsJson: e.target.value\n            }),\n            placeholder: \"[{\\\"type\\\":\\\"reply\\\",\\\"title\\\":\\\"Sim\\\",\\\"id\\\":\\\"YES\\\"}]\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 638,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 603,\n        columnNumber: 9\n      }, this);\n    }\n    if (n.type === 'api') {\n      const d = n.data || {};\n      const tryParse = txt => {\n        try {\n          return JSON.stringify(JSON.parse(txt), null, 2);\n        } catch {\n          return txt;\n        }\n      };\n      const testRequest = async () => {\n        try {\n          const headers = d.headers ? JSON.parse(d.headers) : {};\n          const body = d.method === 'GET' || d.method === 'DELETE' ? undefined : d.body && d.body.trim() !== '{}' ? JSON.parse(d.body) : undefined;\n          const res = await fetch(d.url, {\n            method: d.method || 'GET',\n            headers,\n            body: body ? JSON.stringify(body) : undefined\n          });\n          const text = await res.text();\n          patchNode(n.id, {\n            lastResponse: text\n          });\n          alert('Request executada. Veja a resposta abaixo.');\n        } catch (e) {\n          alert('Falha ao executar request: ' + e.message);\n        }\n      };\n      const addMapping = () => {\n        const m = Array.isArray(d.mappings) ? d.mappings.slice() : [];\n        m.push({\n          path: '',\n          var: ''\n        });\n        patchNode(n.id, {\n          mappings: m\n        });\n      };\n      const updateMap = (idx, patch) => {\n        const m = (d.mappings || []).slice();\n        m[idx] = {\n          ...m[idx],\n          ...patch\n        };\n        patchNode(n.id, {\n          mappings: m\n        });\n      };\n      const removeMap = idx => {\n        const m = (d.mappings || []).slice();\n        m.splice(idx, 1);\n        patchNode(n.id, {\n          mappings: m\n        });\n      };\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        style: panelWrap,\n        children: [label('Label'), /*#__PURE__*/_jsxDEV(\"input\", {\n          style: inputStyle,\n          value: d.label || 'API Call',\n          onChange: e => patchNode(n.id, {\n            label: e.target.value\n          })\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 682,\n          columnNumber: 11\n        }, this), label('Método'), /*#__PURE__*/_jsxDEV(\"select\", {\n          style: inputStyle,\n          value: d.method || 'GET',\n          onChange: e => patchNode(n.id, {\n            method: e.target.value\n          }),\n          children: [/*#__PURE__*/_jsxDEV(\"option\", {\n            children: \"GET\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 686,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n            children: \"POST\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 686,\n            columnNumber: 33\n          }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n            children: \"PUT\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 686,\n            columnNumber: 54\n          }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n            children: \"PATCH\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 686,\n            columnNumber: 74\n          }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n            children: \"DELETE\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 686,\n            columnNumber: 96\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 685,\n          columnNumber: 11\n        }, this), label('URL'), /*#__PURE__*/_jsxDEV(\"input\", {\n          style: inputStyle,\n          placeholder: \"https://api.meuservico.com/...\",\n          value: d.url || '',\n          onChange: e => patchNode(n.id, {\n            url: e.target.value\n          })\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 690,\n          columnNumber: 11\n        }, this), label('Headers (JSON)'), /*#__PURE__*/_jsxDEV(\"textarea\", {\n          rows: 4,\n          style: inputStyle,\n          value: d.headers || '{}',\n          onChange: e => patchNode(n.id, {\n            headers: e.target.value\n          })\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 693,\n          columnNumber: 11\n        }, this), (d.method === 'POST' || d.method === 'PUT' || d.method === 'PATCH') && /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: [label('Body (JSON)'), /*#__PURE__*/_jsxDEV(\"textarea\", {\n            rows: 6,\n            style: inputStyle,\n            value: d.body || '{}',\n            onChange: e => patchNode(n.id, {\n              body: e.target.value\n            })\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 698,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"btn\",\n          onClick: testRequest,\n          style: {\n            marginTop: 10\n          },\n          children: \"Executar request\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 702,\n          columnNumber: 11\n        }, this), label('Resposta (último teste)'), /*#__PURE__*/_jsxDEV(\"textarea\", {\n          rows: 8,\n          style: {\n            ...inputStyle,\n            fontFamily: 'monospace'\n          },\n          readOnly: true,\n          value: tryParse(d.lastResponse || '')\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 705,\n          columnNumber: 11\n        }, this), label('Mapeamentos JSON → Variáveis'), (d.mappings || []).map((m, i) => /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            display: 'grid',\n            gridTemplateColumns: '1fr 1fr auto',\n            gap: 8,\n            marginBottom: 8\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"input\", {\n            style: inputStyle,\n            placeholder: \"ex.: data.user.id\",\n            value: m.path,\n            onChange: e => updateMap(i, {\n              path: e.target.value\n            })\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 710,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            style: inputStyle,\n            placeholder: \"ex.: user_id\",\n            value: m.var,\n            onChange: e => updateMap(i, {\n              var: slug(e.target.value)\n            })\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 711,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"btn danger\",\n            onClick: () => removeMap(i),\n            children: \"x\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 712,\n            columnNumber: 15\n          }, this)]\n        }, i, true, {\n          fileName: _jsxFileName,\n          lineNumber: 709,\n          columnNumber: 13\n        }, this)), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"btn\",\n          onClick: addMapping,\n          children: \"+ adicionar mapeamento\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 715,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 680,\n        columnNumber: 9\n      }, this);\n    }\n    if (n.type === 'code') {\n      const d = n.data || {};\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        style: panelWrap,\n        children: [label('Label'), /*#__PURE__*/_jsxDEV(\"input\", {\n          style: inputStyle,\n          value: d.label || 'Code',\n          onChange: e => patchNode(n.id, {\n            label: e.target.value\n          })\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 725,\n          columnNumber: 11\n        }, this), label('JavaScript'), /*#__PURE__*/_jsxDEV(\"textarea\", {\n          rows: 14,\n          style: {\n            ...inputStyle,\n            fontFamily: 'monospace'\n          },\n          value: d.code || '',\n          onChange: e => patchNode(n.id, {\n            code: e.target.value\n          }),\n          placeholder: `// Recebe \"context\" (variáveis atuais)\\n// deve retornar um objeto com novas variáveis\\nreturn { nova_variavel: 123 };`\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 727,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 723,\n        columnNumber: 9\n      }, this);\n    }\n    if (n.type === 'audience') {\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        style: panelWrap,\n        children: /*#__PURE__*/_jsxDEV(AudiencePanel, {\n          node: n,\n          patchNode: patchNode,\n          inputStyle: inputStyle,\n          label: label,\n          slugFn: slug\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 741,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 740,\n        columnNumber: 9\n      }, this);\n    }\n    if (n.type === 'delay') {\n      var _d$amount;\n      const d = n.data || {};\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        style: panelWrap,\n        children: [label('Label'), /*#__PURE__*/_jsxDEV(\"input\", {\n          style: inputStyle,\n          value: d.label || 'Delay',\n          onChange: e => patchNode(n.id, {\n            label: e.target.value\n          })\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 751,\n          columnNumber: 11\n        }, this), label('Modo'), /*#__PURE__*/_jsxDEV(\"select\", {\n          style: inputStyle,\n          value: d.mode || 'relative',\n          onChange: e => patchNode(n.id, {\n            mode: e.target.value\n          }),\n          children: [/*#__PURE__*/_jsxDEV(\"option\", {\n            value: \"relative\",\n            children: \"Por per\\xEDodo (X unidades)\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 754,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n            value: \"until\",\n            children: \"At\\xE9 data/hora\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 755,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 753,\n          columnNumber: 11\n        }, this), (d.mode || 'relative') === 'relative' ? /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: [label('Quantidade'), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"number\",\n            min: \"1\",\n            step: \"1\",\n            style: inputStyle,\n            value: (_d$amount = d.amount) !== null && _d$amount !== void 0 ? _d$amount : 1,\n            onChange: e => patchNode(n.id, {\n              amount: Math.max(1, parseInt(e.target.value || '1', 10))\n            })\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 761,\n            columnNumber: 15\n          }, this), label('Unidade'), /*#__PURE__*/_jsxDEV(\"select\", {\n            style: inputStyle,\n            value: d.unit || 'hours',\n            onChange: e => patchNode(n.id, {\n              unit: e.target.value\n            }),\n            children: [/*#__PURE__*/_jsxDEV(\"option\", {\n              value: \"seconds\",\n              children: \"segundos\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 766,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n              value: \"minutes\",\n              children: \"minutos\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 767,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n              value: \"hours\",\n              children: \"horas\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 768,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n              value: \"days\",\n              children: \"dias\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 769,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n              value: \"weeks\",\n              children: \"semanas\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 770,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n              value: \"months\",\n              children: \"meses\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 771,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 765,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true) : /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: [label('Executar após (data/hora)'), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"datetime-local\",\n            style: inputStyle,\n            value: d.untilLocal || '',\n            onChange: e => {\n              const local = e.target.value;\n              let iso = '';\n              try {\n                iso = new Date(local).toISOString();\n              } catch {}\n              patchNode(n.id, {\n                untilLocal: local,\n                until: iso\n              });\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 777,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              fontSize: 12,\n              color: '#64748b'\n            },\n            children: [\"Ser\\xE1 convertido para UTC ao salvar. ISO: \", /*#__PURE__*/_jsxDEV(\"code\", {\n              children: d.until || '—'\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 789,\n              columnNumber: 58\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 788,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 749,\n        columnNumber: 9\n      }, this);\n    }\n    if (n.type === 'end') {\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        style: panelWrap,\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            fontSize: 12,\n            color: '#64748b'\n          },\n          children: \"N\\xF3 terminal. Sem propriedades.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 798,\n          columnNumber: 37\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 798,\n        columnNumber: 14\n      }, this);\n    }\n    return null;\n  };\n\n  // UI styles\n  const chip = {\n    padding: '6px 10px',\n    border: '1px solid #c7d2fe',\n    background: '#eef2ff',\n    color: '#1e3a8a',\n    borderRadius: 8,\n    fontSize: 12,\n    cursor: 'grab',\n    userSelect: 'none'\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      height: 'calc(100vh - 80px)',\n      position: 'relative'\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        display: 'flex',\n        gap: 8,\n        padding: 12,\n        alignItems: 'center',\n        border: '1px solid #e5e7eb',\n        borderRadius: 12,\n        marginBottom: 8,\n        background: '#fff'\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"btn\",\n        onClick: () => window.location.href = '/journeys',\n        children: \"\\u2190 Voltar p/ lista\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 816,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          marginLeft: 12,\n          display: 'flex',\n          alignItems: 'center',\n          gap: 8\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"span\", {\n          style: {\n            fontSize: 12,\n            color: '#64748b'\n          },\n          children: \"Arraste para o canvas:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 819,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: chip,\n          draggable: true,\n          onDragStart: e => onDragStart(e, 'message'),\n          children: \"Mensagem\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 820,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: chip,\n          draggable: true,\n          onDragStart: e => onDragStart(e, 'api'),\n          children: \"API\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 821,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: chip,\n          draggable: true,\n          onDragStart: e => onDragStart(e, 'code'),\n          children: \"Code\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 822,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: chip,\n          draggable: true,\n          onDragStart: e => onDragStart(e, 'audience'),\n          children: \"Audi\\xEAncia\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 823,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: chip,\n          draggable: true,\n          onDragStart: e => onDragStart(e, 'delay'),\n          children: \"Delay\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 824,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: chip,\n          draggable: true,\n          onDragStart: e => onDragStart(e, 'end'),\n          children: \"End\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 825,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 818,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          marginLeft: 'auto',\n          display: 'flex',\n          gap: 8,\n          alignItems: 'center'\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"input\", {\n          value: flowName,\n          onChange: e => setFlowName(e.target.value),\n          placeholder: \"Nome do flow\",\n          style: {\n            border: '1px solid #e5e7eb',\n            borderRadius: 8,\n            padding: '8px 10px',\n            width: 220\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 829,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"btn\",\n          onClick: autoLayout,\n          title: \"\\u2318/Ctrl + L\",\n          children: \"Auto-layout\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 835,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"btn\",\n          onClick: onImportClick,\n          children: \"Importar\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 836,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"btn\",\n          onClick: onExport,\n          children: \"Exportar\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 837,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"btn\",\n          onClick: handleSaveFlow,\n          title: \"\\u2318/Ctrl + S\",\n          children: \"Salvar flow\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 838,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 828,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        ref: fileRef,\n        type: \"file\",\n        accept: \"application/json\",\n        onChange: onImportFile,\n        style: {\n          display: 'none'\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 840,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 811,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      ref: wrapperRef,\n      style: {\n        height: 'calc(100% - 60px)',\n        position: 'relative',\n        border: '1px solid #e5e7eb',\n        borderRadius: 12,\n        overflow: 'hidden'\n      },\n      children: [/*#__PURE__*/_jsxDEV(ReactFlow, {\n        nodes: nodes,\n        edges: edges,\n        nodeTypes: nodeTypes,\n        onNodesChange: onNodesChange,\n        onEdgesChange: onEdgesChange,\n        onConnect: onConnect,\n        onSelectionChange: onSelectionChange,\n        onInit: setRfInstance,\n        onDragOver: onDragOver,\n        onDrop: onDrop,\n        onNodeContextMenu: onNodeContextMenu,\n        onPaneClick: () => {\n          setSelectedId(null);\n          closeCtx();\n        },\n        panOnScroll: true,\n        zoomOnDoubleClick: false,\n        snapToGrid: true,\n        snapGrid: SNAP,\n        fitView: true,\n        children: [/*#__PURE__*/_jsxDEV(MiniMap, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 864,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Controls, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 865,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Background, {\n          gap: 16\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 866,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 845,\n        columnNumber: 9\n      }, this), ctx.open && /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          position: 'fixed',\n          top: ctx.y,\n          left: ctx.x,\n          background: '#fff',\n          border: '1px solid #e5e7eb',\n          borderRadius: 8,\n          boxShadow: '0 6px 20px rgba(0,0,0,.12)',\n          zIndex: 50,\n          minWidth: 180,\n          overflow: 'hidden'\n        },\n        onMouseLeave: closeCtx,\n        children: [/*#__PURE__*/_jsxDEV(MenuItem, {\n          onClick: renameCtx,\n          children: \"Renomear n\\xF3\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 886,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(MenuItem, {\n          onClick: duplicateCtx,\n          children: \"Copiar (duplicar)\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 887,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(MenuItem, {\n          onClick: resetCtx,\n          children: \"Redefinir\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 888,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(MenuItem, {\n          danger: true,\n          onClick: deleteCtx,\n          children: \"Apagar\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 889,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 871,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          position: 'absolute',\n          top: 0,\n          right: 0,\n          width: 360,\n          height: '100%',\n          background: '#fff',\n          borderLeft: '1px solid #e5e7eb',\n          transform: showSide ? 'translateX(0)' : 'translateX(100%)',\n          transition: 'transform 220ms ease',\n          zIndex: 40,\n          boxShadow: showSide ? '-8px 0 24px rgba(0,0,0,.05)' : 'none'\n        },\n        children: showSide && /*#__PURE__*/_jsxDEV(PropertiesPanel, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 909,\n          columnNumber: 24\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 894,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 844,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 809,\n    columnNumber: 5\n  }, this);\n}\n\n// pequeno componente de item do menu\n_s2(JourneyBuilder, \"oxWW0RYtyNJdCXMc9uFXzNA3NGs=\", false, function () {\n  return [useNodesState, useEdgesState];\n});\n_c9 = JourneyBuilder;\nfunction MenuItem({\n  children,\n  onClick,\n  danger\n}) {\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    onClick: onClick,\n    style: {\n      padding: '10px 12px',\n      cursor: 'pointer',\n      fontSize: 14,\n      color: danger ? '#b91c1c' : '#0f172a',\n      borderBottom: '1px solid #f3f4f6',\n      userSelect: 'none'\n    },\n    onMouseDown: e => e.preventDefault(),\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 919,\n    columnNumber: 5\n  }, this);\n}\n_c0 = MenuItem;\nvar _c, _c2, _c3, _c4, _c5, _c6, _c7, _c8, _c9, _c0;\n$RefreshReg$(_c, \"NodeShell\");\n$RefreshReg$(_c2, \"EndNode\");\n$RefreshReg$(_c3, \"MessageNode\");\n$RefreshReg$(_c4, \"ApiNode\");\n$RefreshReg$(_c5, \"CodeNode\");\n$RefreshReg$(_c6, \"AudienceNode\");\n$RefreshReg$(_c7, \"DelayNode\");\n$RefreshReg$(_c8, \"AudiencePanel\");\n$RefreshReg$(_c9, \"JourneyBuilder\");\n$RefreshReg$(_c0, \"MenuItem\");","map":{"version":3,"names":["React","useCallback","useEffect","useMemo","useRef","useState","ReactFlow","Background","Controls","MiniMap","addEdge","useEdgesState","useNodesState","MarkerType","Handle","Position","Papa","saveAs","jsxDEV","_jsxDEV","Fragment","_Fragment","PIN_SIZE","DND_TYPE","SNAP","uid","p","Date","now","Math","floor","random","slug","s","String","trim","toLowerCase","replace","defaultDataForType","type","label","channel","mode","text","method","url","headers","body","mappings","lastResponse","code","rows","mapping","phoneKey","amount","unit","until","untilLocal","NodeShell","title","subtitle","selected","children","style","background","border","borderRadius","width","boxShadow","padding","borderBottom","fontWeight","color","fileName","_jsxFileName","lineNumber","columnNumber","fontSize","_c","EndNode","position","Left","id","height","_c2","MessageNode","data","toUpperCase","Right","_c3","ApiNode","_c4","CodeNode","_c5","AudienceNode","_c6","DelayNode","_data$amount","toLocaleString","_c7","AudiencePanel","node","patchNode","inputStyle","slugFn","_s","d","setHeaders","setRows","setMapping","setPhoneKey","onFile","e","_e$target$files","f","target","files","parse","header","skipEmptyLines","complete","res","hs","meta","fields","Object","keys","guess","forEach","h","pk","find","test","slice","saveMap","alert","accept","onChange","length","value","map","display","gridTemplateColumns","gap","maxHeight","overflow","alignSelf","textAlign","placeholder","m","className","onClick","marginTop","JSON","stringify","_c8","JourneyBuilder","_s2","nodes","setNodes","onNodesChange","x","y","selectable","edges","setEdges","onEdgesChange","nodesRef","current","flowId","setFlowId","flowName","setFlowName","sp","URLSearchParams","window","location","search","get","fetch","then","r","ok","json","Promise","reject","Array","isArray","name","catch","raw","localStorage","getItem","selectedId","setSelectedId","selectedNode","n","showSide","Boolean","templates","setTemplates","contents","patch","nds","onConnect","params","eds","filtered","filter","source","stroke","markerEnd","ArrowClosed","onSelectionChange","ns","_ns$0$id","_ns$","addNodeOfType","concat","audience","hasAudienceOut","some","sourceHandle","duplicateSelected","removeNode","handleSaveFlow","entered","prompt","payload","updatedAt","toISOString","Error","saved","history","replaceState","setItem","fileRef","onImportClick","_fileRef$current","click","onImportFile","_e$target$files2","reader","FileReader","onload","result","err","message","readAsText","onExport","exportedAt","blob","Blob","wrapperRef","rfInstance","setRfInstance","onDragStart","event","nodeType","dataTransfer","setData","effectAllowed","onDragOver","preventDefault","dropEffect","onDrop","getData","bounds","getBoundingClientRect","project","clientX","left","clientY","top","ctx","setCtx","open","nodeId","onNodeContextMenu","evt","closeCtx","renameCtx","_n$data","curr","duplicateCtx","copy","resetCtx","deleteCtx","autoLayout","nm","Map","indeg","has","push","set","audiences","starts","level","q","cur","shift","L","t","byLevel","DX","DY","X0","Y0","newNodes","siblings","idx","indexOf","handler","tag","tagName","typing","isContentEditable","key","metaKey","ctrlKey","document","addEventListener","removeEventListener","nodeTypes","end","api","delay","small","marginBottom","panelWrap","borderLeft","TemplatesOptions","sid","friendly_name","PropertiesPanel","_Object$values$","found","templateSid","firstTypeBody","values","types","val","readOnly","fontFamily","mediaUrl","buttonsJson","tryParse","txt","testRequest","undefined","addMapping","path","var","updateMap","removeMap","splice","i","_d$amount","min","step","max","parseInt","local","iso","chip","cursor","userSelect","alignItems","href","marginLeft","draggable","ref","onInit","onPaneClick","panOnScroll","zoomOnDoubleClick","snapToGrid","snapGrid","fitView","zIndex","minWidth","onMouseLeave","MenuItem","danger","right","transform","transition","_c9","onMouseDown","_c0","$RefreshReg$"],"sources":["/Users/gustsantos/Desktop/initucastt/frontend/src/pages/JourneyBuilder.jsx"],"sourcesContent":["// frontend/src/pages/JourneyBuilder.jsx\nimport React, { useCallback, useEffect, useMemo, useRef, useState } from 'react';\nimport ReactFlow, {\n  Background,\n  Controls,\n  MiniMap,\n  addEdge,\n  useEdgesState,\n  useNodesState,\n  MarkerType,\n  Handle,\n  Position,\n} from 'reactflow';\nimport 'reactflow/dist/style.css';\nimport Papa from 'papaparse';\nimport { saveAs } from 'file-saver';\n\nconst PIN_SIZE = 14;\nconst DND_TYPE = 'application/reactflow';\nconst SNAP = [16, 16];\n\n// ---------- helpers ----------\nconst uid = (p) => `${p}_${Date.now()}_${Math.floor(Math.random() * 9999)}`;\nconst slug = (s) =>\n  String(s || '')\n    .trim()\n    .toLowerCase()\n    .replace(/\\s+/g, '_')\n    .replace(/[^\\w]/g, '_')\n    .replace(/_+/g, '_');\n\nconst defaultDataForType = (type) => {\n  switch (type) {\n    case 'message':\n      return { label: 'Mensagem', channel: 'whatsapp', mode: 'text', text: '' };\n    case 'api':\n      return { label: 'API Call', method: 'GET', url: '', headers: '{}', body: '{}', mappings: [], lastResponse: '' };\n    case 'code':\n      return { label: 'Code', code: '// return { nova_variavel: 123 };' };\n    case 'audience':\n      return { headers: [], rows: [], mapping: {}, phoneKey: '' };\n    case 'delay':\n      return { label: 'Delay', mode: 'relative', amount: 1, unit: 'hours', until: '', untilLocal: '' };\n    case 'end':\n      return {};\n    default:\n      return {};\n  }\n};\n\n// ---------- node shells ----------\nconst NodeShell = ({ title, subtitle, selected, children }) => (\n  <div\n    style={{\n      background: '#fff',\n      border: selected ? '2px solid #2563eb' : '1px solid #e5e7eb',\n      borderRadius: 12,\n      width: 320,\n      boxShadow: '0 2px 8px rgba(0,0,0,.06)',\n    }}\n  >\n    <div style={{ padding: '12px 14px', borderBottom: '1px solid #f1f5f9' }}>\n      <div style={{ fontWeight: 700, color: '#0f172a' }}>{title}</div>\n      {subtitle ? <div style={{ fontSize: 12, color: '#64748b' }}>{subtitle}</div> : null}\n    </div>\n    <div style={{ padding: 12 }}>{children}</div>\n  </div>\n);\n\nconst EndNode = ({ selected }) => (\n  <NodeShell title=\"End\" subtitle=\"término do fluxo\" selected={selected}>\n    <div style={{ fontSize: 12, color: '#475569' }}>Nó terminal. Só recebe conexões.</div>\n    <Handle type=\"target\" position={Position.Left} id=\"in\"\n      style={{ background: '#6b7280', width: PIN_SIZE, height: PIN_SIZE, border: '2px solid #fff' }} />\n  </NodeShell>\n);\n\nconst MessageNode = ({ data, selected }) => (\n  <NodeShell\n    title={data.label || 'Mensagem'}\n    subtitle={`Canal: ${String(data.channel || 'whatsapp').toUpperCase()} • Tipo: ${data.mode || 'text'}`}\n    selected={selected}\n  >\n    <div style={{ fontSize: 12, color: '#475569' }}>Conteúdo configurável no painel ao lado.</div>\n    <Handle type=\"target\" position={Position.Left} id=\"in\"\n      style={{ background: '#6b7280', width: PIN_SIZE, height: PIN_SIZE, border: '2px solid #fff' }} />\n    <Handle type=\"source\" position={Position.Right} id=\"out\"\n      style={{ background: '#16a34a', width: PIN_SIZE, height: PIN_SIZE, border: '2px solid #fff' }} />\n  </NodeShell>\n);\n\nconst ApiNode = ({ selected }) => (\n  <NodeShell title=\"API Call\" selected={selected}>\n    <div style={{ fontSize: 12, color: '#475569' }}>\n      Configure método/URL no painel ao lado. Salva variáveis via mapeamentos.\n    </div>\n    <Handle type=\"target\" position={Position.Left} id=\"in\"\n      style={{ background: '#6b7280', width: PIN_SIZE, height: PIN_SIZE, border: '2px solid #fff' }} />\n    <Handle type=\"source\" position={Position.Right} id=\"out\"\n      style={{ background: '#16a34a', width: PIN_SIZE, height: PIN_SIZE, border: '2px solid #fff' }} />\n  </NodeShell>\n);\n\nconst CodeNode = ({ selected }) => (\n  <NodeShell title=\"Code\" subtitle=\"JS custom\" selected={selected}>\n    <div style={{ fontSize: 12, color: '#475569' }}>Cole seu JS no painel ao lado. Deve retornar um objeto de variáveis.</div>\n    <Handle type=\"target\" position={Position.Left} id=\"in\"\n      style={{ background: '#6b7280', width: PIN_SIZE, height: PIN_SIZE, border: '2px solid #fff' }} />\n    <Handle type=\"source\" position={Position.Right} id=\"out\"\n      style={{ background: '#16a34a', width: PIN_SIZE, height: PIN_SIZE, border: '2px solid #fff' }} />\n  </NodeShell>\n);\n\nconst AudienceNode = ({ selected }) => (\n  <NodeShell title=\"Audiência\" subtitle=\"CSV → variáveis\" selected={selected}>\n    <div style={{ fontSize: 12, color: '#475569' }}>Faça upload e mapeie colunas no painel ao lado.</div>\n    <Handle type=\"source\" position={Position.Right} id=\"out\"\n      style={{ background: '#16a34a', width: PIN_SIZE, height: PIN_SIZE, border: '2px solid #fff' }} />\n  </NodeShell>\n);\n\nconst DelayNode = ({ data = {}, selected }) => {\n  const subtitle =\n    data.mode === 'until'\n      ? `até ${data.until ? new Date(data.until).toLocaleString() : '—'}`\n      : `+ ${(data.amount ?? 1)} ${data.unit || 'hours'}`;\n  return (\n    <NodeShell title=\"Delay\" subtitle={subtitle} selected={selected}>\n      <div style={{ fontSize: 12, color: '#475569' }}>Espera antes de seguir para o próximo nó.</div>\n      <Handle type=\"target\" position={Position.Left} id=\"in\"\n        style={{ background: '#6b7280', width: PIN_SIZE, height: PIN_SIZE, border: '2px solid #fff' }} />\n      <Handle type=\"source\" position={Position.Right} id=\"out\"\n        style={{ background: '#16a34a', width: PIN_SIZE, height: PIN_SIZE, border: '2px solid #fff' }} />\n    </NodeShell>\n  );\n};\n\n// ---------- side panel widgets ----------\nfunction AudiencePanel({ node, patchNode, inputStyle, label, slugFn }) {\n  const d = node.data || {};\n  const [headers, setHeaders] = useState(d.headers || []);\n  const [rows, setRows] = useState(d.rows || []);\n  const [mapping, setMapping] = useState(d.mapping || {});\n  const [phoneKey, setPhoneKey] = useState(d.phoneKey || '');\n\n  useEffect(() => {\n    setHeaders(d.headers || []);\n    setRows(d.rows || []);\n    setMapping(d.mapping || {});\n    setPhoneKey(d.phoneKey || '');\n  }, [node.id]);\n\n  const onFile = (e) => {\n    const f = e.target.files?.[0];\n    if (!f) return;\n    Papa.parse(f, {\n      header: true,\n      skipEmptyLines: true,\n      complete: (res) => {\n        const hs = res.meta.fields || Object.keys(res.data[0] || {});\n        const guess = {};\n        hs.forEach((h) => (guess[h] = slugFn(h)));\n        const pk = hs.find((h) => /phone|telefone|celular|numero|n[uú]mero/i.test(h)) || '';\n        setHeaders(hs);\n        setRows(res.data.slice(0, 5));\n        setMapping(guess);\n        setPhoneKey(pk);\n      },\n    });\n  };\n\n  const saveMap = () => {\n    if (!phoneKey) {\n      alert('Escolha a coluna de telefone.');\n      return;\n    }\n    patchNode(node.id, { headers, rows, mapping, phoneKey });\n    alert('Mapeamento salvo.');\n  };\n\n  return (\n    <>\n      {label('Arquivo CSV')}\n      <input type=\"file\" accept=\".csv\" onChange={onFile} />\n\n      {headers.length > 0 && (\n        <>\n          {label('Coluna de telefone')}\n          <select style={inputStyle} value={phoneKey} onChange={(e) => setPhoneKey(e.target.value)}>\n            <option value=\"\">— selecione —</option>\n            {headers.map((h) => <option key={h} value={h}>{h}</option>)}\n          </select>\n\n          {label('Mapeamento (coluna → variável)')}\n          <div style={{ display: 'grid', gridTemplateColumns: '1fr 20px 1fr', gap: 8, maxHeight: 200, overflow: 'auto' }}>\n            {headers.map((h) => (\n              <React.Fragment key={h}>\n                <div style={{ alignSelf: 'center', fontSize: 13 }}>{h}</div>\n                <div style={{ textAlign: 'center', color: '#94a3b8' }}>→</div>\n                <input\n                  style={inputStyle}\n                  value={mapping[h] || ''}\n                  placeholder={slugFn(h)}\n                  onChange={(e) => setMapping((m) => ({ ...m, [h]: slugFn(e.target.value) }))}\n                />\n              </React.Fragment>\n            ))}\n          </div>\n\n          <button className=\"btn\" onClick={saveMap} style={{ marginTop: 10 }}>Salvar mapeamento</button>\n\n          {rows.length > 0 && (\n            <>\n              {label('Amostra (5 primeiras linhas)')}\n              <pre style={{\n                background: '#f8fafc', border: '1px solid #e2e8f0', borderRadius: 8,\n                padding: 10, fontSize: 12, maxHeight: 160, overflow: 'auto',\n              }}>\n                {JSON.stringify(rows, null, 2)}\n              </pre>\n            </>\n          )}\n          <div style={{ fontSize: 12, color: '#64748b', marginTop: 8 }}>\n            Dica: após salvar, use as variáveis com <code>{'{{minha_variavel}}'}</code>.\n          </div>\n        </>\n      )}\n    </>\n  );\n}\n\n// ---------- main page ----------\nexport default function JourneyBuilder() {\n  // audience inicial (sem Start)\n  const [nodes, setNodes, onNodesChange] = useNodesState([\n    {\n      id: 'audience_start',\n      type: 'audience',\n      position: { x: 140, y: 180 },\n      data: defaultDataForType('audience'),\n      selectable: true,\n    },\n  ]);\n  const [edges, setEdges, onEdgesChange] = useEdgesState([]);\n\n  const nodesRef = useRef(nodes);\n  useEffect(() => { nodesRef.current = nodes; }, [nodes]);\n\n  // flow id & name\n  const [flowId, setFlowId] = useState(null);\n  const [flowName, setFlowName] = useState('Novo Flow');\n\n  useEffect(() => {\n    const sp = new URLSearchParams(window.location.search);\n    const id = sp.get('id');\n    if (!id) return;\n    setFlowId(id);\n\n    fetch(`/api/journeys/${id}`)\n      .then((r) => (r.ok ? r.json() : Promise.reject()))\n      .then((f) => {\n        if (Array.isArray(f.nodes) && Array.isArray(f.edges)) {\n          setNodes(f.nodes);\n          setEdges(f.edges);\n          if (f.name) setFlowName(f.name);\n        }\n      })\n      .catch(() => {\n        const raw = localStorage.getItem(id);\n        if (raw) {\n          try {\n            const f = JSON.parse(raw);\n            if (Array.isArray(f.nodes) && Array.isArray(f.edges)) {\n              setNodes(f.nodes);\n              setEdges(f.edges);\n              if (f.name) setFlowName(f.name);\n            }\n          } catch {}\n        }\n      });\n  }, [setEdges, setNodes]);\n\n  // seleção & drawer\n  const [selectedId, setSelectedId] = useState(null);\n  const selectedNode = useMemo(() => nodes.find((n) => n.id === selectedId), [nodes, selectedId]);\n  const showSide = Boolean(selectedNode);\n\n  // templates Twilio\n  const [templates, setTemplates] = useState([]);\n  useEffect(() => {\n    fetch('/api/templates/list')\n      .then((r) => r.json())\n      .then((data) => setTemplates(data.contents || []))\n      .catch(() => setTemplates([]));\n  }, []);\n\n  // patch helper\n  const patchNode = useCallback((id, patch) => {\n    setNodes((nds) => nds.map((n) => (n.id === id ? { ...n, data: { ...n.data, ...patch } } : n)));\n  }, [setNodes]);\n\n  // 1 saída por nó\n  const onConnect = useCallback((params) => {\n    setEdges((eds) => {\n      const filtered = eds.filter((e) => e.source !== params.source);\n      return addEdge({\n        ...params,\n        type: 'smoothstep',\n        style: { stroke: '#0f172a' },\n        markerEnd: { type: MarkerType.ArrowClosed, color: '#0f172a' },\n      }, filtered);\n    });\n  }, [setEdges]);\n\n  const onSelectionChange = useCallback(({ nodes: ns }) => {\n    setSelectedId(ns?.[0]?.id ?? null);\n  }, []);\n\n  // criar nós (usado pelo DnD)\n  const addNodeOfType = (type, position = { x: 360, y: 240 }) => {\n    const id = uid(type);\n    setNodes((nds) => nds.concat({ id, type, position, data: defaultDataForType(type) }));\n\n    // auto-conecta Audiência -> novo nó se a audiência ainda não tem saída\n    setEdges((eds) => {\n      const audience = nodesRef.current.find((n) => n.type === 'audience');\n      const hasAudienceOut = audience ? eds.some((e) => e.source === audience.id) : false;\n      if (audience && !hasAudienceOut && type !== 'audience') {\n        return addEdge({\n          id: uid('e'),\n          source: audience.id,\n          sourceHandle: 'out',\n          target: id,\n          type: 'smoothstep',\n          style: { stroke: '#0f172a' },\n          markerEnd: { type: MarkerType.ArrowClosed, color: '#0f172a' },\n        }, eds);\n      }\n      return eds;\n    });\n  };\n\n  const duplicateSelected = () => {\n    if (!selectedNode) return;\n    const id = uid(selectedNode.type);\n    setNodes((nds) => nds.concat({\n      ...selectedNode,\n      id,\n      position: { x: selectedNode.position.x + 40, y: selectedNode.position.y + 40 },\n      selected: false,\n    }));\n  };\n\n  const removeNode = (id) => {\n    setEdges((eds) => eds.filter((e) => e.source !== id && e.target !== id));\n    setNodes((nds) => nds.filter((n) => n.id !== id));\n    if (selectedId === id) setSelectedId(null);\n  };\n\n  // salvar flow\n  const handleSaveFlow = async () => {\n    let name = flowName || 'Novo Flow';\n    if (!flowId && (!name || name === 'Novo Flow')) {\n      const entered = window.prompt('Dê um nome para este flow:', name);\n      if (entered && entered.trim()) {\n        name = entered.trim();\n        setFlowName(name);\n      }\n    }\n    const payload = { id: flowId || 'flow_' + Date.now(), name, nodes, edges, updatedAt: new Date().toISOString() };\n\n    try {\n      const url = flowId ? `/api/journeys/${flowId}` : '/api/journeys';\n      const method = flowId ? 'PUT' : 'POST';\n      const res = await fetch(url, { method, headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });\n      if (!res.ok) throw new Error('no backend');\n      const saved = await res.json();\n      alert('Flow salvo no backend!');\n      if (!flowId && saved?.id) {\n        window.history.replaceState(null, '', `/journeys/builder?id=${saved.id}`);\n        setFlowId(saved.id);\n      }\n    } catch {\n      localStorage.setItem(payload.id, JSON.stringify(payload));\n      alert('Flow salvo no navegador.');\n      if (!flowId) {\n        window.history.replaceState(null, '', `/journeys/builder?id=${payload.id}`);\n        setFlowId(payload.id);\n      }\n    }\n  };\n\n  // import/export\n  const fileRef = useRef(null);\n  const onImportClick = () => fileRef.current?.click();\n  const onImportFile = (e) => {\n    const f = e.target.files?.[0];\n    if (!f) return;\n    const reader = new FileReader();\n    reader.onload = () => {\n      try {\n        const json = JSON.parse(String(reader.result || '{}'));\n        if (Array.isArray(json.nodes) && Array.isArray(json.edges)) {\n          setNodes(json.nodes);\n          setEdges(json.edges);\n          if (json.id) setFlowId(json.id);\n          if (json.name) setFlowName(json.name);\n          alert('Flow importado.');\n        } else {\n          alert('Arquivo inválido.');\n        }\n      } catch (err) {\n        alert('Falha ao importar: ' + (err?.message || 'erro'));\n      }\n    };\n    reader.readAsText(f);\n    e.target.value = '';\n  };\n\n  const onExport = () => {\n    const data = { id: flowId || 'flow_unsaved', name: flowName || 'Novo Flow', nodes, edges, exportedAt: new Date().toISOString() };\n    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json;charset=utf-8' });\n    saveAs(blob, `${slug(data.name || 'flow')}.json`);\n  };\n\n  // ---- Drag & Drop (palette → canvas) ----\n  const wrapperRef = useRef(null);\n  const [rfInstance, setRfInstance] = useState(null);\n\n  const onDragStart = (event, nodeType) => {\n    event.dataTransfer.setData(DND_TYPE, nodeType);\n    event.dataTransfer.effectAllowed = 'move';\n  };\n  const onDragOver = useCallback((event) => {\n    event.preventDefault();\n    event.dataTransfer.dropEffect = 'move';\n  }, []);\n  const onDrop = useCallback((event) => {\n    event.preventDefault();\n    const type = event.dataTransfer.getData(DND_TYPE);\n    if (!type || !rfInstance || !wrapperRef.current) return;\n    const bounds = wrapperRef.current.getBoundingClientRect();\n    const position = rfInstance.project({ x: event.clientX - bounds.left, y: event.clientY - bounds.top });\n    addNodeOfType(type, position);\n  }, [rfInstance]);\n\n  // ---- Context Menu (right-click no nó) ----\n  const [ctx, setCtx] = useState({ open: false, x: 0, y: 0, nodeId: null, nodeType: null });\n  const onNodeContextMenu = (evt, node) => {\n    evt.preventDefault();\n    setSelectedId(node.id);\n    setCtx({ open: true, x: evt.clientX, y: evt.clientY, nodeId: node.id, nodeType: node.type });\n  };\n  const closeCtx = () => setCtx({ open: false, x: 0, y: 0, nodeId: null, nodeType: null });\n\n  const renameCtx = () => {\n    const n = nodes.find((x) => x.id === ctx.nodeId);\n    if (!n) return;\n    const curr = n.data?.label || '';\n    const name = window.prompt('Novo nome do nó:', curr);\n    if (name !== null) patchNode(n.id, { label: name });\n    closeCtx();\n  };\n  const duplicateCtx = () => {\n    const n = nodes.find((x) => x.id === ctx.nodeId);\n    if (n) {\n      const copy = { ...n, id: uid(n.type), position: { x: n.position.x + 40, y: n.position.y + 40 }, selected: false };\n      setNodes((nds) => nds.concat(copy));\n    }\n    closeCtx();\n  };\n  const resetCtx = () => {\n    const n = nodes.find((x) => x.id === ctx.nodeId);\n    if (n) patchNode(n.id, defaultDataForType(n.type));\n    closeCtx();\n  };\n  const deleteCtx = () => {\n    if (ctx.nodeId) removeNode(ctx.nodeId);\n    closeCtx();\n  };\n\n  // ---- Auto-layout (horizontal por níveis) ----\n  const autoLayout = () => {\n    const nm = new Map(nodes.map((n) => [n.id, n]));\n    const children = new Map(nodes.map((n) => [n.id, []]));\n    const indeg = new Map(nodes.map((n) => [n.id, 0]));\n\n    edges.forEach((e) => {\n      if (children.has(e.source)) children.get(e.source).push(e.target);\n      if (indeg.has(e.target)) indeg.set(e.target, (indeg.get(e.target) || 0) + 1);\n    });\n\n    // nós de entrada (preferindo audiência)\n    const audiences = nodes.filter((n) => n.type === 'audience');\n    let starts = audiences.filter((n) => (indeg.get(n.id) || 0) === 0);\n    if (starts.length === 0) starts = audiences.length ? [audiences[0]] : nodes.filter((n) => (indeg.get(n.id) || 0) === 0);\n    if (starts.length === 0 && nodes.length) starts = [nodes[0]];\n\n    const level = new Map();\n    const q = [...starts];\n    starts.forEach((s) => level.set(s.id, 0));\n\n    while (q.length) {\n      const cur = q.shift();\n      const L = level.get(cur.id) || 0;\n      (children.get(cur.id) || []).forEach((t) => {\n        if (!level.has(t)) {\n          level.set(t, L + 1);\n          q.push(nm.get(t));\n        }\n      });\n    }\n\n    // coloca não visitados também\n    nodes.forEach((n) => {\n      if (!level.has(n.id)) level.set(n.id, 0);\n    });\n\n    const byLevel = {};\n    nodes.forEach((n) => {\n      const L = level.get(n.id) || 0;\n      if (!byLevel[L]) byLevel[L] = [];\n      byLevel[L].push(n.id);\n    });\n\n    const DX = 360, DY = 150, X0 = 140, Y0 = 150;\n    const newNodes = nodes.map((n) => {\n      const L = level.get(n.id) || 0;\n      const siblings = byLevel[L] || [];\n      const idx = siblings.indexOf(n.id);\n      return {\n        ...n,\n        position: { x: X0 + L * DX, y: Y0 + idx * DY },\n      };\n    });\n\n    setNodes(newNodes);\n  };\n\n  // ---- atalhos de teclado ----\n  useEffect(() => {\n    const handler = (e) => {\n      const target = e.target;\n      const tag = (target && target.tagName) || '';\n      const typing = tag === 'INPUT' || tag === 'TEXTAREA' || target?.isContentEditable;\n\n      if ((e.key === 'Delete' || e.key === 'Backspace') && !typing) {\n        if (selectedNode) {\n          e.preventDefault();\n          removeNode(selectedNode.id);\n        }\n      }\n      if ((e.metaKey || e.ctrlKey) && e.key.toLowerCase() === 'd') {\n        e.preventDefault();\n        if (selectedNode) duplicateSelected();\n      }\n      if ((e.metaKey || e.ctrlKey) && e.key.toLowerCase() === 's') {\n        e.preventDefault();\n        handleSaveFlow();\n      }\n      if ((e.metaKey || e.ctrlKey) && e.key.toLowerCase() === 'l') {\n        e.preventDefault();\n        autoLayout();\n      }\n    };\n    document.addEventListener('keydown', handler);\n    return () => document.removeEventListener('keydown', handler);\n  }, [selectedNode, handleSaveFlow]); // eslint-disable-line\n\n  // node types\n  const nodeTypes = useMemo(() => ({\n    end: EndNode,\n    message: MessageNode,\n    api: ApiNode,\n    code: CodeNode,\n    audience: AudienceNode,\n    delay: DelayNode,\n  }), []);\n\n  // ---------- side panel ----------\n  const inputStyle = { width: '100%', border: '1px solid #cbd5e1', borderRadius: 8, padding: '10px 12px' };\n  const small = { fontSize: 12, color: '#475569', marginBottom: 6 };\n  const label = (t) => <div style={small}>{t}</div>;\n\n  const panelWrap = { background: '#fff', borderLeft: '1px solid #e5e7eb', height: '100%', padding: 16 };\n\n  const TemplatesOptions = ({ value, onChange }) => (\n    <select value={value || ''} onChange={(e) => onChange(e.target.value)} style={inputStyle}>\n      <option value=\"\">— none —</option>\n      {templates.map((t) => <option key={t.sid} value={t.sid}>{t.friendly_name || t.sid}</option>)}\n    </select>\n  );\n\n  const PropertiesPanel = () => {\n    if (!selectedNode) return null;\n    const n = selectedNode;\n\n    if (n.type === 'message') {\n      const d = n.data || {};\n      const found = d.templateSid ? templates.find((t) => t.sid === d.templateSid) : null;\n      const firstTypeBody = found ? (Object.values(found.types || {})[0]?.body || '') : '';\n      return (\n        <div style={panelWrap}>\n          {label('Label')}\n          <input style={inputStyle} value={d.label || ''} onChange={(e) => patchNode(n.id, { label: e.target.value })} />\n\n          {label('Canal')}\n          <select style={inputStyle} value={d.channel || 'whatsapp'} onChange={(e) => patchNode(n.id, { channel: e.target.value })}>\n            <option value=\"whatsapp\">WhatsApp</option>\n            <option value=\"sms\">SMS</option>\n          </select>\n\n          {label('Mode')}\n          <select style={inputStyle} value={d.mode || 'text'} onChange={(e) => patchNode(n.id, { mode: e.target.value })}>\n            <option value=\"text\">Text</option>\n            <option value=\"rich\">Rich (text + image + buttons)</option>\n          </select>\n\n          {label('Pick a Twilio template (optional)')}\n          <TemplatesOptions value={d.templateSid} onChange={(val) => patchNode(n.id, { templateSid: val })} />\n\n          {found && (\n            <>\n              {label('Template preview')}\n              <textarea readOnly rows={6} style={{ ...inputStyle, fontFamily: 'monospace' }} value={firstTypeBody} />\n            </>\n          )}\n\n          {label('Text')}\n          <textarea rows={8} style={inputStyle} value={d.text || ''} onChange={(e) => patchNode(n.id, { text: e.target.value })} placeholder=\"Olá {{nome}}!\" />\n\n          {d.mode === 'rich' && (\n            <>\n              {label('Media URL')}\n              <input style={inputStyle} value={d.mediaUrl || ''} onChange={(e) => patchNode(n.id, { mediaUrl: e.target.value })} placeholder=\"https://...\" />\n\n              {label('Buttons (JSON opcional)')}\n              <textarea rows={6} style={inputStyle} value={d.buttonsJson || ''} onChange={(e) => patchNode(n.id, { buttonsJson: e.target.value })}\n                placeholder='[{\"type\":\"reply\",\"title\":\"Sim\",\"id\":\"YES\"}]' />\n            </>\n          )}\n        </div>\n      );\n    }\n\n    if (n.type === 'api') {\n      const d = n.data || {};\n      const tryParse = (txt) => { try { return JSON.stringify(JSON.parse(txt), null, 2); } catch { return txt; } };\n      const testRequest = async () => {\n        try {\n          const headers = d.headers ? JSON.parse(d.headers) : {};\n          const body =\n            d.method === 'GET' || d.method === 'DELETE' ? undefined :\n            d.body && d.body.trim() !== '{}' ? JSON.parse(d.body) : undefined;\n          const res = await fetch(d.url, { method: d.method || 'GET', headers, body: body ? JSON.stringify(body) : undefined });\n          const text = await res.text();\n          patchNode(n.id, { lastResponse: text });\n          alert('Request executada. Veja a resposta abaixo.');\n        } catch (e) {\n          alert('Falha ao executar request: ' + e.message);\n        }\n      };\n      const addMapping = () => {\n        const m = Array.isArray(d.mappings) ? d.mappings.slice() : [];\n        m.push({ path: '', var: '' });\n        patchNode(n.id, { mappings: m });\n      };\n      const updateMap = (idx, patch) => {\n        const m = (d.mappings || []).slice();\n        m[idx] = { ...m[idx], ...patch };\n        patchNode(n.id, { mappings: m });\n      };\n      const removeMap = (idx) => {\n        const m = (d.mappings || []).slice();\n        m.splice(idx, 1);\n        patchNode(n.id, { mappings: m });\n      };\n\n      return (\n        <div style={panelWrap}>\n          {label('Label')}\n          <input style={inputStyle} value={d.label || 'API Call'} onChange={(e) => patchNode(n.id, { label: e.target.value })} />\n\n          {label('Método')}\n          <select style={inputStyle} value={d.method || 'GET'} onChange={(e) => patchNode(n.id, { method: e.target.value })}>\n            <option>GET</option><option>POST</option><option>PUT</option><option>PATCH</option><option>DELETE</option>\n          </select>\n\n          {label('URL')}\n          <input style={inputStyle} placeholder=\"https://api.meuservico.com/...\" value={d.url || ''} onChange={(e) => patchNode(n.id, { url: e.target.value })} />\n\n          {label('Headers (JSON)')}\n          <textarea rows={4} style={inputStyle} value={d.headers || '{}'} onChange={(e) => patchNode(n.id, { headers: e.target.value })} />\n\n          {(d.method === 'POST' || d.method === 'PUT' || d.method === 'PATCH') && (\n            <>\n              {label('Body (JSON)')}\n              <textarea rows={6} style={inputStyle} value={d.body || '{}'} onChange={(e) => patchNode(n.id, { body: e.target.value })} />\n            </>\n          )}\n\n          <button className=\"btn\" onClick={testRequest} style={{ marginTop: 10 }}>Executar request</button>\n\n          {label('Resposta (último teste)')}\n          <textarea rows={8} style={{ ...inputStyle, fontFamily: 'monospace' }} readOnly value={tryParse(d.lastResponse || '')} />\n\n          {label('Mapeamentos JSON → Variáveis')}\n          {(d.mappings || []).map((m, i) => (\n            <div key={i} style={{ display: 'grid', gridTemplateColumns: '1fr 1fr auto', gap: 8, marginBottom: 8 }}>\n              <input style={inputStyle} placeholder=\"ex.: data.user.id\" value={m.path} onChange={(e) => updateMap(i, { path: e.target.value })} />\n              <input style={inputStyle} placeholder=\"ex.: user_id\" value={m.var} onChange={(e) => updateMap(i, { var: slug(e.target.value) })} />\n              <button className=\"btn danger\" onClick={() => removeMap(i)}>x</button>\n            </div>\n          ))}\n          <button className=\"btn\" onClick={addMapping}>+ adicionar mapeamento</button>\n        </div>\n      );\n    }\n\n    if (n.type === 'code') {\n      const d = n.data || {};\n      return (\n        <div style={panelWrap}>\n          {label('Label')}\n          <input style={inputStyle} value={d.label || 'Code'} onChange={(e) => patchNode(n.id, { label: e.target.value })} />\n          {label('JavaScript')}\n          <textarea\n            rows={14}\n            style={{ ...inputStyle, fontFamily: 'monospace' }}\n            value={d.code || ''}\n            onChange={(e) => patchNode(n.id, { code: e.target.value })}\n            placeholder={`// Recebe \"context\" (variáveis atuais)\\n// deve retornar um objeto com novas variáveis\\nreturn { nova_variavel: 123 };`}\n          />\n        </div>\n      );\n    }\n\n    if (n.type === 'audience') {\n      return (\n        <div style={panelWrap}>\n          <AudiencePanel node={n} patchNode={patchNode} inputStyle={inputStyle} label={label} slugFn={slug} />\n        </div>\n      );\n    }\n\n    if (n.type === 'delay') {\n      const d = n.data || {};\n      return (\n        <div style={panelWrap}>\n          {label('Label')}\n          <input style={inputStyle} value={d.label || 'Delay'} onChange={(e) => patchNode(n.id, { label: e.target.value })} />\n          {label('Modo')}\n          <select style={inputStyle} value={d.mode || 'relative'} onChange={(e) => patchNode(n.id, { mode: e.target.value })}>\n            <option value=\"relative\">Por período (X unidades)</option>\n            <option value=\"until\">Até data/hora</option>\n          </select>\n\n          {(d.mode || 'relative') === 'relative' ? (\n            <>\n              {label('Quantidade')}\n              <input type=\"number\" min=\"1\" step=\"1\" style={inputStyle}\n                value={d.amount ?? 1}\n                onChange={(e) => patchNode(n.id, { amount: Math.max(1, parseInt(e.target.value || '1', 10)) })} />\n              {label('Unidade')}\n              <select style={inputStyle} value={d.unit || 'hours'} onChange={(e) => patchNode(n.id, { unit: e.target.value })}>\n                <option value=\"seconds\">segundos</option>\n                <option value=\"minutes\">minutos</option>\n                <option value=\"hours\">horas</option>\n                <option value=\"days\">dias</option>\n                <option value=\"weeks\">semanas</option>\n                <option value=\"months\">meses</option>\n              </select>\n            </>\n          ) : (\n            <>\n              {label('Executar após (data/hora)')}\n              <input\n                type=\"datetime-local\"\n                style={inputStyle}\n                value={d.untilLocal || ''}\n                onChange={(e) => {\n                  const local = e.target.value;\n                  let iso = '';\n                  try { iso = new Date(local).toISOString(); } catch {}\n                  patchNode(n.id, { untilLocal: local, until: iso });\n                }}\n              />\n              <div style={{ fontSize: 12, color: '#64748b' }}>\n                Será convertido para UTC ao salvar. ISO: <code>{d.until || '—'}</code>\n              </div>\n            </>\n          )}\n        </div>\n      );\n    }\n\n    if (n.type === 'end') {\n      return <div style={panelWrap}><div style={{ fontSize: 12, color: '#64748b' }}>Nó terminal. Sem propriedades.</div></div>;\n    }\n\n    return null;\n  };\n\n  // UI styles\n  const chip = { padding: '6px 10px', border: '1px solid #c7d2fe', background: '#eef2ff', color: '#1e3a8a',\n                 borderRadius: 8, fontSize: 12, cursor: 'grab', userSelect: 'none' };\n\n  return (\n    <div style={{ height: 'calc(100vh - 80px)', position: 'relative' }}>\n      {/* header */}\n      <div style={{\n        display: 'flex', gap: 8, padding: 12, alignItems: 'center',\n        border: '1px solid #e5e7eb', borderRadius: 12, marginBottom: 8,\n        background: '#fff'\n      }}>\n        <button className=\"btn\" onClick={() => (window.location.href = '/journeys')}>← Voltar p/ lista</button>\n\n        <div style={{ marginLeft: 12, display: 'flex', alignItems: 'center', gap: 8 }}>\n          <span style={{ fontSize: 12, color: '#64748b' }}>Arraste para o canvas:</span>\n          <div style={chip} draggable onDragStart={(e) => onDragStart(e, 'message')}>Mensagem</div>\n          <div style={chip} draggable onDragStart={(e) => onDragStart(e, 'api')}>API</div>\n          <div style={chip} draggable onDragStart={(e) => onDragStart(e, 'code')}>Code</div>\n          <div style={chip} draggable onDragStart={(e) => onDragStart(e, 'audience')}>Audiência</div>\n          <div style={chip} draggable onDragStart={(e) => onDragStart(e, 'delay')}>Delay</div>\n          <div style={chip} draggable onDragStart={(e) => onDragStart(e, 'end')}>End</div>\n        </div>\n\n        <div style={{ marginLeft: 'auto', display: 'flex', gap: 8, alignItems: 'center' }}>\n          <input\n            value={flowName}\n            onChange={(e) => setFlowName(e.target.value)}\n            placeholder=\"Nome do flow\"\n            style={{ border: '1px solid #e5e7eb', borderRadius: 8, padding: '8px 10px', width: 220 }}\n          />\n          <button className=\"btn\" onClick={autoLayout} title=\"⌘/Ctrl + L\">Auto-layout</button>\n          <button className=\"btn\" onClick={onImportClick}>Importar</button>\n          <button className=\"btn\" onClick={onExport}>Exportar</button>\n          <button className=\"btn\" onClick={handleSaveFlow} title=\"⌘/Ctrl + S\">Salvar flow</button>\n        </div>\n        <input ref={fileRef} type=\"file\" accept=\"application/json\" onChange={onImportFile} style={{ display: 'none' }} />\n      </div>\n\n      {/* canvas + drawer */}\n      <div ref={wrapperRef} style={{ height: 'calc(100% - 60px)', position: 'relative', border: '1px solid #e5e7eb', borderRadius: 12, overflow: 'hidden' }}>\n        <ReactFlow\n          nodes={nodes}\n          edges={edges}\n          nodeTypes={nodeTypes}\n          onNodesChange={onNodesChange}\n          onEdgesChange={onEdgesChange}\n          onConnect={onConnect}\n          onSelectionChange={onSelectionChange}\n          onInit={setRfInstance}\n          onDragOver={onDragOver}\n          onDrop={onDrop}\n          onNodeContextMenu={onNodeContextMenu}\n          onPaneClick={() => { setSelectedId(null); closeCtx(); }}\n          panOnScroll\n          zoomOnDoubleClick={false}\n          snapToGrid\n          snapGrid={SNAP}\n          fitView\n        >\n          <MiniMap />\n          <Controls />\n          <Background gap={16} />\n        </ReactFlow>\n\n        {/* context menu */}\n        {ctx.open && (\n          <div\n            style={{\n              position: 'fixed',\n              top: ctx.y,\n              left: ctx.x,\n              background: '#fff',\n              border: '1px solid #e5e7eb',\n              borderRadius: 8,\n              boxShadow: '0 6px 20px rgba(0,0,0,.12)',\n              zIndex: 50,\n              minWidth: 180,\n              overflow: 'hidden',\n            }}\n            onMouseLeave={closeCtx}\n          >\n            <MenuItem onClick={renameCtx}>Renomear nó</MenuItem>\n            <MenuItem onClick={duplicateCtx}>Copiar (duplicar)</MenuItem>\n            <MenuItem onClick={resetCtx}>Redefinir</MenuItem>\n            <MenuItem danger onClick={deleteCtx}>Apagar</MenuItem>\n          </div>\n        )}\n\n        {/* drawer lateral */}\n        <div\n          style={{\n            position: 'absolute',\n            top: 0,\n            right: 0,\n            width: 360,\n            height: '100%',\n            background: '#fff',\n            borderLeft: '1px solid #e5e7eb',\n            transform: showSide ? 'translateX(0)' : 'translateX(100%)',\n            transition: 'transform 220ms ease',\n            zIndex: 40,\n            boxShadow: showSide ? '-8px 0 24px rgba(0,0,0,.05)' : 'none',\n          }}\n        >\n          {showSide && <PropertiesPanel />}\n        </div>\n      </div>\n    </div>\n  );\n}\n\n// pequeno componente de item do menu\nfunction MenuItem({ children, onClick, danger }) {\n  return (\n    <div\n      onClick={onClick}\n      style={{\n        padding: '10px 12px',\n        cursor: 'pointer',\n        fontSize: 14,\n        color: danger ? '#b91c1c' : '#0f172a',\n        borderBottom: '1px solid #f3f4f6',\n        userSelect: 'none',\n      }}\n      onMouseDown={(e) => e.preventDefault()}\n    >\n      {children}\n    </div>\n  );\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}