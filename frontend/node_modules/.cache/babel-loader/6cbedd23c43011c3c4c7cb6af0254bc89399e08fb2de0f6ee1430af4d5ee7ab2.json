{"ast":null,"code":"var _jsxFileName = \"/Users/gustsantos/Desktop/initucastt/frontend/src/pages/JourneyBuilder.jsx\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\n// frontend/src/pages/JourneyBuilder.jsx\nimport React, { useCallback, useEffect, useMemo, useRef, useState } from 'react';\nimport ReactFlow, { Background, Controls, MiniMap, addEdge, useEdgesState, useNodesState, MarkerType, Handle, Position } from 'reactflow';\nimport 'reactflow/dist/style.css';\nimport Papa from 'papaparse';\nimport { saveAs } from 'file-saver';\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst PIN_SIZE = 14;\n\n// ---------- helpers ----------\nconst uid = p => `${p}_${Date.now()}_${Math.floor(Math.random() * 9999)}`;\nconst slug = s => String(s || '').trim().toLowerCase().replace(/\\s+/g, '_').replace(/[^\\w]/g, '_').replace(/_+/g, '_');\nconst NodeShell = ({\n  title,\n  subtitle,\n  selected,\n  children\n}) => /*#__PURE__*/_jsxDEV(\"div\", {\n  style: {\n    background: '#fff',\n    border: selected ? '2px solid #2563eb' : '1px solid #e5e7eb',\n    borderRadius: 12,\n    width: 320,\n    boxShadow: '0 2px 8px rgba(0,0,0,.06)'\n  },\n  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      padding: '12px 14px',\n      borderBottom: '1px solid #f1f5f9'\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        fontWeight: 700,\n        color: '#0f172a'\n      },\n      children: title\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 41,\n      columnNumber: 7\n    }, this), subtitle ? /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        fontSize: 12,\n        color: '#64748b'\n      },\n      children: subtitle\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 43,\n      columnNumber: 9\n    }, this) : null]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 40,\n    columnNumber: 5\n  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      padding: 12\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 46,\n    columnNumber: 5\n  }, this)]\n}, void 0, true, {\n  fileName: _jsxFileName,\n  lineNumber: 31,\n  columnNumber: 3\n}, this);\n\n// ---------- node components ----------\n_c = NodeShell;\nconst StartNode = ({\n  selected\n}) => /*#__PURE__*/_jsxDEV(NodeShell, {\n  title: \"Start\",\n  subtitle: \"in\\xEDcio do fluxo\",\n  selected: selected,\n  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      fontSize: 12,\n      color: '#475569'\n    },\n    children: \"Arraste do pino verde para o pr\\xF3ximo n\\xF3.\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 53,\n    columnNumber: 5\n  }, this), /*#__PURE__*/_jsxDEV(Handle, {\n    type: \"source\",\n    position: Position.Right,\n    id: \"out\",\n    style: {\n      background: '#16a34a',\n      width: PIN_SIZE,\n      height: PIN_SIZE,\n      border: '2px solid #fff'\n    }\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 56,\n    columnNumber: 5\n  }, this)]\n}, void 0, true, {\n  fileName: _jsxFileName,\n  lineNumber: 52,\n  columnNumber: 3\n}, this);\n_c2 = StartNode;\nconst EndNode = ({\n  selected\n}) => /*#__PURE__*/_jsxDEV(NodeShell, {\n  title: \"End\",\n  subtitle: \"t\\xE9rmino do fluxo\",\n  selected: selected,\n  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      fontSize: 12,\n      color: '#475569'\n    },\n    children: \"N\\xF3 terminal. S\\xF3 recebe conex\\xF5es.\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 67,\n    columnNumber: 5\n  }, this), /*#__PURE__*/_jsxDEV(Handle, {\n    type: \"target\",\n    position: Position.Left,\n    id: \"in\",\n    style: {\n      background: '#6b7280',\n      width: PIN_SIZE,\n      height: PIN_SIZE,\n      border: '2px solid #fff'\n    }\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 68,\n    columnNumber: 5\n  }, this)]\n}, void 0, true, {\n  fileName: _jsxFileName,\n  lineNumber: 66,\n  columnNumber: 3\n}, this);\n_c3 = EndNode;\nconst MessageNode = ({\n  data,\n  selected\n}) => /*#__PURE__*/_jsxDEV(NodeShell, {\n  title: data.label || 'Mensagem',\n  subtitle: `Canal: ${String(data.channel || 'whatsapp').toUpperCase()} • Tipo: ${data.mode || 'text'}`,\n  selected: selected,\n  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      fontSize: 12,\n      color: '#475569'\n    },\n    children: \"Conte\\xFAdo configur\\xE1vel no painel ao lado.\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 83,\n    columnNumber: 5\n  }, this), /*#__PURE__*/_jsxDEV(Handle, {\n    type: \"target\",\n    position: Position.Left,\n    id: \"in\",\n    style: {\n      background: '#6b7280',\n      width: PIN_SIZE,\n      height: PIN_SIZE,\n      border: '2px solid #fff'\n    }\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 84,\n    columnNumber: 5\n  }, this), /*#__PURE__*/_jsxDEV(Handle, {\n    type: \"source\",\n    position: Position.Right,\n    id: \"out\",\n    style: {\n      background: '#16a34a',\n      width: PIN_SIZE,\n      height: PIN_SIZE,\n      border: '2px solid #fff'\n    }\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 90,\n    columnNumber: 5\n  }, this)]\n}, void 0, true, {\n  fileName: _jsxFileName,\n  lineNumber: 78,\n  columnNumber: 3\n}, this);\n_c4 = MessageNode;\nconst ApiNode = ({\n  selected\n}) => /*#__PURE__*/_jsxDEV(NodeShell, {\n  title: \"API Call\",\n  selected: selected,\n  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      fontSize: 12,\n      color: '#475569'\n    },\n    children: \"Configure m\\xE9todo/URL no painel ao lado. Salva vari\\xE1veis via mapeamentos.\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 101,\n    columnNumber: 5\n  }, this), /*#__PURE__*/_jsxDEV(Handle, {\n    type: \"target\",\n    position: Position.Left,\n    id: \"in\",\n    style: {\n      background: '#6b7280',\n      width: PIN_SIZE,\n      height: PIN_SIZE,\n      border: '2px solid #fff'\n    }\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 104,\n    columnNumber: 5\n  }, this), /*#__PURE__*/_jsxDEV(Handle, {\n    type: \"source\",\n    position: Position.Right,\n    id: \"out\",\n    style: {\n      background: '#16a34a',\n      width: PIN_SIZE,\n      height: PIN_SIZE,\n      border: '2px solid #fff'\n    }\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 110,\n    columnNumber: 5\n  }, this)]\n}, void 0, true, {\n  fileName: _jsxFileName,\n  lineNumber: 100,\n  columnNumber: 3\n}, this);\n_c5 = ApiNode;\nconst CodeNode = ({\n  selected\n}) => /*#__PURE__*/_jsxDEV(NodeShell, {\n  title: \"Code\",\n  subtitle: \"JS custom\",\n  selected: selected,\n  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      fontSize: 12,\n      color: '#475569'\n    },\n    children: \"Cole seu JS no painel ao lado. Deve retornar um objeto de vari\\xE1veis.\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 121,\n    columnNumber: 5\n  }, this), /*#__PURE__*/_jsxDEV(Handle, {\n    type: \"target\",\n    position: Position.Left,\n    id: \"in\",\n    style: {\n      background: '#6b7280',\n      width: PIN_SIZE,\n      height: PIN_SIZE,\n      border: '2px solid #fff'\n    }\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 124,\n    columnNumber: 5\n  }, this), /*#__PURE__*/_jsxDEV(Handle, {\n    type: \"source\",\n    position: Position.Right,\n    id: \"out\",\n    style: {\n      background: '#16a34a',\n      width: PIN_SIZE,\n      height: PIN_SIZE,\n      border: '2px solid #fff'\n    }\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 130,\n    columnNumber: 5\n  }, this)]\n}, void 0, true, {\n  fileName: _jsxFileName,\n  lineNumber: 120,\n  columnNumber: 3\n}, this);\n_c6 = CodeNode;\nconst AudienceNode = ({\n  selected\n}) => /*#__PURE__*/_jsxDEV(NodeShell, {\n  title: \"Audi\\xEAncia\",\n  subtitle: \"CSV \\u2192 vari\\xE1veis\",\n  selected: selected,\n  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      fontSize: 12,\n      color: '#475569'\n    },\n    children: \"Fa\\xE7a upload e mapeie colunas no painel ao lado.\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 141,\n    columnNumber: 5\n  }, this), /*#__PURE__*/_jsxDEV(Handle, {\n    type: \"target\",\n    position: Position.Left,\n    id: \"in\",\n    style: {\n      background: '#6b7280',\n      width: PIN_SIZE,\n      height: PIN_SIZE,\n      border: '2px solid #fff'\n    }\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 144,\n    columnNumber: 5\n  }, this), /*#__PURE__*/_jsxDEV(Handle, {\n    type: \"source\",\n    position: Position.Right,\n    id: \"out\",\n    style: {\n      background: '#16a34a',\n      width: PIN_SIZE,\n      height: PIN_SIZE,\n      border: '2px solid #fff'\n    }\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 150,\n    columnNumber: 5\n  }, this)]\n}, void 0, true, {\n  fileName: _jsxFileName,\n  lineNumber: 140,\n  columnNumber: 3\n}, this);\n\n// --- DelayNode ---\n_c7 = AudienceNode;\nconst DelayNode = ({\n  data = {},\n  selected\n}) => {\n  var _data$amount;\n  const subtitle = data.mode === 'until' ? `até ${data.until ? new Date(data.until).toLocaleString() : '—'}` : `+ ${(_data$amount = data.amount) !== null && _data$amount !== void 0 ? _data$amount : 1} ${data.unit || 'hours'}`;\n  return /*#__PURE__*/_jsxDEV(NodeShell, {\n    title: \"Delay\",\n    subtitle: subtitle,\n    selected: selected,\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        fontSize: 12,\n        color: '#475569'\n      },\n      children: \"Espera antes de seguir para o pr\\xF3ximo n\\xF3.\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 168,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Handle, {\n      type: \"target\",\n      position: Position.Left,\n      id: \"in\",\n      style: {\n        background: '#6b7280',\n        width: PIN_SIZE,\n        height: PIN_SIZE,\n        border: '2px solid #fff'\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 171,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Handle, {\n      type: \"source\",\n      position: Position.Right,\n      id: \"out\",\n      style: {\n        background: '#16a34a',\n        width: PIN_SIZE,\n        height: PIN_SIZE,\n        border: '2px solid #fff'\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 177,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 167,\n    columnNumber: 5\n  }, this);\n};\n\n// ---------- side panel pieces ----------\n_c8 = DelayNode;\nfunction AudiencePanel({\n  node,\n  patchNode,\n  inputStyle,\n  label,\n  slugFn\n}) {\n  _s();\n  const d = node.data || {};\n  const [headers, setHeaders] = useState(d.headers || []);\n  const [rows, setRows] = useState(d.rows || []);\n  const [mapping, setMapping] = useState(d.mapping || {});\n  const [phoneKey, setPhoneKey] = useState(d.phoneKey || '');\n  useEffect(() => {\n    setHeaders(d.headers || []);\n    setRows(d.rows || []);\n    setMapping(d.mapping || {});\n    setPhoneKey(d.phoneKey || '');\n  }, [node.id]);\n  const onFile = e => {\n    var _e$target$files;\n    const f = (_e$target$files = e.target.files) === null || _e$target$files === void 0 ? void 0 : _e$target$files[0];\n    if (!f) return;\n    Papa.parse(f, {\n      header: true,\n      skipEmptyLines: true,\n      complete: res => {\n        const hs = res.meta.fields || Object.keys(res.data[0] || {});\n        const guess = {};\n        hs.forEach(h => guess[h] = slugFn(h));\n        const pk = hs.find(h => /phone|telefone|celular|numero|n[uú]mero/i.test(h)) || '';\n        setHeaders(hs);\n        setRows(res.data.slice(0, 5));\n        setMapping(guess);\n        setPhoneKey(pk);\n      }\n    });\n  };\n  const saveMap = () => {\n    if (!phoneKey) {\n      alert('Escolha a coluna de telefone.');\n      return;\n    }\n    patchNode(node.id, {\n      headers,\n      rows,\n      mapping,\n      phoneKey\n    });\n    alert('Mapeamento salvo.');\n  };\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [label('Arquivo CSV'), /*#__PURE__*/_jsxDEV(\"input\", {\n      type: \"file\",\n      accept: \".csv\",\n      onChange: onFile\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 234,\n      columnNumber: 7\n    }, this), headers.length > 0 && /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [label('Coluna de telefone'), /*#__PURE__*/_jsxDEV(\"select\", {\n        style: inputStyle,\n        value: phoneKey,\n        onChange: e => setPhoneKey(e.target.value),\n        children: [/*#__PURE__*/_jsxDEV(\"option\", {\n          value: \"\",\n          children: \"\\u2014 selecione \\u2014\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 244,\n          columnNumber: 13\n        }, this), headers.map(h => /*#__PURE__*/_jsxDEV(\"option\", {\n          value: h,\n          children: h\n        }, h, false, {\n          fileName: _jsxFileName,\n          lineNumber: 246,\n          columnNumber: 15\n        }, this))]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 239,\n        columnNumber: 11\n      }, this), label('Mapeamento (coluna → variável)'), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          display: 'grid',\n          gridTemplateColumns: '1fr 20px 1fr',\n          gap: 8,\n          maxHeight: 200,\n          overflow: 'auto'\n        },\n        children: headers.map(h => /*#__PURE__*/_jsxDEV(React.Fragment, {\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              alignSelf: 'center',\n              fontSize: 13\n            },\n            children: h\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 254,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              textAlign: 'center',\n              color: '#94a3b8'\n            },\n            children: \"\\u2192\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 255,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            style: inputStyle,\n            value: mapping[h] || '',\n            placeholder: slugFn(h),\n            onChange: e => setMapping(m => ({\n              ...m,\n              [h]: slugFn(e.target.value)\n            }))\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 256,\n            columnNumber: 17\n          }, this)]\n        }, h, true, {\n          fileName: _jsxFileName,\n          lineNumber: 253,\n          columnNumber: 15\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 251,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"btn\",\n        onClick: saveMap,\n        style: {\n          marginTop: 10\n        },\n        children: \"Salvar mapeamento\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 268,\n        columnNumber: 11\n      }, this), rows.length > 0 && /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [label('Amostra (5 primeiras linhas)'), /*#__PURE__*/_jsxDEV(\"pre\", {\n          style: {\n            background: '#f8fafc',\n            border: '1px solid #e2e8f0',\n            borderRadius: 8,\n            padding: 10,\n            fontSize: 12,\n            maxHeight: 160,\n            overflow: 'auto'\n          },\n          children: JSON.stringify(rows, null, 2)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 275,\n          columnNumber: 15\n        }, this)]\n      }, void 0, true), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          fontSize: 12,\n          color: '#64748b',\n          marginTop: 8\n        },\n        children: [\"Dica: ap\\xF3s salvar, use as vari\\xE1veis com \", /*#__PURE__*/_jsxDEV(\"code\", {\n          children: '{{minha_variavel}}'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 291,\n          columnNumber: 53\n        }, this), \".\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 290,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true)]\n  }, void 0, true);\n}\n\n// ---------- main page ----------\n_s(AudiencePanel, \"Gvd8UhRxqXlUdrrpexXFfFXUeMs=\");\n_c9 = AudiencePanel;\nexport default function JourneyBuilder() {\n  _s2();\n  // nodes/edges\n  const [nodes, setNodes, onNodesChange] = useNodesState([{\n    id: 'start',\n    type: 'start',\n    position: {\n      x: 140,\n      y: 140\n    },\n    data: {},\n    selectable: true\n  }, {\n    id: 'end',\n    type: 'end',\n    position: {\n      x: 860,\n      y: 140\n    },\n    data: {},\n    selectable: true\n  }]);\n  const [edges, setEdges, onEdgesChange] = useEdgesState([]);\n\n  // flow id & name (carrega por ?id=)\n  const [flowId, setFlowId] = useState(null);\n  const [flowName, setFlowName] = useState('Novo Flow');\n  useEffect(() => {\n    const sp = new URLSearchParams(window.location.search);\n    const id = sp.get('id');\n    if (!id) return;\n    setFlowId(id);\n    fetch(`/api/journeys/${id}`).then(r => r.ok ? r.json() : Promise.reject()).then(f => {\n      if (Array.isArray(f.nodes) && Array.isArray(f.edges)) {\n        setNodes(f.nodes);\n        setEdges(f.edges);\n        if (f.name) setFlowName(f.name);\n      }\n    }).catch(() => {\n      const raw = localStorage.getItem(id);\n      if (raw) {\n        try {\n          const f = JSON.parse(raw);\n          if (Array.isArray(f.nodes) && Array.isArray(f.edges)) {\n            setNodes(f.nodes);\n            setEdges(f.edges);\n            if (f.name) setFlowName(f.name);\n          }\n        } catch {}\n      }\n    });\n  }, [setEdges, setNodes]);\n\n  // selection\n  const [selectedId, setSelectedId] = useState(null);\n  const selectedNode = useMemo(() => nodes.find(n => n.id === selectedId), [nodes, selectedId]);\n\n  // templates (Twilio)\n  const [templates, setTemplates] = useState([]);\n  useEffect(() => {\n    fetch('/api/templates/list').then(r => r.json()).then(data => setTemplates(data.contents || [])).catch(() => setTemplates([]));\n  }, []);\n\n  // centralized patch\n  const patchNode = useCallback((id, patch) => {\n    setNodes(nds => nds.map(n => n.id === id ? {\n      ...n,\n      data: {\n        ...n.data,\n        ...patch\n      }\n    } : n));\n  }, [setNodes]);\n\n  // 1 saída por nó\n  const onConnect = useCallback(params => {\n    setEdges(eds => {\n      const filtered = eds.filter(e => e.source !== params.source);\n      return addEdge({\n        ...params,\n        type: 'smoothstep',\n        style: {\n          stroke: '#0f172a'\n        },\n        markerEnd: {\n          type: MarkerType.ArrowClosed,\n          color: '#0f172a'\n        }\n      }, filtered);\n    });\n  }, [setEdges]);\n  const onSelectionChange = useCallback(({\n    nodes: ns\n  }) => {\n    var _ns$0$id, _ns$;\n    setSelectedId((_ns$0$id = ns === null || ns === void 0 ? void 0 : (_ns$ = ns[0]) === null || _ns$ === void 0 ? void 0 : _ns$.id) !== null && _ns$0$id !== void 0 ? _ns$0$id : null);\n  }, []);\n\n  // adders\n  const addMessageNode = () => {\n    const id = uid('msg');\n    setNodes(nds => [...nds, {\n      id,\n      type: 'message',\n      position: {\n        x: 360,\n        y: 240\n      },\n      data: {\n        label: 'Mensagem',\n        channel: 'whatsapp',\n        mode: 'text',\n        text: ''\n      }\n    }]);\n  };\n  const addApiNode = () => {\n    const id = uid('api');\n    setNodes(nds => [...nds, {\n      id,\n      type: 'api',\n      position: {\n        x: 480,\n        y: 340\n      },\n      data: {\n        label: 'API Call',\n        method: 'GET',\n        url: '',\n        headers: '{}',\n        body: '{}',\n        mappings: [],\n        lastResponse: ''\n      }\n    }]);\n  };\n  const addCodeNode = () => {\n    const id = uid('code');\n    setNodes(nds => [...nds, {\n      id,\n      type: 'code',\n      position: {\n        x: 560,\n        y: 200\n      },\n      data: {\n        label: 'Code',\n        code: '// return { nova_variavel: 123 };'\n      }\n    }]);\n  };\n  const addAudienceNode = () => {\n    const id = uid('aud');\n    setNodes(nds => [...nds, {\n      id,\n      type: 'audience',\n      position: {\n        x: 320,\n        y: 420\n      },\n      data: {\n        headers: [],\n        rows: [],\n        mapping: {},\n        phoneKey: ''\n      }\n    }]);\n  };\n  const addDelayNode = () => {\n    const id = uid('delay');\n    setNodes(nds => [...nds, {\n      id,\n      type: 'delay',\n      position: {\n        x: 420,\n        y: 280\n      },\n      data: {\n        label: 'Delay',\n        mode: 'relative',\n        amount: 1,\n        unit: 'hours',\n        until: '',\n        untilLocal: ''\n      }\n    }]);\n  };\n  const duplicateSelected = () => {\n    if (!selectedNode) return;\n    const id = uid(selectedNode.type);\n    setNodes(nds => [...nds, {\n      ...selectedNode,\n      id,\n      position: {\n        x: selectedNode.position.x + 40,\n        y: selectedNode.position.y + 40\n      },\n      selected: false\n    }]);\n  };\n  const deleteSelected = () => {\n    if (!selectedNode) return;\n    setEdges(eds => eds.filter(e => e.source !== selectedNode.id && e.target !== selectedNode.id));\n    setNodes(nds => nds.filter(n => n.id !== selectedNode.id));\n    setSelectedId(null);\n  };\n\n  // salvar flow (backend se existir; senão localStorage)\n  const handleSaveFlow = async () => {\n    let name = flowName || 'Novo Flow';\n    if (!flowId && (!name || name === 'Novo Flow')) {\n      const entered = window.prompt('Dê um nome para este flow:', name);\n      if (entered && entered.trim()) {\n        name = entered.trim();\n        setFlowName(name);\n      }\n    }\n    const payload = {\n      id: flowId || 'flow_' + Date.now(),\n      name,\n      nodes,\n      edges,\n      updatedAt: new Date().toISOString()\n    };\n    try {\n      const url = flowId ? `/api/journeys/${flowId}` : '/api/journeys';\n      const method = flowId ? 'PUT' : 'POST';\n      const res = await fetch(url, {\n        method,\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(payload)\n      });\n      if (!res.ok) throw new Error('no backend');\n      const saved = await res.json();\n      alert('Flow salvo no backend!');\n      if (!flowId && saved !== null && saved !== void 0 && saved.id) {\n        window.history.replaceState(null, '', `/journeys/builder?id=${saved.id}`);\n        setFlowId(saved.id);\n      }\n    } catch {\n      localStorage.setItem(payload.id, JSON.stringify(payload));\n      alert('Flow salvo no navegador.');\n      if (!flowId) {\n        window.history.replaceState(null, '', `/journeys/builder?id=${payload.id}`);\n        setFlowId(payload.id);\n      }\n    }\n  };\n\n  // import/export\n  const fileRef = useRef(null);\n  const onImportClick = () => {\n    var _fileRef$current;\n    return (_fileRef$current = fileRef.current) === null || _fileRef$current === void 0 ? void 0 : _fileRef$current.click();\n  };\n  const onImportFile = e => {\n    var _e$target$files2;\n    const f = (_e$target$files2 = e.target.files) === null || _e$target$files2 === void 0 ? void 0 : _e$target$files2[0];\n    if (!f) return;\n    const reader = new FileReader();\n    reader.onload = () => {\n      try {\n        const json = JSON.parse(String(reader.result || '{}'));\n        if (Array.isArray(json.nodes) && Array.isArray(json.edges)) {\n          setNodes(json.nodes);\n          setEdges(json.edges);\n          if (json.id) setFlowId(json.id);\n          if (json.name) setFlowName(json.name);\n          alert('Flow importado.');\n        } else {\n          alert('Arquivo inválido.');\n        }\n      } catch (err) {\n        alert('Falha ao importar: ' + ((err === null || err === void 0 ? void 0 : err.message) || 'erro'));\n      }\n    };\n    reader.readAsText(f);\n    // reset input\n    e.target.value = '';\n  };\n  const onExport = () => {\n    const data = {\n      id: flowId || 'flow_unsaved',\n      name: flowName || 'Novo Flow',\n      nodes,\n      edges,\n      exportedAt: new Date().toISOString()\n    };\n    const blob = new Blob([JSON.stringify(data, null, 2)], {\n      type: 'application/json;charset=utf-8'\n    });\n    saveAs(blob, `${slug(data.name || 'flow')}.json`);\n  };\n\n  // node types\n  const nodeTypes = useMemo(() => ({\n    start: StartNode,\n    end: EndNode,\n    message: MessageNode,\n    api: ApiNode,\n    code: CodeNode,\n    audience: AudienceNode,\n    delay: DelayNode\n  }), []);\n\n  // ---------- properties panel ----------\n  const inputStyle = {\n    width: '100%',\n    border: '1px solid #cbd5e1',\n    borderRadius: 8,\n    padding: '10px 12px'\n  };\n  const small = {\n    fontSize: 12,\n    color: '#475569',\n    marginBottom: 6\n  };\n  const label = t => /*#__PURE__*/_jsxDEV(\"div\", {\n    style: small,\n    children: t\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 543,\n    columnNumber: 24\n  }, this);\n  const panelWrap = {\n    background: '#fff',\n    border: '1px solid #e5e7eb',\n    borderRadius: 12,\n    padding: 16\n  };\n  const TemplatesOptions = ({\n    value,\n    onChange\n  }) => /*#__PURE__*/_jsxDEV(\"select\", {\n    value: value || '',\n    onChange: e => onChange(e.target.value),\n    style: inputStyle,\n    children: [/*#__PURE__*/_jsxDEV(\"option\", {\n      value: \"\",\n      children: \"\\u2014 none \\u2014\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 553,\n      columnNumber: 7\n    }, this), templates.map(t => /*#__PURE__*/_jsxDEV(\"option\", {\n      value: t.sid,\n      children: t.friendly_name || t.sid\n    }, t.sid, false, {\n      fileName: _jsxFileName,\n      lineNumber: 555,\n      columnNumber: 9\n    }, this))]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 552,\n    columnNumber: 5\n  }, this);\n  const PropertiesPanel = () => {\n    if (!selectedNode) {\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        style: panelWrap,\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            color: '#94a3b8'\n          },\n          children: \"Selecione um n\\xF3.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 564,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 563,\n        columnNumber: 9\n      }, this);\n    }\n    const n = selectedNode;\n\n    // MESSAGE\n    if (n.type === 'message') {\n      var _Object$values$;\n      const d = n.data || {};\n      const found = d.templateSid ? templates.find(t => t.sid === d.templateSid) : null;\n      const firstTypeBody = found ? ((_Object$values$ = Object.values(found.types || {})[0]) === null || _Object$values$ === void 0 ? void 0 : _Object$values$.body) || '' : '';\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        style: panelWrap,\n        children: [label('Label'), /*#__PURE__*/_jsxDEV(\"input\", {\n          style: inputStyle,\n          value: d.label || '',\n          onChange: e => patchNode(n.id, {\n            label: e.target.value\n          })\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 580,\n          columnNumber: 11\n        }, this), label('Canal'), /*#__PURE__*/_jsxDEV(\"select\", {\n          style: inputStyle,\n          value: d.channel || 'whatsapp',\n          onChange: e => patchNode(n.id, {\n            channel: e.target.value\n          }),\n          children: [/*#__PURE__*/_jsxDEV(\"option\", {\n            value: \"whatsapp\",\n            children: \"WhatsApp\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 584,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n            value: \"sms\",\n            children: \"SMS\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 585,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 583,\n          columnNumber: 11\n        }, this), label('Mode'), /*#__PURE__*/_jsxDEV(\"select\", {\n          style: inputStyle,\n          value: d.mode || 'text',\n          onChange: e => patchNode(n.id, {\n            mode: e.target.value\n          }),\n          children: [/*#__PURE__*/_jsxDEV(\"option\", {\n            value: \"text\",\n            children: \"Text\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 590,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n            value: \"rich\",\n            children: \"Rich (text + image + buttons)\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 591,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 589,\n          columnNumber: 11\n        }, this), label('Pick a Twilio template (optional)'), /*#__PURE__*/_jsxDEV(TemplatesOptions, {\n          value: d.templateSid,\n          onChange: val => patchNode(n.id, {\n            templateSid: val\n          })\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 595,\n          columnNumber: 11\n        }, this), found && /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: [label('Template preview'), /*#__PURE__*/_jsxDEV(\"textarea\", {\n            readOnly: true,\n            rows: 6,\n            style: {\n              ...inputStyle,\n              fontFamily: 'monospace'\n            },\n            value: firstTypeBody\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 600,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true), label('Text'), /*#__PURE__*/_jsxDEV(\"textarea\", {\n          rows: 8,\n          style: inputStyle,\n          value: d.text || '',\n          onChange: e => patchNode(n.id, {\n            text: e.target.value\n          }),\n          placeholder: \"Ol\\xE1 {{nome}}!\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 605,\n          columnNumber: 11\n        }, this), d.mode === 'rich' && /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: [label('Media URL'), /*#__PURE__*/_jsxDEV(\"input\", {\n            style: inputStyle,\n            value: d.mediaUrl || '',\n            onChange: e => patchNode(n.id, {\n              mediaUrl: e.target.value\n            }),\n            placeholder: \"https://...\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 616,\n            columnNumber: 15\n          }, this), label('Buttons (JSON opcional)'), /*#__PURE__*/_jsxDEV(\"textarea\", {\n            rows: 6,\n            style: inputStyle,\n            value: d.buttonsJson || '',\n            onChange: e => patchNode(n.id, {\n              buttonsJson: e.target.value\n            }),\n            placeholder: \"[{\\\"type\\\":\\\"reply\\\",\\\"title\\\":\\\"Sim\\\",\\\"id\\\":\\\"YES\\\"}]\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 624,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            fontSize: 12,\n            color: '#64748b',\n            marginTop: 8\n          },\n          children: [\"Dica: use vari\\xE1veis como \", /*#__PURE__*/_jsxDEV(\"code\", {\n            children: '{{nome}}'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 635,\n            columnNumber: 38\n          }, this), \".\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 634,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 578,\n        columnNumber: 9\n      }, this);\n    }\n\n    // API\n    if (n.type === 'api') {\n      const d = n.data || {};\n      const tryParse = txt => {\n        try {\n          return JSON.stringify(JSON.parse(txt), null, 2);\n        } catch {\n          return txt;\n        }\n      };\n      const testRequest = async () => {\n        try {\n          const headers = d.headers ? JSON.parse(d.headers) : {};\n          const body = d.method === 'GET' || d.method === 'DELETE' ? undefined : d.body && d.body.trim() !== '{}' ? JSON.parse(d.body) : undefined;\n          const res = await fetch(d.url, {\n            method: d.method || 'GET',\n            headers,\n            body: body ? JSON.stringify(body) : undefined\n          });\n          const text = await res.text();\n          patchNode(n.id, {\n            lastResponse: text\n          });\n          alert('Request executada. Veja a resposta abaixo.');\n        } catch (e) {\n          alert('Falha ao executar request: ' + e.message);\n        }\n      };\n      const addMapping = () => {\n        const m = Array.isArray(d.mappings) ? d.mappings.slice() : [];\n        m.push({\n          path: '',\n          var: ''\n        });\n        patchNode(n.id, {\n          mappings: m\n        });\n      };\n      const updateMap = (idx, patch) => {\n        const m = (d.mappings || []).slice();\n        m[idx] = {\n          ...m[idx],\n          ...patch\n        };\n        patchNode(n.id, {\n          mappings: m\n        });\n      };\n      const removeMap = idx => {\n        const m = (d.mappings || []).slice();\n        m.splice(idx, 1);\n        patchNode(n.id, {\n          mappings: m\n        });\n      };\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        style: panelWrap,\n        children: [label('Label'), /*#__PURE__*/_jsxDEV(\"input\", {\n          style: inputStyle,\n          value: d.label || 'API Call',\n          onChange: e => patchNode(n.id, {\n            label: e.target.value\n          })\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 691,\n          columnNumber: 11\n        }, this), label('Método'), /*#__PURE__*/_jsxDEV(\"select\", {\n          style: inputStyle,\n          value: d.method || 'GET',\n          onChange: e => patchNode(n.id, {\n            method: e.target.value\n          }),\n          children: [/*#__PURE__*/_jsxDEV(\"option\", {\n            children: \"GET\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 695,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n            children: \"POST\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 695,\n            columnNumber: 33\n          }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n            children: \"PUT\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 695,\n            columnNumber: 54\n          }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n            children: \"PATCH\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 695,\n            columnNumber: 74\n          }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n            children: \"DELETE\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 695,\n            columnNumber: 96\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 694,\n          columnNumber: 11\n        }, this), label('URL'), /*#__PURE__*/_jsxDEV(\"input\", {\n          style: inputStyle,\n          placeholder: \"https://api.meuservico.com/...\",\n          value: d.url || '',\n          onChange: e => patchNode(n.id, {\n            url: e.target.value\n          })\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 699,\n          columnNumber: 11\n        }, this), label('Headers (JSON)'), /*#__PURE__*/_jsxDEV(\"textarea\", {\n          rows: 4,\n          style: inputStyle,\n          value: d.headers || '{}',\n          onChange: e => patchNode(n.id, {\n            headers: e.target.value\n          })\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 702,\n          columnNumber: 11\n        }, this), (d.method === 'POST' || d.method === 'PUT' || d.method === 'PATCH') && /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: [label('Body (JSON)'), /*#__PURE__*/_jsxDEV(\"textarea\", {\n            rows: 6,\n            style: inputStyle,\n            value: d.body || '{}',\n            onChange: e => patchNode(n.id, {\n              body: e.target.value\n            })\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 707,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"btn\",\n          onClick: testRequest,\n          style: {\n            marginTop: 10\n          },\n          children: \"Executar request\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 711,\n          columnNumber: 11\n        }, this), label('Resposta (último teste)'), /*#__PURE__*/_jsxDEV(\"textarea\", {\n          rows: 8,\n          style: {\n            ...inputStyle,\n            fontFamily: 'monospace'\n          },\n          readOnly: true,\n          value: tryParse(d.lastResponse || '')\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 714,\n          columnNumber: 11\n        }, this), label('Mapeamentos JSON → Variáveis'), (d.mappings || []).map((m, i) => /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            display: 'grid',\n            gridTemplateColumns: '1fr 1fr auto',\n            gap: 8,\n            marginBottom: 8\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"input\", {\n            style: inputStyle,\n            placeholder: \"ex.: data.user.id\",\n            value: m.path,\n            onChange: e => updateMap(i, {\n              path: e.target.value\n            })\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 719,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            style: inputStyle,\n            placeholder: \"ex.: user_id\",\n            value: m.var,\n            onChange: e => updateMap(i, {\n              var: slug(e.target.value)\n            })\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 720,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"btn danger\",\n            onClick: () => removeMap(i),\n            children: \"x\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 721,\n            columnNumber: 15\n          }, this)]\n        }, i, true, {\n          fileName: _jsxFileName,\n          lineNumber: 718,\n          columnNumber: 13\n        }, this)), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"btn\",\n          onClick: addMapping,\n          children: \"+ adicionar mapeamento\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 724,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            fontSize: 12,\n            color: '#64748b',\n            marginTop: 8\n          },\n          children: [\"Use paths tipo \", /*#__PURE__*/_jsxDEV(\"code\", {\n            children: \"data.user.id\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 727,\n            columnNumber: 28\n          }, this), \". O executor gravar\\xE1 o valor em vari\\xE1veis.\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 726,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 689,\n        columnNumber: 9\n      }, this);\n    }\n\n    // CODE\n    if (n.type === 'code') {\n      const d = n.data || {};\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        style: panelWrap,\n        children: [label('Label'), /*#__PURE__*/_jsxDEV(\"input\", {\n          style: inputStyle,\n          value: d.label || 'Code',\n          onChange: e => patchNode(n.id, {\n            label: e.target.value\n          })\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 739,\n          columnNumber: 11\n        }, this), label('JavaScript'), /*#__PURE__*/_jsxDEV(\"textarea\", {\n          rows: 14,\n          style: {\n            ...inputStyle,\n            fontFamily: 'monospace'\n          },\n          value: d.code || '',\n          onChange: e => patchNode(n.id, {\n            code: e.target.value\n          }),\n          placeholder: `// Recebe \"context\" (variáveis atuais)\\n// deve retornar um objeto com novas variáveis\\nreturn { nova_variavel: 123 };`\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 742,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 737,\n        columnNumber: 9\n      }, this);\n    }\n\n    // AUDIENCE\n    if (n.type === 'audience') {\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        style: panelWrap,\n        children: /*#__PURE__*/_jsxDEV(AudiencePanel, {\n          node: n,\n          patchNode: patchNode,\n          inputStyle: inputStyle,\n          label: label,\n          slugFn: slug\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 757,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 756,\n        columnNumber: 9\n      }, this);\n    }\n\n    // DELAY\n    if (n.type === 'delay') {\n      var _d$amount;\n      const d = n.data || {};\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        style: panelWrap,\n        children: [label('Label'), /*#__PURE__*/_jsxDEV(\"input\", {\n          style: inputStyle,\n          value: d.label || 'Delay',\n          onChange: e => patchNode(n.id, {\n            label: e.target.value\n          })\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 768,\n          columnNumber: 11\n        }, this), label('Modo'), /*#__PURE__*/_jsxDEV(\"select\", {\n          style: inputStyle,\n          value: d.mode || 'relative',\n          onChange: e => patchNode(n.id, {\n            mode: e.target.value\n          }),\n          children: [/*#__PURE__*/_jsxDEV(\"option\", {\n            value: \"relative\",\n            children: \"Por per\\xEDodo (X unidades)\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 772,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n            value: \"until\",\n            children: \"At\\xE9 data/hora\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 773,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 771,\n          columnNumber: 11\n        }, this), (d.mode || 'relative') === 'relative' ? /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: [label('Quantidade'), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"number\",\n            min: \"1\",\n            step: \"1\",\n            style: inputStyle,\n            value: (_d$amount = d.amount) !== null && _d$amount !== void 0 ? _d$amount : 1,\n            onChange: e => patchNode(n.id, {\n              amount: Math.max(1, parseInt(e.target.value || '1', 10))\n            })\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 779,\n            columnNumber: 15\n          }, this), label('Unidade'), /*#__PURE__*/_jsxDEV(\"select\", {\n            style: inputStyle,\n            value: d.unit || 'hours',\n            onChange: e => patchNode(n.id, {\n              unit: e.target.value\n            }),\n            children: [/*#__PURE__*/_jsxDEV(\"option\", {\n              value: \"seconds\",\n              children: \"segundos\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 786,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n              value: \"minutes\",\n              children: \"minutos\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 787,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n              value: \"hours\",\n              children: \"horas\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 788,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n              value: \"days\",\n              children: \"dias\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 789,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n              value: \"weeks\",\n              children: \"semanas\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 790,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n              value: \"months\",\n              children: \"meses\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 791,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 785,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true) : /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: [label('Executar após (data/hora)'), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"datetime-local\",\n            style: inputStyle,\n            value: d.untilLocal || '',\n            onChange: e => {\n              const local = e.target.value;\n              let iso = '';\n              try {\n                iso = new Date(local).toISOString();\n              } catch {}\n              patchNode(n.id, {\n                untilLocal: local,\n                until: iso\n              });\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 797,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              fontSize: 12,\n              color: '#64748b'\n            },\n            children: [\"Ser\\xE1 convertido para UTC ao salvar. ISO: \", /*#__PURE__*/_jsxDEV(\"code\", {\n              children: d.until || '—'\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 809,\n              columnNumber: 58\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 808,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 766,\n        columnNumber: 9\n      }, this);\n    }\n\n    // START / END\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      style: panelWrap,\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          color: '#64748b'\n        },\n        children: \"Este n\\xF3 n\\xE3o possui propriedades.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 820,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 819,\n      columnNumber: 7\n    }, this);\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      display: 'grid',\n      gridTemplateColumns: '1fr 360px',\n      gap: 16,\n      height: 'calc(100vh - 80px)'\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        height: '100%',\n        border: '1px solid #e5e7eb',\n        borderRadius: 12\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          display: 'flex',\n          gap: 8,\n          padding: 12,\n          alignItems: 'center'\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"btn\",\n          onClick: () => window.location.href = '/journeys',\n          children: \"\\u2190 Voltar p/ lista\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 829,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"btn\",\n          onClick: addMessageNode,\n          children: \"+ Mensagem\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 831,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"btn\",\n          onClick: addApiNode,\n          children: \"+ API\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 832,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"btn\",\n          onClick: addCodeNode,\n          children: \"+ Code\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 833,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"btn\",\n          onClick: addAudienceNode,\n          children: \"+ Audi\\xEAncia\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 834,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"btn\",\n          onClick: addDelayNode,\n          children: \"+ Delay\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 835,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"btn\",\n          onClick: duplicateSelected,\n          children: \"Duplicar\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 837,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"btn danger\",\n          onClick: deleteSelected,\n          children: \"Delete selected\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 838,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            marginLeft: 'auto',\n            display: 'flex',\n            gap: 8,\n            alignItems: 'center'\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"btn\",\n            onClick: onImportClick,\n            children: \"Importar\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 841,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"btn\",\n            onClick: onExport,\n            children: \"Exportar\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 842,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"btn\",\n            onClick: handleSaveFlow,\n            children: \"Salvar flow\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 843,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 840,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          ref: fileRef,\n          type: \"file\",\n          accept: \"application/json\",\n          onChange: onImportFile,\n          style: {\n            display: 'none'\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 846,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 828,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(ReactFlow, {\n        nodes: nodes,\n        edges: edges,\n        nodeTypes: nodeTypes,\n        onNodesChange: onNodesChange,\n        onEdgesChange: onEdgesChange,\n        onConnect: onConnect,\n        fitView: true,\n        onSelectionChange: onSelectionChange,\n        children: [/*#__PURE__*/_jsxDEV(MiniMap, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 859,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Controls, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 860,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Background, {\n          gap: 16\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 861,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 849,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 827,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(PropertiesPanel, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 865,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 826,\n    columnNumber: 5\n  }, this);\n}\n_s2(JourneyBuilder, \"FzXqqgfzOMawOljwk/Q5+xlGJjc=\", false, function () {\n  return [useNodesState, useEdgesState];\n});\n_c0 = JourneyBuilder;\nvar _c, _c2, _c3, _c4, _c5, _c6, _c7, _c8, _c9, _c0;\n$RefreshReg$(_c, \"NodeShell\");\n$RefreshReg$(_c2, \"StartNode\");\n$RefreshReg$(_c3, \"EndNode\");\n$RefreshReg$(_c4, \"MessageNode\");\n$RefreshReg$(_c5, \"ApiNode\");\n$RefreshReg$(_c6, \"CodeNode\");\n$RefreshReg$(_c7, \"AudienceNode\");\n$RefreshReg$(_c8, \"DelayNode\");\n$RefreshReg$(_c9, \"AudiencePanel\");\n$RefreshReg$(_c0, \"JourneyBuilder\");","map":{"version":3,"names":["React","useCallback","useEffect","useMemo","useRef","useState","ReactFlow","Background","Controls","MiniMap","addEdge","useEdgesState","useNodesState","MarkerType","Handle","Position","Papa","saveAs","jsxDEV","_jsxDEV","Fragment","_Fragment","PIN_SIZE","uid","p","Date","now","Math","floor","random","slug","s","String","trim","toLowerCase","replace","NodeShell","title","subtitle","selected","children","style","background","border","borderRadius","width","boxShadow","padding","borderBottom","fontWeight","color","fileName","_jsxFileName","lineNumber","columnNumber","fontSize","_c","StartNode","type","position","Right","id","height","_c2","EndNode","Left","_c3","MessageNode","data","label","channel","toUpperCase","mode","_c4","ApiNode","_c5","CodeNode","_c6","AudienceNode","_c7","DelayNode","_data$amount","until","toLocaleString","amount","unit","_c8","AudiencePanel","node","patchNode","inputStyle","slugFn","_s","d","headers","setHeaders","rows","setRows","mapping","setMapping","phoneKey","setPhoneKey","onFile","e","_e$target$files","f","target","files","parse","header","skipEmptyLines","complete","res","hs","meta","fields","Object","keys","guess","forEach","h","pk","find","test","slice","saveMap","alert","accept","onChange","length","value","map","display","gridTemplateColumns","gap","maxHeight","overflow","alignSelf","textAlign","placeholder","m","className","onClick","marginTop","JSON","stringify","_c9","JourneyBuilder","_s2","nodes","setNodes","onNodesChange","x","y","selectable","edges","setEdges","onEdgesChange","flowId","setFlowId","flowName","setFlowName","sp","URLSearchParams","window","location","search","get","fetch","then","r","ok","json","Promise","reject","Array","isArray","name","catch","raw","localStorage","getItem","selectedId","setSelectedId","selectedNode","n","templates","setTemplates","contents","patch","nds","onConnect","params","eds","filtered","filter","source","stroke","markerEnd","ArrowClosed","onSelectionChange","ns","_ns$0$id","_ns$","addMessageNode","text","addApiNode","method","url","body","mappings","lastResponse","addCodeNode","code","addAudienceNode","addDelayNode","untilLocal","duplicateSelected","deleteSelected","handleSaveFlow","entered","prompt","payload","updatedAt","toISOString","Error","saved","history","replaceState","setItem","fileRef","onImportClick","_fileRef$current","current","click","onImportFile","_e$target$files2","reader","FileReader","onload","result","err","message","readAsText","onExport","exportedAt","blob","Blob","nodeTypes","start","end","api","audience","delay","small","marginBottom","t","panelWrap","TemplatesOptions","sid","friendly_name","PropertiesPanel","_Object$values$","found","templateSid","firstTypeBody","values","types","val","readOnly","fontFamily","mediaUrl","buttonsJson","tryParse","txt","testRequest","undefined","addMapping","push","path","var","updateMap","idx","removeMap","splice","i","_d$amount","min","step","max","parseInt","local","iso","alignItems","href","marginLeft","ref","fitView","_c0","$RefreshReg$"],"sources":["/Users/gustsantos/Desktop/initucastt/frontend/src/pages/JourneyBuilder.jsx"],"sourcesContent":["// frontend/src/pages/JourneyBuilder.jsx\nimport React, { useCallback, useEffect, useMemo, useRef, useState } from 'react';\nimport ReactFlow, {\n  Background,\n  Controls,\n  MiniMap,\n  addEdge,\n  useEdgesState,\n  useNodesState,\n  MarkerType,\n  Handle,\n  Position,\n} from 'reactflow';\nimport 'reactflow/dist/style.css';\nimport Papa from 'papaparse';\nimport { saveAs } from 'file-saver';\n\nconst PIN_SIZE = 14;\n\n// ---------- helpers ----------\nconst uid = (p) => `${p}_${Date.now()}_${Math.floor(Math.random() * 9999)}`;\nconst slug = (s) =>\n  String(s || '')\n    .trim()\n    .toLowerCase()\n    .replace(/\\s+/g, '_')\n    .replace(/[^\\w]/g, '_')\n    .replace(/_+/g, '_');\n\nconst NodeShell = ({ title, subtitle, selected, children }) => (\n  <div\n    style={{\n      background: '#fff',\n      border: selected ? '2px solid #2563eb' : '1px solid #e5e7eb',\n      borderRadius: 12,\n      width: 320,\n      boxShadow: '0 2px 8px rgba(0,0,0,.06)',\n    }}\n  >\n    <div style={{ padding: '12px 14px', borderBottom: '1px solid #f1f5f9' }}>\n      <div style={{ fontWeight: 700, color: '#0f172a' }}>{title}</div>\n      {subtitle ? (\n        <div style={{ fontSize: 12, color: '#64748b' }}>{subtitle}</div>\n      ) : null}\n    </div>\n    <div style={{ padding: 12 }}>{children}</div>\n  </div>\n);\n\n// ---------- node components ----------\nconst StartNode = ({ selected }) => (\n  <NodeShell title=\"Start\" subtitle=\"início do fluxo\" selected={selected}>\n    <div style={{ fontSize: 12, color: '#475569' }}>\n      Arraste do pino verde para o próximo nó.\n    </div>\n    <Handle\n      type=\"source\"\n      position={Position.Right}\n      id=\"out\"\n      style={{ background: '#16a34a', width: PIN_SIZE, height: PIN_SIZE, border: '2px solid #fff' }}\n    />\n  </NodeShell>\n);\n\nconst EndNode = ({ selected }) => (\n  <NodeShell title=\"End\" subtitle=\"término do fluxo\" selected={selected}>\n    <div style={{ fontSize: 12, color: '#475569' }}>Nó terminal. Só recebe conexões.</div>\n    <Handle\n      type=\"target\"\n      position={Position.Left}\n      id=\"in\"\n      style={{ background: '#6b7280', width: PIN_SIZE, height: PIN_SIZE, border: '2px solid #fff' }}\n    />\n  </NodeShell>\n);\n\nconst MessageNode = ({ data, selected }) => (\n  <NodeShell\n    title={data.label || 'Mensagem'}\n    subtitle={`Canal: ${String(data.channel || 'whatsapp').toUpperCase()} • Tipo: ${data.mode || 'text'}`}\n    selected={selected}\n  >\n    <div style={{ fontSize: 12, color: '#475569' }}>Conteúdo configurável no painel ao lado.</div>\n    <Handle\n      type=\"target\"\n      position={Position.Left}\n      id=\"in\"\n      style={{ background: '#6b7280', width: PIN_SIZE, height: PIN_SIZE, border: '2px solid #fff' }}\n    />\n    <Handle\n      type=\"source\"\n      position={Position.Right}\n      id=\"out\"\n      style={{ background: '#16a34a', width: PIN_SIZE, height: PIN_SIZE, border: '2px solid #fff' }}\n    />\n  </NodeShell>\n);\n\nconst ApiNode = ({ selected }) => (\n  <NodeShell title=\"API Call\" selected={selected}>\n    <div style={{ fontSize: 12, color: '#475569' }}>\n      Configure método/URL no painel ao lado. Salva variáveis via mapeamentos.\n    </div>\n    <Handle\n      type=\"target\"\n      position={Position.Left}\n      id=\"in\"\n      style={{ background: '#6b7280', width: PIN_SIZE, height: PIN_SIZE, border: '2px solid #fff' }}\n    />\n    <Handle\n      type=\"source\"\n      position={Position.Right}\n      id=\"out\"\n      style={{ background: '#16a34a', width: PIN_SIZE, height: PIN_SIZE, border: '2px solid #fff' }}\n    />\n  </NodeShell>\n);\n\nconst CodeNode = ({ selected }) => (\n  <NodeShell title=\"Code\" subtitle=\"JS custom\" selected={selected}>\n    <div style={{ fontSize: 12, color: '#475569' }}>\n      Cole seu JS no painel ao lado. Deve retornar um objeto de variáveis.\n    </div>\n    <Handle\n      type=\"target\"\n      position={Position.Left}\n      id=\"in\"\n      style={{ background: '#6b7280', width: PIN_SIZE, height: PIN_SIZE, border: '2px solid #fff' }}\n    />\n    <Handle\n      type=\"source\"\n      position={Position.Right}\n      id=\"out\"\n      style={{ background: '#16a34a', width: PIN_SIZE, height: PIN_SIZE, border: '2px solid #fff' }}\n    />\n  </NodeShell>\n);\n\nconst AudienceNode = ({ selected }) => (\n  <NodeShell title=\"Audiência\" subtitle=\"CSV → variáveis\" selected={selected}>\n    <div style={{ fontSize: 12, color: '#475569' }}>\n      Faça upload e mapeie colunas no painel ao lado.\n    </div>\n    <Handle\n      type=\"target\"\n      position={Position.Left}\n      id=\"in\"\n      style={{ background: '#6b7280', width: PIN_SIZE, height: PIN_SIZE, border: '2px solid #fff' }}\n    />\n    <Handle\n      type=\"source\"\n      position={Position.Right}\n      id=\"out\"\n      style={{ background: '#16a34a', width: PIN_SIZE, height: PIN_SIZE, border: '2px solid #fff' }}\n    />\n  </NodeShell>\n);\n\n// --- DelayNode ---\nconst DelayNode = ({ data = {}, selected }) => {\n  const subtitle =\n    data.mode === 'until'\n      ? `até ${data.until ? new Date(data.until).toLocaleString() : '—'}`\n      : `+ ${(data.amount ?? 1)} ${data.unit || 'hours'}`;\n\n  return (\n    <NodeShell title=\"Delay\" subtitle={subtitle} selected={selected}>\n      <div style={{ fontSize: 12, color: '#475569' }}>\n        Espera antes de seguir para o próximo nó.\n      </div>\n      <Handle\n        type=\"target\"\n        position={Position.Left}\n        id=\"in\"\n        style={{ background: '#6b7280', width: PIN_SIZE, height: PIN_SIZE, border: '2px solid #fff' }}\n      />\n      <Handle\n        type=\"source\"\n        position={Position.Right}\n        id=\"out\"\n        style={{ background: '#16a34a', width: PIN_SIZE, height: PIN_SIZE, border: '2px solid #fff' }}\n      />\n    </NodeShell>\n  );\n};\n\n// ---------- side panel pieces ----------\nfunction AudiencePanel({ node, patchNode, inputStyle, label, slugFn }) {\n  const d = node.data || {};\n  const [headers, setHeaders] = useState(d.headers || []);\n  const [rows, setRows] = useState(d.rows || []);\n  const [mapping, setMapping] = useState(d.mapping || {});\n  const [phoneKey, setPhoneKey] = useState(d.phoneKey || '');\n\n  useEffect(() => {\n    setHeaders(d.headers || []);\n    setRows(d.rows || []);\n    setMapping(d.mapping || {});\n    setPhoneKey(d.phoneKey || '');\n  }, [node.id]);\n\n  const onFile = (e) => {\n    const f = e.target.files?.[0];\n    if (!f) return;\n    Papa.parse(f, {\n      header: true,\n      skipEmptyLines: true,\n      complete: (res) => {\n        const hs = res.meta.fields || Object.keys(res.data[0] || {});\n        const guess = {};\n        hs.forEach((h) => (guess[h] = slugFn(h)));\n        const pk =\n          hs.find((h) => /phone|telefone|celular|numero|n[uú]mero/i.test(h)) || '';\n        setHeaders(hs);\n        setRows(res.data.slice(0, 5));\n        setMapping(guess);\n        setPhoneKey(pk);\n      },\n    });\n  };\n\n  const saveMap = () => {\n    if (!phoneKey) {\n      alert('Escolha a coluna de telefone.');\n      return;\n    }\n    patchNode(node.id, { headers, rows, mapping, phoneKey });\n    alert('Mapeamento salvo.');\n  };\n\n  return (\n    <>\n      {label('Arquivo CSV')}\n      <input type=\"file\" accept=\".csv\" onChange={onFile} />\n\n      {headers.length > 0 && (\n        <>\n          {label('Coluna de telefone')}\n          <select\n            style={inputStyle}\n            value={phoneKey}\n            onChange={(e) => setPhoneKey(e.target.value)}\n          >\n            <option value=\"\">— selecione —</option>\n            {headers.map((h) => (\n              <option key={h} value={h}>{h}</option>\n            ))}\n          </select>\n\n          {label('Mapeamento (coluna → variável)')}\n          <div style={{ display: 'grid', gridTemplateColumns: '1fr 20px 1fr', gap: 8, maxHeight: 200, overflow: 'auto' }}>\n            {headers.map((h) => (\n              <React.Fragment key={h}>\n                <div style={{ alignSelf: 'center', fontSize: 13 }}>{h}</div>\n                <div style={{ textAlign: 'center', color: '#94a3b8' }}>→</div>\n                <input\n                  style={inputStyle}\n                  value={mapping[h] || ''}\n                  placeholder={slugFn(h)}\n                  onChange={(e) =>\n                    setMapping((m) => ({ ...m, [h]: slugFn(e.target.value) }))\n                  }\n                />\n              </React.Fragment>\n            ))}\n          </div>\n\n          <button className=\"btn\" onClick={saveMap} style={{ marginTop: 10 }}>\n            Salvar mapeamento\n          </button>\n\n          {rows.length > 0 && (\n            <>\n              {label('Amostra (5 primeiras linhas)')}\n              <pre\n                style={{\n                  background: '#f8fafc',\n                  border: '1px solid #e2e8f0',\n                  borderRadius: 8,\n                  padding: 10,\n                  fontSize: 12,\n                  maxHeight: 160,\n                  overflow: 'auto',\n                }}\n              >\n                {JSON.stringify(rows, null, 2)}\n              </pre>\n            </>\n          )}\n          <div style={{ fontSize: 12, color: '#64748b', marginTop: 8 }}>\n            Dica: após salvar, use as variáveis com <code>{'{{minha_variavel}}'}</code>.\n          </div>\n        </>\n      )}\n    </>\n  );\n}\n\n// ---------- main page ----------\nexport default function JourneyBuilder() {\n  // nodes/edges\n  const [nodes, setNodes, onNodesChange] = useNodesState([\n    { id: 'start', type: 'start', position: { x: 140, y: 140 }, data: {}, selectable: true },\n    { id: 'end', type: 'end', position: { x: 860, y: 140 }, data: {}, selectable: true },\n  ]);\n  const [edges, setEdges, onEdgesChange] = useEdgesState([]);\n\n  // flow id & name (carrega por ?id=)\n  const [flowId, setFlowId] = useState(null);\n  const [flowName, setFlowName] = useState('Novo Flow');\n\n  useEffect(() => {\n    const sp = new URLSearchParams(window.location.search);\n    const id = sp.get('id');\n    if (!id) return;\n    setFlowId(id);\n\n    fetch(`/api/journeys/${id}`)\n      .then((r) => (r.ok ? r.json() : Promise.reject()))\n      .then((f) => {\n        if (Array.isArray(f.nodes) && Array.isArray(f.edges)) {\n          setNodes(f.nodes);\n          setEdges(f.edges);\n          if (f.name) setFlowName(f.name);\n        }\n      })\n      .catch(() => {\n        const raw = localStorage.getItem(id);\n        if (raw) {\n          try {\n            const f = JSON.parse(raw);\n            if (Array.isArray(f.nodes) && Array.isArray(f.edges)) {\n              setNodes(f.nodes);\n              setEdges(f.edges);\n              if (f.name) setFlowName(f.name);\n            }\n          } catch {}\n        }\n      });\n  }, [setEdges, setNodes]);\n\n  // selection\n  const [selectedId, setSelectedId] = useState(null);\n  const selectedNode = useMemo(\n    () => nodes.find((n) => n.id === selectedId),\n    [nodes, selectedId]\n  );\n\n  // templates (Twilio)\n  const [templates, setTemplates] = useState([]);\n  useEffect(() => {\n    fetch('/api/templates/list')\n      .then((r) => r.json())\n      .then((data) => setTemplates(data.contents || []))\n      .catch(() => setTemplates([]));\n  }, []);\n\n  // centralized patch\n  const patchNode = useCallback((id, patch) => {\n    setNodes((nds) => nds.map((n) => (n.id === id ? { ...n, data: { ...n.data, ...patch } } : n)));\n  }, [setNodes]);\n\n  // 1 saída por nó\n  const onConnect = useCallback((params) => {\n    setEdges((eds) => {\n      const filtered = eds.filter((e) => e.source !== params.source);\n      return addEdge(\n        {\n          ...params,\n          type: 'smoothstep',\n          style: { stroke: '#0f172a' },\n          markerEnd: { type: MarkerType.ArrowClosed, color: '#0f172a' },\n        },\n        filtered\n      );\n    });\n  }, [setEdges]);\n\n  const onSelectionChange = useCallback(({ nodes: ns }) => {\n    setSelectedId(ns?.[0]?.id ?? null);\n  }, []);\n\n  // adders\n  const addMessageNode = () => {\n    const id = uid('msg');\n    setNodes((nds) => [...nds, {\n      id, type: 'message', position: { x: 360, y: 240 },\n      data: { label: 'Mensagem', channel: 'whatsapp', mode: 'text', text: '' },\n    }]);\n  };\n  const addApiNode = () => {\n    const id = uid('api');\n    setNodes((nds) => [...nds, {\n      id, type: 'api', position: { x: 480, y: 340 },\n      data: { label: 'API Call', method: 'GET', url: '', headers: '{}', body: '{}', mappings: [], lastResponse: '' },\n    }]);\n  };\n  const addCodeNode = () => {\n    const id = uid('code');\n    setNodes((nds) => [...nds, {\n      id, type: 'code', position: { x: 560, y: 200 },\n      data: { label: 'Code', code: '// return { nova_variavel: 123 };' },\n    }]);\n  };\n  const addAudienceNode = () => {\n    const id = uid('aud');\n    setNodes((nds) => [...nds, {\n      id, type: 'audience', position: { x: 320, y: 420 },\n      data: { headers: [], rows: [], mapping: {}, phoneKey: '' },\n    }]);\n  };\n  const addDelayNode = () => {\n    const id = uid('delay');\n    setNodes((nds) => [...nds, {\n      id, type: 'delay', position: { x: 420, y: 280 },\n      data: { label: 'Delay', mode: 'relative', amount: 1, unit: 'hours', until: '', untilLocal: '' },\n    }]);\n  };\n\n  const duplicateSelected = () => {\n    if (!selectedNode) return;\n    const id = uid(selectedNode.type);\n    setNodes((nds) => [...nds, {\n      ...selectedNode,\n      id,\n      position: { x: selectedNode.position.x + 40, y: selectedNode.position.y + 40 },\n      selected: false,\n    }]);\n  };\n\n  const deleteSelected = () => {\n    if (!selectedNode) return;\n    setEdges((eds) => eds.filter((e) => e.source !== selectedNode.id && e.target !== selectedNode.id));\n    setNodes((nds) => nds.filter((n) => n.id !== selectedNode.id));\n    setSelectedId(null);\n  };\n\n  // salvar flow (backend se existir; senão localStorage)\n  const handleSaveFlow = async () => {\n    let name = flowName || 'Novo Flow';\n    if (!flowId && (!name || name === 'Novo Flow')) {\n      const entered = window.prompt('Dê um nome para este flow:', name);\n      if (entered && entered.trim()) {\n        name = entered.trim();\n        setFlowName(name);\n      }\n    }\n    const payload = {\n      id: flowId || 'flow_' + Date.now(),\n      name,\n      nodes,\n      edges,\n      updatedAt: new Date().toISOString(),\n    };\n\n    try {\n      const url = flowId ? `/api/journeys/${flowId}` : '/api/journeys';\n      const method = flowId ? 'PUT' : 'POST';\n      const res = await fetch(url, {\n        method,\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(payload),\n      });\n      if (!res.ok) throw new Error('no backend');\n      const saved = await res.json();\n      alert('Flow salvo no backend!');\n      if (!flowId && saved?.id) {\n        window.history.replaceState(null, '', `/journeys/builder?id=${saved.id}`);\n        setFlowId(saved.id);\n      }\n    } catch {\n      localStorage.setItem(payload.id, JSON.stringify(payload));\n      alert('Flow salvo no navegador.');\n      if (!flowId) {\n        window.history.replaceState(null, '', `/journeys/builder?id=${payload.id}`);\n        setFlowId(payload.id);\n      }\n    }\n  };\n\n  // import/export\n  const fileRef = useRef(null);\n  const onImportClick = () => fileRef.current?.click();\n  const onImportFile = (e) => {\n    const f = e.target.files?.[0];\n    if (!f) return;\n    const reader = new FileReader();\n    reader.onload = () => {\n      try {\n        const json = JSON.parse(String(reader.result || '{}'));\n        if (Array.isArray(json.nodes) && Array.isArray(json.edges)) {\n          setNodes(json.nodes);\n          setEdges(json.edges);\n          if (json.id) setFlowId(json.id);\n          if (json.name) setFlowName(json.name);\n          alert('Flow importado.');\n        } else {\n          alert('Arquivo inválido.');\n        }\n      } catch (err) {\n        alert('Falha ao importar: ' + (err?.message || 'erro'));\n      }\n    };\n    reader.readAsText(f);\n    // reset input\n    e.target.value = '';\n  };\n\n  const onExport = () => {\n    const data = {\n      id: flowId || 'flow_unsaved',\n      name: flowName || 'Novo Flow',\n      nodes,\n      edges,\n      exportedAt: new Date().toISOString(),\n    };\n    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json;charset=utf-8' });\n    saveAs(blob, `${slug(data.name || 'flow')}.json`);\n  };\n\n  // node types\n  const nodeTypes = useMemo(\n    () => ({\n      start: StartNode,\n      end: EndNode,\n      message: MessageNode,\n      api: ApiNode,\n      code: CodeNode,\n      audience: AudienceNode,\n      delay: DelayNode,\n    }),\n    []\n  );\n\n  // ---------- properties panel ----------\n  const inputStyle = {\n    width: '100%',\n    border: '1px solid #cbd5e1',\n    borderRadius: 8,\n    padding: '10px 12px',\n  };\n  const small = { fontSize: 12, color: '#475569', marginBottom: 6 };\n  const label = (t) => <div style={small}>{t}</div>;\n  const panelWrap = {\n    background: '#fff',\n    border: '1px solid #e5e7eb',\n    borderRadius: 12,\n    padding: 16,\n  };\n\n  const TemplatesOptions = ({ value, onChange }) => (\n    <select value={value || ''} onChange={(e) => onChange(e.target.value)} style={inputStyle}>\n      <option value=\"\">— none —</option>\n      {templates.map((t) => (\n        <option key={t.sid} value={t.sid}>{t.friendly_name || t.sid}</option>\n      ))}\n    </select>\n  );\n\n  const PropertiesPanel = () => {\n    if (!selectedNode) {\n      return (\n        <div style={panelWrap}>\n          <div style={{ color: '#94a3b8' }}>Selecione um nó.</div>\n        </div>\n      );\n    }\n\n    const n = selectedNode;\n\n    // MESSAGE\n    if (n.type === 'message') {\n      const d = n.data || {};\n      const found = d.templateSid ? templates.find((t) => t.sid === d.templateSid) : null;\n      const firstTypeBody = found ? (Object.values(found.types || {})[0]?.body || '') : '';\n\n      return (\n        <div style={panelWrap}>\n          {label('Label')}\n          <input style={inputStyle} value={d.label || ''} onChange={(e) => patchNode(n.id, { label: e.target.value })} />\n\n          {label('Canal')}\n          <select style={inputStyle} value={d.channel || 'whatsapp'} onChange={(e) => patchNode(n.id, { channel: e.target.value })}>\n            <option value=\"whatsapp\">WhatsApp</option>\n            <option value=\"sms\">SMS</option>\n          </select>\n\n          {label('Mode')}\n          <select style={inputStyle} value={d.mode || 'text'} onChange={(e) => patchNode(n.id, { mode: e.target.value })}>\n            <option value=\"text\">Text</option>\n            <option value=\"rich\">Rich (text + image + buttons)</option>\n          </select>\n\n          {label('Pick a Twilio template (optional)')}\n          <TemplatesOptions value={d.templateSid} onChange={(val) => patchNode(n.id, { templateSid: val })} />\n\n          {found && (\n            <>\n              {label('Template preview')}\n              <textarea readOnly rows={6} style={{ ...inputStyle, fontFamily: 'monospace' }} value={firstTypeBody} />\n            </>\n          )}\n\n          {label('Text')}\n          <textarea\n            rows={8}\n            style={inputStyle}\n            value={d.text || ''}\n            onChange={(e) => patchNode(n.id, { text: e.target.value })}\n            placeholder=\"Olá {{nome}}!\"\n          />\n\n          {d.mode === 'rich' && (\n            <>\n              {label('Media URL')}\n              <input\n                style={inputStyle}\n                value={d.mediaUrl || ''}\n                onChange={(e) => patchNode(n.id, { mediaUrl: e.target.value })}\n                placeholder=\"https://...\"\n              />\n\n              {label('Buttons (JSON opcional)')}\n              <textarea\n                rows={6}\n                style={inputStyle}\n                value={d.buttonsJson || ''}\n                onChange={(e) => patchNode(n.id, { buttonsJson: e.target.value })}\n                placeholder='[{\"type\":\"reply\",\"title\":\"Sim\",\"id\":\"YES\"}]'\n              />\n            </>\n          )}\n\n          <div style={{ fontSize: 12, color: '#64748b', marginTop: 8 }}>\n            Dica: use variáveis como <code>{'{{nome}}'}</code>.\n          </div>\n        </div>\n      );\n    }\n\n    // API\n    if (n.type === 'api') {\n      const d = n.data || {};\n      const tryParse = (txt) => {\n        try { return JSON.stringify(JSON.parse(txt), null, 2); }\n        catch { return txt; }\n      };\n\n      const testRequest = async () => {\n        try {\n          const headers = d.headers ? JSON.parse(d.headers) : {};\n          const body =\n            d.method === 'GET' || d.method === 'DELETE'\n              ? undefined\n              : d.body && d.body.trim() !== '{}'\n              ? JSON.parse(d.body)\n              : undefined;\n\n          const res = await fetch(d.url, {\n            method: d.method || 'GET',\n            headers,\n            body: body ? JSON.stringify(body) : undefined,\n          });\n          const text = await res.text();\n          patchNode(n.id, { lastResponse: text });\n          alert('Request executada. Veja a resposta abaixo.');\n        } catch (e) {\n          alert('Falha ao executar request: ' + e.message);\n        }\n      };\n\n      const addMapping = () => {\n        const m = Array.isArray(d.mappings) ? d.mappings.slice() : [];\n        m.push({ path: '', var: '' });\n        patchNode(n.id, { mappings: m });\n      };\n      const updateMap = (idx, patch) => {\n        const m = (d.mappings || []).slice();\n        m[idx] = { ...m[idx], ...patch };\n        patchNode(n.id, { mappings: m });\n      };\n      const removeMap = (idx) => {\n        const m = (d.mappings || []).slice();\n        m.splice(idx, 1);\n        patchNode(n.id, { mappings: m });\n      };\n\n      return (\n        <div style={panelWrap}>\n          {label('Label')}\n          <input style={inputStyle} value={d.label || 'API Call'} onChange={(e) => patchNode(n.id, { label: e.target.value })} />\n\n          {label('Método')}\n          <select style={inputStyle} value={d.method || 'GET'} onChange={(e) => patchNode(n.id, { method: e.target.value })}>\n            <option>GET</option><option>POST</option><option>PUT</option><option>PATCH</option><option>DELETE</option>\n          </select>\n\n          {label('URL')}\n          <input style={inputStyle} placeholder=\"https://api.meuservico.com/...\" value={d.url || ''} onChange={(e) => patchNode(n.id, { url: e.target.value })} />\n\n          {label('Headers (JSON)')}\n          <textarea rows={4} style={inputStyle} value={d.headers || '{}'} onChange={(e) => patchNode(n.id, { headers: e.target.value })} />\n\n          {(d.method === 'POST' || d.method === 'PUT' || d.method === 'PATCH') && (\n            <>\n              {label('Body (JSON)')}\n              <textarea rows={6} style={inputStyle} value={d.body || '{}'} onChange={(e) => patchNode(n.id, { body: e.target.value })} />\n            </>\n          )}\n\n          <button className=\"btn\" onClick={testRequest} style={{ marginTop: 10 }}>Executar request</button>\n\n          {label('Resposta (último teste)')}\n          <textarea rows={8} style={{ ...inputStyle, fontFamily: 'monospace' }} readOnly value={tryParse(d.lastResponse || '')} />\n\n          {label('Mapeamentos JSON → Variáveis')}\n          {(d.mappings || []).map((m, i) => (\n            <div key={i} style={{ display: 'grid', gridTemplateColumns: '1fr 1fr auto', gap: 8, marginBottom: 8 }}>\n              <input style={inputStyle} placeholder=\"ex.: data.user.id\" value={m.path} onChange={(e) => updateMap(i, { path: e.target.value })} />\n              <input style={inputStyle} placeholder=\"ex.: user_id\" value={m.var} onChange={(e) => updateMap(i, { var: slug(e.target.value) })} />\n              <button className=\"btn danger\" onClick={() => removeMap(i)}>x</button>\n            </div>\n          ))}\n          <button className=\"btn\" onClick={addMapping}>+ adicionar mapeamento</button>\n\n          <div style={{ fontSize: 12, color: '#64748b', marginTop: 8 }}>\n            Use paths tipo <code>data.user.id</code>. O executor gravará o valor em variáveis.\n          </div>\n        </div>\n      );\n    }\n\n    // CODE\n    if (n.type === 'code') {\n      const d = n.data || {};\n      return (\n        <div style={panelWrap}>\n          {label('Label')}\n          <input style={inputStyle} value={d.label || 'Code'} onChange={(e) => patchNode(n.id, { label: e.target.value })} />\n\n          {label('JavaScript')}\n          <textarea\n            rows={14}\n            style={{ ...inputStyle, fontFamily: 'monospace' }}\n            value={d.code || ''}\n            onChange={(e) => patchNode(n.id, { code: e.target.value })}\n            placeholder={`// Recebe \"context\" (variáveis atuais)\\n// deve retornar um objeto com novas variáveis\\nreturn { nova_variavel: 123 };`}\n          />\n        </div>\n      );\n    }\n\n    // AUDIENCE\n    if (n.type === 'audience') {\n      return (\n        <div style={panelWrap}>\n          <AudiencePanel node={n} patchNode={patchNode} inputStyle={inputStyle} label={label} slugFn={slug} />\n        </div>\n      );\n    }\n\n    // DELAY\n    if (n.type === 'delay') {\n      const d = n.data || {};\n      return (\n        <div style={panelWrap}>\n          {label('Label')}\n          <input style={inputStyle} value={d.label || 'Delay'} onChange={(e) => patchNode(n.id, { label: e.target.value })} />\n\n          {label('Modo')}\n          <select style={inputStyle} value={d.mode || 'relative'} onChange={(e) => patchNode(n.id, { mode: e.target.value })}>\n            <option value=\"relative\">Por período (X unidades)</option>\n            <option value=\"until\">Até data/hora</option>\n          </select>\n\n          {(d.mode || 'relative') === 'relative' ? (\n            <>\n              {label('Quantidade')}\n              <input\n                type=\"number\" min=\"1\" step=\"1\" style={inputStyle}\n                value={d.amount ?? 1}\n                onChange={(e) => patchNode(n.id, { amount: Math.max(1, parseInt(e.target.value || '1', 10)) })}\n              />\n              {label('Unidade')}\n              <select style={inputStyle} value={d.unit || 'hours'} onChange={(e) => patchNode(n.id, { unit: e.target.value })}>\n                <option value=\"seconds\">segundos</option>\n                <option value=\"minutes\">minutos</option>\n                <option value=\"hours\">horas</option>\n                <option value=\"days\">dias</option>\n                <option value=\"weeks\">semanas</option>\n                <option value=\"months\">meses</option>\n              </select>\n            </>\n          ) : (\n            <>\n              {label('Executar após (data/hora)')}\n              <input\n                type=\"datetime-local\"\n                style={inputStyle}\n                value={d.untilLocal || ''}\n                onChange={(e) => {\n                  const local = e.target.value;\n                  let iso = '';\n                  try { iso = new Date(local).toISOString(); } catch {}\n                  patchNode(n.id, { untilLocal: local, until: iso });\n                }}\n              />\n              <div style={{ fontSize: 12, color: '#64748b' }}>\n                Será convertido para UTC ao salvar. ISO: <code>{d.until || '—'}</code>\n              </div>\n            </>\n          )}\n        </div>\n      );\n    }\n\n    // START / END\n    return (\n      <div style={panelWrap}>\n        <div style={{ color: '#64748b' }}>Este nó não possui propriedades.</div>\n      </div>\n    );\n  };\n\n  return (\n    <div style={{ display: 'grid', gridTemplateColumns: '1fr 360px', gap: 16, height: 'calc(100vh - 80px)' }}>\n      <div style={{ height: '100%', border: '1px solid #e5e7eb', borderRadius: 12 }}>\n        <div style={{ display: 'flex', gap: 8, padding: 12, alignItems: 'center' }}>\n          <button className=\"btn\" onClick={() => (window.location.href = '/journeys')}>← Voltar p/ lista</button>\n\n          <button className=\"btn\" onClick={addMessageNode}>+ Mensagem</button>\n          <button className=\"btn\" onClick={addApiNode}>+ API</button>\n          <button className=\"btn\" onClick={addCodeNode}>+ Code</button>\n          <button className=\"btn\" onClick={addAudienceNode}>+ Audiência</button>\n          <button className=\"btn\" onClick={addDelayNode}>+ Delay</button>\n\n          <button className=\"btn\" onClick={duplicateSelected}>Duplicar</button>\n          <button className=\"btn danger\" onClick={deleteSelected}>Delete selected</button>\n\n          <div style={{ marginLeft: 'auto', display: 'flex', gap: 8, alignItems: 'center' }}>\n            <button className=\"btn\" onClick={onImportClick}>Importar</button>\n            <button className=\"btn\" onClick={onExport}>Exportar</button>\n            <button className=\"btn\" onClick={handleSaveFlow}>Salvar flow</button>\n          </div>\n\n          <input ref={fileRef} type=\"file\" accept=\"application/json\" onChange={onImportFile} style={{ display: 'none' }} />\n        </div>\n\n        <ReactFlow\n          nodes={nodes}\n          edges={edges}\n          nodeTypes={nodeTypes}\n          onNodesChange={onNodesChange}\n          onEdgesChange={onEdgesChange}\n          onConnect={onConnect}\n          fitView\n          onSelectionChange={onSelectionChange}\n        >\n          <MiniMap />\n          <Controls />\n          <Background gap={16} />\n        </ReactFlow>\n      </div>\n\n      <PropertiesPanel />\n    </div>\n  );\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}