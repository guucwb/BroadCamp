{"ast":null,"code":"var _jsxFileName = \"/Users/gustsantos/Desktop/initucastt_old/frontend/src/pages/JourneyBuilder.jsx\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$(),\n  _s5 = $RefreshSig$();\n// frontend/src/pages/JourneyBuilder.jsx\nimport React, { useCallback, useEffect, useMemo, useRef, useState } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport ReactFlow, { Background, Controls, MiniMap, addEdge, useEdgesState, useNodesState, MarkerType, Handle, Position } from 'reactflow';\nimport 'reactflow/dist/style.css';\nimport Papa from 'papaparse';\n\n// === util ===\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst PIN = 14;\nconst uid = p => `${p}_${Date.now()}_${Math.floor(Math.random() * 9999)}`;\nconst slug = s => String(s || '').trim().toLowerCase().replace(/\\s+/g, '_').replace(/[^\\w]/g, '_').replace(/_+/g, '_');\nconst NodeShell = ({\n  title,\n  subtitle,\n  selected,\n  children\n}) => /*#__PURE__*/_jsxDEV(\"div\", {\n  style: {\n    background: '#fff',\n    border: selected ? '2px solid #2563eb' : '1px solid #e5e7eb',\n    borderRadius: 12,\n    width: 320,\n    boxShadow: '0 2px 8px rgba(0,0,0,.06)'\n  },\n  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      padding: '12px 14px',\n      borderBottom: '1px solid #f1f5f9'\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        fontWeight: 700,\n        color: '#0f172a'\n      },\n      children: title\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 40,\n      columnNumber: 7\n    }, this), subtitle ? /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        fontSize: 12,\n        color: '#64748b'\n      },\n      children: subtitle\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 41,\n      columnNumber: 19\n    }, this) : null]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 39,\n    columnNumber: 5\n  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      padding: 12\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 43,\n    columnNumber: 5\n  }, this)]\n}, void 0, true, {\n  fileName: _jsxFileName,\n  lineNumber: 30,\n  columnNumber: 3\n}, this);\n\n// === node components ===\n_c = NodeShell;\nconst AudienceNode = ({\n  selected\n}) => /*#__PURE__*/_jsxDEV(NodeShell, {\n  title: \"Audi\\xEAncia\",\n  subtitle: \"CSV \\u2192 vari\\xE1veis\",\n  selected: selected,\n  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      fontSize: 12,\n      color: '#475569'\n    },\n    children: \"Fa\\xE7a upload e mapeie colunas no painel ao lado.\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 50,\n    columnNumber: 5\n  }, this), /*#__PURE__*/_jsxDEV(Handle, {\n    type: \"source\",\n    id: \"out\",\n    position: Position.Right,\n    style: {\n      background: '#16a34a',\n      width: PIN,\n      height: PIN,\n      border: '2px solid #fff'\n    }\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 53,\n    columnNumber: 5\n  }, this)]\n}, void 0, true, {\n  fileName: _jsxFileName,\n  lineNumber: 49,\n  columnNumber: 3\n}, this);\n_c2 = AudienceNode;\nconst MessageNode = ({\n  data,\n  selected\n}) => /*#__PURE__*/_jsxDEV(NodeShell, {\n  title: data.label || 'Mensagem',\n  subtitle: `Canal: ${String(data.channel || 'whatsapp').toUpperCase()} • Tipo: ${data.mode || 'text'}`,\n  selected: selected,\n  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      fontSize: 12,\n      color: '#475569'\n    },\n    children: \"Conte\\xFAdo configur\\xE1vel no painel ao lado.\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 68,\n    columnNumber: 5\n  }, this), /*#__PURE__*/_jsxDEV(Handle, {\n    type: \"target\",\n    id: \"in\",\n    position: Position.Left,\n    style: {\n      background: '#6b7280',\n      width: PIN,\n      height: PIN,\n      border: '2px solid #fff'\n    }\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 69,\n    columnNumber: 5\n  }, this), /*#__PURE__*/_jsxDEV(Handle, {\n    type: \"source\",\n    id: \"out\",\n    position: Position.Right,\n    style: {\n      background: '#16a34a',\n      width: PIN,\n      height: PIN,\n      border: '2px solid #fff'\n    }\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 75,\n    columnNumber: 5\n  }, this)]\n}, void 0, true, {\n  fileName: _jsxFileName,\n  lineNumber: 63,\n  columnNumber: 3\n}, this);\n\n// === UI para montar botões (sem digitar JSON) ===\n_c3 = MessageNode;\nfunction ButtonsBuilder({\n  nodeId,\n  valueJson,\n  patchNode,\n  inputStyle,\n  label\n}) {\n  _s();\n  const safeParse = txt => {\n    if (!txt) return [];\n    try {\n      const arr = JSON.parse(txt);\n      return Array.isArray(arr) ? arr : [];\n    } catch {\n      return [];\n    }\n  };\n  const [btns, setBtns] = React.useState(safeParse(valueJson));\n  const [showJson, setShowJson] = React.useState(false);\n\n  // Se vier mudança externa (ex.: carregar flow), sincroniza\n  React.useEffect(() => {\n    setBtns(safeParse(valueJson));\n  }, [valueJson]);\n\n  // Empurra para o node sempre que btns mudar\n  React.useEffect(() => {\n    const json = JSON.stringify(btns, null, 2);\n    patchNode(nodeId, {\n      buttonsJson: json\n    });\n    // eslint-disable-next-line\n  }, [btns]);\n  const add = (type = 'reply') => {\n    const base = type === 'reply' ? {\n      type: 'reply',\n      title: '',\n      id: ''\n    } : type === 'url' ? {\n      type: 'url',\n      title: '',\n      url: ''\n    } : {\n      type: 'phone',\n      title: '',\n      phone: ''\n    };\n    setBtns(b => [...b, base]);\n  };\n  const upd = (i, patch) => setBtns(b => b.map((x, idx) => idx === i ? {\n    ...x,\n    ...patch\n  } : x));\n  const del = i => setBtns(b => b.filter((_, idx) => idx !== i));\n  const move = (i, dir) => {\n    setBtns(b => {\n      const next = b.slice();\n      const j = i + dir;\n      if (j < 0 || j >= next.length) return b;\n      [next[i], next[j]] = [next[j], next[i]];\n      return next;\n    });\n  };\n  const BtnRow = ({\n    it,\n    i\n  }) => {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        display: 'grid',\n        gridTemplateColumns: '110px 1fr 1fr auto',\n        gap: 8,\n        marginBottom: 8,\n        alignItems: 'center'\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"select\", {\n        style: inputStyle,\n        value: it.type || 'reply',\n        onChange: e => {\n          const t = e.target.value;\n          // ao trocar tipo, normaliza campos\n          if (t === 'reply') upd(i, {\n            type: 'reply',\n            url: undefined,\n            phone: undefined,\n            id: it.id || '',\n            title: it.title || ''\n          });\n          if (t === 'url') upd(i, {\n            type: 'url',\n            id: undefined,\n            phone: undefined,\n            url: it.url || '',\n            title: it.title || ''\n          });\n          if (t === 'phone') upd(i, {\n            type: 'phone',\n            id: undefined,\n            url: undefined,\n            phone: it.phone || '',\n            title: it.title || ''\n          });\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"option\", {\n          value: \"reply\",\n          children: \"reply\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 159,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n          value: \"url\",\n          children: \"url\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 160,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n          value: \"phone\",\n          children: \"phone\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 161,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 148,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        style: inputStyle,\n        placeholder: \"T\\xEDtulo do bot\\xE3o\",\n        value: it.title || '',\n        onChange: e => upd(i, {\n          title: e.target.value\n        })\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 165,\n        columnNumber: 9\n      }, this), it.type === 'reply' && /*#__PURE__*/_jsxDEV(\"input\", {\n        style: inputStyle,\n        placeholder: \"ID (ex.: YES)\",\n        value: it.id || '',\n        onChange: e => upd(i, {\n          id: e.target.value\n        })\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 174,\n        columnNumber: 11\n      }, this), it.type === 'url' && /*#__PURE__*/_jsxDEV(\"input\", {\n        style: inputStyle,\n        placeholder: \"https://...\",\n        value: it.url || '',\n        onChange: e => upd(i, {\n          url: e.target.value\n        })\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 182,\n        columnNumber: 11\n      }, this), it.type === 'phone' && /*#__PURE__*/_jsxDEV(\"input\", {\n        style: inputStyle,\n        placeholder: \"+55...\",\n        value: it.phone || '',\n        onChange: e => upd(i, {\n          phone: e.target.value\n        })\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 190,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          display: 'flex',\n          gap: 6\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"btn secondary\",\n          onClick: () => move(i, -1),\n          children: \"\\u2191\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 200,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"btn secondary\",\n          onClick: () => move(i, +1),\n          children: \"\\u2193\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 201,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"btn danger\",\n          onClick: () => del(i),\n          children: \"x\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 202,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 199,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 138,\n      columnNumber: 7\n    }, this);\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [label('Botões'), btns.map((it, i) => /*#__PURE__*/_jsxDEV(BtnRow, {\n      it: it,\n      i: i\n    }, i, false, {\n      fileName: _jsxFileName,\n      lineNumber: 212,\n      columnNumber: 9\n    }, this)), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        display: 'flex',\n        gap: 8,\n        marginTop: 6,\n        marginBottom: 10\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"btn\",\n        onClick: () => add('reply'),\n        children: \"+ Reply\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 216,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"btn\",\n        onClick: () => add('url'),\n        children: \"+ URL\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 217,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"btn\",\n        onClick: () => add('phone'),\n        children: \"+ Phone\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 218,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"btn secondary\",\n        onClick: () => setShowJson(v => !v),\n        children: showJson ? 'Esconder JSON' : 'Ver JSON (avançado)'\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 219,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 215,\n      columnNumber: 7\n    }, this), showJson && /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [label('JSON (só leitura)'), /*#__PURE__*/_jsxDEV(\"textarea\", {\n        rows: 6,\n        readOnly: true,\n        style: {\n          ...inputStyle,\n          fontFamily: 'monospace'\n        },\n        value: JSON.stringify(btns, null, 2)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 227,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          fontSize: 12,\n          color: '#64748b',\n          marginTop: 6\n        },\n        children: \"Observa\\xE7\\xE3o: salvamos neste formato para o executor, mas voc\\xEA edita tudo por cima sem precisar mexer em JSON.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 233,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        fontSize: 12,\n        color: '#64748b',\n        marginTop: 8\n      },\n      children: \"Dicas do WhatsApp: **Reply** (at\\xE9 3 bot\\xF5es), **URL** abre link, **Phone** inicia chamada.\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 239,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 209,\n    columnNumber: 5\n  }, this);\n}\n_s(ButtonsBuilder, \"L5it/GqHM4yMqReGFuoKCzQNIfI=\");\n_c4 = ButtonsBuilder;\nconst ApiNode = ({\n  selected\n}) => /*#__PURE__*/_jsxDEV(NodeShell, {\n  title: \"API Call\",\n  selected: selected,\n  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      fontSize: 12,\n      color: '#475569'\n    },\n    children: \"Configure m\\xE9todo/URL no painel ao lado. Salva vari\\xE1veis via mapeamentos.\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 248,\n    columnNumber: 5\n  }, this), /*#__PURE__*/_jsxDEV(Handle, {\n    type: \"target\",\n    id: \"in\",\n    position: Position.Left,\n    style: {\n      background: '#6b7280',\n      width: PIN,\n      height: PIN,\n      border: '2px solid #fff'\n    }\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 251,\n    columnNumber: 5\n  }, this), /*#__PURE__*/_jsxDEV(Handle, {\n    type: \"source\",\n    id: \"out\",\n    position: Position.Right,\n    style: {\n      background: '#16a34a',\n      width: PIN,\n      height: PIN,\n      border: '2px solid #fff'\n    }\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 257,\n    columnNumber: 5\n  }, this)]\n}, void 0, true, {\n  fileName: _jsxFileName,\n  lineNumber: 247,\n  columnNumber: 3\n}, this);\n_c5 = ApiNode;\nconst CodeNode = ({\n  selected\n}) => /*#__PURE__*/_jsxDEV(NodeShell, {\n  title: \"Code\",\n  subtitle: \"JS custom\",\n  selected: selected,\n  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      fontSize: 12,\n      color: '#475569'\n    },\n    children: \"Cole seu JS no painel ao lado. Deve retornar um objeto de vari\\xE1veis.\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 268,\n    columnNumber: 5\n  }, this), /*#__PURE__*/_jsxDEV(Handle, {\n    type: \"target\",\n    id: \"in\",\n    position: Position.Left,\n    style: {\n      background: '#6b7280',\n      width: PIN,\n      height: PIN,\n      border: '2px solid #fff'\n    }\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 271,\n    columnNumber: 5\n  }, this), /*#__PURE__*/_jsxDEV(Handle, {\n    type: \"source\",\n    id: \"out\",\n    position: Position.Right,\n    style: {\n      background: '#16a34a',\n      width: PIN,\n      height: PIN,\n      border: '2px solid #fff'\n    }\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 277,\n    columnNumber: 5\n  }, this)]\n}, void 0, true, {\n  fileName: _jsxFileName,\n  lineNumber: 267,\n  columnNumber: 3\n}, this);\n_c6 = CodeNode;\nconst DelayNode = ({\n  data,\n  selected\n}) => /*#__PURE__*/_jsxDEV(NodeShell, {\n  title: \"Delay\",\n  subtitle: (data === null || data === void 0 ? void 0 : data.summary) || '',\n  selected: selected,\n  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      fontSize: 12,\n      color: '#475569'\n    },\n    children: \"Espera antes de seguir para o pr\\xF3ximo n\\xF3.\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 288,\n    columnNumber: 5\n  }, this), /*#__PURE__*/_jsxDEV(Handle, {\n    type: \"target\",\n    id: \"in\",\n    position: Position.Left,\n    style: {\n      background: '#6b7280',\n      width: PIN,\n      height: PIN,\n      border: '2px solid #fff'\n    }\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 289,\n    columnNumber: 5\n  }, this), /*#__PURE__*/_jsxDEV(Handle, {\n    type: \"source\",\n    id: \"out\",\n    position: Position.Right,\n    style: {\n      background: '#16a34a',\n      width: PIN,\n      height: PIN,\n      border: '2px solid #fff'\n    }\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 295,\n    columnNumber: 5\n  }, this)]\n}, void 0, true, {\n  fileName: _jsxFileName,\n  lineNumber: 287,\n  columnNumber: 3\n}, this);\n_c7 = DelayNode;\nconst WaitNode = ({\n  data,\n  selected\n}) => /*#__PURE__*/_jsxDEV(NodeShell, {\n  title: \"Wait & Reply\",\n  subtitle: \"aguarda resposta e ramifica\",\n  selected: selected,\n  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      fontSize: 12,\n      color: '#475569'\n    },\n    children: [\"Conecte \", /*#__PURE__*/_jsxDEV(\"em\", {\n      children: \"m\\xFAltiplos\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 311,\n      columnNumber: 15\n    }, this), \" edges para as rotas e edite a condi\\xE7\\xE3o no edge.\"]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 310,\n    columnNumber: 5\n  }, this), /*#__PURE__*/_jsxDEV(Handle, {\n    type: \"target\",\n    id: \"in\",\n    position: Position.Left,\n    style: {\n      background: '#6b7280',\n      width: PIN,\n      height: PIN,\n      border: '2px solid #fff'\n    }\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 313,\n    columnNumber: 5\n  }, this), /*#__PURE__*/_jsxDEV(Handle, {\n    type: \"source\",\n    id: \"out\",\n    position: Position.Right,\n    style: {\n      background: '#16a34a',\n      width: PIN,\n      height: PIN,\n      border: '2px solid #fff'\n    }\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 319,\n    columnNumber: 5\n  }, this)]\n}, void 0, true, {\n  fileName: _jsxFileName,\n  lineNumber: 305,\n  columnNumber: 3\n}, this);\n_c8 = WaitNode;\nconst EndNode = ({\n  selected\n}) => /*#__PURE__*/_jsxDEV(NodeShell, {\n  title: \"End\",\n  subtitle: \"t\\xE9rmino do fluxo\",\n  selected: selected,\n  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      fontSize: 12,\n      color: '#475569'\n    },\n    children: \"N\\xF3 terminal. S\\xF3 recebe conex\\xF5es.\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 330,\n    columnNumber: 5\n  }, this), /*#__PURE__*/_jsxDEV(Handle, {\n    type: \"target\",\n    id: \"in\",\n    position: Position.Left,\n    style: {\n      background: '#6b7280',\n      width: PIN,\n      height: PIN,\n      border: '2px solid #fff'\n    }\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 331,\n    columnNumber: 5\n  }, this)]\n}, void 0, true, {\n  fileName: _jsxFileName,\n  lineNumber: 329,\n  columnNumber: 3\n}, this);\n\n// === side panels ===\n_c9 = EndNode;\nfunction AudiencePanel({\n  node,\n  patchNode,\n  inputStyle,\n  label,\n  slugFn\n}) {\n  _s2();\n  const d = node.data || {};\n  const [headers, setHeaders] = useState(d.headers || []);\n  const [rows, setRows] = useState(d.rows || []);\n  const [allRows, setAllRows] = useState(d.allRows || []);\n  const [mapping, setMapping] = useState(d.mapping || {});\n  const [phoneKey, setPhoneKey] = useState(d.phoneKey || '');\n  useEffect(() => {\n    setHeaders(d.headers || []);\n    setRows(d.rows || []);\n    setMapping(d.mapping || {});\n    setPhoneKey(d.phoneKey || '');\n    // eslint-disable-next-line\n  }, [node.id]);\n  const onFile = e => {\n    var _e$target$files;\n    const f = (_e$target$files = e.target.files) === null || _e$target$files === void 0 ? void 0 : _e$target$files[0];\n    if (!f) return;\n    Papa.parse(f, {\n      header: true,\n      skipEmptyLines: true,\n      complete: res => {\n        const hs = res.meta.fields || Object.keys(res.data[0] || {});\n        const guess = {};\n        hs.forEach(h => guess[h] = slugFn(h));\n        const pk = hs.find(h => /phone|telefone|celular|numero|n[uú]mero/i.test(h)) || '';\n        setHeaders(hs);\n        setRows(res.data.slice(0, 5));\n        setAllRows(res.data);\n        setMapping(guess);\n        setPhoneKey(pk);\n      }\n    });\n  };\n  const saveMap = () => {\n    if (!phoneKey) return alert('Escolha a coluna de telefone.');\n    patchNode(node.id, {\n      headers,\n      rows,\n      mapping,\n      phoneKey,\n      allRows\n    });\n    alert('Mapeamento salvo.');\n  };\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [label('Arquivo CSV'), /*#__PURE__*/_jsxDEV(\"input\", {\n      type: \"file\",\n      accept: \".csv\",\n      onChange: onFile\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 386,\n      columnNumber: 7\n    }, this), headers.length > 0 && /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [label('Coluna de telefone'), /*#__PURE__*/_jsxDEV(\"select\", {\n        style: inputStyle,\n        value: phoneKey,\n        onChange: e => setPhoneKey(e.target.value),\n        children: [/*#__PURE__*/_jsxDEV(\"option\", {\n          value: \"\",\n          children: \"\\u2014 selecione \\u2014\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 392,\n          columnNumber: 13\n        }, this), headers.map(h => /*#__PURE__*/_jsxDEV(\"option\", {\n          value: h,\n          children: h\n        }, h, false, {\n          fileName: _jsxFileName,\n          lineNumber: 394,\n          columnNumber: 15\n        }, this))]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 391,\n        columnNumber: 11\n      }, this), label('Mapeamento (coluna → variável)'), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          display: 'grid',\n          gridTemplateColumns: '1fr 20px 1fr',\n          gap: 8,\n          maxHeight: 200,\n          overflow: 'auto'\n        },\n        children: headers.map(h => /*#__PURE__*/_jsxDEV(React.Fragment, {\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              alignSelf: 'center',\n              fontSize: 13\n            },\n            children: h\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 412,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              textAlign: 'center',\n              color: '#94a3b8'\n            },\n            children: \"\\u2192\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 413,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            style: inputStyle,\n            value: mapping[h] || '',\n            placeholder: slugFn(h),\n            onChange: e => setMapping(m => ({\n              ...m,\n              [h]: slugFn(e.target.value)\n            }))\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 414,\n            columnNumber: 17\n          }, this)]\n        }, h, true, {\n          fileName: _jsxFileName,\n          lineNumber: 411,\n          columnNumber: 15\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 401,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"btn\",\n        onClick: saveMap,\n        style: {\n          marginTop: 10\n        },\n        children: \"Salvar mapeamento\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 424,\n        columnNumber: 11\n      }, this), rows.length > 0 && /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [label('Amostra (5 primeiras linhas)'), /*#__PURE__*/_jsxDEV(\"pre\", {\n          style: {\n            background: '#f8fafc',\n            border: '1px solid #e2e8f0',\n            borderRadius: 8,\n            padding: 10,\n            fontSize: 12,\n            maxHeight: 160,\n            overflow: 'auto'\n          },\n          children: JSON.stringify(rows, null, 2)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 431,\n          columnNumber: 15\n        }, this)]\n      }, void 0, true), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          fontSize: 12,\n          color: '#64748b',\n          marginTop: 8\n        },\n        children: [\"Use as vari\\xE1veis com \", /*#__PURE__*/_jsxDEV(\"code\", {\n          children: '{{minha_variavel}}'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 447,\n          columnNumber: 34\n        }, this), \".\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 446,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true)]\n  }, void 0, true);\n}\n\n// === principal ===\n_s2(AudiencePanel, \"fIyLNbCw4MxP8F6eNqC6DsbNTyQ=\");\n_c0 = AudiencePanel;\nexport default function JourneyBuilder() {\n  _s5();\n  var _s3 = $RefreshSig$(),\n    _s4 = $RefreshSig$();\n  const navigate = useNavigate();\n  const [nodes, setNodes, onNodesChangeBase] = useNodesState([]);\n  const [edges, setEdges, onEdgesChangeBase] = useEdgesState([]);\n  const [flowId, setFlowId] = useState(null);\n  const [flowName, setFlowName] = useState('Novo Flow');\n  const [drawerNodeId, setDrawerNodeId] = useState(null);\n  const [drawerEdgeId, setDrawerEdgeId] = useState(null);\n  const [dirty, setDirty] = useState(false);\n  const initializedRef = useRef(false);\n  const rfInstanceRef = useRef(null);\n\n  // palette drag type\n  const dragType = useRef(null);\n\n  // templates (Twilio)\n  const [templates, setTemplates] = useState([]);\n  useEffect(() => {\n    fetch('/api/templates/list').then(r => r.json()).then(data => setTemplates(data.contents || [])).catch(() => setTemplates([]));\n  }, []);\n  const nodeTypes = useMemo(() => ({\n    audience: AudienceNode,\n    message: MessageNode,\n    api: ApiNode,\n    code: CodeNode,\n    delay: DelayNode,\n    wait: WaitNode,\n    end: EndNode\n  }), []);\n\n  // init: se ?id carrega; se ?new, cria com Audiência; default idem\n  useEffect(() => {\n    if (initializedRef.current) return;\n    initializedRef.current = true;\n    const sp = new URLSearchParams(window.location.search);\n    const id = sp.get('id');\n    const isNew = sp.get('new') === '1';\n    const seedAudience = () => {\n      const audId = uid('aud');\n      setNodes([{\n        id: audId,\n        type: 'audience',\n        position: {\n          x: 120,\n          y: 160\n        },\n        data: {}\n      }]);\n      setEdges([]);\n      setTimeout(() => {\n        var _rfInstanceRef$curren;\n        return (_rfInstanceRef$curren = rfInstanceRef.current) === null || _rfInstanceRef$curren === void 0 ? void 0 : _rfInstanceRef$curren.fitView({\n          padding: 0.2\n        });\n      }, 50);\n    };\n    if (id) {\n      setFlowId(id);\n      fetch(`/api/journeys/${id}`).then(r => r.ok ? r.json() : Promise.reject()).then(f => {\n        if (Array.isArray(f.nodes) && Array.isArray(f.edges)) {\n          setNodes(f.nodes);\n          setEdges(f.edges);\n          setFlowName(f.name || 'Flow');\n          setTimeout(() => {\n            var _rfInstanceRef$curren2;\n            return (_rfInstanceRef$curren2 = rfInstanceRef.current) === null || _rfInstanceRef$curren2 === void 0 ? void 0 : _rfInstanceRef$curren2.fitView({\n              padding: 0.2\n            });\n          }, 60);\n        } else seedAudience();\n      }).catch(() => {\n        const raw = localStorage.getItem(id);\n        if (raw) {\n          try {\n            const f = JSON.parse(raw);\n            setNodes(f.nodes || []);\n            setEdges(f.edges || []);\n            setFlowName(f.name || 'Flow');\n          } catch {\n            seedAudience();\n          }\n        } else seedAudience();\n        setTimeout(() => {\n          var _rfInstanceRef$curren3;\n          return (_rfInstanceRef$curren3 = rfInstanceRef.current) === null || _rfInstanceRef$curren3 === void 0 ? void 0 : _rfInstanceRef$curren3.fitView({\n            padding: 0.2\n          });\n        }, 60);\n      });\n    } else if (isNew) {\n      seedAudience();\n    } else {\n      seedAudience();\n    }\n  }, [setNodes, setEdges]);\n\n  // dirty tracking\n  const onNodesChange = useCallback(chs => {\n    setDirty(true);\n    onNodesChangeBase(chs);\n  }, [onNodesChangeBase]);\n  const onEdgesChange = useCallback(chs => {\n    setDirty(true);\n    onEdgesChangeBase(chs);\n  }, [onEdgesChangeBase]);\n\n  // helper: pega tipo do nó\n  const typeOf = useCallback(id => {\n    var _nodes$find;\n    return (_nodes$find = nodes.find(n => n.id === id)) === null || _nodes$find === void 0 ? void 0 : _nodes$find.type;\n  }, [nodes]);\n\n  // conecta (1 saída por nó exceto wait)\n  const onConnect = useCallback(params => {\n    setDirty(true);\n    const sourceType = typeOf(params.source);\n    setEdges(eds => {\n      const base = sourceType === 'wait' ? eds : eds.filter(e => e.source !== params.source);\n      return addEdge({\n        ...params,\n        type: 'smoothstep',\n        label: '',\n        data: {\n          conditionType: 'keywords',\n          value: '',\n          isFallback: false\n        },\n        style: {\n          stroke: '#0f172a'\n        },\n        markerEnd: {\n          type: MarkerType.ArrowClosed,\n          color: '#0f172a'\n        }\n      }, base);\n    });\n  }, [setEdges, typeOf]);\n\n  // seleção → abrir drawer (nó ou edge)\n  const onSelectionChange = useCallback(({\n    nodes: ns,\n    edges: es\n  }) => {\n    var _ns$, _es$;\n    setDrawerNodeId((ns === null || ns === void 0 ? void 0 : (_ns$ = ns[0]) === null || _ns$ === void 0 ? void 0 : _ns$.id) || null);\n    setDrawerEdgeId((es === null || es === void 0 ? void 0 : (_es$ = es[0]) === null || _es$ === void 0 ? void 0 : _es$.id) || null);\n  }, []);\n\n  // fechar drawer ao clicar no canvas\n  const onPaneClick = useCallback(() => {\n    setDrawerNodeId(null);\n    setDrawerEdgeId(null);\n  }, []);\n\n  // patch node\n  const patchNode = useCallback((id, patch) => {\n    setDirty(true);\n    setNodes(nds => nds.map(n => n.id === id ? {\n      ...n,\n      data: {\n        ...n.data,\n        ...patch\n      }\n    } : n));\n  }, [setNodes]);\n\n  // patch edge\n  const patchEdge = useCallback((id, patch) => {\n    setDirty(true);\n    setEdges(eds => eds.map(e => e.id === id ? {\n      ...e,\n      ...patch,\n      data: {\n        ...(e.data || {}),\n        ...(patch.data || {})\n      }\n    } : e));\n  }, [setEdges]);\n\n  // DnD\n  const onDragStartChip = type => e => {\n    dragType.current = type;\n    e.dataTransfer.setData('application/reactflow', type);\n    e.dataTransfer.effectAllowed = 'move';\n  };\n  const onDragOver = e => {\n    e.preventDefault();\n    e.dataTransfer.dropEffect = 'move';\n  };\n  const onDrop = e => {\n    var _rfInstanceRef$curren4, _rfInstanceRef$curren5, _rfInstanceRef$curren6, _rfInstanceRef$curren7, _rfInstanceRef$curren8, _rfInstanceRef$curren9;\n    e.preventDefault();\n    const type = dragType.current || e.dataTransfer.getData('application/reactflow');\n    if (!type) return;\n    const rect = (_rfInstanceRef$curren4 = rfInstanceRef.current) === null || _rfInstanceRef$curren4 === void 0 ? void 0 : (_rfInstanceRef$curren5 = _rfInstanceRef$curren4.wrapper) === null || _rfInstanceRef$curren5 === void 0 ? void 0 : (_rfInstanceRef$curren6 = _rfInstanceRef$curren5.getBoundingClientRect) === null || _rfInstanceRef$curren6 === void 0 ? void 0 : _rfInstanceRef$curren6.call(_rfInstanceRef$curren5);\n    const transform = ((_rfInstanceRef$curren7 = rfInstanceRef.current) === null || _rfInstanceRef$curren7 === void 0 ? void 0 : (_rfInstanceRef$curren8 = _rfInstanceRef$curren7.getViewport) === null || _rfInstanceRef$curren8 === void 0 ? void 0 : (_rfInstanceRef$curren9 = _rfInstanceRef$curren8.call(_rfInstanceRef$curren7)) === null || _rfInstanceRef$curren9 === void 0 ? void 0 : _rfInstanceRef$curren9.transform) || [0, 0, 1];\n    const pos = {\n      x: (e.clientX - ((rect === null || rect === void 0 ? void 0 : rect.left) || 0) - transform[0]) / transform[2],\n      y: (e.clientY - ((rect === null || rect === void 0 ? void 0 : rect.top) || 0) - transform[1]) / transform[2]\n    };\n    const common = {\n      position: pos\n    };\n    const id = uid(type);\n    let node;\n    if (type === 'message') {\n      node = {\n        id,\n        type,\n        data: {\n          label: 'Mensagem',\n          channel: 'whatsapp',\n          mode: 'text',\n          text: ''\n        },\n        ...common\n      };\n    } else if (type === 'api') {\n      node = {\n        id,\n        type,\n        data: {\n          label: 'API Call',\n          method: 'GET',\n          url: '',\n          headers: '{}',\n          body: '{}',\n          mappings: [],\n          lastResponse: ''\n        },\n        ...common\n      };\n    } else if (type === 'code') {\n      node = {\n        id,\n        type,\n        data: {\n          label: 'Code',\n          code: '// return { nova_variavel: 123 };'\n        },\n        ...common\n      };\n    } else if (type === 'delay') {\n      node = {\n        id,\n        type,\n        data: {\n          mode: 'duration',\n          seconds: 30,\n          summary: '30 seconds'\n        },\n        ...common\n      };\n    } else if (type === 'wait') {\n      node = {\n        id,\n        type,\n        data: {\n          label: 'Wait & Reply'\n        },\n        ...common\n      };\n    } else {\n      return;\n    }\n    setNodes(nds => nds.concat(node));\n    setDirty(true);\n  };\n\n  // Context menu (só nó)\n  const [ctxMenu, setCtxMenu] = useState(null); // {x,y,nodeId}\n  const onNodeContextMenu = (e, node) => {\n    e.preventDefault();\n    setCtxMenu({\n      x: e.clientX,\n      y: e.clientY,\n      nodeId: node.id\n    });\n  };\n  const closeCtx = () => setCtxMenu(null);\n  const doRename = () => {\n    var _nodes$find2, _nodes$find2$data;\n    if (!ctxMenu) return;\n    const val = window.prompt('Novo nome do nó:', ((_nodes$find2 = nodes.find(n => n.id === ctxMenu.nodeId)) === null || _nodes$find2 === void 0 ? void 0 : (_nodes$find2$data = _nodes$find2.data) === null || _nodes$find2$data === void 0 ? void 0 : _nodes$find2$data.label) || '');\n    if (val != null) patchNode(ctxMenu.nodeId, {\n      label: val\n    });\n    closeCtx();\n  };\n  const doDuplicate = () => {\n    if (!ctxMenu) return;\n    setNodes(nds => {\n      const n = nds.find(x => x.id === ctxMenu.nodeId);\n      if (!n) return nds;\n      const clone = {\n        ...n,\n        id: uid(n.type),\n        position: {\n          x: n.position.x + 40,\n          y: n.position.y + 40\n        }\n      };\n      return nds.concat(clone);\n    });\n    closeCtx();\n  };\n  const doReset = () => {\n    if (!ctxMenu) return;\n    const n = nodes.find(x => x.id === ctxMenu.nodeId);\n    if (!n) return;\n    let fresh = {};\n    if (n.type === 'message') fresh = {\n      label: 'Mensagem',\n      channel: 'whatsapp',\n      mode: 'text',\n      text: ''\n    };\n    if (n.type === 'api') fresh = {\n      label: 'API Call',\n      method: 'GET',\n      url: '',\n      headers: '{}',\n      body: '{}',\n      mappings: [],\n      lastResponse: ''\n    };\n    if (n.type === 'code') fresh = {\n      label: 'Code',\n      code: '// return { nova_variavel: 123 };'\n    };\n    if (n.type === 'delay') fresh = {\n      mode: 'duration',\n      seconds: 30,\n      summary: '30 seconds'\n    };\n    if (n.type === 'wait') fresh = {\n      label: 'Wait & Reply'\n    };\n    patchNode(n.id, fresh);\n    closeCtx();\n  };\n  const doDelete = () => {\n    if (!ctxMenu) return;\n    const id = ctxMenu.nodeId;\n    setEdges(eds => eds.filter(e => e.source !== id && e.target !== id));\n    setNodes(nds => nds.filter(n => n.id !== id));\n    setDirty(true);\n    closeCtx();\n  };\n\n  // auto-layout simples\n  const autoLayout = () => {\n    const newNodes = [...nodes];\n    const start = newNodes.find(n => n.type === 'audience');\n    if (!start) return;\n    const byId = Object.fromEntries(newNodes.map(n => [n.id, n]));\n    const outs = {};\n    edges.forEach(e => {\n      (outs[e.source] ||= []).push(e.target);\n    });\n    const ordered = [start.id];\n    let cur = start.id;\n    const visited = new Set([start.id]);\n    // linear heurístico (pega primeira saída)\n    while ((_outs$cur = outs[cur]) !== null && _outs$cur !== void 0 && _outs$cur[0] && !visited.has(outs[cur][0])) {\n      var _outs$cur;\n      ordered.push(outs[cur][0]);\n      visited.add(outs[cur][0]);\n      cur = outs[cur][0];\n    }\n    ordered.forEach((id, idx) => {\n      const n = byId[id];\n      if (n) n.position = {\n        x: 140 + idx * 360,\n        y: 180 + (n.type === 'audience' ? -20 : 0)\n      };\n    });\n    setNodes(Object.values(byId));\n    setTimeout(() => {\n      var _rfInstanceRef$curren0;\n      return (_rfInstanceRef$curren0 = rfInstanceRef.current) === null || _rfInstanceRef$curren0 === void 0 ? void 0 : _rfInstanceRef$curren0.fitView({\n        padding: 0.2\n      });\n    }, 30);\n  };\n\n  // salvar → injeta End se não existir\n  const handleSave = async () => {\n    const hasEnd = nodes.some(n => n.type === 'end');\n    let nNodes = nodes;\n    let nEdges = edges;\n    if (!hasEnd) {\n      const idsWithOut = new Set(edges.map(e => e.source));\n      const last = nodes.find(n => !idsWithOut.has(n.id) && n.type !== 'end');\n      if (last) {\n        const endId = uid('end');\n        const endNode = {\n          id: endId,\n          type: 'end',\n          position: {\n            x: last.position.x + 360,\n            y: last.position.y\n          },\n          data: {}\n        };\n        const edge = {\n          id: uid('e'),\n          source: last.id,\n          target: endId,\n          type: 'smoothstep'\n        };\n        nNodes = [...nodes, endNode];\n        nEdges = [...edges, edge];\n        setNodes(nNodes);\n        setEdges(nEdges);\n      }\n    }\n    const payload = {\n      id: flowId || 'flow_' + Date.now(),\n      name: flowName || 'Flow',\n      nodes: nNodes,\n      edges: nEdges,\n      updatedAt: new Date().toISOString()\n    };\n    try {\n      const url = flowId ? `/api/journeys/${flowId}` : `/api/journeys`;\n      const method = flowId ? 'PUT' : 'POST';\n      const res = await fetch(url, {\n        method,\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(payload)\n      });\n      if (!res.ok) throw new Error('offline');\n      const saved = await res.json();\n      alert('Flow salvo!');\n      setDirty(false);\n      if (!flowId && saved !== null && saved !== void 0 && saved.id) {\n        setFlowId(saved.id);\n        window.history.replaceState(null, '', `/journeys/builder?id=${saved.id}`);\n      }\n    } catch {\n      localStorage.setItem(payload.id, JSON.stringify(payload));\n      alert('Flow salvo no navegador.');\n      setDirty(false);\n      if (!flowId) {\n        setFlowId(payload.id);\n        window.history.replaceState(null, '', `/journeys/builder?id=${payload.id}`);\n      }\n    }\n  };\n\n  // voltar → perguntar salvar\n  const handleBack = async () => {\n    if (dirty) {\n      const ok = window.confirm('Salvar antes de voltar?\\nOK: salvar e voltar • Cancel: voltar sem salvar');\n      if (ok) await handleSave();\n    }\n    navigate('/journeys');\n  };\n\n  // inputs/styles\n  const inputStyle = {\n    width: '100%',\n    border: '1px solid #cbd5e1',\n    borderRadius: 8,\n    padding: '10px 12px'\n  };\n  const small = {\n    fontSize: 12,\n    color: '#475569',\n    marginBottom: 6\n  };\n  const label = t => /*#__PURE__*/_jsxDEV(\"div\", {\n    style: small,\n    children: t\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 818,\n    columnNumber: 24\n  }, this);\n  const panelWrap = {\n    background: '#fff',\n    border: '1px solid #e5e7eb',\n    borderRadius: 12,\n    padding: 16,\n    width: 360\n  };\n\n  // Drawer — NODE\n  const selectedNode = nodes.find(n => n.id === drawerNodeId);\n\n  // helpers de input local (conserta foco)\n  function useLocalField(initial, onCommit) {\n    _s3();\n    const [val, setVal] = useState(initial);\n    useEffect(() => setVal(initial), [initial]);\n    const commit = () => onCommit === null || onCommit === void 0 ? void 0 : onCommit(val);\n    return {\n      val,\n      setVal,\n      commit\n    };\n  }\n  _s3(useLocalField, \"amxG4nbPdXvQ/fdAGyAM+S/YWds=\");\n  const DrawerNode = () => {\n    _s4();\n    if (!selectedNode) return null;\n    const n = selectedNode;\n\n    // AUDIENCE\n    if (n.type === 'audience') {\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          position: 'fixed',\n          right: 16,\n          top: 72,\n          zIndex: 20\n        },\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          style: panelWrap,\n          children: /*#__PURE__*/_jsxDEV(AudiencePanel, {\n            node: n,\n            patchNode: patchNode,\n            inputStyle: inputStyle,\n            label: label,\n            slugFn: slug\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 847,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 846,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 845,\n        columnNumber: 9\n      }, this);\n    }\n\n    // Mensagem (usa estado local p/ não perder foco)\n    if (n.type === 'message') {\n      var _Object$values$;\n      const d = n.data || {};\n      const found = d.templateSid ? templates.find(t => t.sid === d.templateSid) : null;\n      const firstTypeBody = found ? ((_Object$values$ = Object.values(found.types || {})[0]) === null || _Object$values$ === void 0 ? void 0 : _Object$values$.body) || '' : '';\n      const labelField = useLocalField(d.label || '', v => patchNode(n.id, {\n        label: v\n      }));\n      const textField = useLocalField(d.text || '', v => patchNode(n.id, {\n        text: v\n      }));\n      const mediaField = useLocalField(d.mediaUrl || '', v => patchNode(n.id, {\n        mediaUrl: v\n      }));\n      const buttonsField = useLocalField(d.buttonsJson || '', v => patchNode(n.id, {\n        buttonsJson: v\n      }));\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          position: 'fixed',\n          right: 16,\n          top: 72,\n          zIndex: 20\n        },\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          style: panelWrap,\n          children: [label('Label'), /*#__PURE__*/_jsxDEV(\"input\", {\n            style: inputStyle,\n            value: labelField.val,\n            onChange: e => labelField.setVal(e.target.value),\n            onBlur: labelField.commit\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 874,\n            columnNumber: 13\n          }, this), label('Canal'), /*#__PURE__*/_jsxDEV(\"select\", {\n            style: inputStyle,\n            value: d.channel || 'whatsapp',\n            onChange: e => patchNode(n.id, {\n              channel: e.target.value\n            }),\n            children: [/*#__PURE__*/_jsxDEV(\"option\", {\n              value: \"whatsapp\",\n              children: \"WhatsApp\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 887,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n              value: \"sms\",\n              children: \"SMS\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 888,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 882,\n            columnNumber: 13\n          }, this), label('Mode'), /*#__PURE__*/_jsxDEV(\"select\", {\n            style: inputStyle,\n            value: d.mode || 'text',\n            onChange: e => patchNode(n.id, {\n              mode: e.target.value\n            }),\n            children: [/*#__PURE__*/_jsxDEV(\"option\", {\n              value: \"text\",\n              children: \"Text\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 897,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n              value: \"rich\",\n              children: \"Rich (text + image + buttons)\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 898,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 892,\n            columnNumber: 13\n          }, this), label('Pick a Twilio template (optional)'), /*#__PURE__*/_jsxDEV(\"select\", {\n            style: inputStyle,\n            value: d.templateSid || '',\n            onChange: e => patchNode(n.id, {\n              templateSid: e.target.value\n            }),\n            children: [/*#__PURE__*/_jsxDEV(\"option\", {\n              value: \"\",\n              children: \"\\u2014 none \\u2014\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 907,\n              columnNumber: 15\n            }, this), templates.map(t => /*#__PURE__*/_jsxDEV(\"option\", {\n              value: t.sid,\n              children: t.friendly_name || t.sid\n            }, t.sid, false, {\n              fileName: _jsxFileName,\n              lineNumber: 909,\n              columnNumber: 17\n            }, this))]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 902,\n            columnNumber: 13\n          }, this), found && /*#__PURE__*/_jsxDEV(_Fragment, {\n            children: [label('Template preview'), /*#__PURE__*/_jsxDEV(\"textarea\", {\n              readOnly: true,\n              rows: 6,\n              style: {\n                ...inputStyle,\n                fontFamily: 'monospace'\n              },\n              value: firstTypeBody\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 918,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true), label('Text'), /*#__PURE__*/_jsxDEV(\"textarea\", {\n            rows: 6,\n            style: inputStyle,\n            value: textField.val,\n            onChange: e => textField.setVal(e.target.value),\n            onBlur: textField.commit,\n            placeholder: \"Ol\\xE1 {{nome}}!\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 928,\n            columnNumber: 13\n          }, this), d.mode === 'rich' && /*#__PURE__*/_jsxDEV(_Fragment, {\n            children: [label('Media URL'), /*#__PURE__*/_jsxDEV(\"input\", {\n              style: inputStyle,\n              value: d.mediaUrl || '',\n              onChange: e => patchNode(n.id, {\n                mediaUrl: e.target.value\n              }),\n              placeholder: \"https://...\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 940,\n              columnNumber: 5\n            }, this), /*#__PURE__*/_jsxDEV(ButtonsBuilder, {\n              nodeId: n.id,\n              valueJson: d.buttonsJson,\n              patchNode: patchNode,\n              inputStyle: inputStyle,\n              label: label\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 947,\n              columnNumber: 5\n            }, this)]\n          }, void 0, true)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 872,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 871,\n        columnNumber: 9\n      }, this);\n    }\n\n    // API (usa commit no blur)\n    if (n.type === 'api') {\n      const d = n.data || {};\n      const labelField = useLocalField(d.label || 'API Call', v => patchNode(n.id, {\n        label: v\n      }));\n      const headersField = useLocalField(d.headers || '{}', v => patchNode(n.id, {\n        headers: v\n      }));\n      const bodyField = useLocalField(d.body || '{}', v => patchNode(n.id, {\n        body: v\n      }));\n      const tryParse = txt => {\n        try {\n          return JSON.stringify(JSON.parse(txt), null, 2);\n        } catch {\n          return txt;\n        }\n      };\n      const testRequest = async () => {\n        try {\n          const headers = d.headers ? JSON.parse(d.headers) : {};\n          const body = d.method === 'GET' || d.method === 'DELETE' ? undefined : d.body && d.body.trim() !== '{}' ? JSON.parse(d.body) : undefined;\n          const res = await fetch(d.url, {\n            method: d.method || 'GET',\n            headers,\n            body: body ? JSON.stringify(body) : undefined\n          });\n          const text = await res.text();\n          patchNode(n.id, {\n            lastResponse: text\n          });\n          alert('Request executada. Veja a resposta abaixo.');\n        } catch (e) {\n          alert('Falha: ' + e.message);\n        }\n      };\n      const addMapping = () => {\n        const m = Array.isArray(d.mappings) ? d.mappings.slice() : [];\n        m.push({\n          path: '',\n          var: ''\n        });\n        patchNode(n.id, {\n          mappings: m\n        });\n      };\n      const updateMap = (idx, patch) => {\n        const m = (d.mappings || []).slice();\n        m[idx] = {\n          ...m[idx],\n          ...patch\n        };\n        patchNode(n.id, {\n          mappings: m\n        });\n      };\n      const removeMap = idx => {\n        const m = (d.mappings || []).slice();\n        m.splice(idx, 1);\n        patchNode(n.id, {\n          mappings: m\n        });\n      };\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          position: 'fixed',\n          right: 16,\n          top: 72,\n          zIndex: 20\n        },\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          style: panelWrap,\n          children: [label('Label'), /*#__PURE__*/_jsxDEV(\"input\", {\n            style: inputStyle,\n            value: labelField.val,\n            onChange: e => labelField.setVal(e.target.value),\n            onBlur: labelField.commit\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1016,\n            columnNumber: 13\n          }, this), label('Método'), /*#__PURE__*/_jsxDEV(\"select\", {\n            style: inputStyle,\n            value: d.method || 'GET',\n            onChange: e => patchNode(n.id, {\n              method: e.target.value\n            }),\n            children: [/*#__PURE__*/_jsxDEV(\"option\", {\n              children: \"GET\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1029,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n              children: \"POST\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1030,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n              children: \"PUT\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1031,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n              children: \"PATCH\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1032,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n              children: \"DELETE\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1033,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1024,\n            columnNumber: 13\n          }, this), label('URL'), /*#__PURE__*/_jsxDEV(\"input\", {\n            style: inputStyle,\n            placeholder: \"https://api.meuservico.com/...\",\n            value: d.url || '',\n            onChange: e => patchNode(n.id, {\n              url: e.target.value\n            })\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1037,\n            columnNumber: 13\n          }, this), label('Headers (JSON)'), /*#__PURE__*/_jsxDEV(\"textarea\", {\n            rows: 4,\n            style: inputStyle,\n            value: headersField.val,\n            onChange: e => headersField.setVal(e.target.value),\n            onBlur: headersField.commit\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1045,\n            columnNumber: 13\n          }, this), (d.method === 'POST' || d.method === 'PUT' || d.method === 'PATCH') && /*#__PURE__*/_jsxDEV(_Fragment, {\n            children: [label('Body (JSON)'), /*#__PURE__*/_jsxDEV(\"textarea\", {\n              rows: 6,\n              style: inputStyle,\n              value: bodyField.val,\n              onChange: e => bodyField.setVal(e.target.value),\n              onBlur: bodyField.commit\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1056,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"btn\",\n            onClick: testRequest,\n            style: {\n              marginTop: 10\n            },\n            children: \"Executar request\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1066,\n            columnNumber: 13\n          }, this), label('Resposta (último teste)'), /*#__PURE__*/_jsxDEV(\"textarea\", {\n            rows: 8,\n            readOnly: true,\n            style: {\n              ...inputStyle,\n              fontFamily: 'monospace'\n            },\n            value: tryParse(d.lastResponse || '')\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1071,\n            columnNumber: 13\n          }, this), label('Mapeamentos JSON → Variáveis'), (d.mappings || []).map((m, i) => /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              display: 'grid',\n              gridTemplateColumns: '1fr 1fr auto',\n              gap: 8,\n              marginBottom: 8\n            },\n            children: [/*#__PURE__*/_jsxDEV(\"input\", {\n              style: inputStyle,\n              placeholder: \"ex.: data.user.id\",\n              value: m.path,\n              onChange: e => updateMap(i, {\n                path: e.target.value\n              })\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1089,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              style: inputStyle,\n              placeholder: \"ex.: user_id\",\n              value: m.var,\n              onChange: e => updateMap(i, {\n                var: slug(e.target.value)\n              })\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1095,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"btn danger\",\n              onClick: () => removeMap(i),\n              children: \"x\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1101,\n              columnNumber: 17\n            }, this)]\n          }, i, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1080,\n            columnNumber: 15\n          }, this)), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"btn\",\n            onClick: addMapping,\n            children: \"+ adicionar mapeamento\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1106,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              fontSize: 12,\n              color: '#64748b',\n              marginTop: 8\n            },\n            children: [\"Use paths tipo \", /*#__PURE__*/_jsxDEV(\"code\", {\n              children: \"data.user.id\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1111,\n              columnNumber: 30\n            }, this), \". O executor gravar\\xE1 o valor em vari\\xE1veis.\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1110,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1014,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1013,\n        columnNumber: 9\n      }, this);\n    }\n\n    // CODE\n    if (n.type === 'code') {\n      const d = n.data || {};\n      const codeField = useLocalField(d.code || '', v => patchNode(n.id, {\n        code: v\n      }));\n      const labelField = useLocalField(d.label || 'Code', v => patchNode(n.id, {\n        label: v\n      }));\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          position: 'fixed',\n          right: 16,\n          top: 72,\n          zIndex: 20\n        },\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          style: panelWrap,\n          children: [label('Label'), /*#__PURE__*/_jsxDEV(\"input\", {\n            style: inputStyle,\n            value: labelField.val,\n            onChange: e => labelField.setVal(e.target.value),\n            onBlur: labelField.commit\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1128,\n            columnNumber: 13\n          }, this), label('JavaScript'), /*#__PURE__*/_jsxDEV(\"textarea\", {\n            rows: 14,\n            style: {\n              ...inputStyle,\n              fontFamily: 'monospace'\n            },\n            value: codeField.val,\n            onChange: e => codeField.setVal(e.target.value),\n            onBlur: codeField.commit,\n            placeholder: `// Recebe \"context\" (variáveis atuais)\\n// deve retornar um objeto com novas variáveis\\nreturn { nova_variavel: 123 };`\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1135,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1126,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1125,\n        columnNumber: 9\n      }, this);\n    }\n\n    // DELAY\n    if (n.type === 'delay') {\n      const d = n.data || {};\n      const upd = p => patchNode(n.id, {\n        ...d,\n        ...p\n      });\n      const updateSummary = (mode, v) => {\n        if (mode === 'duration') {\n          const {\n            seconds = 0\n          } = {\n            ...d,\n            ...v\n          };\n          upd({\n            summary: `${seconds} second${seconds === 1 ? '' : 's'}`\n          });\n        } else {\n          const dt = new Date((v === null || v === void 0 ? void 0 : v.until) || d.until || Date.now());\n          upd({\n            summary: `until ${dt.toLocaleString()}`\n          });\n        }\n      };\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          position: 'fixed',\n          right: 16,\n          top: 72,\n          zIndex: 20\n        },\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          style: panelWrap,\n          children: [label('Modo'), /*#__PURE__*/_jsxDEV(\"select\", {\n            style: inputStyle,\n            value: d.mode || 'duration',\n            onChange: e => {\n              const mode = e.target.value;\n              upd({\n                mode\n              });\n              updateSummary(mode);\n            },\n            children: [/*#__PURE__*/_jsxDEV(\"option\", {\n              value: \"duration\",\n              children: \"Por dura\\xE7\\xE3o\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1174,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n              value: \"until\",\n              children: \"At\\xE9 data/hora\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1175,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1165,\n            columnNumber: 13\n          }, this), d.mode !== 'until' ? /*#__PURE__*/_jsxDEV(_Fragment, {\n            children: [label('Segundos'), /*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"number\",\n              min: 1,\n              style: inputStyle,\n              value: d.seconds || 30,\n              onChange: e => {\n                const seconds = Math.max(1, Number(e.target.value || 1));\n                upd({\n                  seconds\n                });\n                updateSummary('duration', {\n                  seconds\n                });\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1181,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true) : /*#__PURE__*/_jsxDEV(_Fragment, {\n            children: [label('Executar após (data/hora)'), /*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"datetime-local\",\n              style: inputStyle,\n              value: d.until || '',\n              onChange: e => {\n                const until = e.target.value;\n                upd({\n                  until\n                });\n                updateSummary('until', {\n                  until\n                });\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1196,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1163,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1162,\n        columnNumber: 9\n      }, this);\n    }\n\n    // WAIT — sem config: as rotas são nos edges\n    if (n.type === 'wait') {\n      const d = n.data || {};\n      const labelField = useLocalField(d.label || 'Wait & Reply', v => patchNode(n.id, {\n        label: v\n      }));\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          position: 'fixed',\n          right: 16,\n          top: 72,\n          zIndex: 20\n        },\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          style: panelWrap,\n          children: [label('Label'), /*#__PURE__*/_jsxDEV(\"input\", {\n            style: inputStyle,\n            value: labelField.val,\n            onChange: e => labelField.setVal(e.target.value),\n            onBlur: labelField.commit\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1221,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              fontSize: 12,\n              color: '#64748b',\n              marginTop: 8\n            },\n            children: \"Conecte m\\xFAltiplos edges a este n\\xF3. Selecione um edge para editar a condi\\xE7\\xE3o (palavras, payload de bot\\xE3o ou regex). Defina um \\u201CFallback\\u201D em um edge, se desejar.\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1227,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1219,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1218,\n        columnNumber: 9\n      }, this);\n    }\n    return null;\n  };\n\n  // Drawer — EDGE (condições)\n  _s4(DrawerNode, \"mc1k9YCRNIRj9nW0XJblG9pebVA=\", false, function () {\n    return [useLocalField, useLocalField, useLocalField, useLocalField, useLocalField, useLocalField, useLocalField, useLocalField, useLocalField, useLocalField];\n  });\n  const selectedEdge = edges.find(e => e.id === drawerEdgeId);\n  const DrawerEdge = () => {\n    if (!selectedEdge) return null;\n    const d = selectedEdge.data || {};\n    const condType = d.conditionType || 'keywords';\n    const value = d.value || '';\n    const isFallback = !!d.isFallback;\n    const labelVal = selectedEdge.label || '';\n    const setCondType = v => patchEdge(selectedEdge.id, {\n      data: {\n        conditionType: v\n      }\n    });\n    const setValue = v => patchEdge(selectedEdge.id, {\n      data: {\n        value: v\n      }\n    });\n    const setFallback = v => patchEdge(selectedEdge.id, {\n      data: {\n        isFallback: v\n      }\n    });\n    const setLabel = v => patchEdge(selectedEdge.id, {\n      label: v\n    });\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        position: 'fixed',\n        right: 16,\n        top: 72,\n        zIndex: 21\n      },\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        style: panelWrap,\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            fontWeight: 700,\n            marginBottom: 8\n          },\n          children: \"Condi\\xE7\\xE3o do Edge\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1257,\n          columnNumber: 11\n        }, this), label('Rótulo (aparece no edge)'), /*#__PURE__*/_jsxDEV(\"input\", {\n          style: inputStyle,\n          value: labelVal,\n          onChange: e => setLabel(e.target.value),\n          placeholder: \"ex.: SIM / N\\xC3O / Outro\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1260,\n          columnNumber: 11\n        }, this), label('Tipo de condição'), /*#__PURE__*/_jsxDEV(\"select\", {\n          style: inputStyle,\n          value: condType,\n          onChange: e => setCondType(e.target.value),\n          children: [/*#__PURE__*/_jsxDEV(\"option\", {\n            value: \"keywords\",\n            children: \"keywords (palavras separadas por |)\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1264,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n            value: \"payload\",\n            children: \"payload (ID de bot\\xE3o)\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1265,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n            value: \"regex\",\n            children: \"regex (ex.: /sim|yes/i)\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1266,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1263,\n          columnNumber: 11\n        }, this), label(condType === 'keywords' ? 'Palavras (separadas por |)' : condType === 'payload' ? 'Payload(s) (separados por |)' : 'Regex (ex.: /sim|yes/i)'), /*#__PURE__*/_jsxDEV(\"input\", {\n          style: inputStyle,\n          value: value,\n          onChange: e => setValue(e.target.value),\n          placeholder: condType === 'regex' ? '/sim|yes/i' : 'sim|yes'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1274,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n          style: {\n            display: 'flex',\n            gap: 8,\n            marginTop: 8,\n            alignItems: 'center'\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"checkbox\",\n            checked: isFallback,\n            onChange: e => setFallback(e.target.checked)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1277,\n            columnNumber: 13\n          }, this), \"Tornar este edge Fallback (usado se nenhuma outra condi\\xE7\\xE3o casar)\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1276,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1256,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1255,\n      columnNumber: 7\n    }, this);\n  };\n\n  // toolbar chips (sem Audiência / sem End)\n  const Chips = () => /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      display: 'flex',\n      gap: 8,\n      alignItems: 'center'\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"span\", {\n      style: {\n        fontSize: 12,\n        color: '#6b7280',\n        marginRight: 8\n      },\n      children: \"Arraste para o canvas:\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1288,\n      columnNumber: 7\n    }, this), [['message', 'Mensagem'], ['api', 'API'], ['code', 'Code'], ['delay', 'Delay'], ['wait', 'Wait & Reply']].map(([t, label]) => /*#__PURE__*/_jsxDEV(\"button\", {\n      className: \"btn secondary\",\n      draggable: true,\n      onDragStart: onDragStartChip(t),\n      children: label\n    }, t, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1296,\n      columnNumber: 9\n    }, this))]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 1287,\n    columnNumber: 5\n  }, this);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      padding: 12,\n      display: 'grid',\n      gridTemplateColumns: '1fr auto',\n      gap: 12\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        display: 'flex',\n        alignItems: 'center',\n        gap: 10\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"btn\",\n        onClick: handleBack,\n        children: \"Voltar\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1306,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Chips, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1309,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        value: flowName,\n        onChange: e => {\n          setFlowName(e.target.value);\n          setDirty(true);\n        },\n        style: {\n          marginLeft: 12,\n          width: 320,\n          border: '1px solid #cbd5e1',\n          borderRadius: 8,\n          padding: '8px 10px'\n        },\n        placeholder: \"Nome do flow\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1310,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 1305,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        display: 'flex',\n        gap: 8,\n        justifyContent: 'flex-end'\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"btn\",\n        onClick: autoLayout,\n        children: \"Auto-layout\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1321,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"btn\",\n        onClick: async () => {\n          try {\n            const input = document.createElement('input');\n            input.type = 'file';\n            input.accept = 'application/json';\n            input.onchange = ev => {\n              var _ev$target$files;\n              const f = (_ev$target$files = ev.target.files) === null || _ev$target$files === void 0 ? void 0 : _ev$target$files[0];\n              if (!f) return;\n              const r = new FileReader();\n              r.onload = () => {\n                try {\n                  const data = JSON.parse(r.result);\n                  if (Array.isArray(data.nodes) && Array.isArray(data.edges)) {\n                    setNodes(data.nodes);\n                    setEdges(data.edges);\n                    setFlowName(data.name || 'Flow');\n                    setDirty(true);\n                    setTimeout(() => {\n                      var _rfInstanceRef$curren1;\n                      return (_rfInstanceRef$curren1 = rfInstanceRef.current) === null || _rfInstanceRef$curren1 === void 0 ? void 0 : _rfInstanceRef$curren1.fitView({\n                        padding: 0.2\n                      });\n                    }, 40);\n                  } else alert('JSON inválido.');\n                } catch {\n                  alert('Falha ao ler JSON.');\n                }\n              };\n              r.readAsText(f);\n            };\n            input.click();\n          } catch {}\n        },\n        children: \"Importar\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1324,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"btn\",\n        onClick: () => {\n          const blob = new Blob([JSON.stringify({\n            name: flowName,\n            nodes,\n            edges\n          }, null, 2)], {\n            type: 'application/json'\n          });\n          const a = document.createElement('a');\n          a.href = URL.createObjectURL(blob);\n          a.download = `${slug(flowName)}.json`;\n          a.click();\n          URL.revokeObjectURL(a.href);\n        },\n        children: \"Exportar\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1357,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"btn\",\n        onClick: handleSave,\n        children: \"Salvar flow\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1372,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 1320,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        gridColumn: '1 / span 2',\n        height: 'calc(100vh - 120px)',\n        border: '1px solid #e5e7eb',\n        borderRadius: 12,\n        position: 'relative',\n        overflow: 'hidden'\n      },\n      onDrop: onDrop,\n      onDragOver: onDragOver,\n      children: [/*#__PURE__*/_jsxDEV(ReactFlow, {\n        nodes: nodes,\n        edges: edges,\n        nodeTypes: nodeTypes,\n        onInit: inst => {\n          rfInstanceRef.current = inst;\n          setTimeout(() => inst.fitView({\n            padding: 0.2\n          }), 30);\n        },\n        onNodesChange: onNodesChange,\n        onEdgesChange: onEdgesChange,\n        onConnect: onConnect,\n        onSelectionChange: onSelectionChange,\n        onNodeContextMenu: onNodeContextMenu,\n        onPaneClick: onPaneClick,\n        fitView: true,\n        children: [/*#__PURE__*/_jsxDEV(MiniMap, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1405,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Controls, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1406,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Background, {\n          gap: 16\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1407,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1389,\n        columnNumber: 9\n      }, this), ctxMenu && /*#__PURE__*/_jsxDEV(\"div\", {\n        onMouseLeave: closeCtx,\n        style: {\n          position: 'fixed',\n          top: ctxMenu.y,\n          left: ctxMenu.x,\n          transform: 'translateY(-8px)',\n          background: '#fff',\n          border: '1px solid #e5e7eb',\n          borderRadius: 8,\n          boxShadow: '0 8px 24px rgba(0,0,0,.12)',\n          zIndex: 30,\n          overflow: 'hidden'\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"btn secondary\",\n          style: {\n            width: 180,\n            display: 'block',\n            borderRadius: 0\n          },\n          onClick: doRename,\n          children: \"Renomear\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1427,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"btn secondary\",\n          style: {\n            width: 180,\n            display: 'block',\n            borderRadius: 0\n          },\n          onClick: doDuplicate,\n          children: \"Duplicar\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1430,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"btn secondary\",\n          style: {\n            width: 180,\n            display: 'block',\n            borderRadius: 0\n          },\n          onClick: doReset,\n          children: \"Resetar\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1433,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"btn danger\",\n          style: {\n            width: 180,\n            display: 'block',\n            borderRadius: 0\n          },\n          onClick: doDelete,\n          children: \"Deletar\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1436,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1412,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 1377,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(DrawerNode, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1444,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(DrawerEdge, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1445,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 1304,\n    columnNumber: 5\n  }, this);\n}\n_s5(JourneyBuilder, \"sNBWaOiPzwMrUGxBG/UERdpXDyw=\", false, function () {\n  return [useNavigate, useNodesState, useEdgesState];\n});\n_c1 = JourneyBuilder;\nvar _c, _c2, _c3, _c4, _c5, _c6, _c7, _c8, _c9, _c0, _c1;\n$RefreshReg$(_c, \"NodeShell\");\n$RefreshReg$(_c2, \"AudienceNode\");\n$RefreshReg$(_c3, \"MessageNode\");\n$RefreshReg$(_c4, \"ButtonsBuilder\");\n$RefreshReg$(_c5, \"ApiNode\");\n$RefreshReg$(_c6, \"CodeNode\");\n$RefreshReg$(_c7, \"DelayNode\");\n$RefreshReg$(_c8, \"WaitNode\");\n$RefreshReg$(_c9, \"EndNode\");\n$RefreshReg$(_c0, \"AudiencePanel\");\n$RefreshReg$(_c1, \"JourneyBuilder\");","map":{"version":3,"names":["React","useCallback","useEffect","useMemo","useRef","useState","useNavigate","ReactFlow","Background","Controls","MiniMap","addEdge","useEdgesState","useNodesState","MarkerType","Handle","Position","Papa","jsxDEV","_jsxDEV","Fragment","_Fragment","PIN","uid","p","Date","now","Math","floor","random","slug","s","String","trim","toLowerCase","replace","NodeShell","title","subtitle","selected","children","style","background","border","borderRadius","width","boxShadow","padding","borderBottom","fontWeight","color","fileName","_jsxFileName","lineNumber","columnNumber","fontSize","_c","AudienceNode","type","id","position","Right","height","_c2","MessageNode","data","label","channel","toUpperCase","mode","Left","_c3","ButtonsBuilder","nodeId","valueJson","patchNode","inputStyle","_s","safeParse","txt","arr","JSON","parse","Array","isArray","btns","setBtns","showJson","setShowJson","json","stringify","buttonsJson","add","base","url","phone","b","upd","i","patch","map","x","idx","del","filter","_","move","dir","next","slice","j","length","BtnRow","it","display","gridTemplateColumns","gap","marginBottom","alignItems","value","onChange","e","t","target","undefined","placeholder","className","onClick","marginTop","v","rows","readOnly","fontFamily","_c4","ApiNode","_c5","CodeNode","_c6","DelayNode","summary","_c7","WaitNode","_c8","EndNode","_c9","AudiencePanel","node","slugFn","_s2","d","headers","setHeaders","setRows","allRows","setAllRows","mapping","setMapping","phoneKey","setPhoneKey","onFile","_e$target$files","f","files","header","skipEmptyLines","complete","res","hs","meta","fields","Object","keys","guess","forEach","h","pk","find","test","saveMap","alert","accept","maxHeight","overflow","alignSelf","textAlign","m","_c0","JourneyBuilder","_s5","_s3","$RefreshSig$","_s4","navigate","nodes","setNodes","onNodesChangeBase","edges","setEdges","onEdgesChangeBase","flowId","setFlowId","flowName","setFlowName","drawerNodeId","setDrawerNodeId","drawerEdgeId","setDrawerEdgeId","dirty","setDirty","initializedRef","rfInstanceRef","dragType","templates","setTemplates","fetch","then","r","contents","catch","nodeTypes","audience","message","api","code","delay","wait","end","current","sp","URLSearchParams","window","location","search","get","isNew","seedAudience","audId","y","setTimeout","_rfInstanceRef$curren","fitView","ok","Promise","reject","name","_rfInstanceRef$curren2","raw","localStorage","getItem","_rfInstanceRef$curren3","onNodesChange","chs","onEdgesChange","typeOf","_nodes$find","n","onConnect","params","sourceType","source","eds","conditionType","isFallback","stroke","markerEnd","ArrowClosed","onSelectionChange","ns","es","_ns$","_es$","onPaneClick","nds","patchEdge","onDragStartChip","dataTransfer","setData","effectAllowed","onDragOver","preventDefault","dropEffect","onDrop","_rfInstanceRef$curren4","_rfInstanceRef$curren5","_rfInstanceRef$curren6","_rfInstanceRef$curren7","_rfInstanceRef$curren8","_rfInstanceRef$curren9","getData","rect","wrapper","getBoundingClientRect","call","transform","getViewport","pos","clientX","left","clientY","top","common","text","method","body","mappings","lastResponse","seconds","concat","ctxMenu","setCtxMenu","onNodeContextMenu","closeCtx","doRename","_nodes$find2","_nodes$find2$data","val","prompt","doDuplicate","clone","doReset","fresh","doDelete","autoLayout","newNodes","start","byId","fromEntries","outs","push","ordered","cur","visited","Set","_outs$cur","has","values","_rfInstanceRef$curren0","handleSave","hasEnd","some","nNodes","nEdges","idsWithOut","last","endId","endNode","edge","payload","updatedAt","toISOString","Error","saved","history","replaceState","setItem","handleBack","confirm","small","panelWrap","selectedNode","useLocalField","initial","onCommit","setVal","commit","DrawerNode","right","zIndex","_Object$values$","found","templateSid","sid","firstTypeBody","types","labelField","textField","mediaField","mediaUrl","buttonsField","onBlur","friendly_name","headersField","bodyField","tryParse","testRequest","addMapping","path","var","updateMap","removeMap","splice","codeField","updateSummary","dt","until","toLocaleString","min","max","Number","selectedEdge","DrawerEdge","condType","labelVal","setCondType","setValue","setFallback","setLabel","checked","Chips","marginRight","draggable","onDragStart","marginLeft","justifyContent","input","document","createElement","onchange","ev","_ev$target$files","FileReader","onload","result","_rfInstanceRef$curren1","readAsText","click","blob","Blob","a","href","URL","createObjectURL","download","revokeObjectURL","gridColumn","onInit","inst","onMouseLeave","_c1","$RefreshReg$"],"sources":["/Users/gustsantos/Desktop/initucastt_old/frontend/src/pages/JourneyBuilder.jsx"],"sourcesContent":["// frontend/src/pages/JourneyBuilder.jsx\nimport React, { useCallback, useEffect, useMemo, useRef, useState } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport ReactFlow, {\n  Background,\n  Controls,\n  MiniMap,\n  addEdge,\n  useEdgesState,\n  useNodesState,\n  MarkerType,\n  Handle,\n  Position,\n} from 'reactflow';\nimport 'reactflow/dist/style.css';\nimport Papa from 'papaparse';\n\n// === util ===\nconst PIN = 14;\nconst uid = (p) => `${p}_${Date.now()}_${Math.floor(Math.random() * 9999)}`;\nconst slug = (s) =>\n  String(s || '')\n    .trim()\n    .toLowerCase()\n    .replace(/\\s+/g, '_')\n    .replace(/[^\\w]/g, '_')\n    .replace(/_+/g, '_');\n\nconst NodeShell = ({ title, subtitle, selected, children }) => (\n  <div\n    style={{\n      background: '#fff',\n      border: selected ? '2px solid #2563eb' : '1px solid #e5e7eb',\n      borderRadius: 12,\n      width: 320,\n      boxShadow: '0 2px 8px rgba(0,0,0,.06)',\n    }}\n  >\n    <div style={{ padding: '12px 14px', borderBottom: '1px solid #f1f5f9' }}>\n      <div style={{ fontWeight: 700, color: '#0f172a' }}>{title}</div>\n      {subtitle ? <div style={{ fontSize: 12, color: '#64748b' }}>{subtitle}</div> : null}\n    </div>\n    <div style={{ padding: 12 }}>{children}</div>\n  </div>\n);\n\n// === node components ===\nconst AudienceNode = ({ selected }) => (\n  <NodeShell title=\"Audiência\" subtitle=\"CSV → variáveis\" selected={selected}>\n    <div style={{ fontSize: 12, color: '#475569' }}>\n      Faça upload e mapeie colunas no painel ao lado.\n    </div>\n    <Handle\n      type=\"source\"\n      id=\"out\"\n      position={Position.Right}\n      style={{ background: '#16a34a', width: PIN, height: PIN, border: '2px solid #fff' }}\n    />\n  </NodeShell>\n);\n\nconst MessageNode = ({ data, selected }) => (\n  <NodeShell\n    title={data.label || 'Mensagem'}\n    subtitle={`Canal: ${String(data.channel || 'whatsapp').toUpperCase()} • Tipo: ${data.mode || 'text'}`}\n    selected={selected}\n  >\n    <div style={{ fontSize: 12, color: '#475569' }}>Conteúdo configurável no painel ao lado.</div>\n    <Handle\n      type=\"target\"\n      id=\"in\"\n      position={Position.Left}\n      style={{ background: '#6b7280', width: PIN, height: PIN, border: '2px solid #fff' }}\n    />\n    <Handle\n      type=\"source\"\n      id=\"out\"\n      position={Position.Right}\n      style={{ background: '#16a34a', width: PIN, height: PIN, border: '2px solid #fff' }}\n    />\n  </NodeShell>\n);\n\n// === UI para montar botões (sem digitar JSON) ===\nfunction ButtonsBuilder({ nodeId, valueJson, patchNode, inputStyle, label }) {\n  const safeParse = (txt) => {\n    if (!txt) return [];\n    try {\n      const arr = JSON.parse(txt);\n      return Array.isArray(arr) ? arr : [];\n    } catch {\n      return [];\n    }\n  };\n\n  const [btns, setBtns] = React.useState(safeParse(valueJson));\n  const [showJson, setShowJson] = React.useState(false);\n\n  // Se vier mudança externa (ex.: carregar flow), sincroniza\n  React.useEffect(() => {\n    setBtns(safeParse(valueJson));\n  }, [valueJson]);\n\n  // Empurra para o node sempre que btns mudar\n  React.useEffect(() => {\n    const json = JSON.stringify(btns, null, 2);\n    patchNode(nodeId, { buttonsJson: json });\n    // eslint-disable-next-line\n  }, [btns]);\n\n  const add = (type = 'reply') => {\n    const base =\n      type === 'reply'\n        ? { type: 'reply', title: '', id: '' }\n        : type === 'url'\n        ? { type: 'url', title: '', url: '' }\n        : { type: 'phone', title: '', phone: '' };\n    setBtns((b) => [...b, base]);\n  };\n\n  const upd = (i, patch) =>\n    setBtns((b) => b.map((x, idx) => (idx === i ? { ...x, ...patch } : x)));\n\n  const del = (i) => setBtns((b) => b.filter((_, idx) => idx !== i));\n\n  const move = (i, dir) => {\n    setBtns((b) => {\n      const next = b.slice();\n      const j = i + dir;\n      if (j < 0 || j >= next.length) return b;\n      [next[i], next[j]] = [next[j], next[i]];\n      return next;\n    });\n  };\n\n  const BtnRow = ({ it, i }) => {\n    return (\n      <div\n        style={{\n          display: 'grid',\n          gridTemplateColumns: '110px 1fr 1fr auto',\n          gap: 8,\n          marginBottom: 8,\n          alignItems: 'center',\n        }}\n      >\n        {/* Tipo */}\n        <select\n          style={inputStyle}\n          value={it.type || 'reply'}\n          onChange={(e) => {\n            const t = e.target.value;\n            // ao trocar tipo, normaliza campos\n            if (t === 'reply') upd(i, { type: 'reply', url: undefined, phone: undefined, id: it.id || '', title: it.title || '' });\n            if (t === 'url')   upd(i, { type: 'url',   id: undefined,  phone: undefined, url: it.url || '', title: it.title || '' });\n            if (t === 'phone') upd(i, { type: 'phone', id: undefined,  url: undefined,  phone: it.phone || '', title: it.title || '' });\n          }}\n        >\n          <option value=\"reply\">reply</option>\n          <option value=\"url\">url</option>\n          <option value=\"phone\">phone</option>\n        </select>\n\n        {/* Title sempre existe */}\n        <input\n          style={inputStyle}\n          placeholder=\"Título do botão\"\n          value={it.title || ''}\n          onChange={(e) => upd(i, { title: e.target.value })}\n        />\n\n        {/* Campo condicionado ao tipo */}\n        {it.type === 'reply' && (\n          <input\n            style={inputStyle}\n            placeholder=\"ID (ex.: YES)\"\n            value={it.id || ''}\n            onChange={(e) => upd(i, { id: e.target.value })}\n          />\n        )}\n        {it.type === 'url' && (\n          <input\n            style={inputStyle}\n            placeholder=\"https://...\"\n            value={it.url || ''}\n            onChange={(e) => upd(i, { url: e.target.value })}\n          />\n        )}\n        {it.type === 'phone' && (\n          <input\n            style={inputStyle}\n            placeholder=\"+55...\"\n            value={it.phone || ''}\n            onChange={(e) => upd(i, { phone: e.target.value })}\n          />\n        )}\n\n        {/* Ações */}\n        <div style={{ display: 'flex', gap: 6 }}>\n          <button className=\"btn secondary\" onClick={() => move(i, -1)}>↑</button>\n          <button className=\"btn secondary\" onClick={() => move(i, +1)}>↓</button>\n          <button className=\"btn danger\" onClick={() => del(i)}>x</button>\n        </div>\n      </div>\n    );\n  };\n\n  return (\n    <div>\n      {label('Botões')}\n      {btns.map((it, i) => (\n        <BtnRow key={i} it={it} i={i} />\n      ))}\n\n      <div style={{ display: 'flex', gap: 8, marginTop: 6, marginBottom: 10 }}>\n        <button className=\"btn\" onClick={() => add('reply')}>+ Reply</button>\n        <button className=\"btn\" onClick={() => add('url')}>+ URL</button>\n        <button className=\"btn\" onClick={() => add('phone')}>+ Phone</button>\n        <button className=\"btn secondary\" onClick={() => setShowJson((v) => !v)}>\n          {showJson ? 'Esconder JSON' : 'Ver JSON (avançado)'}\n        </button>\n      </div>\n\n      {showJson && (\n        <>\n          {label('JSON (só leitura)')}\n          <textarea\n            rows={6}\n            readOnly\n            style={{ ...inputStyle, fontFamily: 'monospace' }}\n            value={JSON.stringify(btns, null, 2)}\n          />\n          <div style={{ fontSize: 12, color: '#64748b', marginTop: 6 }}>\n            Observação: salvamos neste formato para o executor, mas você edita tudo por cima sem precisar mexer em JSON.\n          </div>\n        </>\n      )}\n\n      <div style={{ fontSize: 12, color: '#64748b', marginTop: 8 }}>\n        Dicas do WhatsApp: **Reply** (até 3 botões), **URL** abre link, **Phone** inicia chamada.\n      </div>\n    </div>\n  );\n}\n\nconst ApiNode = ({ selected }) => (\n  <NodeShell title=\"API Call\" selected={selected}>\n    <div style={{ fontSize: 12, color: '#475569' }}>\n      Configure método/URL no painel ao lado. Salva variáveis via mapeamentos.\n    </div>\n    <Handle\n      type=\"target\"\n      id=\"in\"\n      position={Position.Left}\n      style={{ background: '#6b7280', width: PIN, height: PIN, border: '2px solid #fff' }}\n    />\n    <Handle\n      type=\"source\"\n      id=\"out\"\n      position={Position.Right}\n      style={{ background: '#16a34a', width: PIN, height: PIN, border: '2px solid #fff' }}\n    />\n  </NodeShell>\n);\n\nconst CodeNode = ({ selected }) => (\n  <NodeShell title=\"Code\" subtitle=\"JS custom\" selected={selected}>\n    <div style={{ fontSize: 12, color: '#475569' }}>\n      Cole seu JS no painel ao lado. Deve retornar um objeto de variáveis.\n    </div>\n    <Handle\n      type=\"target\"\n      id=\"in\"\n      position={Position.Left}\n      style={{ background: '#6b7280', width: PIN, height: PIN, border: '2px solid #fff' }}\n    />\n    <Handle\n      type=\"source\"\n      id=\"out\"\n      position={Position.Right}\n      style={{ background: '#16a34a', width: PIN, height: PIN, border: '2px solid #fff' }}\n    />\n  </NodeShell>\n);\n\nconst DelayNode = ({ data, selected }) => (\n  <NodeShell title=\"Delay\" subtitle={data?.summary || ''} selected={selected}>\n    <div style={{ fontSize: 12, color: '#475569' }}>Espera antes de seguir para o próximo nó.</div>\n    <Handle\n      type=\"target\"\n      id=\"in\"\n      position={Position.Left}\n      style={{ background: '#6b7280', width: PIN, height: PIN, border: '2px solid #fff' }}\n    />\n    <Handle\n      type=\"source\"\n      id=\"out\"\n      position={Position.Right}\n      style={{ background: '#16a34a', width: PIN, height: PIN, border: '2px solid #fff' }}\n    />\n  </NodeShell>\n);\n\nconst WaitNode = ({ data, selected }) => (\n  <NodeShell\n    title=\"Wait & Reply\"\n    subtitle=\"aguarda resposta e ramifica\"\n    selected={selected}\n  >\n    <div style={{ fontSize: 12, color: '#475569' }}>\n      Conecte <em>múltiplos</em> edges para as rotas e edite a condição no edge.\n    </div>\n    <Handle\n      type=\"target\"\n      id=\"in\"\n      position={Position.Left}\n      style={{ background: '#6b7280', width: PIN, height: PIN, border: '2px solid #fff' }}\n    />\n    <Handle\n      type=\"source\"\n      id=\"out\"\n      position={Position.Right}\n      style={{ background: '#16a34a', width: PIN, height: PIN, border: '2px solid #fff' }}\n    />\n  </NodeShell>\n);\n\nconst EndNode = ({ selected }) => (\n  <NodeShell title=\"End\" subtitle=\"término do fluxo\" selected={selected}>\n    <div style={{ fontSize: 12, color: '#475569' }}>Nó terminal. Só recebe conexões.</div>\n    <Handle\n      type=\"target\"\n      id=\"in\"\n      position={Position.Left}\n      style={{ background: '#6b7280', width: PIN, height: PIN, border: '2px solid #fff' }}\n    />\n  </NodeShell>\n);\n\n// === side panels ===\nfunction AudiencePanel({ node, patchNode, inputStyle, label, slugFn }) {\n  const d = node.data || {};\n  const [headers, setHeaders] = useState(d.headers || []);\n  const [rows, setRows] = useState(d.rows || []);\n  const [allRows, setAllRows] = useState(d.allRows || []);\n  const [mapping, setMapping] = useState(d.mapping || {});\n  const [phoneKey, setPhoneKey] = useState(d.phoneKey || '');\n\n  useEffect(() => {\n    setHeaders(d.headers || []);\n    setRows(d.rows || []);\n    setMapping(d.mapping || {});\n    setPhoneKey(d.phoneKey || '');\n    // eslint-disable-next-line\n  }, [node.id]);\n\n  const onFile = (e) => {\n    const f = e.target.files?.[0];\n    if (!f) return;\n    Papa.parse(f, {\n      header: true,\n      skipEmptyLines: true,\n      complete: (res) => {\n        const hs = res.meta.fields || Object.keys(res.data[0] || {});\n        const guess = {};\n        hs.forEach((h) => (guess[h] = slugFn(h)));\n        const pk = hs.find((h) => /phone|telefone|celular|numero|n[uú]mero/i.test(h)) || '';\n        setHeaders(hs);\n        setRows(res.data.slice(0, 5));\n        setAllRows(res.data);\n        setMapping(guess);\n        setPhoneKey(pk);\n      },\n    });\n  };\n\n  const saveMap = () => {\n    if (!phoneKey) return alert('Escolha a coluna de telefone.');\n    patchNode(node.id, { headers, rows, mapping, phoneKey, allRows });\n    alert('Mapeamento salvo.');\n  };\n\n  return (\n    <>\n      {label('Arquivo CSV')}\n      <input type=\"file\" accept=\".csv\" onChange={onFile} />\n\n      {headers.length > 0 && (\n        <>\n          {label('Coluna de telefone')}\n          <select style={inputStyle} value={phoneKey} onChange={(e) => setPhoneKey(e.target.value)}>\n            <option value=\"\">— selecione —</option>\n            {headers.map((h) => (\n              <option key={h} value={h}>\n                {h}\n              </option>\n            ))}\n          </select>\n\n          {label('Mapeamento (coluna → variável)')}\n          <div\n            style={{\n              display: 'grid',\n              gridTemplateColumns: '1fr 20px 1fr',\n              gap: 8,\n              maxHeight: 200,\n              overflow: 'auto',\n            }}\n          >\n            {headers.map((h) => (\n              <React.Fragment key={h}>\n                <div style={{ alignSelf: 'center', fontSize: 13 }}>{h}</div>\n                <div style={{ textAlign: 'center', color: '#94a3b8' }}>→</div>\n                <input\n                  style={inputStyle}\n                  value={mapping[h] || ''}\n                  placeholder={slugFn(h)}\n                  onChange={(e) => setMapping((m) => ({ ...m, [h]: slugFn(e.target.value) }))}\n                />\n              </React.Fragment>\n            ))}\n          </div>\n\n          <button className=\"btn\" onClick={saveMap} style={{ marginTop: 10 }}>\n            Salvar mapeamento\n          </button>\n\n          {rows.length > 0 && (\n            <>\n              {label('Amostra (5 primeiras linhas)')}\n              <pre\n                style={{\n                  background: '#f8fafc',\n                  border: '1px solid #e2e8f0',\n                  borderRadius: 8,\n                  padding: 10,\n                  fontSize: 12,\n                  maxHeight: 160,\n                  overflow: 'auto',\n                }}\n              >\n                {JSON.stringify(rows, null, 2)}\n              </pre>\n            </>\n          )}\n          <div style={{ fontSize: 12, color: '#64748b', marginTop: 8 }}>\n            Use as variáveis com <code>{'{{minha_variavel}}'}</code>.\n          </div>\n        </>\n      )}\n    </>\n  );\n}\n\n// === principal ===\nexport default function JourneyBuilder() {\n  const navigate = useNavigate();\n  const [nodes, setNodes, onNodesChangeBase] = useNodesState([]);\n  const [edges, setEdges, onEdgesChangeBase] = useEdgesState([]);\n\n  const [flowId, setFlowId] = useState(null);\n  const [flowName, setFlowName] = useState('Novo Flow');\n  const [drawerNodeId, setDrawerNodeId] = useState(null);\n  const [drawerEdgeId, setDrawerEdgeId] = useState(null);\n  const [dirty, setDirty] = useState(false);\n  const initializedRef = useRef(false);\n  const rfInstanceRef = useRef(null);\n\n  // palette drag type\n  const dragType = useRef(null);\n\n  // templates (Twilio)\n  const [templates, setTemplates] = useState([]);\n  useEffect(() => {\n    fetch('/api/templates/list')\n      .then((r) => r.json())\n      .then((data) => setTemplates(data.contents || []))\n      .catch(() => setTemplates([]));\n  }, []);\n\n  const nodeTypes = useMemo(\n    () => ({\n      audience: AudienceNode,\n      message: MessageNode,\n      api: ApiNode,\n      code: CodeNode,\n      delay: DelayNode,\n      wait: WaitNode,\n      end: EndNode,\n    }),\n    []\n  );\n\n  // init: se ?id carrega; se ?new, cria com Audiência; default idem\n  useEffect(() => {\n    if (initializedRef.current) return;\n    initializedRef.current = true;\n\n    const sp = new URLSearchParams(window.location.search);\n    const id = sp.get('id');\n    const isNew = sp.get('new') === '1';\n\n    const seedAudience = () => {\n      const audId = uid('aud');\n      setNodes([{ id: audId, type: 'audience', position: { x: 120, y: 160 }, data: {} }]);\n      setEdges([]);\n      setTimeout(() => rfInstanceRef.current?.fitView({ padding: 0.2 }), 50);\n    };\n\n    if (id) {\n      setFlowId(id);\n      fetch(`/api/journeys/${id}`)\n        .then((r) => (r.ok ? r.json() : Promise.reject()))\n        .then((f) => {\n          if (Array.isArray(f.nodes) && Array.isArray(f.edges)) {\n            setNodes(f.nodes);\n            setEdges(f.edges);\n            setFlowName(f.name || 'Flow');\n            setTimeout(() => rfInstanceRef.current?.fitView({ padding: 0.2 }), 60);\n          } else seedAudience();\n        })\n        .catch(() => {\n          const raw = localStorage.getItem(id);\n          if (raw) {\n            try {\n              const f = JSON.parse(raw);\n              setNodes(f.nodes || []);\n              setEdges(f.edges || []);\n              setFlowName(f.name || 'Flow');\n            } catch {\n              seedAudience();\n            }\n          } else seedAudience();\n          setTimeout(() => rfInstanceRef.current?.fitView({ padding: 0.2 }), 60);\n        });\n    } else if (isNew) {\n      seedAudience();\n    } else {\n      seedAudience();\n    }\n  }, [setNodes, setEdges]);\n\n  // dirty tracking\n  const onNodesChange = useCallback(\n    (chs) => {\n      setDirty(true);\n      onNodesChangeBase(chs);\n    },\n    [onNodesChangeBase]\n  );\n  const onEdgesChange = useCallback(\n    (chs) => {\n      setDirty(true);\n      onEdgesChangeBase(chs);\n    },\n    [onEdgesChangeBase]\n  );\n\n  // helper: pega tipo do nó\n  const typeOf = useCallback(\n    (id) => nodes.find((n) => n.id === id)?.type,\n    [nodes]\n  );\n\n  // conecta (1 saída por nó exceto wait)\n  const onConnect = useCallback(\n    (params) => {\n      setDirty(true);\n      const sourceType = typeOf(params.source);\n      setEdges((eds) => {\n        const base = sourceType === 'wait' ? eds : eds.filter((e) => e.source !== params.source);\n        return addEdge(\n          {\n            ...params,\n            type: 'smoothstep',\n            label: '',\n            data: { conditionType: 'keywords', value: '', isFallback: false },\n            style: { stroke: '#0f172a' },\n            markerEnd: { type: MarkerType.ArrowClosed, color: '#0f172a' },\n          },\n          base\n        );\n      });\n    },\n    [setEdges, typeOf]\n  );\n\n  // seleção → abrir drawer (nó ou edge)\n  const onSelectionChange = useCallback(({ nodes: ns, edges: es }) => {\n    setDrawerNodeId(ns?.[0]?.id || null);\n    setDrawerEdgeId(es?.[0]?.id || null);\n  }, []);\n\n  // fechar drawer ao clicar no canvas\n  const onPaneClick = useCallback(() => {\n    setDrawerNodeId(null);\n    setDrawerEdgeId(null);\n  }, []);\n\n  // patch node\n  const patchNode = useCallback(\n    (id, patch) => {\n      setDirty(true);\n      setNodes((nds) => nds.map((n) => (n.id === id ? { ...n, data: { ...n.data, ...patch } } : n)));\n    },\n    [setNodes]\n  );\n\n  // patch edge\n  const patchEdge = useCallback(\n    (id, patch) => {\n      setDirty(true);\n      setEdges((eds) =>\n        eds.map((e) => (e.id === id ? { ...e, ...patch, data: { ...(e.data || {}), ...(patch.data || {}) } } : e))\n      );\n    },\n    [setEdges]\n  );\n\n  // DnD\n  const onDragStartChip = (type) => (e) => {\n    dragType.current = type;\n    e.dataTransfer.setData('application/reactflow', type);\n    e.dataTransfer.effectAllowed = 'move';\n  };\n  const onDragOver = (e) => {\n    e.preventDefault();\n    e.dataTransfer.dropEffect = 'move';\n  };\n  const onDrop = (e) => {\n    e.preventDefault();\n    const type = dragType.current || e.dataTransfer.getData('application/reactflow');\n    if (!type) return;\n\n    const rect = rfInstanceRef.current?.wrapper?.getBoundingClientRect?.();\n    const transform = rfInstanceRef.current?.getViewport?.()?.transform || [0, 0, 1];\n    const pos = {\n      x: (e.clientX - (rect?.left || 0) - transform[0]) / transform[2],\n      y: (e.clientY - (rect?.top || 0) - transform[1]) / transform[2],\n    };\n\n    const common = { position: pos };\n    const id = uid(type);\n    let node;\n    if (type === 'message') {\n      node = { id, type, data: { label: 'Mensagem', channel: 'whatsapp', mode: 'text', text: '' }, ...common };\n    } else if (type === 'api') {\n      node = {\n        id,\n        type,\n        data: { label: 'API Call', method: 'GET', url: '', headers: '{}', body: '{}', mappings: [], lastResponse: '' },\n        ...common,\n      };\n    } else if (type === 'code') {\n      node = { id, type, data: { label: 'Code', code: '// return { nova_variavel: 123 };' }, ...common };\n    } else if (type === 'delay') {\n      node = { id, type, data: { mode: 'duration', seconds: 30, summary: '30 seconds' }, ...common };\n    } else if (type === 'wait') {\n      node = { id, type, data: { label: 'Wait & Reply' }, ...common };\n    } else {\n      return;\n    }\n    setNodes((nds) => nds.concat(node));\n    setDirty(true);\n  };\n\n  // Context menu (só nó)\n  const [ctxMenu, setCtxMenu] = useState(null); // {x,y,nodeId}\n  const onNodeContextMenu = (e, node) => {\n    e.preventDefault();\n    setCtxMenu({ x: e.clientX, y: e.clientY, nodeId: node.id });\n  };\n  const closeCtx = () => setCtxMenu(null);\n  const doRename = () => {\n    if (!ctxMenu) return;\n    const val = window.prompt('Novo nome do nó:', nodes.find((n) => n.id === ctxMenu.nodeId)?.data?.label || '');\n    if (val != null) patchNode(ctxMenu.nodeId, { label: val });\n    closeCtx();\n  };\n  const doDuplicate = () => {\n    if (!ctxMenu) return;\n    setNodes((nds) => {\n      const n = nds.find((x) => x.id === ctxMenu.nodeId);\n      if (!n) return nds;\n      const clone = { ...n, id: uid(n.type), position: { x: n.position.x + 40, y: n.position.y + 40 } };\n      return nds.concat(clone);\n    });\n    closeCtx();\n  };\n  const doReset = () => {\n    if (!ctxMenu) return;\n    const n = nodes.find((x) => x.id === ctxMenu.nodeId);\n    if (!n) return;\n    let fresh = {};\n    if (n.type === 'message')\n      fresh = { label: 'Mensagem', channel: 'whatsapp', mode: 'text', text: '' };\n    if (n.type === 'api')\n      fresh = { label: 'API Call', method: 'GET', url: '', headers: '{}', body: '{}', mappings: [], lastResponse: '' };\n    if (n.type === 'code') fresh = { label: 'Code', code: '// return { nova_variavel: 123 };' };\n    if (n.type === 'delay') fresh = { mode: 'duration', seconds: 30, summary: '30 seconds' };\n    if (n.type === 'wait') fresh = { label: 'Wait & Reply' };\n    patchNode(n.id, fresh);\n    closeCtx();\n  };\n  const doDelete = () => {\n    if (!ctxMenu) return;\n    const id = ctxMenu.nodeId;\n    setEdges((eds) => eds.filter((e) => e.source !== id && e.target !== id));\n    setNodes((nds) => nds.filter((n) => n.id !== id));\n    setDirty(true);\n    closeCtx();\n  };\n\n  // auto-layout simples\n  const autoLayout = () => {\n    const newNodes = [...nodes];\n    const start = newNodes.find((n) => n.type === 'audience');\n    if (!start) return;\n    const byId = Object.fromEntries(newNodes.map((n) => [n.id, n]));\n    const outs = {};\n    edges.forEach((e) => {\n      (outs[e.source] ||= []).push(e.target);\n    });\n    const ordered = [start.id];\n    let cur = start.id;\n    const visited = new Set([start.id]);\n    // linear heurístico (pega primeira saída)\n    while (outs[cur]?.[0] && !visited.has(outs[cur][0])) {\n      ordered.push(outs[cur][0]);\n      visited.add(outs[cur][0]);\n      cur = outs[cur][0];\n    }\n    ordered.forEach((id, idx) => {\n      const n = byId[id];\n      if (n) n.position = { x: 140 + idx * 360, y: 180 + (n.type === 'audience' ? -20 : 0) };\n    });\n    setNodes(Object.values(byId));\n    setTimeout(() => rfInstanceRef.current?.fitView({ padding: 0.2 }), 30);\n  };\n\n  // salvar → injeta End se não existir\n  const handleSave = async () => {\n    const hasEnd = nodes.some((n) => n.type === 'end');\n    let nNodes = nodes;\n    let nEdges = edges;\n\n    if (!hasEnd) {\n      const idsWithOut = new Set(edges.map((e) => e.source));\n      const last = nodes.find((n) => !idsWithOut.has(n.id) && n.type !== 'end');\n      if (last) {\n        const endId = uid('end');\n        const endNode = {\n          id: endId,\n          type: 'end',\n          position: { x: last.position.x + 360, y: last.position.y },\n          data: {},\n        };\n        const edge = { id: uid('e'), source: last.id, target: endId, type: 'smoothstep' };\n        nNodes = [...nodes, endNode];\n        nEdges = [...edges, edge];\n        setNodes(nNodes);\n        setEdges(nEdges);\n      }\n    }\n\n    const payload = {\n      id: flowId || 'flow_' + Date.now(),\n      name: flowName || 'Flow',\n      nodes: nNodes,\n      edges: nEdges,\n      updatedAt: new Date().toISOString(),\n    };\n\n    try {\n      const url = flowId ? `/api/journeys/${flowId}` : `/api/journeys`;\n      const method = flowId ? 'PUT' : 'POST';\n      const res = await fetch(url, {\n        method,\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(payload),\n      });\n      if (!res.ok) throw new Error('offline');\n      const saved = await res.json();\n      alert('Flow salvo!');\n      setDirty(false);\n      if (!flowId && saved?.id) {\n        setFlowId(saved.id);\n        window.history.replaceState(null, '', `/journeys/builder?id=${saved.id}`);\n      }\n    } catch {\n      localStorage.setItem(payload.id, JSON.stringify(payload));\n      alert('Flow salvo no navegador.');\n      setDirty(false);\n      if (!flowId) {\n        setFlowId(payload.id);\n        window.history.replaceState(null, '', `/journeys/builder?id=${payload.id}`);\n      }\n    }\n  };\n\n  // voltar → perguntar salvar\n  const handleBack = async () => {\n    if (dirty) {\n      const ok = window.confirm('Salvar antes de voltar?\\nOK: salvar e voltar • Cancel: voltar sem salvar');\n      if (ok) await handleSave();\n    }\n    navigate('/journeys');\n  };\n\n  // inputs/styles\n  const inputStyle = {\n    width: '100%',\n    border: '1px solid #cbd5e1',\n    borderRadius: 8,\n    padding: '10px 12px',\n  };\n  const small = { fontSize: 12, color: '#475569', marginBottom: 6 };\n  const label = (t) => <div style={small}>{t}</div>;\n  const panelWrap = {\n    background: '#fff',\n    border: '1px solid #e5e7eb',\n    borderRadius: 12,\n    padding: 16,\n    width: 360,\n  };\n\n  // Drawer — NODE\n  const selectedNode = nodes.find((n) => n.id === drawerNodeId);\n\n  // helpers de input local (conserta foco)\n  function useLocalField(initial, onCommit) {\n    const [val, setVal] = useState(initial);\n    useEffect(() => setVal(initial), [initial]);\n    const commit = () => onCommit?.(val);\n    return { val, setVal, commit };\n  }\n\n  const DrawerNode = () => {\n    if (!selectedNode) return null;\n    const n = selectedNode;\n\n    // AUDIENCE\n    if (n.type === 'audience') {\n      return (\n        <div style={{ position: 'fixed', right: 16, top: 72, zIndex: 20 }}>\n          <div style={panelWrap}>\n            <AudiencePanel\n              node={n}\n              patchNode={patchNode}\n              inputStyle={inputStyle}\n              label={label}\n              slugFn={slug}\n            />\n          </div>\n        </div>\n      );\n    }\n\n    // Mensagem (usa estado local p/ não perder foco)\n    if (n.type === 'message') {\n      const d = n.data || {};\n      const found = d.templateSid ? templates.find((t) => t.sid === d.templateSid) : null;\n      const firstTypeBody = found ? (Object.values(found.types || {})[0]?.body || '') : '';\n\n      const labelField = useLocalField(d.label || '', (v) => patchNode(n.id, { label: v }));\n      const textField = useLocalField(d.text || '', (v) => patchNode(n.id, { text: v }));\n      const mediaField = useLocalField(d.mediaUrl || '', (v) => patchNode(n.id, { mediaUrl: v }));\n      const buttonsField = useLocalField(d.buttonsJson || '', (v) => patchNode(n.id, { buttonsJson: v }));\n\n      return (\n        <div style={{ position: 'fixed', right: 16, top: 72, zIndex: 20 }}>\n          <div style={panelWrap}>\n            {label('Label')}\n            <input\n              style={inputStyle}\n              value={labelField.val}\n              onChange={(e) => labelField.setVal(e.target.value)}\n              onBlur={labelField.commit}\n            />\n\n            {label('Canal')}\n            <select\n              style={inputStyle}\n              value={d.channel || 'whatsapp'}\n              onChange={(e) => patchNode(n.id, { channel: e.target.value })}\n            >\n              <option value=\"whatsapp\">WhatsApp</option>\n              <option value=\"sms\">SMS</option>\n            </select>\n\n            {label('Mode')}\n            <select\n              style={inputStyle}\n              value={d.mode || 'text'}\n              onChange={(e) => patchNode(n.id, { mode: e.target.value })}\n            >\n              <option value=\"text\">Text</option>\n              <option value=\"rich\">Rich (text + image + buttons)</option>\n            </select>\n\n            {label('Pick a Twilio template (optional)')}\n            <select\n              style={inputStyle}\n              value={d.templateSid || ''}\n              onChange={(e) => patchNode(n.id, { templateSid: e.target.value })}\n            >\n              <option value=\"\">— none —</option>\n              {templates.map((t) => (\n                <option key={t.sid} value={t.sid}>\n                  {t.friendly_name || t.sid}\n                </option>\n              ))}\n            </select>\n\n            {found && (\n              <>\n                {label('Template preview')}\n                <textarea\n                  readOnly\n                  rows={6}\n                  style={{ ...inputStyle, fontFamily: 'monospace' }}\n                  value={firstTypeBody}\n                />\n              </>\n            )}\n\n            {label('Text')}\n            <textarea\n              rows={6}\n              style={inputStyle}\n              value={textField.val}\n              onChange={(e) => textField.setVal(e.target.value)}\n              onBlur={textField.commit}\n              placeholder=\"Olá {{nome}}!\"\n            />\n\n            {d.mode === 'rich' && (\n  <>\n    {label('Media URL')}\n    <input\n      style={inputStyle}\n      value={d.mediaUrl || ''}\n      onChange={(e) => patchNode(n.id, { mediaUrl: e.target.value })}\n      placeholder=\"https://...\"\n    />\n\n    <ButtonsBuilder\n      nodeId={n.id}\n      valueJson={d.buttonsJson}\n      patchNode={patchNode}\n      inputStyle={inputStyle}\n      label={label}\n    />\n  </>\n)}\n\n          </div>\n        </div>\n      );\n    }\n\n    // API (usa commit no blur)\n    if (n.type === 'api') {\n      const d = n.data || {};\n      const labelField = useLocalField(d.label || 'API Call', (v) => patchNode(n.id, { label: v }));\n      const headersField = useLocalField(d.headers || '{}', (v) => patchNode(n.id, { headers: v }));\n      const bodyField = useLocalField(d.body || '{}', (v) => patchNode(n.id, { body: v }));\n\n      const tryParse = (txt) => {\n        try {\n          return JSON.stringify(JSON.parse(txt), null, 2);\n        } catch {\n          return txt;\n        }\n      };\n      const testRequest = async () => {\n        try {\n          const headers = d.headers ? JSON.parse(d.headers) : {};\n          const body =\n            d.method === 'GET' || d.method === 'DELETE'\n              ? undefined\n              : d.body && d.body.trim() !== '{}'\n              ? JSON.parse(d.body)\n              : undefined;\n          const res = await fetch(d.url, {\n            method: d.method || 'GET',\n            headers,\n            body: body ? JSON.stringify(body) : undefined,\n          });\n          const text = await res.text();\n          patchNode(n.id, { lastResponse: text });\n          alert('Request executada. Veja a resposta abaixo.');\n        } catch (e) {\n          alert('Falha: ' + e.message);\n        }\n      };\n      const addMapping = () => {\n        const m = Array.isArray(d.mappings) ? d.mappings.slice() : [];\n        m.push({ path: '', var: '' });\n        patchNode(n.id, { mappings: m });\n      };\n      const updateMap = (idx, patch) => {\n        const m = (d.mappings || []).slice();\n        m[idx] = { ...m[idx], ...patch };\n        patchNode(n.id, { mappings: m });\n      };\n      const removeMap = (idx) => {\n        const m = (d.mappings || []).slice();\n        m.splice(idx, 1);\n        patchNode(n.id, { mappings: m });\n      };\n      return (\n        <div style={{ position: 'fixed', right: 16, top: 72, zIndex: 20 }}>\n          <div style={panelWrap}>\n            {label('Label')}\n            <input\n              style={inputStyle}\n              value={labelField.val}\n              onChange={(e) => labelField.setVal(e.target.value)}\n              onBlur={labelField.commit}\n            />\n\n            {label('Método')}\n            <select\n              style={inputStyle}\n              value={d.method || 'GET'}\n              onChange={(e) => patchNode(n.id, { method: e.target.value })}\n            >\n              <option>GET</option>\n              <option>POST</option>\n              <option>PUT</option>\n              <option>PATCH</option>\n              <option>DELETE</option>\n            </select>\n\n            {label('URL')}\n            <input\n              style={inputStyle}\n              placeholder=\"https://api.meuservico.com/...\"\n              value={d.url || ''}\n              onChange={(e) => patchNode(n.id, { url: e.target.value })}\n            />\n\n            {label('Headers (JSON)')}\n            <textarea\n              rows={4}\n              style={inputStyle}\n              value={headersField.val}\n              onChange={(e) => headersField.setVal(e.target.value)}\n              onBlur={headersField.commit}\n            />\n\n            {(d.method === 'POST' || d.method === 'PUT' || d.method === 'PATCH') && (\n              <>\n                {label('Body (JSON)')}\n                <textarea\n                  rows={6}\n                  style={inputStyle}\n                  value={bodyField.val}\n                  onChange={(e) => bodyField.setVal(e.target.value)}\n                  onBlur={bodyField.commit}\n                />\n              </>\n            )}\n\n            <button className=\"btn\" onClick={testRequest} style={{ marginTop: 10 }}>\n              Executar request\n            </button>\n\n            {label('Resposta (último teste)')}\n            <textarea\n              rows={8}\n              readOnly\n              style={{ ...inputStyle, fontFamily: 'monospace' }}\n              value={tryParse(d.lastResponse || '')}\n            />\n\n            {label('Mapeamentos JSON → Variáveis')}\n            {(d.mappings || []).map((m, i) => (\n              <div\n                key={i}\n                style={{\n                  display: 'grid',\n                  gridTemplateColumns: '1fr 1fr auto',\n                  gap: 8,\n                  marginBottom: 8,\n                }}\n              >\n                <input\n                  style={inputStyle}\n                  placeholder=\"ex.: data.user.id\"\n                  value={m.path}\n                  onChange={(e) => updateMap(i, { path: e.target.value })}\n                />\n                <input\n                  style={inputStyle}\n                  placeholder=\"ex.: user_id\"\n                  value={m.var}\n                  onChange={(e) => updateMap(i, { var: slug(e.target.value) })}\n                />\n                <button className=\"btn danger\" onClick={() => removeMap(i)}>\n                  x\n                </button>\n              </div>\n            ))}\n            <button className=\"btn\" onClick={addMapping}>\n              + adicionar mapeamento\n            </button>\n\n            <div style={{ fontSize: 12, color: '#64748b', marginTop: 8 }}>\n              Use paths tipo <code>data.user.id</code>. O executor gravará o valor em variáveis.\n            </div>\n          </div>\n        </div>\n      );\n    }\n\n    // CODE\n    if (n.type === 'code') {\n      const d = n.data || {};\n      const codeField = useLocalField(d.code || '', (v) => patchNode(n.id, { code: v }));\n      const labelField = useLocalField(d.label || 'Code', (v) => patchNode(n.id, { label: v }));\n\n      return (\n        <div style={{ position: 'fixed', right: 16, top: 72, zIndex: 20 }}>\n          <div style={panelWrap}>\n            {label('Label')}\n            <input\n              style={inputStyle}\n              value={labelField.val}\n              onChange={(e) => labelField.setVal(e.target.value)}\n              onBlur={labelField.commit}\n            />\n            {label('JavaScript')}\n            <textarea\n              rows={14}\n              style={{ ...inputStyle, fontFamily: 'monospace' }}\n              value={codeField.val}\n              onChange={(e) => codeField.setVal(e.target.value)}\n              onBlur={codeField.commit}\n              placeholder={`// Recebe \"context\" (variáveis atuais)\\n// deve retornar um objeto com novas variáveis\\nreturn { nova_variavel: 123 };`}\n            />\n          </div>\n        </div>\n      );\n    }\n\n    // DELAY\n    if (n.type === 'delay') {\n      const d = n.data || {};\n      const upd = (p) => patchNode(n.id, { ...d, ...p });\n      const updateSummary = (mode, v) => {\n        if (mode === 'duration') {\n          const { seconds = 0 } = { ...d, ...v };\n          upd({ summary: `${seconds} second${seconds === 1 ? '' : 's'}` });\n        } else {\n          const dt = new Date(v?.until || d.until || Date.now());\n          upd({ summary: `until ${dt.toLocaleString()}` });\n        }\n      };\n      return (\n        <div style={{ position: 'fixed', right: 16, top: 72, zIndex: 20 }}>\n          <div style={panelWrap}>\n            {label('Modo')}\n            <select\n              style={inputStyle}\n              value={d.mode || 'duration'}\n              onChange={(e) => {\n                const mode = e.target.value;\n                upd({ mode });\n                updateSummary(mode);\n              }}\n            >\n              <option value=\"duration\">Por duração</option>\n              <option value=\"until\">Até data/hora</option>\n            </select>\n\n            {d.mode !== 'until' ? (\n              <>\n                {label('Segundos')}\n                <input\n                  type=\"number\"\n                  min={1}\n                  style={inputStyle}\n                  value={d.seconds || 30}\n                  onChange={(e) => {\n                    const seconds = Math.max(1, Number(e.target.value || 1));\n                    upd({ seconds });\n                    updateSummary('duration', { seconds });\n                  }}\n                />\n              </>\n            ) : (\n              <>\n                {label('Executar após (data/hora)')}\n                <input\n                  type=\"datetime-local\"\n                  style={inputStyle}\n                  value={d.until || ''}\n                  onChange={(e) => {\n                    const until = e.target.value;\n                    upd({ until });\n                    updateSummary('until', { until });\n                  }}\n                />\n              </>\n            )}\n          </div>\n        </div>\n      );\n    }\n\n    // WAIT — sem config: as rotas são nos edges\n    if (n.type === 'wait') {\n      const d = n.data || {};\n      const labelField = useLocalField(d.label || 'Wait & Reply', (v) => patchNode(n.id, { label: v }));\n      return (\n        <div style={{ position: 'fixed', right: 16, top: 72, zIndex: 20 }}>\n          <div style={panelWrap}>\n            {label('Label')}\n            <input\n              style={inputStyle}\n              value={labelField.val}\n              onChange={(e) => labelField.setVal(e.target.value)}\n              onBlur={labelField.commit}\n            />\n            <div style={{ fontSize: 12, color: '#64748b', marginTop: 8 }}>\n              Conecte múltiplos edges a este nó. Selecione um edge para editar a condição\n              (palavras, payload de botão ou regex). Defina um “Fallback” em um edge, se desejar.\n            </div>\n          </div>\n        </div>\n      );\n    }\n\n    return null;\n  };\n\n  // Drawer — EDGE (condições)\n  const selectedEdge = edges.find((e) => e.id === drawerEdgeId);\n  const DrawerEdge = () => {\n    if (!selectedEdge) return null;\n    const d = selectedEdge.data || {};\n    const condType = d.conditionType || 'keywords';\n    const value = d.value || '';\n    const isFallback = !!d.isFallback;\n    const labelVal = selectedEdge.label || '';\n\n    const setCondType = (v) => patchEdge(selectedEdge.id, { data: { conditionType: v } });\n    const setValue = (v) => patchEdge(selectedEdge.id, { data: { value: v } });\n    const setFallback = (v) => patchEdge(selectedEdge.id, { data: { isFallback: v } });\n    const setLabel = (v) => patchEdge(selectedEdge.id, { label: v });\n\n    return (\n      <div style={{ position: 'fixed', right: 16, top: 72, zIndex: 21 }}>\n        <div style={panelWrap}>\n          <div style={{ fontWeight: 700, marginBottom: 8 }}>Condição do Edge</div>\n\n          {label('Rótulo (aparece no edge)')}\n          <input style={inputStyle} value={labelVal} onChange={(e) => setLabel(e.target.value)} placeholder=\"ex.: SIM / NÃO / Outro\" />\n\n          {label('Tipo de condição')}\n          <select style={inputStyle} value={condType} onChange={(e) => setCondType(e.target.value)}>\n            <option value=\"keywords\">keywords (palavras separadas por |)</option>\n            <option value=\"payload\">payload (ID de botão)</option>\n            <option value=\"regex\">regex (ex.: /sim|yes/i)</option>\n          </select>\n\n          {label(condType === 'keywords'\n            ? 'Palavras (separadas por |)'\n            : condType === 'payload'\n            ? 'Payload(s) (separados por |)'\n            : 'Regex (ex.: /sim|yes/i)')}\n          <input style={inputStyle} value={value} onChange={(e) => setValue(e.target.value)} placeholder={condType === 'regex' ? '/sim|yes/i' : 'sim|yes'} />\n\n          <label style={{ display: 'flex', gap: 8, marginTop: 8, alignItems: 'center' }}>\n            <input type=\"checkbox\" checked={isFallback} onChange={(e) => setFallback(e.target.checked)} />\n            Tornar este edge Fallback (usado se nenhuma outra condição casar)\n          </label>\n        </div>\n      </div>\n    );\n  };\n\n  // toolbar chips (sem Audiência / sem End)\n  const Chips = () => (\n    <div style={{ display: 'flex', gap: 8, alignItems: 'center' }}>\n      <span style={{ fontSize: 12, color: '#6b7280', marginRight: 8 }}>Arraste para o canvas:</span>\n      {[\n        ['message', 'Mensagem'],\n        ['api', 'API'],\n        ['code', 'Code'],\n        ['delay', 'Delay'],\n        ['wait', 'Wait & Reply'],\n      ].map(([t, label]) => (\n        <button key={t} className=\"btn secondary\" draggable onDragStart={onDragStartChip(t)}>\n          {label}\n        </button>\n      ))}\n    </div>\n  );\n\n  return (\n    <div style={{ padding: 12, display: 'grid', gridTemplateColumns: '1fr auto', gap: 12 }}>\n      <div style={{ display: 'flex', alignItems: 'center', gap: 10 }}>\n        <button className=\"btn\" onClick={handleBack}>\n          Voltar\n        </button>\n        <Chips />\n        <input\n          value={flowName}\n          onChange={(e) => {\n            setFlowName(e.target.value);\n            setDirty(true);\n          }}\n          style={{ marginLeft: 12, width: 320, border: '1px solid #cbd5e1', borderRadius: 8, padding: '8px 10px' }}\n          placeholder=\"Nome do flow\"\n        />\n      </div>\n      <div style={{ display: 'flex', gap: 8, justifyContent: 'flex-end' }}>\n        <button className=\"btn\" onClick={autoLayout}>\n          Auto-layout\n        </button>\n        <button\n          className=\"btn\"\n          onClick={async () => {\n            try {\n              const input = document.createElement('input');\n              input.type = 'file';\n              input.accept = 'application/json';\n              input.onchange = (ev) => {\n                const f = ev.target.files?.[0];\n                if (!f) return;\n                const r = new FileReader();\n                r.onload = () => {\n                  try {\n                    const data = JSON.parse(r.result);\n                    if (Array.isArray(data.nodes) && Array.isArray(data.edges)) {\n                      setNodes(data.nodes);\n                      setEdges(data.edges);\n                      setFlowName(data.name || 'Flow');\n                      setDirty(true);\n                      setTimeout(() => rfInstanceRef.current?.fitView({ padding: 0.2 }), 40);\n                    } else alert('JSON inválido.');\n                  } catch {\n                    alert('Falha ao ler JSON.');\n                  }\n                };\n                r.readAsText(f);\n              };\n              input.click();\n            } catch {}\n          }}\n        >\n          Importar\n        </button>\n        <button\n          className=\"btn\"\n          onClick={() => {\n            const blob = new Blob([JSON.stringify({ name: flowName, nodes, edges }, null, 2)], {\n              type: 'application/json',\n            });\n            const a = document.createElement('a');\n            a.href = URL.createObjectURL(blob);\n            a.download = `${slug(flowName)}.json`;\n            a.click();\n            URL.revokeObjectURL(a.href);\n          }}\n        >\n          Exportar\n        </button>\n        <button className=\"btn\" onClick={handleSave}>\n          Salvar flow\n        </button>\n      </div>\n\n      <div\n        style={{\n          gridColumn: '1 / span 2',\n          height: 'calc(100vh - 120px)',\n          border: '1px solid #e5e7eb',\n          borderRadius: 12,\n          position: 'relative',\n          overflow: 'hidden',\n        }}\n        onDrop={onDrop}\n        onDragOver={onDragOver}\n      >\n        <ReactFlow\n          nodes={nodes}\n          edges={edges}\n          nodeTypes={nodeTypes}\n          onInit={(inst) => {\n            rfInstanceRef.current = inst;\n            setTimeout(() => inst.fitView({ padding: 0.2 }), 30);\n          }}\n          onNodesChange={onNodesChange}\n          onEdgesChange={onEdgesChange}\n          onConnect={onConnect}\n          onSelectionChange={onSelectionChange}\n          onNodeContextMenu={onNodeContextMenu}\n          onPaneClick={onPaneClick}\n          fitView\n        >\n          <MiniMap />\n          <Controls />\n          <Background gap={16} />\n        </ReactFlow>\n\n        {/* Context menu vertical */}\n        {ctxMenu && (\n          <div\n            onMouseLeave={closeCtx}\n            style={{\n              position: 'fixed',\n              top: ctxMenu.y,\n              left: ctxMenu.x,\n              transform: 'translateY(-8px)',\n              background: '#fff',\n              border: '1px solid #e5e7eb',\n              borderRadius: 8,\n              boxShadow: '0 8px 24px rgba(0,0,0,.12)',\n              zIndex: 30,\n              overflow: 'hidden',\n            }}\n          >\n            <button className=\"btn secondary\" style={{ width: 180, display: 'block', borderRadius: 0 }} onClick={doRename}>\n              Renomear\n            </button>\n            <button className=\"btn secondary\" style={{ width: 180, display: 'block', borderRadius: 0 }} onClick={doDuplicate}>\n              Duplicar\n            </button>\n            <button className=\"btn secondary\" style={{ width: 180, display: 'block', borderRadius: 0 }} onClick={doReset}>\n              Resetar\n            </button>\n            <button className=\"btn danger\" style={{ width: 180, display: 'block', borderRadius: 0 }} onClick={doDelete}>\n              Deletar\n            </button>\n          </div>\n        )}\n      </div>\n\n      {/* Drawers */}\n      <DrawerNode />\n      <DrawerEdge />\n    </div>\n  );\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}