{"ast":null,"code":"var _jsxFileName = \"/Users/gustsantos/Desktop/initucastt/frontend/src/pages/JourneyBuilder.jsx\",\n  _s = $RefreshSig$();\n// frontend/src/pages/JourneyBuilder.jsx\nimport React, { useCallback, useEffect, useMemo, useRef, useState } from 'react';\nimport ReactFlow, { MiniMap, Controls, Background, addEdge, useEdgesState, useNodesState, Handle, Position } from 'reactflow';\nimport 'reactflow/dist/style.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst START_ID = 'start';\nconst END_ID = 'end';\nconst defaultNodes = [{\n  id: START_ID,\n  type: 'system',\n  position: {\n    x: 120,\n    y: 240\n  },\n  data: {\n    label: 'Start',\n    type: 'start'\n  }\n}, {\n  id: END_ID,\n  type: 'system',\n  position: {\n    x: 760,\n    y: 240\n  },\n  data: {\n    label: 'End',\n    type: 'end'\n  }\n}];\nconst nodeStyle = {\n  border: '1px solid #e5e7eb',\n  borderRadius: 12,\n  padding: '12px 16px',\n  background: '#fff',\n  boxShadow: '0 1px 3px rgba(0,0,0,.04)',\n  minWidth: 160\n};\nfunction SystemNode({\n  data,\n  selected\n}) {\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      ...nodeStyle,\n      borderColor: selected ? '#2563eb' : '#e5e7eb'\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        fontWeight: 700\n      },\n      children: data.label\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 36,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        fontSize: 12,\n        color: '#6b7280'\n      },\n      children: data.type === 'start' ? 'início do fluxo' : 'término do fluxo'\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 37,\n      columnNumber: 7\n    }, this), data.type === 'start' && /*#__PURE__*/_jsxDEV(Handle, {\n      type: \"source\",\n      position: Position.Right,\n      id: \"out\",\n      style: {\n        background: '#16a34a',\n        width: 14,\n        height: 14\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 41,\n      columnNumber: 9\n    }, this), data.type === 'end' && /*#__PURE__*/_jsxDEV(Handle, {\n      type: \"target\",\n      position: Position.Left,\n      id: \"in\",\n      style: {\n        background: '#9ca3af',\n        width: 14,\n        height: 14\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 45,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 35,\n    columnNumber: 5\n  }, this);\n}\n_c = SystemNode;\nfunction MessageNode({\n  data,\n  selected\n}) {\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      ...nodeStyle,\n      borderColor: selected ? '#2563eb' : '#e5e7eb'\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        fontWeight: 700\n      },\n      children: data.label || 'Message'\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 55,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        fontSize: 12,\n        color: '#6b7280'\n      },\n      children: [\"Canal: \", String(data.channel || '').toUpperCase(), \" \\u2022 Tipo: \", data.mode || 'text']\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 56,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Handle, {\n      type: \"target\",\n      position: Position.Left,\n      id: \"in\",\n      style: {\n        background: '#9ca3af',\n        width: 14,\n        height: 14\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 60,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Handle, {\n      type: \"source\",\n      position: Position.Right,\n      id: \"out\",\n      style: {\n        background: '#16a34a',\n        width: 14,\n        height: 14\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 63,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 54,\n    columnNumber: 5\n  }, this);\n}\n_c2 = MessageNode;\nfunction ApiNode({\n  data,\n  selected\n}) {\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      ...nodeStyle,\n      borderColor: selected ? '#2563eb' : '#e5e7eb'\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        fontWeight: 700\n      },\n      children: data.label || 'API Call'\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 72,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        fontSize: 12,\n        color: '#6b7280'\n      },\n      children: data.method || 'GET'\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 73,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Handle, {\n      type: \"target\",\n      position: Position.Left,\n      id: \"in\",\n      style: {\n        background: '#9ca3af',\n        width: 14,\n        height: 14\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 76,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Handle, {\n      type: \"source\",\n      position: Position.Right,\n      id: \"out\",\n      style: {\n        background: '#16a34a',\n        width: 14,\n        height: 14\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 78,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 71,\n    columnNumber: 5\n  }, this);\n}\n_c3 = ApiNode;\nfunction CodeNode({\n  data,\n  selected\n}) {\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      ...nodeStyle,\n      borderColor: selected ? '#2563eb' : '#e5e7eb'\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        fontWeight: 700\n      },\n      children: data.label || 'Code'\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 87,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        fontSize: 12,\n        color: '#6b7280'\n      },\n      children: \"Exec. JS\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 88,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Handle, {\n      type: \"target\",\n      position: Position.Left,\n      id: \"in\",\n      style: {\n        background: '#9ca3af',\n        width: 14,\n        height: 14\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 91,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Handle, {\n      type: \"source\",\n      position: Position.Right,\n      id: \"out\",\n      style: {\n        background: '#16a34a',\n        width: 14,\n        height: 14\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 93,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 86,\n    columnNumber: 5\n  }, this);\n}\n_c4 = CodeNode;\nconst nodeTypes = {\n  system: SystemNode,\n  message: MessageNode,\n  api: ApiNode,\n  code: CodeNode\n};\nfunction flattenJSON(obj, prefix = '') {\n  const out = {};\n  const isScalar = v => ['string', 'number', 'boolean'].includes(typeof v) || v == null;\n  if (isScalar(obj)) {\n    out[prefix || '$'] = obj;\n    return out;\n  }\n  if (Array.isArray(obj)) {\n    obj.forEach((v, i) => {\n      Object.assign(out, flattenJSON(v, `${prefix}[${i}]`));\n    });\n    return out;\n  }\n  Object.entries(obj || {}).forEach(([k, v]) => {\n    const p = prefix ? `${prefix}.${k}` : k;\n    Object.assign(out, flattenJSON(v, p));\n  });\n  return out;\n}\nexport default function JourneyBuilder() {\n  _s();\n  const [nodes, setNodes, onNodesChange] = useNodesState(defaultNodes);\n  const [edges, setEdges, onEdgesChange] = useEdgesState([]);\n  const [selectedNodeId, setSelectedNodeId] = useState(null);\n  const selectedNode = useMemo(() => nodes.find(n => n.id === selectedNodeId), [nodes, selectedNodeId]);\n\n  // templates Twilio\n  const [templates, setTemplates] = useState([]);\n  useEffect(() => {\n    fetch('/api/templates/list').then(r => r.json()).then(d => setTemplates((d === null || d === void 0 ? void 0 : d.contents) || [])).catch(() => {});\n  }, []);\n  const onConnect = useCallback(params => {\n    // 1 saída por nó (source)\n    setEdges(eds => {\n      const filtered = eds.filter(e => e.source !== params.source);\n      return addEdge({\n        ...params,\n        animated: false\n      }, filtered);\n    });\n  }, [setEdges]);\n  const onSelectionChange = useCallback(({\n    nodes: ns\n  }) => {\n    if (ns && ns[0]) setSelectedNodeId(ns[0].id);else setSelectedNodeId(null);\n  }, []);\n\n  // helpers\n  const addNode = useCallback(kind => {\n    const id = `n_${Date.now()}`;\n    const base = {\n      id,\n      position: {\n        x: 360,\n        y: 360\n      },\n      data: {},\n      type: kind\n    };\n    if (kind === 'message') {\n      base.data = {\n        label: 'Free Form',\n        type: 'message',\n        channel: 'whatsapp',\n        mode: 'text',\n        text: 'Olá {{nome}}!',\n        mediaUrl: '',\n        buttons: [],\n        templateSid: ''\n      };\n    } else if (kind === 'api') {\n      base.data = {\n        label: 'API Call',\n        type: 'api',\n        method: 'GET',\n        url: '',\n        headers: '{}',\n        body: '{}',\n        mappings: [],\n        lastResponse: null\n      };\n    } else if (kind === 'code') {\n      base.data = {\n        label: 'Code',\n        type: 'code',\n        code: `// input: vars\\nreturn { result: (vars.a ?? 0) + (vars.b ?? 0) };`,\n        outputs: [{\n          var: 'result'\n        }]\n      };\n    }\n    setNodes(ns => [...ns, base]);\n    setSelectedNodeId(id);\n  }, [setNodes]);\n  const deleteSelected = useCallback(() => {\n    const ids = new Set(nodes.filter(n => n.selected).map(n => n.id));\n    setNodes(ns => ns.filter(n => !ids.has(n.id)));\n    setEdges(es => es.filter(e => !ids.has(e.source) && !ids.has(e.target)));\n    setSelectedNodeId(null);\n  }, [nodes, setNodes, setEdges]);\n  const duplicateSelected = useCallback(() => {\n    const n = nodes.find(n => n.selected);\n    if (!n) return;\n    const clone = {\n      ...n,\n      id: `${n.id}_copy_${Date.now()}`,\n      position: {\n        x: n.position.x + 40,\n        y: n.position.y + 40\n      },\n      selected: false\n    };\n    setNodes(ns => [...ns, clone]);\n  }, [nodes, setNodes]);\n  const updateNodeData = (id, patch) => {\n    setNodes(ns => ns.map(n => n.id === id ? {\n      ...n,\n      data: {\n        ...n.data,\n        ...patch\n      }\n    } : n));\n  };\n\n  // ---------------- Teste de API + sugestões ----------------\n  const [apiBusy, setApiBusy] = useState(false);\n  const [apiPreview, setApiPreview] = useState(null);\n  const runApi = async () => {\n    if (!selectedNode || selectedNode.type !== 'api') return;\n    const {\n      method,\n      url,\n      headers,\n      body\n    } = selectedNode.data;\n    try {\n      setApiBusy(true);\n      setApiPreview(null);\n      // use proxy para evitar CORS\n      const r = await fetch('/api/dev/proxy', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          url,\n          method,\n          headers: headers ? JSON.parse(headers) : {},\n          body: ['POST', 'PUT', 'PATCH', 'DELETE'].includes((method || '').toUpperCase()) ? body ? JSON.parse(body) : {} : undefined\n        })\n      });\n      const out = await r.json();\n      setApiPreview(out);\n      updateNodeData(selectedNode.id, {\n        lastResponse: out\n      });\n    } catch (e) {\n      setApiPreview({\n        ok: false,\n        error: String(e.message || e)\n      });\n    } finally {\n      setApiBusy(false);\n    }\n  };\n  const suggestMappings = () => {\n    var _selectedNode$data, _selectedNode$data$la;\n    if (!selectedNode) return;\n    const data = (_selectedNode$data = selectedNode.data) === null || _selectedNode$data === void 0 ? void 0 : (_selectedNode$data$la = _selectedNode$data.lastResponse) === null || _selectedNode$data$la === void 0 ? void 0 : _selectedNode$data$la.data;\n    if (!data) return;\n    const flat = flattenJSON(data);\n    // só escalares\n    const picks = Object.entries(flat).filter(([, v]) => ['string', 'number', 'boolean'].includes(typeof v) || v == null).slice(0, 20);\n    const suggestions = picks.map(([path]) => ({\n      path,\n      var: path.replace(/[^\\w]/g, '_').slice(-40) // variável curta\n    }));\n    updateNodeData(selectedNode.id, {\n      mappings: suggestions\n    });\n  };\n\n  // --------------- painel de propriedades -------------------\n  const PropPanel = () => {\n    if (!selectedNode) {\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          padding: 16,\n          color: '#6b7280'\n        },\n        children: \"Selecione um n\\xF3.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 242,\n        columnNumber: 9\n      }, this);\n    }\n    const id = selectedNode.id;\n    const d = selectedNode.data;\n    if (selectedNode.type === 'api') {\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          padding: 16\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n          style: {\n            margin: 0\n          },\n          children: \"Propriedades do N\\xF3\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 254,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"f\",\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            children: \"Label\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 256,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            value: d.label || '',\n            onChange: e => updateNodeData(id, {\n              label: e.target.value\n            })\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 257,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 255,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"f\",\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            children: \"M\\xE9todo\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 261,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n            value: d.method || 'GET',\n            onChange: e => updateNodeData(id, {\n              method: e.target.value\n            }),\n            children: ['GET', 'POST', 'PUT', 'PATCH', 'DELETE'].map(m => /*#__PURE__*/_jsxDEV(\"option\", {\n              value: m,\n              children: m\n            }, m, false, {\n              fileName: _jsxFileName,\n              lineNumber: 263,\n              columnNumber: 67\n            }, this))\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 262,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 260,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"f\",\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            children: \"URL\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 268,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            value: d.url || '',\n            onChange: e => updateNodeData(id, {\n              url: e.target.value\n            }),\n            placeholder: \"https://api.meuservico.com/...\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 269,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 267,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"f\",\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            children: \"Headers (JSON)\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 273,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"textarea\", {\n            rows: 4,\n            value: d.headers || '{}',\n            onChange: e => updateNodeData(id, {\n              headers: e.target.value\n            })\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 274,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 272,\n          columnNumber: 11\n        }, this), ['POST', 'PUT', 'PATCH', 'DELETE'].includes((d.method || '').toUpperCase()) && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"f\",\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            children: \"Body (JSON)\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 279,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"textarea\", {\n            rows: 6,\n            value: d.body || '{}',\n            onChange: e => updateNodeData(id, {\n              body: e.target.value\n            })\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 280,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 278,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"row\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: runApi,\n            disabled: apiBusy,\n            className: \"btn\",\n            children: apiBusy ? 'Testando…' : 'Testar requisição'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 285,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: suggestMappings,\n            className: \"btn secondary\",\n            children: \"Sugerir mapeamentos\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 286,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 284,\n          columnNumber: 11\n        }, this), apiPreview && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"f\",\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            children: \"Response preview\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 291,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"textarea\", {\n            rows: 10,\n            readOnly: true,\n            value: JSON.stringify(apiPreview, null, 2)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 292,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 290,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"f\",\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            children: \"Mapeamentos JSON \\u2192 Vari\\xE1veis\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 297,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(MappingEditor, {\n            mappings: d.mappings || [],\n            onChange: m => updateNodeData(id, {\n              mappings: m\n            })\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 298,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 296,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Hint, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 304,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 253,\n        columnNumber: 9\n      }, this);\n    }\n    if (selectedNode.type === 'message') {\n      const twilioOpts = templates.map(t => {\n        var _Object$values$;\n        return {\n          sid: t.sid,\n          name: t.friendly_name,\n          body: ((_Object$values$ = Object.values(t.types || {})[0]) === null || _Object$values$ === void 0 ? void 0 : _Object$values$.body) || ''\n        };\n      });\n      const tpl = twilioOpts.find(o => o.sid === d.templateSid);\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          padding: 16\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n          style: {\n            margin: 0\n          },\n          children: \"Propriedades do N\\xF3\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 320,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"f\",\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            children: \"Label\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 322,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            value: d.label || '',\n            onChange: e => updateNodeData(id, {\n              label: e.target.value\n            })\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 323,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 321,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"f\",\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            children: \"Channel\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 327,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n            value: d.channel || 'whatsapp',\n            onChange: e => updateNodeData(id, {\n              channel: e.target.value\n            }),\n            children: [/*#__PURE__*/_jsxDEV(\"option\", {\n              value: \"whatsapp\",\n              children: \"WhatsApp\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 329,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n              value: \"sms\",\n              children: \"SMS\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 330,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 328,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 326,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"f\",\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            children: \"Mode\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 335,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n            value: d.mode || 'text',\n            onChange: e => updateNodeData(id, {\n              mode: e.target.value\n            }),\n            children: [/*#__PURE__*/_jsxDEV(\"option\", {\n              value: \"text\",\n              children: \"Text\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 337,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n              value: \"image\",\n              children: \"Image\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 338,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n              value: \"rich\",\n              children: \"Rich (text + image + buttons)\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 339,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 336,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 334,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"f\",\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            children: \"Pick a Twilio template (optional)\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 344,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n            value: d.templateSid || '',\n            onChange: e => {\n              const sid = e.target.value;\n              const found = twilioOpts.find(o => o.sid === sid);\n              updateNodeData(id, {\n                templateSid: sid,\n                text: (found === null || found === void 0 ? void 0 : found.body) || d.text\n              });\n            },\n            children: [/*#__PURE__*/_jsxDEV(\"option\", {\n              value: \"\",\n              children: \"\\u2014 none \\u2014\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 353,\n              columnNumber: 15\n            }, this), twilioOpts.map(o => /*#__PURE__*/_jsxDEV(\"option\", {\n              value: o.sid,\n              children: o.name\n            }, o.sid, false, {\n              fileName: _jsxFileName,\n              lineNumber: 354,\n              columnNumber: 36\n            }, this))]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 345,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 343,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"f\",\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            children: \"Text\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 359,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"textarea\", {\n            rows: 6,\n            value: d.text || '',\n            onChange: e => updateNodeData(id, {\n              text: e.target.value\n            })\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 360,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 358,\n          columnNumber: 11\n        }, this), (d.mode === 'image' || d.mode === 'rich') && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"f\",\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            children: \"Media URL\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 365,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            value: d.mediaUrl || '',\n            onChange: e => updateNodeData(id, {\n              mediaUrl: e.target.value\n            }),\n            placeholder: \"https://...\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 366,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 364,\n          columnNumber: 13\n        }, this), d.mode === 'rich' && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"f\",\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            children: \"Buttons\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 372,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(ButtonsEditor, {\n            buttons: d.buttons || [],\n            onChange: btns => updateNodeData(id, {\n              buttons: btns\n            })\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 373,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 371,\n          columnNumber: 13\n        }, this), (tpl === null || tpl === void 0 ? void 0 : tpl.body) && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"f\",\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            children: \"Template preview\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 382,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"textarea\", {\n            rows: 6,\n            readOnly: true,\n            value: tpl.body\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 383,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 381,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(Hint, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 387,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 319,\n        columnNumber: 9\n      }, this);\n    }\n    if (selectedNode.type === 'code') {\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          padding: 16\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n          style: {\n            margin: 0\n          },\n          children: \"Propriedades do N\\xF3\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 395,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"f\",\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            children: \"Label\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 397,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            value: d.label || '',\n            onChange: e => updateNodeData(id, {\n              label: e.target.value\n            })\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 398,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 396,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"f\",\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            children: \"JavaScript\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 401,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"textarea\", {\n            rows: 10,\n            value: d.code || '',\n            onChange: e => updateNodeData(id, {\n              code: e.target.value\n            })\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 402,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 400,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"note\",\n          children: [\"O c\\xF3digo recebe \", /*#__PURE__*/_jsxDEV(\"code\", {\n            children: \"vars\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 404,\n            columnNumber: 49\n          }, this), \" e deve retornar um objeto com novas vari\\xE1veis. Ex.: \", /*#__PURE__*/_jsxDEV(\"code\", {\n            children: `return {total: (vars.a||0)+(vars.b||0)}`\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 404,\n            columnNumber: 119\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 404,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Hint, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 405,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 394,\n        columnNumber: 9\n      }, this);\n    }\n    return null;\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"page\",\n    children: [/*#__PURE__*/_jsxDEV(\"header\", {\n      className: \"hdr\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"title\",\n        children: \"Journey Builder (MVP)\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 416,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"actions\",\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"btn\",\n          onClick: addMessageNode,\n          children: \"+ Mensagem\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 418,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"btn\",\n          onClick: addApiNode,\n          children: \"+ API\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 419,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"btn\",\n          onClick: addCodeNode,\n          children: \"+ Code\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 420,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"btn\",\n          onClick: addAudienceNode,\n          children: \"+ Audi\\xEAncia\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 421,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"btn primary\",\n          onClick: handleSaveFlow,\n          children: \"Salvar flow\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 422,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"btn\",\n          onClick: duplicateSelected,\n          children: \"Duplicar\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 423,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"btn danger\",\n          onClick: deleteSelected,\n          children: \"Delete selected\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 424,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 417,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 415,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"grid\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"canvas\",\n        children: /*#__PURE__*/_jsxDEV(ReactFlow, {\n          nodes: nodes,\n          edges: edges,\n          nodeTypes: nodeTypes,\n          onNodesChange: onNodesChange,\n          onEdgesChange: onEdgesChange,\n          onConnect: onConnect,\n          onSelectionChange: onSelectionChange,\n          fitView: true,\n          children: [/*#__PURE__*/_jsxDEV(MiniMap, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 440,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Controls, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 441,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Background, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 442,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 430,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 429,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"aside\", {\n        className: \"side\",\n        children: /*#__PURE__*/_jsxDEV(PropPanel, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 447,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 446,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 428,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 414,\n    columnNumber: 5\n  }, this);\n}\n\n/* ---------- sub-componentes --------- */\n_s(JourneyBuilder, \"KV9wY+01mEylhZSfy+ErVVoMXVw=\", false, function () {\n  return [useNodesState, useEdgesState];\n});\n_c5 = JourneyBuilder;\nfunction ButtonsEditor({\n  buttons,\n  onChange\n}) {\n  const add = () => onChange([...(buttons || []), {\n    type: 'quick_reply',\n    label: '',\n    payload: ''\n  }]);\n  const upd = (i, patch) => onChange(buttons.map((b, idx) => idx === i ? {\n    ...b,\n    ...patch\n  } : b));\n  const rem = i => onChange(buttons.filter((_, idx) => idx !== i));\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [(buttons || []).map((b, i) => /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"btnrow\",\n      children: [/*#__PURE__*/_jsxDEV(\"select\", {\n        value: b.type || 'quick_reply',\n        onChange: e => upd(i, {\n          type: e.target.value\n        }),\n        children: [/*#__PURE__*/_jsxDEV(\"option\", {\n          value: \"quick_reply\",\n          children: \"Quick Reply\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 466,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n          value: \"url\",\n          children: \"URL Button\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 467,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 465,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        placeholder: \"label\",\n        value: b.label || '',\n        onChange: e => upd(i, {\n          label: e.target.value\n        })\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 469,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        placeholder: b.type === 'url' ? 'https://...' : 'payload',\n        value: b.payload || '',\n        onChange: e => upd(i, {\n          payload: e.target.value\n        })\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 470,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"btn danger\",\n        onClick: () => rem(i),\n        children: \"remover\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 471,\n        columnNumber: 11\n      }, this)]\n    }, i, true, {\n      fileName: _jsxFileName,\n      lineNumber: 464,\n      columnNumber: 9\n    }, this)), /*#__PURE__*/_jsxDEV(\"button\", {\n      className: \"btn secondary\",\n      onClick: add,\n      children: \"+ adicionar bot\\xE3o\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 474,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 462,\n    columnNumber: 5\n  }, this);\n}\n_c6 = ButtonsEditor;\nfunction MappingEditor({\n  mappings,\n  onChange\n}) {\n  const add = () => onChange([...(mappings || []), {\n    path: '',\n    var: ''\n  }]);\n  const upd = (i, patch) => onChange(mappings.map((m, idx) => idx === i ? {\n    ...m,\n    ...patch\n  } : m));\n  const rem = i => onChange(mappings.filter((_, idx) => idx !== i));\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [(mappings || []).map((m, i) => /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"maprow\",\n      children: [/*#__PURE__*/_jsxDEV(\"input\", {\n        placeholder: \"json.path\",\n        value: m.path || '',\n        onChange: e => upd(i, {\n          path: e.target.value\n        })\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 488,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        placeholder: \"var_name\",\n        value: m.var || '',\n        onChange: e => upd(i, {\n          var: e.target.value\n        })\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 489,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"btn danger\",\n        onClick: () => rem(i),\n        children: \"remover\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 490,\n        columnNumber: 11\n      }, this)]\n    }, i, true, {\n      fileName: _jsxFileName,\n      lineNumber: 487,\n      columnNumber: 9\n    }, this)), /*#__PURE__*/_jsxDEV(\"button\", {\n      className: \"btn secondary\",\n      onClick: add,\n      children: \"+ adicionar mapeamento\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 493,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 485,\n    columnNumber: 5\n  }, this);\n}\n_c7 = MappingEditor;\nfunction Hint() {\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"note\",\n    style: {\n      marginTop: 8\n    },\n    children: [\"Dicas: arraste do pino \", /*#__PURE__*/_jsxDEV(\"span\", {\n      style: {\n        color: '#16a34a',\n        fontWeight: 700\n      },\n      children: \"verde\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 501,\n      columnNumber: 30\n    }, this), \" para o pino \", /*#__PURE__*/_jsxDEV(\"span\", {\n      style: {\n        color: '#6b7280',\n        fontWeight: 700\n      },\n      children: \"cinza\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 501,\n      columnNumber: 107\n    }, this), \". Cada n\\xF3 s\\xF3 pode ter \", /*#__PURE__*/_jsxDEV(\"strong\", {\n      children: \"1 sa\\xEDda\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 501,\n      columnNumber: 193\n    }, this), \". Use \", /*#__PURE__*/_jsxDEV(\"code\", {\n      children: '{{minha_var}}'\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 501,\n      columnNumber: 223\n    }, this), \" para interpolar.\"]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 500,\n    columnNumber: 5\n  }, this);\n}\n\n/* ---------- estilos locais mínimos ---------- */\n_c8 = Hint;\nvar _c, _c2, _c3, _c4, _c5, _c6, _c7, _c8;\n$RefreshReg$(_c, \"SystemNode\");\n$RefreshReg$(_c2, \"MessageNode\");\n$RefreshReg$(_c3, \"ApiNode\");\n$RefreshReg$(_c4, \"CodeNode\");\n$RefreshReg$(_c5, \"JourneyBuilder\");\n$RefreshReg$(_c6, \"ButtonsEditor\");\n$RefreshReg$(_c7, \"MappingEditor\");\n$RefreshReg$(_c8, \"Hint\");","map":{"version":3,"names":["React","useCallback","useEffect","useMemo","useRef","useState","ReactFlow","MiniMap","Controls","Background","addEdge","useEdgesState","useNodesState","Handle","Position","jsxDEV","_jsxDEV","START_ID","END_ID","defaultNodes","id","type","position","x","y","data","label","nodeStyle","border","borderRadius","padding","background","boxShadow","minWidth","SystemNode","selected","style","borderColor","children","fontWeight","fileName","_jsxFileName","lineNumber","columnNumber","fontSize","color","Right","width","height","Left","_c","MessageNode","String","channel","toUpperCase","mode","_c2","ApiNode","method","_c3","CodeNode","_c4","nodeTypes","system","message","api","code","flattenJSON","obj","prefix","out","isScalar","v","includes","Array","isArray","forEach","i","Object","assign","entries","k","p","JourneyBuilder","_s","nodes","setNodes","onNodesChange","edges","setEdges","onEdgesChange","selectedNodeId","setSelectedNodeId","selectedNode","find","n","templates","setTemplates","fetch","then","r","json","d","contents","catch","onConnect","params","eds","filtered","filter","e","source","animated","onSelectionChange","ns","addNode","kind","Date","now","base","text","mediaUrl","buttons","templateSid","url","headers","body","mappings","lastResponse","outputs","var","deleteSelected","ids","Set","map","has","es","target","duplicateSelected","clone","updateNodeData","patch","apiBusy","setApiBusy","apiPreview","setApiPreview","runApi","JSON","stringify","parse","undefined","ok","error","suggestMappings","_selectedNode$data","_selectedNode$data$la","flat","picks","slice","suggestions","path","replace","PropPanel","margin","className","value","onChange","m","placeholder","rows","onClick","disabled","readOnly","MappingEditor","Hint","twilioOpts","t","_Object$values$","sid","name","friendly_name","values","types","tpl","o","found","ButtonsEditor","btns","addMessageNode","addApiNode","addCodeNode","addAudienceNode","handleSaveFlow","fitView","_c5","add","payload","upd","b","idx","rem","_","_c6","_c7","marginTop","_c8","$RefreshReg$"],"sources":["/Users/gustsantos/Desktop/initucastt/frontend/src/pages/JourneyBuilder.jsx"],"sourcesContent":["// frontend/src/pages/JourneyBuilder.jsx\nimport React, { useCallback, useEffect, useMemo, useRef, useState } from 'react';\nimport ReactFlow, {\n  MiniMap, Controls, Background,\n  addEdge, useEdgesState, useNodesState,\n  Handle, Position\n} from 'reactflow';\nimport 'reactflow/dist/style.css';\n\nconst START_ID = 'start';\nconst END_ID = 'end';\n\nconst defaultNodes = [\n  {\n    id: START_ID,\n    type: 'system',\n    position: { x: 120, y: 240 },\n    data: { label: 'Start', type: 'start' }\n  },\n  {\n    id: END_ID,\n    type: 'system',\n    position: { x: 760, y: 240 },\n    data: { label: 'End', type: 'end' }\n  },\n];\n\nconst nodeStyle = {\n  border: '1px solid #e5e7eb', borderRadius: 12, padding: '12px 16px', background: '#fff',\n  boxShadow: '0 1px 3px rgba(0,0,0,.04)', minWidth: 160\n};\n\nfunction SystemNode({ data, selected }) {\n  return (\n    <div style={{ ...nodeStyle, borderColor: selected ? '#2563eb' : '#e5e7eb' }}>\n      <div style={{ fontWeight: 700 }}>{data.label}</div>\n      <div style={{ fontSize: 12, color: '#6b7280' }}>\n        {data.type === 'start' ? 'início do fluxo' : 'término do fluxo'}\n      </div>\n      {data.type === 'start' && (\n        <Handle type=\"source\" position={Position.Right} id=\"out\"\n          style={{ background: '#16a34a', width: 14, height: 14 }} />\n      )}\n      {data.type === 'end' && (\n        <Handle type=\"target\" position={Position.Left} id=\"in\"\n          style={{ background: '#9ca3af', width: 14, height: 14 }} />\n      )}\n    </div>\n  );\n}\n\nfunction MessageNode({ data, selected }) {\n  return (\n    <div style={{ ...nodeStyle, borderColor: selected ? '#2563eb' : '#e5e7eb' }}>\n      <div style={{ fontWeight: 700 }}>{data.label || 'Message'}</div>\n      <div style={{ fontSize: 12, color: '#6b7280' }}>\n        Canal: {String(data.channel || '').toUpperCase()} • Tipo: {data.mode || 'text'}\n      </div>\n      {/* entrada */}\n      <Handle type=\"target\" position={Position.Left} id=\"in\"\n        style={{ background: '#9ca3af', width: 14, height: 14 }} />\n      {/* saída */}\n      <Handle type=\"source\" position={Position.Right} id=\"out\"\n        style={{ background: '#16a34a', width: 14, height: 14 }} />\n    </div>\n  );\n}\n\nfunction ApiNode({ data, selected }) {\n  return (\n    <div style={{ ...nodeStyle, borderColor: selected ? '#2563eb' : '#e5e7eb' }}>\n      <div style={{ fontWeight: 700 }}>{data.label || 'API Call'}</div>\n      <div style={{ fontSize: 12, color: '#6b7280' }}>\n        {data.method || 'GET'}\n      </div>\n      <Handle type=\"target\" position={Position.Left} id=\"in\"\n        style={{ background: '#9ca3af', width: 14, height: 14 }} />\n      <Handle type=\"source\" position={Position.Right} id=\"out\"\n        style={{ background: '#16a34a', width: 14, height: 14 }} />\n    </div>\n  );\n}\n\nfunction CodeNode({ data, selected }) {\n  return (\n    <div style={{ ...nodeStyle, borderColor: selected ? '#2563eb' : '#e5e7eb' }}>\n      <div style={{ fontWeight: 700 }}>{data.label || 'Code'}</div>\n      <div style={{ fontSize: 12, color: '#6b7280' }}>\n        Exec. JS\n      </div>\n      <Handle type=\"target\" position={Position.Left} id=\"in\"\n        style={{ background: '#9ca3af', width: 14, height: 14 }} />\n      <Handle type=\"source\" position={Position.Right} id=\"out\"\n        style={{ background: '#16a34a', width: 14, height: 14 }} />\n    </div>\n  );\n}\n\nconst nodeTypes = {\n  system: SystemNode,\n  message: MessageNode,\n  api: ApiNode,\n  code: CodeNode,\n};\n\nfunction flattenJSON(obj, prefix = '') {\n  const out = {};\n  const isScalar = (v) => ['string', 'number', 'boolean'].includes(typeof v) || v == null;\n  if (isScalar(obj)) {\n    out[prefix || '$'] = obj;\n    return out;\n  }\n  if (Array.isArray(obj)) {\n    obj.forEach((v, i) => {\n      Object.assign(out, flattenJSON(v, `${prefix}[${i}]`));\n    });\n    return out;\n  }\n  Object.entries(obj || {}).forEach(([k, v]) => {\n    const p = prefix ? `${prefix}.${k}` : k;\n    Object.assign(out, flattenJSON(v, p));\n  });\n  return out;\n}\n\nexport default function JourneyBuilder() {\n  const [nodes, setNodes, onNodesChange] = useNodesState(defaultNodes);\n  const [edges, setEdges, onEdgesChange] = useEdgesState([]);\n  const [selectedNodeId, setSelectedNodeId] = useState(null);\n  const selectedNode = useMemo(() => nodes.find(n => n.id === selectedNodeId), [nodes, selectedNodeId]);\n\n  // templates Twilio\n  const [templates, setTemplates] = useState([]);\n  useEffect(() => {\n    fetch('/api/templates/list')\n      .then(r => r.json())\n      .then(d => setTemplates(d?.contents || []))\n      .catch(() => {});\n  }, []);\n\n  const onConnect = useCallback((params) => {\n    // 1 saída por nó (source)\n    setEdges((eds) => {\n      const filtered = eds.filter(e => e.source !== params.source);\n      return addEdge({ ...params, animated: false }, filtered);\n    });\n  }, [setEdges]);\n\n  const onSelectionChange = useCallback(({ nodes: ns }) => {\n    if (ns && ns[0]) setSelectedNodeId(ns[0].id);\n    else setSelectedNodeId(null);\n  }, []);\n\n  // helpers\n  const addNode = useCallback((kind) => {\n    const id = `n_${Date.now()}`;\n    const base = { id, position: { x: 360, y: 360 }, data: {}, type: kind };\n    if (kind === 'message') {\n      base.data = { label: 'Free Form', type: 'message', channel: 'whatsapp', mode: 'text', text: 'Olá {{nome}}!', mediaUrl: '', buttons: [], templateSid: '' };\n    } else if (kind === 'api') {\n      base.data = { label: 'API Call', type: 'api', method: 'GET', url: '', headers: '{}', body: '{}', mappings: [], lastResponse: null };\n    } else if (kind === 'code') {\n      base.data = { label: 'Code', type: 'code', code: `// input: vars\\nreturn { result: (vars.a ?? 0) + (vars.b ?? 0) };`, outputs: [{ var: 'result' }] };\n    }\n    setNodes((ns) => [...ns, base]);\n    setSelectedNodeId(id);\n  }, [setNodes]);\n\n  const deleteSelected = useCallback(() => {\n    const ids = new Set(nodes.filter(n => n.selected).map(n => n.id));\n    setNodes(ns => ns.filter(n => !ids.has(n.id)));\n    setEdges(es => es.filter(e => !ids.has(e.source) && !ids.has(e.target)));\n    setSelectedNodeId(null);\n  }, [nodes, setNodes, setEdges]);\n\n  const duplicateSelected = useCallback(() => {\n    const n = nodes.find(n => n.selected);\n    if (!n) return;\n    const clone = {\n      ...n,\n      id: `${n.id}_copy_${Date.now()}`,\n      position: { x: n.position.x + 40, y: n.position.y + 40 },\n      selected: false\n    };\n    setNodes(ns => [...ns, clone]);\n  }, [nodes, setNodes]);\n\n  const updateNodeData = (id, patch) => {\n    setNodes(ns => ns.map(n => n.id === id ? { ...n, data: { ...n.data, ...patch } } : n));\n  };\n\n  // ---------------- Teste de API + sugestões ----------------\n  const [apiBusy, setApiBusy] = useState(false);\n  const [apiPreview, setApiPreview] = useState(null);\n  const runApi = async () => {\n    if (!selectedNode || selectedNode.type !== 'api') return;\n    const { method, url, headers, body } = selectedNode.data;\n    try {\n      setApiBusy(true);\n      setApiPreview(null);\n      // use proxy para evitar CORS\n      const r = await fetch('/api/dev/proxy', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          url, method,\n          headers: headers ? JSON.parse(headers) : {},\n          body: ['POST', 'PUT', 'PATCH', 'DELETE'].includes((method || '').toUpperCase())\n            ? (body ? JSON.parse(body) : {}) : undefined\n        })\n      });\n      const out = await r.json();\n      setApiPreview(out);\n      updateNodeData(selectedNode.id, { lastResponse: out });\n    } catch (e) {\n      setApiPreview({ ok: false, error: String(e.message || e) });\n    } finally {\n      setApiBusy(false);\n    }\n  };\n\n  const suggestMappings = () => {\n    if (!selectedNode) return;\n    const data = selectedNode.data?.lastResponse?.data;\n    if (!data) return;\n    const flat = flattenJSON(data);\n    // só escalares\n    const picks = Object.entries(flat).filter(([, v]) =>\n      ['string', 'number', 'boolean'].includes(typeof v) || v == null\n    ).slice(0, 20);\n    const suggestions = picks.map(([path]) => ({\n      path,\n      var: path.replace(/[^\\w]/g, '_').slice(-40) // variável curta\n    }));\n    updateNodeData(selectedNode.id, { mappings: suggestions });\n  };\n\n  // --------------- painel de propriedades -------------------\n  const PropPanel = () => {\n    if (!selectedNode) {\n      return (\n        <div style={{ padding: 16, color: '#6b7280' }}>\n          Selecione um nó.\n        </div>\n      );\n    }\n\n    const id = selectedNode.id;\n    const d = selectedNode.data;\n\n    if (selectedNode.type === 'api') {\n      return (\n        <div style={{ padding: 16 }}>\n          <h4 style={{ margin: 0 }}>Propriedades do Nó</h4>\n          <div className=\"f\">\n            <label>Label</label>\n            <input value={d.label || ''} onChange={e => updateNodeData(id, { label: e.target.value })} />\n          </div>\n\n          <div className=\"f\">\n            <label>Método</label>\n            <select value={d.method || 'GET'} onChange={e => updateNodeData(id, { method: e.target.value })}>\n              {['GET', 'POST', 'PUT', 'PATCH', 'DELETE'].map(m => <option key={m} value={m}>{m}</option>)}\n            </select>\n          </div>\n\n          <div className=\"f\">\n            <label>URL</label>\n            <input value={d.url || ''} onChange={e => updateNodeData(id, { url: e.target.value })} placeholder=\"https://api.meuservico.com/...\" />\n          </div>\n\n          <div className=\"f\">\n            <label>Headers (JSON)</label>\n            <textarea rows={4} value={d.headers || '{}'} onChange={e => updateNodeData(id, { headers: e.target.value })} />\n          </div>\n\n          {['POST', 'PUT', 'PATCH', 'DELETE'].includes((d.method || '').toUpperCase()) && (\n            <div className=\"f\">\n              <label>Body (JSON)</label>\n              <textarea rows={6} value={d.body || '{}'} onChange={e => updateNodeData(id, { body: e.target.value })} />\n            </div>\n          )}\n\n          <div className=\"row\">\n            <button onClick={runApi} disabled={apiBusy} className=\"btn\">{apiBusy ? 'Testando…' : 'Testar requisição'}</button>\n            <button onClick={suggestMappings} className=\"btn secondary\">Sugerir mapeamentos</button>\n          </div>\n\n          {apiPreview && (\n            <div className=\"f\">\n              <label>Response preview</label>\n              <textarea rows={10} readOnly value={JSON.stringify(apiPreview, null, 2)} />\n            </div>\n          )}\n\n          <div className=\"f\">\n            <label>Mapeamentos JSON → Variáveis</label>\n            <MappingEditor\n              mappings={d.mappings || []}\n              onChange={(m) => updateNodeData(id, { mappings: m })}\n            />\n          </div>\n\n          <Hint />\n        </div>\n      );\n    }\n\n    if (selectedNode.type === 'message') {\n      const twilioOpts = templates.map(t => ({\n        sid: t.sid,\n        name: t.friendly_name,\n        body: (Object.values(t.types || {})[0]?.body) || ''\n      }));\n\n      const tpl = twilioOpts.find(o => o.sid === d.templateSid);\n\n      return (\n        <div style={{ padding: 16 }}>\n          <h4 style={{ margin: 0 }}>Propriedades do Nó</h4>\n          <div className=\"f\">\n            <label>Label</label>\n            <input value={d.label || ''} onChange={e => updateNodeData(id, { label: e.target.value })} />\n          </div>\n\n          <div className=\"f\">\n            <label>Channel</label>\n            <select value={d.channel || 'whatsapp'} onChange={e => updateNodeData(id, { channel: e.target.value })}>\n              <option value=\"whatsapp\">WhatsApp</option>\n              <option value=\"sms\">SMS</option>\n            </select>\n          </div>\n\n          <div className=\"f\">\n            <label>Mode</label>\n            <select value={d.mode || 'text'} onChange={e => updateNodeData(id, { mode: e.target.value })}>\n              <option value=\"text\">Text</option>\n              <option value=\"image\">Image</option>\n              <option value=\"rich\">Rich (text + image + buttons)</option>\n            </select>\n          </div>\n\n          <div className=\"f\">\n            <label>Pick a Twilio template (optional)</label>\n            <select\n              value={d.templateSid || ''}\n              onChange={e => {\n                const sid = e.target.value;\n                const found = twilioOpts.find(o => o.sid === sid);\n                updateNodeData(id, { templateSid: sid, text: found?.body || d.text });\n              }}\n            >\n              <option value=\"\">— none —</option>\n              {twilioOpts.map(o => <option key={o.sid} value={o.sid}>{o.name}</option>)}\n            </select>\n          </div>\n\n          <div className=\"f\">\n            <label>Text</label>\n            <textarea rows={6} value={d.text || ''} onChange={e => updateNodeData(id, { text: e.target.value })} />\n          </div>\n\n          {(d.mode === 'image' || d.mode === 'rich') && (\n            <div className=\"f\">\n              <label>Media URL</label>\n              <input value={d.mediaUrl || ''} onChange={e => updateNodeData(id, { mediaUrl: e.target.value })} placeholder=\"https://...\" />\n            </div>\n          )}\n\n          {d.mode === 'rich' && (\n            <div className=\"f\">\n              <label>Buttons</label>\n              <ButtonsEditor\n                buttons={d.buttons || []}\n                onChange={(btns) => updateNodeData(id, { buttons: btns })}\n              />\n            </div>\n          )}\n\n          {tpl?.body && (\n            <div className=\"f\">\n              <label>Template preview</label>\n              <textarea rows={6} readOnly value={tpl.body} />\n            </div>\n          )}\n\n          <Hint />\n        </div>\n      );\n    }\n\n    if (selectedNode.type === 'code') {\n      return (\n        <div style={{ padding: 16 }}>\n          <h4 style={{ margin: 0 }}>Propriedades do Nó</h4>\n          <div className=\"f\">\n            <label>Label</label>\n            <input value={d.label || ''} onChange={e => updateNodeData(id, { label: e.target.value })} />\n          </div>\n          <div className=\"f\">\n            <label>JavaScript</label>\n            <textarea rows={10} value={d.code || ''} onChange={e => updateNodeData(id, { code: e.target.value })} />\n          </div>\n          <div className=\"note\">O código recebe <code>vars</code> e deve retornar um objeto com novas variáveis. Ex.: <code>{`return {total: (vars.a||0)+(vars.b||0)}`}</code></div>\n          <Hint />\n        </div>\n      );\n    }\n\n    return null;\n  };\n\n  return (\n    <div className=\"page\">\n      <header className=\"hdr\">\n        <div className=\"title\">Journey Builder (MVP)</div>\n        <div className=\"actions\">\n            <button className=\"btn\" onClick={addMessageNode}>+ Mensagem</button>\n            <button className=\"btn\" onClick={addApiNode}>+ API</button>\n            <button className=\"btn\" onClick={addCodeNode}>+ Code</button>\n            <button className=\"btn\" onClick={addAudienceNode}>+ Audiência</button>\n            <button className=\"btn primary\" onClick={handleSaveFlow}>Salvar flow</button>\n            <button className=\"btn\" onClick={duplicateSelected}>Duplicar</button>\n            <button className=\"btn danger\" onClick={deleteSelected}>Delete selected</button>\n        </div>\n      </header>\n\n      <div className=\"grid\">\n        <div className=\"canvas\">\n          <ReactFlow\n            nodes={nodes}\n            edges={edges}\n            nodeTypes={nodeTypes}\n            onNodesChange={onNodesChange}\n            onEdgesChange={onEdgesChange}\n            onConnect={onConnect}\n            onSelectionChange={onSelectionChange}\n            fitView\n          >\n            <MiniMap />\n            <Controls />\n            <Background />\n          </ReactFlow>\n        </div>\n\n        <aside className=\"side\">\n          <PropPanel />\n        </aside>\n      </div>\n    </div>\n  );\n}\n\n/* ---------- sub-componentes --------- */\n\nfunction ButtonsEditor({ buttons, onChange }) {\n  const add = () => onChange([...(buttons || []), { type: 'quick_reply', label: '', payload: '' }]);\n  const upd = (i, patch) => onChange(buttons.map((b, idx) => idx === i ? { ...b, ...patch } : b));\n  const rem = (i) => onChange(buttons.filter((_, idx) => idx !== i));\n\n  return (\n    <div>\n      {(buttons || []).map((b, i) => (\n        <div key={i} className=\"btnrow\">\n          <select value={b.type || 'quick_reply'} onChange={e => upd(i, { type: e.target.value })}>\n            <option value=\"quick_reply\">Quick Reply</option>\n            <option value=\"url\">URL Button</option>\n          </select>\n          <input placeholder=\"label\" value={b.label || ''} onChange={e => upd(i, { label: e.target.value })} />\n          <input placeholder={b.type === 'url' ? 'https://...' : 'payload'} value={b.payload || ''} onChange={e => upd(i, { payload: e.target.value })} />\n          <button className=\"btn danger\" onClick={() => rem(i)}>remover</button>\n        </div>\n      ))}\n      <button className=\"btn secondary\" onClick={add}>+ adicionar botão</button>\n    </div>\n  );\n}\n\nfunction MappingEditor({ mappings, onChange }) {\n  const add = () => onChange([...(mappings || []), { path: '', var: '' }]);\n  const upd = (i, patch) => onChange(mappings.map((m, idx) => idx === i ? { ...m, ...patch } : m));\n  const rem = (i) => onChange(mappings.filter((_, idx) => idx !== i));\n\n  return (\n    <div>\n      {(mappings || []).map((m, i) => (\n        <div key={i} className=\"maprow\">\n          <input placeholder=\"json.path\" value={m.path || ''} onChange={e => upd(i, { path: e.target.value })} />\n          <input placeholder=\"var_name\" value={m.var || ''} onChange={e => upd(i, { var: e.target.value })} />\n          <button className=\"btn danger\" onClick={() => rem(i)}>remover</button>\n        </div>\n      ))}\n      <button className=\"btn secondary\" onClick={add}>+ adicionar mapeamento</button>\n    </div>\n  );\n}\n\nfunction Hint() {\n  return (\n    <div className=\"note\" style={{ marginTop: 8 }}>\n      Dicas: arraste do pino <span style={{ color: '#16a34a', fontWeight: 700 }}>verde</span> para o pino <span style={{ color: '#6b7280', fontWeight: 700 }}>cinza</span>. Cada nó só pode ter <strong>1 saída</strong>. Use <code>{'{{minha_var}}'}</code> para interpolar.\n    </div>\n  );\n}\n\n/* ---------- estilos locais mínimos ---------- */"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}