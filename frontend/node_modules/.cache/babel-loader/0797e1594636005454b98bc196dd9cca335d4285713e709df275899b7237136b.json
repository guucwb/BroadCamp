{"ast":null,"code":"var _jsxFileName = \"/Users/gustsantos/Desktop/initucastt/frontend/src/pages/JourneyBuilder.jsx\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\n// frontend/src/pages/JourneyBuilder.jsx\nimport React, { useCallback, useEffect, useMemo, useRef, useState } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport ReactFlow, { Background, Controls, MiniMap, addEdge, useEdgesState, useNodesState, MarkerType, Handle, Position } from 'reactflow';\nimport 'reactflow/dist/style.css';\nimport Papa from 'papaparse';\n\n// === util ===\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst PIN = 14;\nconst uid = p => `${p}_${Date.now()}_${Math.floor(Math.random() * 9999)}`;\nconst slug = s => String(s || '').trim().toLowerCase().replace(/\\s+/g, '_').replace(/[^\\w]/g, '_').replace(/_+/g, '_');\nconst NodeShell = ({\n  title,\n  subtitle,\n  selected,\n  children\n}) => /*#__PURE__*/_jsxDEV(\"div\", {\n  style: {\n    background: '#fff',\n    border: selected ? '2px solid #2563eb' : '1px solid #e5e7eb',\n    borderRadius: 12,\n    width: 320,\n    boxShadow: '0 2px 8px rgba(0,0,0,.06)'\n  },\n  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      padding: '12px 14px',\n      borderBottom: '1px solid #f1f5f9'\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        fontWeight: 700,\n        color: '#0f172a'\n      },\n      children: title\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 40,\n      columnNumber: 7\n    }, this), subtitle ? /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        fontSize: 12,\n        color: '#64748b'\n      },\n      children: subtitle\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 41,\n      columnNumber: 19\n    }, this) : null]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 39,\n    columnNumber: 5\n  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      padding: 12\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 43,\n    columnNumber: 5\n  }, this)]\n}, void 0, true, {\n  fileName: _jsxFileName,\n  lineNumber: 30,\n  columnNumber: 3\n}, this);\n\n// === node components ===\n_c = NodeShell;\nconst AudienceNode = ({\n  selected\n}) => /*#__PURE__*/_jsxDEV(NodeShell, {\n  title: \"Audi\\xEAncia\",\n  subtitle: \"CSV \\u2192 vari\\xE1veis\",\n  selected: selected,\n  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      fontSize: 12,\n      color: '#475569'\n    },\n    children: \"Fa\\xE7a upload e mapeie colunas no painel ao lado.\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 50,\n    columnNumber: 5\n  }, this), /*#__PURE__*/_jsxDEV(Handle, {\n    type: \"source\",\n    id: \"out\",\n    position: Position.Right,\n    style: {\n      background: '#16a34a',\n      width: PIN,\n      height: PIN,\n      border: '2px solid #fff'\n    }\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 53,\n    columnNumber: 5\n  }, this)]\n}, void 0, true, {\n  fileName: _jsxFileName,\n  lineNumber: 49,\n  columnNumber: 3\n}, this);\n_c2 = AudienceNode;\nconst MessageNode = ({\n  data,\n  selected\n}) => /*#__PURE__*/_jsxDEV(NodeShell, {\n  title: data.label || 'Mensagem',\n  subtitle: `Canal: ${String(data.channel || 'whatsapp').toUpperCase()} • Tipo: ${data.mode || 'text'}`,\n  selected: selected,\n  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      fontSize: 12,\n      color: '#475569'\n    },\n    children: \"Conte\\xFAdo configur\\xE1vel no painel ao lado.\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 64,\n    columnNumber: 5\n  }, this), /*#__PURE__*/_jsxDEV(Handle, {\n    type: \"target\",\n    id: \"in\",\n    position: Position.Left,\n    style: {\n      background: '#6b7280',\n      width: PIN,\n      height: PIN,\n      border: '2px solid #fff'\n    }\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 65,\n    columnNumber: 5\n  }, this), /*#__PURE__*/_jsxDEV(Handle, {\n    type: \"source\",\n    id: \"out\",\n    position: Position.Right,\n    style: {\n      background: '#16a34a',\n      width: PIN,\n      height: PIN,\n      border: '2px solid #fff'\n    }\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 67,\n    columnNumber: 5\n  }, this)]\n}, void 0, true, {\n  fileName: _jsxFileName,\n  lineNumber: 59,\n  columnNumber: 3\n}, this);\n_c3 = MessageNode;\nconst ApiNode = ({\n  selected\n}) => /*#__PURE__*/_jsxDEV(NodeShell, {\n  title: \"API Call\",\n  selected: selected,\n  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      fontSize: 12,\n      color: '#475569'\n    },\n    children: \"Configure m\\xE9todo/URL no painel ao lado. Salva vari\\xE1veis via mapeamentos.\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 74,\n    columnNumber: 5\n  }, this), /*#__PURE__*/_jsxDEV(Handle, {\n    type: \"target\",\n    id: \"in\",\n    position: Position.Left,\n    style: {\n      background: '#6b7280',\n      width: PIN,\n      height: PIN,\n      border: '2px solid #fff'\n    }\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 77,\n    columnNumber: 5\n  }, this), /*#__PURE__*/_jsxDEV(Handle, {\n    type: \"source\",\n    id: \"out\",\n    position: Position.Right,\n    style: {\n      background: '#16a34a',\n      width: PIN,\n      height: PIN,\n      border: '2px solid #fff'\n    }\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 79,\n    columnNumber: 5\n  }, this)]\n}, void 0, true, {\n  fileName: _jsxFileName,\n  lineNumber: 73,\n  columnNumber: 3\n}, this);\n_c4 = ApiNode;\nconst CodeNode = ({\n  selected\n}) => /*#__PURE__*/_jsxDEV(NodeShell, {\n  title: \"Code\",\n  subtitle: \"JS custom\",\n  selected: selected,\n  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      fontSize: 12,\n      color: '#475569'\n    },\n    children: \"Cole seu JS no painel ao lado. Deve retornar um objeto de vari\\xE1veis.\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 86,\n    columnNumber: 5\n  }, this), /*#__PURE__*/_jsxDEV(Handle, {\n    type: \"target\",\n    id: \"in\",\n    position: Position.Left,\n    style: {\n      background: '#6b7280',\n      width: PIN,\n      height: PIN,\n      border: '2px solid #fff'\n    }\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 89,\n    columnNumber: 5\n  }, this), /*#__PURE__*/_jsxDEV(Handle, {\n    type: \"source\",\n    id: \"out\",\n    position: Position.Right,\n    style: {\n      background: '#16a34a',\n      width: PIN,\n      height: PIN,\n      border: '2px solid #fff'\n    }\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 91,\n    columnNumber: 5\n  }, this)]\n}, void 0, true, {\n  fileName: _jsxFileName,\n  lineNumber: 85,\n  columnNumber: 3\n}, this);\n_c5 = CodeNode;\nconst DelayNode = ({\n  data,\n  selected\n}) => /*#__PURE__*/_jsxDEV(NodeShell, {\n  title: \"Delay\",\n  subtitle: (data === null || data === void 0 ? void 0 : data.summary) || '',\n  selected: selected,\n  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      fontSize: 12,\n      color: '#475569'\n    },\n    children: \"Espera antes de seguir para o pr\\xF3ximo n\\xF3.\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 98,\n    columnNumber: 5\n  }, this), /*#__PURE__*/_jsxDEV(Handle, {\n    type: \"target\",\n    id: \"in\",\n    position: Position.Left,\n    style: {\n      background: '#6b7280',\n      width: PIN,\n      height: PIN,\n      border: '2px solid #fff'\n    }\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 99,\n    columnNumber: 5\n  }, this), /*#__PURE__*/_jsxDEV(Handle, {\n    type: \"source\",\n    id: \"out\",\n    position: Position.Right,\n    style: {\n      background: '#16a34a',\n      width: PIN,\n      height: PIN,\n      border: '2px solid #fff'\n    }\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 101,\n    columnNumber: 5\n  }, this)]\n}, void 0, true, {\n  fileName: _jsxFileName,\n  lineNumber: 97,\n  columnNumber: 3\n}, this);\n_c6 = DelayNode;\nconst EndNode = ({\n  selected\n}) => /*#__PURE__*/_jsxDEV(NodeShell, {\n  title: \"End\",\n  subtitle: \"t\\xE9rmino do fluxo\",\n  selected: selected,\n  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      fontSize: 12,\n      color: '#475569'\n    },\n    children: \"N\\xF3 terminal. S\\xF3 recebe conex\\xF5es.\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 108,\n    columnNumber: 5\n  }, this), /*#__PURE__*/_jsxDEV(Handle, {\n    type: \"target\",\n    id: \"in\",\n    position: Position.Left,\n    style: {\n      background: '#6b7280',\n      width: PIN,\n      height: PIN,\n      border: '2px solid #fff'\n    }\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 109,\n    columnNumber: 5\n  }, this)]\n}, void 0, true, {\n  fileName: _jsxFileName,\n  lineNumber: 107,\n  columnNumber: 3\n}, this);\n\n// === side panels (podem usar hooks) ===\n_c7 = EndNode;\nfunction AudiencePanel({\n  node,\n  patchNode,\n  inputStyle,\n  label,\n  slugFn\n}) {\n  _s();\n  const d = node.data || {};\n  const [headers, setHeaders] = useState(d.headers || []);\n  const [rows, setRows] = useState(d.rows || []);\n  const [mapping, setMapping] = useState(d.mapping || {});\n  const [phoneKey, setPhoneKey] = useState(d.phoneKey || '');\n  useEffect(() => {\n    setHeaders(d.headers || []);\n    setRows(d.rows || []);\n    setMapping(d.mapping || {});\n    setPhoneKey(d.phoneKey || '');\n    // eslint-disable-next-line\n  }, [node.id]);\n  const onFile = e => {\n    var _e$target$files;\n    const f = (_e$target$files = e.target.files) === null || _e$target$files === void 0 ? void 0 : _e$target$files[0];\n    if (!f) return;\n    Papa.parse(f, {\n      header: true,\n      skipEmptyLines: true,\n      complete: res => {\n        const hs = res.meta.fields || Object.keys(res.data[0] || {});\n        const guess = {};\n        hs.forEach(h => guess[h] = slugFn(h));\n        const pk = hs.find(h => /phone|telefone|celular|numero|n[uú]mero/i.test(h)) || '';\n        setHeaders(hs);\n        setRows(res.data.slice(0, 5));\n        setMapping(guess);\n        setPhoneKey(pk);\n      }\n    });\n  };\n  const saveMap = () => {\n    if (!phoneKey) return alert('Escolha a coluna de telefone.');\n    patchNode(node.id, {\n      headers,\n      rows,\n      mapping,\n      phoneKey\n    });\n    alert('Mapeamento salvo.');\n  };\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [label('Arquivo CSV'), /*#__PURE__*/_jsxDEV(\"input\", {\n      type: \"file\",\n      accept: \".csv\",\n      onChange: onFile\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 158,\n      columnNumber: 7\n    }, this), headers.length > 0 && /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [label('Coluna de telefone'), /*#__PURE__*/_jsxDEV(\"select\", {\n        style: inputStyle,\n        value: phoneKey,\n        onChange: e => setPhoneKey(e.target.value),\n        children: [/*#__PURE__*/_jsxDEV(\"option\", {\n          value: \"\",\n          children: \"\\u2014 selecione \\u2014\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 164,\n          columnNumber: 13\n        }, this), headers.map(h => /*#__PURE__*/_jsxDEV(\"option\", {\n          value: h,\n          children: h\n        }, h, false, {\n          fileName: _jsxFileName,\n          lineNumber: 165,\n          columnNumber: 34\n        }, this))]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 163,\n        columnNumber: 11\n      }, this), label('Mapeamento (coluna → variável)'), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          display: 'grid',\n          gridTemplateColumns: '1fr 20px 1fr',\n          gap: 8,\n          maxHeight: 200,\n          overflow: 'auto'\n        },\n        children: headers.map(h => /*#__PURE__*/_jsxDEV(React.Fragment, {\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              alignSelf: 'center',\n              fontSize: 13\n            },\n            children: h\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 172,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              textAlign: 'center',\n              color: '#94a3b8'\n            },\n            children: \"\\u2192\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 173,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            style: inputStyle,\n            value: mapping[h] || '',\n            placeholder: slugFn(h),\n            onChange: e => setMapping(m => ({\n              ...m,\n              [h]: slugFn(e.target.value)\n            }))\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 174,\n            columnNumber: 17\n          }, this)]\n        }, h, true, {\n          fileName: _jsxFileName,\n          lineNumber: 171,\n          columnNumber: 15\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 169,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"btn\",\n        onClick: saveMap,\n        style: {\n          marginTop: 10\n        },\n        children: \"Salvar mapeamento\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 184,\n        columnNumber: 11\n      }, this), rows.length > 0 && /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [label('Amostra (5 primeiras linhas)'), /*#__PURE__*/_jsxDEV(\"pre\", {\n          style: {\n            background: '#f8fafc',\n            border: '1px solid #e2e8f0',\n            borderRadius: 8,\n            padding: 10,\n            fontSize: 12,\n            maxHeight: 160,\n            overflow: 'auto'\n          },\n          children: JSON.stringify(rows, null, 2)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 189,\n          columnNumber: 15\n        }, this)]\n      }, void 0, true), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          fontSize: 12,\n          color: '#64748b',\n          marginTop: 8\n        },\n        children: [\"Use as vari\\xE1veis com \", /*#__PURE__*/_jsxDEV(\"code\", {\n          children: '{{minha_variavel}}'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 195,\n          columnNumber: 34\n        }, this), \".\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 194,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true)]\n  }, void 0, true);\n}\n\n// === principal ===\n_s(AudiencePanel, \"Gvd8UhRxqXlUdrrpexXFfFXUeMs=\");\n_c8 = AudiencePanel;\nexport default function JourneyBuilder() {\n  _s2();\n  const navigate = useNavigate();\n  const [nodes, setNodes, onNodesChangeBase] = useNodesState([]);\n  const [edges, setEdges, onEdgesChangeBase] = useEdgesState([]);\n  const [flowId, setFlowId] = useState(null);\n  const [flowName, setFlowName] = useState('Novo Flow');\n  const [drawerNodeId, setDrawerNodeId] = useState(null);\n  const [dirty, setDirty] = useState(false);\n  const initializedRef = useRef(false);\n\n  // React Flow instance + wrapper (para DnD)\n  const rfInstanceRef = useRef(null);\n  const wrapperRef = useRef(null);\n\n  // palette drag type\n  const dragType = useRef(null);\n\n  // templates (Twilio)\n  const [templates, setTemplates] = useState([]);\n  useEffect(() => {\n    fetch('/api/templates/list').then(r => r.json()).then(data => setTemplates(data.contents || [])).catch(() => setTemplates([]));\n  }, []);\n  const nodeTypes = useMemo(() => ({\n    audience: AudienceNode,\n    message: MessageNode,\n    api: ApiNode,\n    code: CodeNode,\n    delay: DelayNode,\n    end: EndNode\n  }), []);\n\n  // init: se ?id carrega; se ?new, cria com Audiência; default idem\n  useEffect(() => {\n    if (initializedRef.current) return;\n    initializedRef.current = true;\n    const sp = new URLSearchParams(window.location.search);\n    const id = sp.get('id');\n    const isNew = sp.get('new') === '1';\n    const seedAudience = () => {\n      const audId = uid('aud');\n      setNodes([{\n        id: audId,\n        type: 'audience',\n        position: {\n          x: 120,\n          y: 160\n        },\n        data: {}\n      }]);\n      setEdges([]);\n      // viewport inicial \"normal\" — sem fitView pra não ficar gigante\n      setTimeout(() => {\n        var _rfInstanceRef$curren;\n        return (_rfInstanceRef$curren = rfInstanceRef.current) === null || _rfInstanceRef$curren === void 0 ? void 0 : _rfInstanceRef$curren.setViewport({\n          x: 0,\n          y: 0,\n          zoom: 1\n        }, {\n          duration: 120\n        });\n      }, 30);\n    };\n    if (id) {\n      setFlowId(id);\n      fetch(`/api/journeys/${id}`).then(r => r.ok ? r.json() : Promise.reject()).then(f => {\n        if (Array.isArray(f.nodes) && Array.isArray(f.edges)) {\n          setNodes(f.nodes);\n          setEdges(f.edges);\n          setFlowName(f.name || 'Flow');\n          setTimeout(() => {\n            var _rfInstanceRef$curren2;\n            return (_rfInstanceRef$curren2 = rfInstanceRef.current) === null || _rfInstanceRef$curren2 === void 0 ? void 0 : _rfInstanceRef$curren2.fitView({\n              padding: 0.2\n            });\n          }, 60);\n        } else seedAudience();\n      }).catch(() => {\n        const raw = localStorage.getItem(id);\n        if (raw) {\n          try {\n            const f = JSON.parse(raw);\n            setNodes(f.nodes || []);\n            setEdges(f.edges || []);\n            setFlowName(f.name || 'Flow');\n          } catch {\n            seedAudience();\n          }\n        } else seedAudience();\n        setTimeout(() => {\n          var _rfInstanceRef$curren3;\n          return (_rfInstanceRef$curren3 = rfInstanceRef.current) === null || _rfInstanceRef$curren3 === void 0 ? void 0 : _rfInstanceRef$curren3.fitView({\n            padding: 0.2\n          });\n        }, 60);\n      });\n    } else if (isNew) {\n      seedAudience();\n    } else {\n      // acesso direto ao /builder\n      seedAudience();\n    }\n  }, [setNodes, setEdges]);\n\n  // Se for flow novo com apenas Audiência, garanta zoom 1 (evita \"gigante\")\n  useEffect(() => {\n    var _nodes$;\n    if (!rfInstanceRef.current) return;\n    if (!flowId && nodes.length === 1 && ((_nodes$ = nodes[0]) === null || _nodes$ === void 0 ? void 0 : _nodes$.type) === 'audience') {\n      rfInstanceRef.current.setViewport({\n        x: 0,\n        y: 0,\n        zoom: 1\n      }, {\n        duration: 120\n      });\n    }\n  }, [flowId, nodes.length]); // eslint-disable-line\n\n  // dirty tracking\n  const onNodesChange = useCallback(chs => {\n    setDirty(true);\n    onNodesChangeBase(chs);\n  }, [onNodesChangeBase]);\n  const onEdgesChange = useCallback(chs => {\n    setDirty(true);\n    onEdgesChangeBase(chs);\n  }, [onEdgesChangeBase]);\n\n  // conecta com 1 saída por nó\n  const onConnect = useCallback(params => {\n    setDirty(true);\n    setEdges(eds => {\n      const filtered = eds.filter(e => e.source !== params.source);\n      return addEdge({\n        ...params,\n        type: 'smoothstep',\n        style: {\n          stroke: '#0f172a'\n        },\n        markerEnd: {\n          type: MarkerType.ArrowClosed,\n          color: '#0f172a'\n        }\n      }, filtered);\n    });\n  }, [setEdges]);\n\n  // seleção → abrir drawer\n  const onSelectionChange = useCallback(({\n    nodes: ns\n  }) => {\n    var _ns$;\n    setDrawerNodeId((ns === null || ns === void 0 ? void 0 : (_ns$ = ns[0]) === null || _ns$ === void 0 ? void 0 : _ns$.id) || null);\n  }, []);\n\n  // patch node\n  const patchNode = useCallback((id, patch) => {\n    setDirty(true);\n    setNodes(nds => nds.map(n => n.id === id ? {\n      ...n,\n      data: {\n        ...n.data,\n        ...patch\n      }\n    } : n));\n  }, [setNodes]);\n\n  // DnD\n  const onDragStartChip = type => e => {\n    dragType.current = type;\n    e.dataTransfer.setData('application/reactflow', type);\n    e.dataTransfer.effectAllowed = 'move';\n  };\n  const onDragOver = e => {\n    e.preventDefault();\n    e.dataTransfer.dropEffect = 'move';\n  };\n  const onDrop = e => {\n    e.preventDefault();\n    const type = dragType.current || e.dataTransfer.getData('application/reactflow');\n    if (!type || !rfInstanceRef.current || !wrapperRef.current) return;\n    const bounds = wrapperRef.current.getBoundingClientRect();\n    const position = rfInstanceRef.current.screenToFlowPosition({\n      x: e.clientX - bounds.left,\n      y: e.clientY - bounds.top\n    });\n    const id = uid(type);\n    let node;\n    if (type === 'message') {\n      node = {\n        id,\n        type,\n        position,\n        data: {\n          label: 'Mensagem',\n          channel: 'whatsapp',\n          mode: 'text',\n          text: ''\n        }\n      };\n    } else if (type === 'api') {\n      node = {\n        id,\n        type,\n        position,\n        data: {\n          label: 'API Call',\n          method: 'GET',\n          url: '',\n          headers: '{}',\n          body: '{}',\n          mappings: [],\n          lastResponse: ''\n        }\n      };\n    } else if (type === 'code') {\n      node = {\n        id,\n        type,\n        position,\n        data: {\n          label: 'Code',\n          code: '// return { nova_variavel: 123 };'\n        }\n      };\n    } else if (type === 'delay') {\n      node = {\n        id,\n        type,\n        position,\n        data: {\n          mode: 'duration',\n          seconds: 30,\n          summary: '30 seconds'\n        }\n      };\n    } else {\n      return;\n    }\n    setNodes(nds => nds.concat(node));\n    setDirty(true);\n  };\n\n  // Context menu (vertical)\n  const [ctxMenu, setCtxMenu] = useState(null); // {x,y,nodeId}\n  const onNodeContextMenu = (e, node) => {\n    e.preventDefault();\n    setCtxMenu({\n      x: e.clientX,\n      y: e.clientY,\n      nodeId: node.id\n    });\n  };\n  const closeCtx = () => setCtxMenu(null);\n  const doRename = () => {\n    var _nodes$find, _nodes$find$data;\n    if (!ctxMenu) return;\n    const val = window.prompt('Novo nome do nó:', ((_nodes$find = nodes.find(n => n.id === ctxMenu.nodeId)) === null || _nodes$find === void 0 ? void 0 : (_nodes$find$data = _nodes$find.data) === null || _nodes$find$data === void 0 ? void 0 : _nodes$find$data.label) || '');\n    if (val != null) patchNode(ctxMenu.nodeId, {\n      label: val\n    });\n    closeCtx();\n  };\n  const doDuplicate = () => {\n    if (!ctxMenu) return;\n    setNodes(nds => {\n      const n = nds.find(x => x.id === ctxMenu.nodeId);\n      if (!n) return nds;\n      const clone = {\n        ...n,\n        id: uid(n.type),\n        position: {\n          x: n.position.x + 40,\n          y: n.position.y + 40\n        }\n      };\n      return nds.concat(clone);\n    });\n    closeCtx();\n  };\n  const doReset = () => {\n    if (!ctxMenu) return;\n    const n = nodes.find(x => x.id === ctxMenu.nodeId);\n    if (!n) return;\n    let fresh = {};\n    if (n.type === 'message') fresh = {\n      label: 'Mensagem',\n      channel: 'whatsapp',\n      mode: 'text',\n      text: ''\n    };\n    if (n.type === 'api') fresh = {\n      label: 'API Call',\n      method: 'GET',\n      url: '',\n      headers: '{}',\n      body: '{}',\n      mappings: [],\n      lastResponse: ''\n    };\n    if (n.type === 'code') fresh = {\n      label: 'Code',\n      code: '// return { nova_variavel: 123 };'\n    };\n    if (n.type === 'delay') fresh = {\n      mode: 'duration',\n      seconds: 30,\n      summary: '30 seconds'\n    };\n    patchNode(n.id, fresh);\n    closeCtx();\n  };\n  const doDelete = () => {\n    if (!ctxMenu) return;\n    const id = ctxMenu.nodeId;\n    setEdges(eds => eds.filter(e => e.source !== id && e.target !== id));\n    setNodes(nds => nds.filter(n => n.id !== id));\n    setDirty(true);\n    closeCtx();\n  };\n\n  // auto-layout (Dagre simples)\n  const autoLayout = () => {\n    // layout linear simples da esquerda p/ direita\n    const newNodes = [...nodes];\n    const start = newNodes.find(n => n.type === 'audience');\n    if (!start) return;\n    const byId = Object.fromEntries(newNodes.map(n => [n.id, n]));\n    const outs = {};\n    edges.forEach(e => {\n      (outs[e.source] ||= []).push(e.target);\n    });\n    const ordered = [start.id];\n    let cur = start.id;\n    // como só permitimos 1 saída por nó, dá pra caminhar\n    while ((_outs$cur = outs[cur]) !== null && _outs$cur !== void 0 && _outs$cur[0]) {\n      var _outs$cur;\n      ordered.push(outs[cur][0]);\n      cur = outs[cur][0];\n    }\n    ordered.forEach((id, idx) => {\n      const n = byId[id];\n      if (n) {\n        n.position = {\n          x: 140 + idx * 360,\n          y: 180 + (n.type === 'audience' ? -20 : 0)\n        };\n      }\n    });\n    setNodes(Object.values(byId));\n    setTimeout(() => {\n      var _rfInstanceRef$curren4;\n      return (_rfInstanceRef$curren4 = rfInstanceRef.current) === null || _rfInstanceRef$curren4 === void 0 ? void 0 : _rfInstanceRef$curren4.fitView({\n        padding: 0.2\n      });\n    }, 30);\n  };\n\n  // salvar → injeta End se não existir\n  const handleSave = async () => {\n    // existe end?\n    const hasEnd = nodes.some(n => n.type === 'end');\n    let nNodes = nodes;\n    let nEdges = edges;\n    if (!hasEnd) {\n      const idsWithOut = new Set(edges.map(e => e.source));\n      const last = nodes.find(n => !idsWithOut.has(n.id) && n.type !== 'end');\n      if (last) {\n        const endId = uid('end');\n        const endNode = {\n          id: endId,\n          type: 'end',\n          position: {\n            x: last.position.x + 360,\n            y: last.position.y\n          },\n          data: {}\n        };\n        const edge = {\n          id: uid('e'),\n          source: last.id,\n          target: endId\n        };\n        nNodes = [...nodes, endNode];\n        nEdges = [...edges.filter(e => e.source !== last.id), edge]; // garante 1 saída\n        setNodes(nNodes);\n        setEdges(nEdges);\n      }\n    }\n    const payload = {\n      id: flowId || 'flow_' + Date.now(),\n      name: flowName || 'Flow',\n      nodes: nNodes,\n      edges: nEdges,\n      updatedAt: new Date().toISOString()\n    };\n    try {\n      const url = flowId ? `/api/journeys/${flowId}` : '/api/journeys';\n      const method = flowId ? 'PUT' : 'POST';\n      const res = await fetch(url, {\n        method,\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(payload)\n      });\n      if (!res.ok) throw new Error('offline');\n      const saved = await res.json();\n      alert('Flow salvo!');\n      setDirty(false);\n      if (!flowId && saved !== null && saved !== void 0 && saved.id) {\n        setFlowId(saved.id);\n        window.history.replaceState(null, '', `/journeys/builder?id=${saved.id}`);\n      }\n    } catch {\n      localStorage.setItem(payload.id, JSON.stringify(payload));\n      alert('Flow salvo no navegador.');\n      setDirty(false);\n      if (!flowId) {\n        setFlowId(payload.id);\n        window.history.replaceState(null, '', `/journeys/builder?id=${payload.id}`);\n      }\n    }\n  };\n\n  // voltar → perguntar salvar\n  const handleBack = async () => {\n    if (dirty) {\n      const ok = window.confirm('Salvar antes de voltar?\\nOK: salvar e voltar • Cancel: voltar sem salvar');\n      if (ok) {\n        await handleSave();\n      }\n    }\n    navigate('/journeys');\n  };\n\n  // inputs/styles\n  const inputStyle = {\n    width: '100%',\n    border: '1px solid #cbd5e1',\n    borderRadius: 8,\n    padding: '10px 12px'\n  };\n  const small = {\n    fontSize: 12,\n    color: '#475569',\n    marginBottom: 6\n  };\n  const label = t => /*#__PURE__*/_jsxDEV(\"div\", {\n    style: small,\n    children: t\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 508,\n    columnNumber: 24\n  }, this);\n  const panelWrap = {\n    background: '#fff',\n    border: '1px solid #e5e7eb',\n    borderRadius: 12,\n    padding: 16,\n    width: 360\n  };\n\n  // drawer\n  const selectedNode = nodes.find(n => n.id === drawerNodeId);\n  const Drawer = () => {\n    if (!selectedNode) return null;\n    const n = selectedNode;\n\n    // Mensagem\n    if (n.type === 'message') {\n      var _Object$values$;\n      const d = n.data || {};\n      const found = d.templateSid ? templates.find(t => t.sid === d.templateSid) : null;\n      const firstTypeBody = found ? ((_Object$values$ = Object.values(found.types || {})[0]) === null || _Object$values$ === void 0 ? void 0 : _Object$values$.body) || '' : '';\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          position: 'fixed',\n          right: 16,\n          top: 72,\n          zIndex: 20\n        },\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          style: panelWrap,\n          children: [label('Label'), /*#__PURE__*/_jsxDEV(\"input\", {\n            style: inputStyle,\n            value: d.label || '',\n            onChange: e => patchNode(n.id, {\n              label: e.target.value\n            })\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 526,\n            columnNumber: 13\n          }, this), label('Canal'), /*#__PURE__*/_jsxDEV(\"select\", {\n            style: inputStyle,\n            value: d.channel || 'whatsapp',\n            onChange: e => patchNode(n.id, {\n              channel: e.target.value\n            }),\n            children: [/*#__PURE__*/_jsxDEV(\"option\", {\n              value: \"whatsapp\",\n              children: \"WhatsApp\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 530,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n              value: \"sms\",\n              children: \"SMS\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 530,\n              columnNumber: 57\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 529,\n            columnNumber: 13\n          }, this), label('Mode'), /*#__PURE__*/_jsxDEV(\"select\", {\n            style: inputStyle,\n            value: d.mode || 'text',\n            onChange: e => patchNode(n.id, {\n              mode: e.target.value\n            }),\n            children: [/*#__PURE__*/_jsxDEV(\"option\", {\n              value: \"text\",\n              children: \"Text\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 535,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n              value: \"rich\",\n              children: \"Rich (text + image + buttons)\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 535,\n              columnNumber: 49\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 534,\n            columnNumber: 13\n          }, this), label('Pick a Twilio template (optional)'), /*#__PURE__*/_jsxDEV(\"select\", {\n            style: inputStyle,\n            value: d.templateSid || '',\n            onChange: e => patchNode(n.id, {\n              templateSid: e.target.value\n            }),\n            children: [/*#__PURE__*/_jsxDEV(\"option\", {\n              value: \"\",\n              children: \"\\u2014 none \\u2014\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 540,\n              columnNumber: 15\n            }, this), templates.map(t => /*#__PURE__*/_jsxDEV(\"option\", {\n              value: t.sid,\n              children: t.friendly_name || t.sid\n            }, t.sid, false, {\n              fileName: _jsxFileName,\n              lineNumber: 541,\n              columnNumber: 36\n            }, this))]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 539,\n            columnNumber: 13\n          }, this), found && /*#__PURE__*/_jsxDEV(_Fragment, {\n            children: [label('Template preview'), /*#__PURE__*/_jsxDEV(\"textarea\", {\n              readOnly: true,\n              rows: 6,\n              style: {\n                ...inputStyle,\n                fontFamily: 'monospace'\n              },\n              value: firstTypeBody\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 547,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true), label('Text'), /*#__PURE__*/_jsxDEV(\"textarea\", {\n            rows: 6,\n            style: inputStyle,\n            value: d.text || '',\n            onChange: e => patchNode(n.id, {\n              text: e.target.value\n            }),\n            placeholder: \"Ol\\xE1 {{nome}}!\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 552,\n            columnNumber: 13\n          }, this), d.mode === 'rich' && /*#__PURE__*/_jsxDEV(_Fragment, {\n            children: [label('Media URL'), /*#__PURE__*/_jsxDEV(\"input\", {\n              style: inputStyle,\n              value: d.mediaUrl || '',\n              onChange: e => patchNode(n.id, {\n                mediaUrl: e.target.value\n              }),\n              placeholder: \"https://...\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 557,\n              columnNumber: 17\n            }, this), label('Buttons (JSON)'), /*#__PURE__*/_jsxDEV(\"textarea\", {\n              rows: 5,\n              style: inputStyle,\n              value: d.buttonsJson || '',\n              onChange: e => patchNode(n.id, {\n                buttonsJson: e.target.value\n              }),\n              placeholder: \"[{\\\"type\\\":\\\"reply\\\",\\\"title\\\":\\\"Sim\\\",\\\"id\\\":\\\"YES\\\"}]\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 559,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 524,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 523,\n        columnNumber: 9\n      }, this);\n    }\n\n    // API\n    if (n.type === 'api') {\n      const d = n.data || {};\n      const tryParse = txt => {\n        try {\n          return JSON.stringify(JSON.parse(txt), null, 2);\n        } catch {\n          return txt;\n        }\n      };\n      const testRequest = async () => {\n        try {\n          const headers = d.headers ? JSON.parse(d.headers) : {};\n          const body = d.method === 'GET' || d.method === 'DELETE' ? undefined : d.body && d.body.trim() !== '{}' ? JSON.parse(d.body) : undefined;\n          const res = await fetch(d.url, {\n            method: d.method || 'GET',\n            headers,\n            body: body ? JSON.stringify(body) : undefined\n          });\n          const text = await res.text();\n          patchNode(n.id, {\n            lastResponse: text\n          });\n          alert('Request executada. Veja a resposta abaixo.');\n        } catch (e) {\n          alert('Falha: ' + e.message);\n        }\n      };\n      const addMapping = () => {\n        const m = Array.isArray(d.mappings) ? d.mappings.slice() : [];\n        m.push({\n          path: '',\n          var: ''\n        });\n        patchNode(n.id, {\n          mappings: m\n        });\n      };\n      const updateMap = (idx, patch) => {\n        const m = (d.mappings || []).slice();\n        m[idx] = {\n          ...m[idx],\n          ...patch\n        };\n        patchNode(n.id, {\n          mappings: m\n        });\n      };\n      const removeMap = idx => {\n        const m = (d.mappings || []).slice();\n        m.splice(idx, 1);\n        patchNode(n.id, {\n          mappings: m\n        });\n      };\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          position: 'fixed',\n          right: 16,\n          top: 72,\n          zIndex: 20\n        },\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          style: panelWrap,\n          children: [label('Label'), /*#__PURE__*/_jsxDEV(\"input\", {\n            style: inputStyle,\n            value: d.label || 'API Call',\n            onChange: e => patchNode(n.id, {\n              label: e.target.value\n            })\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 599,\n            columnNumber: 13\n          }, this), label('Método'), /*#__PURE__*/_jsxDEV(\"select\", {\n            style: inputStyle,\n            value: d.method || 'GET',\n            onChange: e => patchNode(n.id, {\n              method: e.target.value\n            }),\n            children: [/*#__PURE__*/_jsxDEV(\"option\", {\n              children: \"GET\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 603,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n              children: \"POST\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 603,\n              columnNumber: 35\n            }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n              children: \"PUT\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 603,\n              columnNumber: 56\n            }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n              children: \"PATCH\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 603,\n              columnNumber: 76\n            }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n              children: \"DELETE\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 603,\n              columnNumber: 98\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 602,\n            columnNumber: 13\n          }, this), label('URL'), /*#__PURE__*/_jsxDEV(\"input\", {\n            style: inputStyle,\n            placeholder: \"https://api.meuservico.com/...\",\n            value: d.url || '',\n            onChange: e => patchNode(n.id, {\n              url: e.target.value\n            })\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 607,\n            columnNumber: 13\n          }, this), label('Headers (JSON)'), /*#__PURE__*/_jsxDEV(\"textarea\", {\n            rows: 4,\n            style: inputStyle,\n            value: d.headers || '{}',\n            onChange: e => patchNode(n.id, {\n              headers: e.target.value\n            })\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 610,\n            columnNumber: 13\n          }, this), (d.method === 'POST' || d.method === 'PUT' || d.method === 'PATCH') && /*#__PURE__*/_jsxDEV(_Fragment, {\n            children: [label('Body (JSON)'), /*#__PURE__*/_jsxDEV(\"textarea\", {\n              rows: 6,\n              style: inputStyle,\n              value: d.body || '{}',\n              onChange: e => patchNode(n.id, {\n                body: e.target.value\n              })\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 615,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"btn\",\n            onClick: testRequest,\n            style: {\n              marginTop: 10\n            },\n            children: \"Executar request\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 619,\n            columnNumber: 13\n          }, this), label('Resposta (último teste)'), /*#__PURE__*/_jsxDEV(\"textarea\", {\n            rows: 8,\n            readOnly: true,\n            style: {\n              ...inputStyle,\n              fontFamily: 'monospace'\n            },\n            value: tryParse(d.lastResponse || '')\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 622,\n            columnNumber: 13\n          }, this), label('Mapeamentos JSON → Variáveis'), (d.mappings || []).map((m, i) => /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              display: 'grid',\n              gridTemplateColumns: '1fr 1fr auto',\n              gap: 8,\n              marginBottom: 8\n            },\n            children: [/*#__PURE__*/_jsxDEV(\"input\", {\n              style: inputStyle,\n              placeholder: \"ex.: data.user.id\",\n              value: m.path,\n              onChange: e => updateMap(i, {\n                path: e.target.value\n              })\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 627,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              style: inputStyle,\n              placeholder: \"ex.: user_id\",\n              value: m.var,\n              onChange: e => updateMap(i, {\n                var: slug(e.target.value)\n              })\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 628,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"btn danger\",\n              onClick: () => removeMap(i),\n              children: \"x\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 629,\n              columnNumber: 17\n            }, this)]\n          }, i, true, {\n            fileName: _jsxFileName,\n            lineNumber: 626,\n            columnNumber: 15\n          }, this)), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"btn\",\n            onClick: addMapping,\n            children: \"+ adicionar mapeamento\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 632,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              fontSize: 12,\n              color: '#64748b',\n              marginTop: 8\n            },\n            children: [\"Use paths tipo \", /*#__PURE__*/_jsxDEV(\"code\", {\n              children: \"data.user.id\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 635,\n              columnNumber: 30\n            }, this), \". O executor gravar\\xE1 o valor em vari\\xE1veis.\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 634,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 597,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 596,\n        columnNumber: 9\n      }, this);\n    }\n\n    // CODE\n    if (n.type === 'code') {\n      const d = n.data || {};\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          position: 'fixed',\n          right: 16,\n          top: 72,\n          zIndex: 20\n        },\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          style: panelWrap,\n          children: [label('Label'), /*#__PURE__*/_jsxDEV(\"input\", {\n            style: inputStyle,\n            value: d.label || 'Code',\n            onChange: e => patchNode(n.id, {\n              label: e.target.value\n            })\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 649,\n            columnNumber: 13\n          }, this), label('JavaScript'), /*#__PURE__*/_jsxDEV(\"textarea\", {\n            rows: 14,\n            style: {\n              ...inputStyle,\n              fontFamily: 'monospace'\n            },\n            value: d.code || '',\n            onChange: e => patchNode(n.id, {\n              code: e.target.value\n            }),\n            placeholder: `// Recebe \"context\" (variáveis atuais)\\n// deve retornar um objeto com novas variáveis\\nreturn { nova_variavel: 123 };`\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 651,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 647,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 646,\n        columnNumber: 9\n      }, this);\n    }\n\n    // DELAY\n    if (n.type === 'delay') {\n      const d = n.data || {};\n      const upd = p => patchNode(n.id, {\n        ...d,\n        ...p\n      });\n      const updateSummary = (mode, v) => {\n        if (mode === 'duration') {\n          const {\n            seconds = 0\n          } = {\n            ...d,\n            ...v\n          };\n          upd({\n            summary: `${seconds} second${seconds === 1 ? '' : 's'}`\n          });\n        } else {\n          const dt = new Date((v === null || v === void 0 ? void 0 : v.until) || d.until || Date.now());\n          upd({\n            summary: `until ${dt.toLocaleString()}`\n          });\n        }\n      };\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          position: 'fixed',\n          right: 16,\n          top: 72,\n          zIndex: 20\n        },\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          style: panelWrap,\n          children: [label('Modo'), /*#__PURE__*/_jsxDEV(\"select\", {\n            style: inputStyle,\n            value: d.mode || 'duration',\n            onChange: e => {\n              const mode = e.target.value;\n              upd({\n                mode\n              });\n              updateSummary(mode);\n            },\n            children: [/*#__PURE__*/_jsxDEV(\"option\", {\n              value: \"duration\",\n              children: \"Por dura\\xE7\\xE3o\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 677,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n              value: \"until\",\n              children: \"At\\xE9 data/hora\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 678,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 676,\n            columnNumber: 13\n          }, this), d.mode !== 'until' ? /*#__PURE__*/_jsxDEV(_Fragment, {\n            children: [label('Segundos'), /*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"number\",\n              min: 1,\n              style: inputStyle,\n              value: d.seconds || 30,\n              onChange: e => {\n                const seconds = Math.max(1, Number(e.target.value || 1));\n                upd({\n                  seconds\n                });\n                updateSummary('duration', {\n                  seconds\n                });\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 684,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true) : /*#__PURE__*/_jsxDEV(_Fragment, {\n            children: [label('Executar após (data/hora)'), /*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"datetime-local\",\n              style: inputStyle,\n              value: d.until || '',\n              onChange: e => {\n                const until = e.target.value;\n                upd({\n                  until\n                });\n                updateSummary('until', {\n                  until\n                });\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 690,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 674,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 673,\n        columnNumber: 9\n      }, this);\n    }\n\n    // outros\n    return null;\n  };\n\n  // toolbar chips (sem Audiência / sem End)\n  const Chips = () => /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      display: 'flex',\n      gap: 8,\n      alignItems: 'center'\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"span\", {\n      style: {\n        fontSize: 12,\n        color: '#6b7280',\n        marginRight: 8\n      },\n      children: \"Arraste para o canvas:\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 706,\n      columnNumber: 7\n    }, this), ['message', 'api', 'code', 'delay'].map(t => /*#__PURE__*/_jsxDEV(\"button\", {\n      className: \"btn secondary\",\n      draggable: true,\n      onDragStart: onDragStartChip(t),\n      children: t === 'message' ? 'Mensagem' : t === 'api' ? 'API' : t === 'code' ? 'Code' : 'Delay'\n    }, t, false, {\n      fileName: _jsxFileName,\n      lineNumber: 708,\n      columnNumber: 9\n    }, this))]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 705,\n    columnNumber: 5\n  }, this);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      padding: 12,\n      display: 'grid',\n      gridTemplateColumns: '1fr auto',\n      gap: 12\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        display: 'flex',\n        alignItems: 'center',\n        gap: 10\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"btn\",\n        onClick: handleBack,\n        children: \"Voltar\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 718,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Chips, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 719,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        value: flowName,\n        onChange: e => {\n          setFlowName(e.target.value);\n          setDirty(true);\n        },\n        style: {\n          marginLeft: 12,\n          width: 320,\n          border: '1px solid #cbd5e1',\n          borderRadius: 8,\n          padding: '8px 10px'\n        },\n        placeholder: \"Nome do flow\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 720,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 717,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        display: 'flex',\n        gap: 8,\n        justifyContent: 'flex-end'\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"btn\",\n        onClick: autoLayout,\n        children: \"Auto-layout\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 728,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"btn\",\n        onClick: async () => {\n          try {\n            const input = document.createElement('input');\n            input.type = 'file';\n            input.accept = 'application/json';\n            input.onchange = ev => {\n              var _ev$target$files;\n              const f = (_ev$target$files = ev.target.files) === null || _ev$target$files === void 0 ? void 0 : _ev$target$files[0];\n              if (!f) return;\n              const r = new FileReader();\n              r.onload = () => {\n                try {\n                  const data = JSON.parse(r.result);\n                  if (Array.isArray(data.nodes) && Array.isArray(data.edges)) {\n                    setNodes(data.nodes);\n                    setEdges(data.edges);\n                    setFlowName(data.name || 'Flow');\n                    setDirty(true);\n                    setTimeout(() => {\n                      var _rfInstanceRef$curren5;\n                      return (_rfInstanceRef$curren5 = rfInstanceRef.current) === null || _rfInstanceRef$curren5 === void 0 ? void 0 : _rfInstanceRef$curren5.fitView({\n                        padding: 0.2\n                      });\n                    }, 40);\n                  } else alert('JSON inválido.');\n                } catch {\n                  alert('Falha ao ler JSON.');\n                }\n              };\n              r.readAsText(f);\n            };\n            input.click();\n          } catch {}\n        },\n        children: \"Importar\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 729,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"btn\",\n        onClick: () => {\n          const blob = new Blob([JSON.stringify({\n            name: flowName,\n            nodes,\n            edges\n          }, null, 2)], {\n            type: 'application/json'\n          });\n          const a = document.createElement('a');\n          a.href = URL.createObjectURL(blob);\n          a.download = `${slug(flowName)}.json`;\n          a.click();\n          URL.revokeObjectURL(a.href);\n        },\n        children: \"Exportar\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 751,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"btn\",\n        onClick: handleSave,\n        children: \"Salvar flow\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 756,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 727,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      ref: wrapperRef,\n      style: {\n        gridColumn: '1 / span 2',\n        height: 'calc(100vh - 120px)',\n        border: '1px solid #e5e7eb',\n        borderRadius: 12,\n        position: 'relative',\n        overflow: 'hidden'\n      },\n      onDrop: onDrop,\n      onDragOver: onDragOver,\n      children: [/*#__PURE__*/_jsxDEV(ReactFlow, {\n        nodes: nodes,\n        edges: edges,\n        nodeTypes: nodeTypes,\n        onInit: inst => {\n          rfInstanceRef.current = inst;\n          // Se já for flow existente, ajusta; se for novo, viewport 1 (feito no seed/useEffect)\n          setTimeout(() => {\n            if (flowId) inst.fitView({\n              padding: 0.2\n            });else inst.setViewport({\n              x: 0,\n              y: 0,\n              zoom: 1\n            }, {\n              duration: 120\n            });\n          }, 30);\n        },\n        onNodesChange: onNodesChange,\n        onEdgesChange: onEdgesChange,\n        onConnect: onConnect,\n        onSelectionChange: onSelectionChange,\n        onNodeContextMenu: onNodeContextMenu,\n        fitView: false,\n        children: [/*#__PURE__*/_jsxDEV(MiniMap, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 784,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Controls, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 785,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Background, {\n          gap: 16\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 786,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 765,\n        columnNumber: 9\n      }, this), ctxMenu && /*#__PURE__*/_jsxDEV(\"div\", {\n        onMouseLeave: closeCtx,\n        style: {\n          position: 'fixed',\n          top: ctxMenu.y,\n          left: ctxMenu.x,\n          transform: 'translateY(-8px)',\n          background: '#fff',\n          border: '1px solid #e5e7eb',\n          borderRadius: 8,\n          boxShadow: '0 8px 24px rgba(0,0,0,.12)',\n          zIndex: 30,\n          overflow: 'hidden'\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"btn secondary\",\n          style: {\n            width: 180,\n            display: 'block',\n            borderRadius: 0\n          },\n          onClick: doRename,\n          children: \"Renomear\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 798,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"btn secondary\",\n          style: {\n            width: 180,\n            display: 'block',\n            borderRadius: 0\n          },\n          onClick: doDuplicate,\n          children: \"Duplicar\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 799,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"btn secondary\",\n          style: {\n            width: 180,\n            display: 'block',\n            borderRadius: 0\n          },\n          onClick: doReset,\n          children: \"Resetar\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 800,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"btn danger\",\n          style: {\n            width: 180,\n            display: 'block',\n            borderRadius: 0\n          },\n          onClick: doDelete,\n          children: \"Deletar\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 801,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 791,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 759,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Drawer, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 807,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 716,\n    columnNumber: 5\n  }, this);\n}\n_s2(JourneyBuilder, \"lGM7JP9qGI6WB5pPhQPpY/7CfRc=\", false, function () {\n  return [useNavigate, useNodesState, useEdgesState];\n});\n_c9 = JourneyBuilder;\nvar _c, _c2, _c3, _c4, _c5, _c6, _c7, _c8, _c9;\n$RefreshReg$(_c, \"NodeShell\");\n$RefreshReg$(_c2, \"AudienceNode\");\n$RefreshReg$(_c3, \"MessageNode\");\n$RefreshReg$(_c4, \"ApiNode\");\n$RefreshReg$(_c5, \"CodeNode\");\n$RefreshReg$(_c6, \"DelayNode\");\n$RefreshReg$(_c7, \"EndNode\");\n$RefreshReg$(_c8, \"AudiencePanel\");\n$RefreshReg$(_c9, \"JourneyBuilder\");","map":{"version":3,"names":["React","useCallback","useEffect","useMemo","useRef","useState","useNavigate","ReactFlow","Background","Controls","MiniMap","addEdge","useEdgesState","useNodesState","MarkerType","Handle","Position","Papa","jsxDEV","_jsxDEV","Fragment","_Fragment","PIN","uid","p","Date","now","Math","floor","random","slug","s","String","trim","toLowerCase","replace","NodeShell","title","subtitle","selected","children","style","background","border","borderRadius","width","boxShadow","padding","borderBottom","fontWeight","color","fileName","_jsxFileName","lineNumber","columnNumber","fontSize","_c","AudienceNode","type","id","position","Right","height","_c2","MessageNode","data","label","channel","toUpperCase","mode","Left","_c3","ApiNode","_c4","CodeNode","_c5","DelayNode","summary","_c6","EndNode","_c7","AudiencePanel","node","patchNode","inputStyle","slugFn","_s","d","headers","setHeaders","rows","setRows","mapping","setMapping","phoneKey","setPhoneKey","onFile","e","_e$target$files","f","target","files","parse","header","skipEmptyLines","complete","res","hs","meta","fields","Object","keys","guess","forEach","h","pk","find","test","slice","saveMap","alert","accept","onChange","length","value","map","display","gridTemplateColumns","gap","maxHeight","overflow","alignSelf","textAlign","placeholder","m","className","onClick","marginTop","JSON","stringify","_c8","JourneyBuilder","_s2","navigate","nodes","setNodes","onNodesChangeBase","edges","setEdges","onEdgesChangeBase","flowId","setFlowId","flowName","setFlowName","drawerNodeId","setDrawerNodeId","dirty","setDirty","initializedRef","rfInstanceRef","wrapperRef","dragType","templates","setTemplates","fetch","then","r","json","contents","catch","nodeTypes","audience","message","api","code","delay","end","current","sp","URLSearchParams","window","location","search","get","isNew","seedAudience","audId","x","y","setTimeout","_rfInstanceRef$curren","setViewport","zoom","duration","ok","Promise","reject","Array","isArray","name","_rfInstanceRef$curren2","fitView","raw","localStorage","getItem","_rfInstanceRef$curren3","_nodes$","onNodesChange","chs","onEdgesChange","onConnect","params","eds","filtered","filter","source","stroke","markerEnd","ArrowClosed","onSelectionChange","ns","_ns$","patch","nds","n","onDragStartChip","dataTransfer","setData","effectAllowed","onDragOver","preventDefault","dropEffect","onDrop","getData","bounds","getBoundingClientRect","screenToFlowPosition","clientX","left","clientY","top","text","method","url","body","mappings","lastResponse","seconds","concat","ctxMenu","setCtxMenu","onNodeContextMenu","nodeId","closeCtx","doRename","_nodes$find","_nodes$find$data","val","prompt","doDuplicate","clone","doReset","fresh","doDelete","autoLayout","newNodes","start","byId","fromEntries","outs","push","ordered","cur","_outs$cur","idx","values","_rfInstanceRef$curren4","handleSave","hasEnd","some","nNodes","nEdges","idsWithOut","Set","last","has","endId","endNode","edge","payload","updatedAt","toISOString","Error","saved","history","replaceState","setItem","handleBack","confirm","small","marginBottom","t","panelWrap","selectedNode","Drawer","_Object$values$","found","templateSid","sid","firstTypeBody","types","right","zIndex","friendly_name","readOnly","fontFamily","mediaUrl","buttonsJson","tryParse","txt","testRequest","undefined","addMapping","path","var","updateMap","removeMap","splice","i","upd","updateSummary","v","dt","until","toLocaleString","min","max","Number","Chips","alignItems","marginRight","draggable","onDragStart","marginLeft","justifyContent","input","document","createElement","onchange","ev","_ev$target$files","FileReader","onload","result","_rfInstanceRef$curren5","readAsText","click","blob","Blob","a","href","URL","createObjectURL","download","revokeObjectURL","ref","gridColumn","onInit","inst","onMouseLeave","transform","_c9","$RefreshReg$"],"sources":["/Users/gustsantos/Desktop/initucastt/frontend/src/pages/JourneyBuilder.jsx"],"sourcesContent":["// frontend/src/pages/JourneyBuilder.jsx\nimport React, { useCallback, useEffect, useMemo, useRef, useState } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport ReactFlow, {\n  Background,\n  Controls,\n  MiniMap,\n  addEdge,\n  useEdgesState,\n  useNodesState,\n  MarkerType,\n  Handle,\n  Position,\n} from 'reactflow';\nimport 'reactflow/dist/style.css';\nimport Papa from 'papaparse';\n\n// === util ===\nconst PIN = 14;\nconst uid = (p) => `${p}_${Date.now()}_${Math.floor(Math.random() * 9999)}`;\nconst slug = (s) =>\n  String(s || '')\n    .trim()\n    .toLowerCase()\n    .replace(/\\s+/g, '_')\n    .replace(/[^\\w]/g, '_')\n    .replace(/_+/g, '_');\n\nconst NodeShell = ({ title, subtitle, selected, children }) => (\n  <div\n    style={{\n      background: '#fff',\n      border: selected ? '2px solid #2563eb' : '1px solid #e5e7eb',\n      borderRadius: 12,\n      width: 320,\n      boxShadow: '0 2px 8px rgba(0,0,0,.06)'\n    }}\n  >\n    <div style={{ padding: '12px 14px', borderBottom: '1px solid #f1f5f9' }}>\n      <div style={{ fontWeight: 700, color: '#0f172a' }}>{title}</div>\n      {subtitle ? <div style={{ fontSize: 12, color: '#64748b' }}>{subtitle}</div> : null}\n    </div>\n    <div style={{ padding: 12 }}>{children}</div>\n  </div>\n);\n\n// === node components ===\nconst AudienceNode = ({ selected }) => (\n  <NodeShell title=\"Audiência\" subtitle=\"CSV → variáveis\" selected={selected}>\n    <div style={{ fontSize: 12, color: '#475569' }}>\n      Faça upload e mapeie colunas no painel ao lado.\n    </div>\n    <Handle type=\"source\" id=\"out\" position={Position.Right}\n      style={{ background: '#16a34a', width: PIN, height: PIN, border: '2px solid #fff' }} />\n  </NodeShell>\n);\n\nconst MessageNode = ({ data, selected }) => (\n  <NodeShell\n    title={data.label || 'Mensagem'}\n    subtitle={`Canal: ${String(data.channel || 'whatsapp').toUpperCase()} • Tipo: ${data.mode || 'text'}`}\n    selected={selected}\n  >\n    <div style={{ fontSize: 12, color: '#475569' }}>Conteúdo configurável no painel ao lado.</div>\n    <Handle type=\"target\" id=\"in\" position={Position.Left}\n      style={{ background: '#6b7280', width: PIN, height: PIN, border: '2px solid #fff' }} />\n    <Handle type=\"source\" id=\"out\" position={Position.Right}\n      style={{ background: '#16a34a', width: PIN, height: PIN, border: '2px solid #fff' }} />\n  </NodeShell>\n);\n\nconst ApiNode = ({ selected }) => (\n  <NodeShell title=\"API Call\" selected={selected}>\n    <div style={{ fontSize: 12, color: '#475569' }}>\n      Configure método/URL no painel ao lado. Salva variáveis via mapeamentos.\n    </div>\n    <Handle type=\"target\" id=\"in\" position={Position.Left}\n      style={{ background: '#6b7280', width: PIN, height: PIN, border: '2px solid #fff' }} />\n    <Handle type=\"source\" id=\"out\" position={Position.Right}\n      style={{ background: '#16a34a', width: PIN, height: PIN, border: '2px solid #fff' }} />\n  </NodeShell>\n);\n\nconst CodeNode = ({ selected }) => (\n  <NodeShell title=\"Code\" subtitle=\"JS custom\" selected={selected}>\n    <div style={{ fontSize: 12, color: '#475569' }}>\n      Cole seu JS no painel ao lado. Deve retornar um objeto de variáveis.\n    </div>\n    <Handle type=\"target\" id=\"in\" position={Position.Left}\n      style={{ background: '#6b7280', width: PIN, height: PIN, border: '2px solid #fff' }} />\n    <Handle type=\"source\" id=\"out\" position={Position.Right}\n      style={{ background: '#16a34a', width: PIN, height: PIN, border: '2px solid #fff' }} />\n  </NodeShell>\n);\n\nconst DelayNode = ({ data, selected }) => (\n  <NodeShell title=\"Delay\" subtitle={data?.summary || ''} selected={selected}>\n    <div style={{ fontSize: 12, color: '#475569' }}>Espera antes de seguir para o próximo nó.</div>\n    <Handle type=\"target\" id=\"in\" position={Position.Left}\n      style={{ background: '#6b7280', width: PIN, height: PIN, border: '2px solid #fff' }} />\n    <Handle type=\"source\" id=\"out\" position={Position.Right}\n      style={{ background: '#16a34a', width: PIN, height: PIN, border: '2px solid #fff' }} />\n  </NodeShell>\n);\n\nconst EndNode = ({ selected }) => (\n  <NodeShell title=\"End\" subtitle=\"término do fluxo\" selected={selected}>\n    <div style={{ fontSize: 12, color: '#475569' }}>Nó terminal. Só recebe conexões.</div>\n    <Handle type=\"target\" id=\"in\" position={Position.Left}\n      style={{ background: '#6b7280', width: PIN, height: PIN, border: '2px solid #fff' }} />\n  </NodeShell>\n);\n\n// === side panels (podem usar hooks) ===\nfunction AudiencePanel({ node, patchNode, inputStyle, label, slugFn }) {\n  const d = node.data || {};\n  const [headers, setHeaders] = useState(d.headers || []);\n  const [rows, setRows] = useState(d.rows || []);\n  const [mapping, setMapping] = useState(d.mapping || {});\n  const [phoneKey, setPhoneKey] = useState(d.phoneKey || '');\n\n  useEffect(() => {\n    setHeaders(d.headers || []);\n    setRows(d.rows || []);\n    setMapping(d.mapping || {});\n    setPhoneKey(d.phoneKey || '');\n    // eslint-disable-next-line\n  }, [node.id]);\n\n  const onFile = (e) => {\n    const f = e.target.files?.[0];\n    if (!f) return;\n    Papa.parse(f, {\n      header: true,\n      skipEmptyLines: true,\n      complete: (res) => {\n        const hs = res.meta.fields || Object.keys(res.data[0] || {});\n        const guess = {};\n        hs.forEach((h) => (guess[h] = slugFn(h)));\n        const pk = hs.find((h) => /phone|telefone|celular|numero|n[uú]mero/i.test(h)) || '';\n        setHeaders(hs);\n        setRows(res.data.slice(0, 5));\n        setMapping(guess);\n        setPhoneKey(pk);\n      },\n    });\n  };\n\n  const saveMap = () => {\n    if (!phoneKey) return alert('Escolha a coluna de telefone.');\n    patchNode(node.id, { headers, rows, mapping, phoneKey });\n    alert('Mapeamento salvo.');\n  };\n\n  return (\n    <>\n      {label('Arquivo CSV')}\n      <input type=\"file\" accept=\".csv\" onChange={onFile} />\n\n      {headers.length > 0 && (\n        <>\n          {label('Coluna de telefone')}\n          <select style={inputStyle} value={phoneKey} onChange={(e) => setPhoneKey(e.target.value)}>\n            <option value=\"\">— selecione —</option>\n            {headers.map((h) => (<option key={h} value={h}>{h}</option>))}\n          </select>\n\n          {label('Mapeamento (coluna → variável)')}\n          <div style={{ display: 'grid', gridTemplateColumns: '1fr 20px 1fr', gap: 8, maxHeight: 200, overflow: 'auto' }}>\n            {headers.map((h) => (\n              <React.Fragment key={h}>\n                <div style={{ alignSelf: 'center', fontSize: 13 }}>{h}</div>\n                <div style={{ textAlign: 'center', color: '#94a3b8' }}>→</div>\n                <input\n                  style={inputStyle}\n                  value={mapping[h] || ''}\n                  placeholder={slugFn(h)}\n                  onChange={(e) => setMapping((m) => ({ ...m, [h]: slugFn(e.target.value) }))}\n                />\n              </React.Fragment>\n            ))}\n          </div>\n\n          <button className=\"btn\" onClick={saveMap} style={{ marginTop: 10 }}>Salvar mapeamento</button>\n\n          {rows.length > 0 && (\n            <>\n              {label('Amostra (5 primeiras linhas)')}\n              <pre style={{ background: '#f8fafc', border: '1px solid #e2e8f0', borderRadius: 8, padding: 10, fontSize: 12, maxHeight: 160, overflow: 'auto' }}>\n                {JSON.stringify(rows, null, 2)}\n              </pre>\n            </>\n          )}\n          <div style={{ fontSize: 12, color: '#64748b', marginTop: 8 }}>\n            Use as variáveis com <code>{'{{minha_variavel}}'}</code>.\n          </div>\n        </>\n      )}\n    </>\n  );\n}\n\n// === principal ===\nexport default function JourneyBuilder() {\n  const navigate = useNavigate();\n  const [nodes, setNodes, onNodesChangeBase] = useNodesState([]);\n  const [edges, setEdges, onEdgesChangeBase] = useEdgesState([]);\n\n  const [flowId, setFlowId] = useState(null);\n  const [flowName, setFlowName] = useState('Novo Flow');\n  const [drawerNodeId, setDrawerNodeId] = useState(null);\n  const [dirty, setDirty] = useState(false);\n  const initializedRef = useRef(false);\n\n  // React Flow instance + wrapper (para DnD)\n  const rfInstanceRef = useRef(null);\n  const wrapperRef = useRef(null);\n\n  // palette drag type\n  const dragType = useRef(null);\n\n  // templates (Twilio)\n  const [templates, setTemplates] = useState([]);\n  useEffect(() => {\n    fetch('/api/templates/list')\n      .then((r) => r.json())\n      .then((data) => setTemplates(data.contents || []))\n      .catch(() => setTemplates([]));\n  }, []);\n\n  const nodeTypes = useMemo(() => ({\n    audience: AudienceNode,\n    message: MessageNode,\n    api: ApiNode,\n    code: CodeNode,\n    delay: DelayNode,\n    end: EndNode,\n  }), []);\n\n  // init: se ?id carrega; se ?new, cria com Audiência; default idem\n  useEffect(() => {\n    if (initializedRef.current) return;\n    initializedRef.current = true;\n\n    const sp = new URLSearchParams(window.location.search);\n    const id = sp.get('id');\n    const isNew = sp.get('new') === '1';\n\n    const seedAudience = () => {\n      const audId = uid('aud');\n      setNodes([\n        { id: audId, type: 'audience', position: { x: 120, y: 160 }, data: {} },\n      ]);\n      setEdges([]);\n      // viewport inicial \"normal\" — sem fitView pra não ficar gigante\n      setTimeout(() => rfInstanceRef.current?.setViewport({ x: 0, y: 0, zoom: 1 }, { duration: 120 }), 30);\n    };\n\n    if (id) {\n      setFlowId(id);\n      fetch(`/api/journeys/${id}`)\n        .then((r) => (r.ok ? r.json() : Promise.reject()))\n        .then((f) => {\n          if (Array.isArray(f.nodes) && Array.isArray(f.edges)) {\n            setNodes(f.nodes);\n            setEdges(f.edges);\n            setFlowName(f.name || 'Flow');\n            setTimeout(() => rfInstanceRef.current?.fitView({ padding: 0.2 }), 60);\n          } else seedAudience();\n        })\n        .catch(() => {\n          const raw = localStorage.getItem(id);\n          if (raw) {\n            try {\n              const f = JSON.parse(raw);\n              setNodes(f.nodes || []);\n              setEdges(f.edges || []);\n              setFlowName(f.name || 'Flow');\n            } catch { seedAudience(); }\n          } else seedAudience();\n          setTimeout(() => rfInstanceRef.current?.fitView({ padding: 0.2 }), 60);\n        });\n    } else if (isNew) {\n      seedAudience();\n    } else {\n      // acesso direto ao /builder\n      seedAudience();\n    }\n  }, [setNodes, setEdges]);\n\n  // Se for flow novo com apenas Audiência, garanta zoom 1 (evita \"gigante\")\n  useEffect(() => {\n    if (!rfInstanceRef.current) return;\n    if (!flowId && nodes.length === 1 && nodes[0]?.type === 'audience') {\n      rfInstanceRef.current.setViewport({ x: 0, y: 0, zoom: 1 }, { duration: 120 });\n    }\n  }, [flowId, nodes.length]); // eslint-disable-line\n\n  // dirty tracking\n  const onNodesChange = useCallback((chs) => {\n    setDirty(true);\n    onNodesChangeBase(chs);\n  }, [onNodesChangeBase]);\n  const onEdgesChange = useCallback((chs) => {\n    setDirty(true);\n    onEdgesChangeBase(chs);\n  }, [onEdgesChangeBase]);\n\n  // conecta com 1 saída por nó\n  const onConnect = useCallback((params) => {\n    setDirty(true);\n    setEdges((eds) => {\n      const filtered = eds.filter((e) => e.source !== params.source);\n      return addEdge(\n        { ...params, type: 'smoothstep', style: { stroke: '#0f172a' }, markerEnd: { type: MarkerType.ArrowClosed, color: '#0f172a' } },\n        filtered\n      );\n    });\n  }, [setEdges]);\n\n  // seleção → abrir drawer\n  const onSelectionChange = useCallback(({ nodes: ns }) => {\n    setDrawerNodeId(ns?.[0]?.id || null);\n  }, []);\n\n  // patch node\n  const patchNode = useCallback((id, patch) => {\n    setDirty(true);\n    setNodes((nds) => nds.map((n) => (n.id === id ? { ...n, data: { ...n.data, ...patch } } : n)));\n  }, [setNodes]);\n\n  // DnD\n  const onDragStartChip = (type) => (e) => {\n    dragType.current = type;\n    e.dataTransfer.setData('application/reactflow', type);\n    e.dataTransfer.effectAllowed = 'move';\n  };\n  const onDragOver = (e) => {\n    e.preventDefault();\n    e.dataTransfer.dropEffect = 'move';\n  };\n  const onDrop = (e) => {\n    e.preventDefault();\n    const type = dragType.current || e.dataTransfer.getData('application/reactflow');\n    if (!type || !rfInstanceRef.current || !wrapperRef.current) return;\n\n    const bounds = wrapperRef.current.getBoundingClientRect();\n    const position = rfInstanceRef.current.screenToFlowPosition({\n      x: e.clientX - bounds.left,\n      y: e.clientY - bounds.top,\n    });\n\n    const id = uid(type);\n    let node;\n    if (type === 'message') {\n      node = { id, type, position, data: { label: 'Mensagem', channel: 'whatsapp', mode: 'text', text: '' } };\n    } else if (type === 'api') {\n      node = { id, type, position, data: { label: 'API Call', method: 'GET', url: '', headers: '{}', body: '{}', mappings: [], lastResponse: '' } };\n    } else if (type === 'code') {\n      node = { id, type, position, data: { label: 'Code', code: '// return { nova_variavel: 123 };' } };\n    } else if (type === 'delay') {\n      node = { id, type, position, data: { mode: 'duration', seconds: 30, summary: '30 seconds' } };\n    } else {\n      return;\n    }\n    setNodes((nds) => nds.concat(node));\n    setDirty(true);\n  };\n\n  // Context menu (vertical)\n  const [ctxMenu, setCtxMenu] = useState(null); // {x,y,nodeId}\n  const onNodeContextMenu = (e, node) => {\n    e.preventDefault();\n    setCtxMenu({ x: e.clientX, y: e.clientY, nodeId: node.id });\n  };\n  const closeCtx = () => setCtxMenu(null);\n  const doRename = () => {\n    if (!ctxMenu) return;\n    const val = window.prompt('Novo nome do nó:', nodes.find(n => n.id === ctxMenu.nodeId)?.data?.label || '');\n    if (val != null) patchNode(ctxMenu.nodeId, { label: val });\n    closeCtx();\n  };\n  const doDuplicate = () => {\n    if (!ctxMenu) return;\n    setNodes((nds) => {\n      const n = nds.find((x) => x.id === ctxMenu.nodeId);\n      if (!n) return nds;\n      const clone = { ...n, id: uid(n.type), position: { x: n.position.x + 40, y: n.position.y + 40 } };\n      return nds.concat(clone);\n    });\n    closeCtx();\n  };\n  const doReset = () => {\n    if (!ctxMenu) return;\n    const n = nodes.find((x) => x.id === ctxMenu.nodeId);\n    if (!n) return;\n    let fresh = {};\n    if (n.type === 'message') fresh = { label: 'Mensagem', channel: 'whatsapp', mode: 'text', text: '' };\n    if (n.type === 'api') fresh = { label: 'API Call', method: 'GET', url: '', headers: '{}', body: '{}', mappings: [], lastResponse: '' };\n    if (n.type === 'code') fresh = { label: 'Code', code: '// return { nova_variavel: 123 };' };\n    if (n.type === 'delay') fresh = { mode: 'duration', seconds: 30, summary: '30 seconds' };\n    patchNode(n.id, fresh);\n    closeCtx();\n  };\n  const doDelete = () => {\n    if (!ctxMenu) return;\n    const id = ctxMenu.nodeId;\n    setEdges((eds) => eds.filter((e) => e.source !== id && e.target !== id));\n    setNodes((nds) => nds.filter((n) => n.id !== id));\n    setDirty(true);\n    closeCtx();\n  };\n\n  // auto-layout (Dagre simples)\n  const autoLayout = () => {\n    // layout linear simples da esquerda p/ direita\n    const newNodes = [...nodes];\n    const start = newNodes.find(n => n.type === 'audience');\n    if (!start) return;\n    const byId = Object.fromEntries(newNodes.map(n => [n.id, n]));\n    const outs = {};\n    edges.forEach(e => { (outs[e.source] ||= []).push(e.target); });\n    const ordered = [start.id];\n    let cur = start.id;\n    // como só permitimos 1 saída por nó, dá pra caminhar\n    while (outs[cur]?.[0]) {\n      ordered.push(outs[cur][0]);\n      cur = outs[cur][0];\n    }\n    ordered.forEach((id, idx) => {\n      const n = byId[id];\n      if (n) {\n        n.position = { x: 140 + idx * 360, y: 180 + (n.type === 'audience' ? -20 : 0) };\n      }\n    });\n    setNodes(Object.values(byId));\n    setTimeout(() => rfInstanceRef.current?.fitView({ padding: 0.2 }), 30);\n  };\n\n  // salvar → injeta End se não existir\n  const handleSave = async () => {\n    // existe end?\n    const hasEnd = nodes.some(n => n.type === 'end');\n    let nNodes = nodes;\n    let nEdges = edges;\n\n    if (!hasEnd) {\n      const idsWithOut = new Set(edges.map(e => e.source));\n      const last = nodes.find(n => !idsWithOut.has(n.id) && n.type !== 'end');\n      if (last) {\n        const endId = uid('end');\n        const endNode = { id: endId, type: 'end', position: { x: last.position.x + 360, y: last.position.y }, data: {} };\n        const edge = { id: uid('e'), source: last.id, target: endId };\n        nNodes = [...nodes, endNode];\n        nEdges = [...edges.filter(e => e.source !== last.id), edge]; // garante 1 saída\n        setNodes(nNodes);\n        setEdges(nEdges);\n      }\n    }\n\n    const payload = {\n      id: flowId || 'flow_' + Date.now(),\n      name: flowName || 'Flow',\n      nodes: nNodes,\n      edges: nEdges,\n      updatedAt: new Date().toISOString(),\n    };\n\n    try {\n      const url = flowId ? `/api/journeys/${flowId}` : '/api/journeys';\n      const method = flowId ? 'PUT' : 'POST';\n      const res = await fetch(url, {\n        method, headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload),\n      });\n      if (!res.ok) throw new Error('offline');\n      const saved = await res.json();\n      alert('Flow salvo!');\n      setDirty(false);\n      if (!flowId && saved?.id) {\n        setFlowId(saved.id);\n        window.history.replaceState(null, '', `/journeys/builder?id=${saved.id}`);\n      }\n    } catch {\n      localStorage.setItem(payload.id, JSON.stringify(payload));\n      alert('Flow salvo no navegador.');\n      setDirty(false);\n      if (!flowId) {\n        setFlowId(payload.id);\n        window.history.replaceState(null, '', `/journeys/builder?id=${payload.id}`);\n      }\n    }\n  };\n\n  // voltar → perguntar salvar\n  const handleBack = async () => {\n    if (dirty) {\n      const ok = window.confirm('Salvar antes de voltar?\\nOK: salvar e voltar • Cancel: voltar sem salvar');\n      if (ok) {\n        await handleSave();\n      }\n    }\n    navigate('/journeys');\n  };\n\n  // inputs/styles\n  const inputStyle = { width: '100%', border: '1px solid #cbd5e1', borderRadius: 8, padding: '10px 12px' };\n  const small = { fontSize: 12, color: '#475569', marginBottom: 6 };\n  const label = (t) => <div style={small}>{t}</div>;\n  const panelWrap = { background: '#fff', border: '1px solid #e5e7eb', borderRadius: 12, padding: 16, width: 360 };\n\n  // drawer\n  const selectedNode = nodes.find(n => n.id === drawerNodeId);\n  const Drawer = () => {\n    if (!selectedNode) return null;\n    const n = selectedNode;\n\n    // Mensagem\n    if (n.type === 'message') {\n      const d = n.data || {};\n      const found = d.templateSid ? templates.find(t => t.sid === d.templateSid) : null;\n      const firstTypeBody = found ? (Object.values(found.types || {})[0]?.body || '') : '';\n      return (\n        <div style={{ position: 'fixed', right: 16, top: 72, zIndex: 20 }}>\n          <div style={panelWrap}>\n            {label('Label')}\n            <input style={inputStyle} value={d.label || ''} onChange={(e) => patchNode(n.id, { label: e.target.value })} />\n\n            {label('Canal')}\n            <select style={inputStyle} value={d.channel || 'whatsapp'} onChange={(e) => patchNode(n.id, { channel: e.target.value })}>\n              <option value=\"whatsapp\">WhatsApp</option><option value=\"sms\">SMS</option>\n            </select>\n\n            {label('Mode')}\n            <select style={inputStyle} value={d.mode || 'text'} onChange={(e) => patchNode(n.id, { mode: e.target.value })}>\n              <option value=\"text\">Text</option><option value=\"rich\">Rich (text + image + buttons)</option>\n            </select>\n\n            {label('Pick a Twilio template (optional)')}\n            <select style={inputStyle} value={d.templateSid || ''} onChange={(e) => patchNode(n.id, { templateSid: e.target.value })}>\n              <option value=\"\">— none —</option>\n              {templates.map(t => (<option key={t.sid} value={t.sid}>{t.friendly_name || t.sid}</option>))}\n            </select>\n\n            {found && (\n              <>\n                {label('Template preview')}\n                <textarea readOnly rows={6} style={{ ...inputStyle, fontFamily: 'monospace' }} value={firstTypeBody} />\n              </>\n            )}\n\n            {label('Text')}\n            <textarea rows={6} style={inputStyle} value={d.text || ''} onChange={(e) => patchNode(n.id, { text: e.target.value })} placeholder=\"Olá {{nome}}!\" />\n\n            {d.mode === 'rich' && (\n              <>\n                {label('Media URL')}\n                <input style={inputStyle} value={d.mediaUrl || ''} onChange={(e) => patchNode(n.id, { mediaUrl: e.target.value })} placeholder=\"https://...\" />\n                {label('Buttons (JSON)')}\n                <textarea rows={5} style={inputStyle} value={d.buttonsJson || ''} onChange={(e) => patchNode(n.id, { buttonsJson: e.target.value })}\n                  placeholder='[{\"type\":\"reply\",\"title\":\"Sim\",\"id\":\"YES\"}]' />\n              </>\n            )}\n          </div>\n        </div>\n      );\n    }\n\n    // API\n    if (n.type === 'api') {\n      const d = n.data || {};\n      const tryParse = (txt) => { try { return JSON.stringify(JSON.parse(txt), null, 2); } catch { return txt; } };\n      const testRequest = async () => {\n        try {\n          const headers = d.headers ? JSON.parse(d.headers) : {};\n          const body =\n            d.method === 'GET' || d.method === 'DELETE'\n              ? undefined\n              : d.body && d.body.trim() !== '{}' ? JSON.parse(d.body) : undefined;\n          const res = await fetch(d.url, { method: d.method || 'GET', headers, body: body ? JSON.stringify(body) : undefined });\n          const text = await res.text();\n          patchNode(n.id, { lastResponse: text });\n          alert('Request executada. Veja a resposta abaixo.');\n        } catch (e) { alert('Falha: ' + e.message); }\n      };\n      const addMapping = () => {\n        const m = Array.isArray(d.mappings) ? d.mappings.slice() : [];\n        m.push({ path: '', var: '' }); patchNode(n.id, { mappings: m });\n      };\n      const updateMap = (idx, patch) => {\n        const m = (d.mappings || []).slice(); m[idx] = { ...m[idx], ...patch }; patchNode(n.id, { mappings: m });\n      };\n      const removeMap = (idx) => {\n        const m = (d.mappings || []).slice(); m.splice(idx, 1); patchNode(n.id, { mappings: m });\n      };\n      return (\n        <div style={{ position: 'fixed', right: 16, top: 72, zIndex: 20 }}>\n          <div style={panelWrap}>\n            {label('Label')}\n            <input style={inputStyle} value={d.label || 'API Call'} onChange={(e) => patchNode(n.id, { label: e.target.value })} />\n\n            {label('Método')}\n            <select style={inputStyle} value={d.method || 'GET'} onChange={(e) => patchNode(n.id, { method: e.target.value })}>\n              <option>GET</option><option>POST</option><option>PUT</option><option>PATCH</option><option>DELETE</option>\n            </select>\n\n            {label('URL')}\n            <input style={inputStyle} placeholder=\"https://api.meuservico.com/...\" value={d.url || ''} onChange={(e) => patchNode(n.id, { url: e.target.value })} />\n\n            {label('Headers (JSON)')}\n            <textarea rows={4} style={inputStyle} value={d.headers || '{}'} onChange={(e) => patchNode(n.id, { headers: e.target.value })} />\n\n            {(d.method === 'POST' || d.method === 'PUT' || d.method === 'PATCH') && (\n              <>\n                {label('Body (JSON)')}\n                <textarea rows={6} style={inputStyle} value={d.body || '{}'} onChange={(e) => patchNode(n.id, { body: e.target.value })} />\n              </>\n            )}\n\n            <button className=\"btn\" onClick={testRequest} style={{ marginTop: 10 }}>Executar request</button>\n\n            {label('Resposta (último teste)')}\n            <textarea rows={8} readOnly style={{ ...inputStyle, fontFamily: 'monospace' }} value={tryParse(d.lastResponse || '')} />\n\n            {label('Mapeamentos JSON → Variáveis')}\n            {(d.mappings || []).map((m, i) => (\n              <div key={i} style={{ display: 'grid', gridTemplateColumns: '1fr 1fr auto', gap: 8, marginBottom: 8 }}>\n                <input style={inputStyle} placeholder=\"ex.: data.user.id\" value={m.path} onChange={(e) => updateMap(i, { path: e.target.value })} />\n                <input style={inputStyle} placeholder=\"ex.: user_id\" value={m.var} onChange={(e) => updateMap(i, { var: slug(e.target.value) })} />\n                <button className=\"btn danger\" onClick={() => removeMap(i)}>x</button>\n              </div>\n            ))}\n            <button className=\"btn\" onClick={addMapping}>+ adicionar mapeamento</button>\n\n            <div style={{ fontSize: 12, color: '#64748b', marginTop: 8 }}>\n              Use paths tipo <code>data.user.id</code>. O executor gravará o valor em variáveis.\n            </div>\n          </div>\n        </div>\n      );\n    }\n\n    // CODE\n    if (n.type === 'code') {\n      const d = n.data || {};\n      return (\n        <div style={{ position: 'fixed', right: 16, top: 72, zIndex: 20 }}>\n          <div style={panelWrap}>\n            {label('Label')}\n            <input style={inputStyle} value={d.label || 'Code'} onChange={(e) => patchNode(n.id, { label: e.target.value })} />\n            {label('JavaScript')}\n            <textarea rows={14} style={{ ...inputStyle, fontFamily: 'monospace' }}\n              value={d.code || ''} onChange={(e) => patchNode(n.id, { code: e.target.value })}\n              placeholder={`// Recebe \"context\" (variáveis atuais)\\n// deve retornar um objeto com novas variáveis\\nreturn { nova_variavel: 123 };`} />\n          </div>\n        </div>\n      );\n    }\n\n    // DELAY\n    if (n.type === 'delay') {\n      const d = n.data || {};\n      const upd = (p) => patchNode(n.id, { ...d, ...p });\n      const updateSummary = (mode, v) => {\n        if (mode === 'duration') {\n          const { seconds = 0 } = { ...d, ...v };\n          upd({ summary: `${seconds} second${seconds === 1 ? '' : 's'}` });\n        } else {\n          const dt = new Date(v?.until || d.until || Date.now());\n          upd({ summary: `until ${dt.toLocaleString()}` });\n        }\n      };\n      return (\n        <div style={{ position: 'fixed', right: 16, top: 72, zIndex: 20 }}>\n          <div style={panelWrap}>\n            {label('Modo')}\n            <select style={inputStyle} value={d.mode || 'duration'} onChange={(e) => { const mode = e.target.value; upd({ mode }); updateSummary(mode); }}>\n              <option value=\"duration\">Por duração</option>\n              <option value=\"until\">Até data/hora</option>\n            </select>\n\n            {d.mode !== 'until' ? (\n              <>\n                {label('Segundos')}\n                <input type=\"number\" min={1} style={inputStyle} value={d.seconds || 30}\n                  onChange={(e) => { const seconds = Math.max(1, Number(e.target.value || 1)); upd({ seconds }); updateSummary('duration', { seconds }); }} />\n              </>\n            ) : (\n              <>\n                {label('Executar após (data/hora)')}\n                <input type=\"datetime-local\" style={inputStyle}\n                  value={d.until || ''} onChange={(e) => { const until = e.target.value; upd({ until }); updateSummary('until', { until }); }} />\n              </>\n            )}\n          </div>\n        </div>\n      );\n    }\n\n    // outros\n    return null;\n  };\n\n  // toolbar chips (sem Audiência / sem End)\n  const Chips = () => (\n    <div style={{ display: 'flex', gap: 8, alignItems: 'center' }}>\n      <span style={{ fontSize: 12, color: '#6b7280', marginRight: 8 }}>Arraste para o canvas:</span>\n      {['message', 'api', 'code', 'delay'].map((t) => (\n        <button key={t} className=\"btn secondary\" draggable onDragStart={onDragStartChip(t)}>\n          {t === 'message' ? 'Mensagem' : t === 'api' ? 'API' : t === 'code' ? 'Code' : 'Delay'}\n        </button>\n      ))}\n    </div>\n  );\n\n  return (\n    <div style={{ padding: 12, display: 'grid', gridTemplateColumns: '1fr auto', gap: 12 }}>\n      <div style={{ display: 'flex', alignItems: 'center', gap: 10 }}>\n        <button className=\"btn\" onClick={handleBack}>Voltar</button>\n        <Chips />\n        <input\n          value={flowName}\n          onChange={(e) => { setFlowName(e.target.value); setDirty(true); }}\n          style={{ marginLeft: 12, width: 320, border: '1px solid #cbd5e1', borderRadius: 8, padding: '8px 10px' }}\n          placeholder=\"Nome do flow\"\n        />\n      </div>\n      <div style={{ display: 'flex', gap: 8, justifyContent: 'flex-end' }}>\n        <button className=\"btn\" onClick={autoLayout}>Auto-layout</button>\n        <button className=\"btn\" onClick={async () => {\n          try {\n            const input = document.createElement('input');\n            input.type = 'file'; input.accept = 'application/json';\n            input.onchange = (ev) => {\n              const f = ev.target.files?.[0]; if (!f) return;\n              const r = new FileReader();\n              r.onload = () => {\n                try {\n                  const data = JSON.parse(r.result);\n                  if (Array.isArray(data.nodes) && Array.isArray(data.edges)) {\n                    setNodes(data.nodes); setEdges(data.edges);\n                    setFlowName(data.name || 'Flow'); setDirty(true);\n                    setTimeout(() => rfInstanceRef.current?.fitView({ padding: 0.2 }), 40);\n                  } else alert('JSON inválido.');\n                } catch { alert('Falha ao ler JSON.'); }\n              };\n              r.readAsText(f);\n            };\n            input.click();\n          } catch {}\n        }}>Importar</button>\n        <button className=\"btn\" onClick={() => {\n          const blob = new Blob([JSON.stringify({ name: flowName, nodes, edges }, null, 2)], { type: 'application/json' });\n          const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = `${slug(flowName)}.json`; a.click();\n          URL.revokeObjectURL(a.href);\n        }}>Exportar</button>\n        <button className=\"btn\" onClick={handleSave}>Salvar flow</button>\n      </div>\n\n      <div\n        ref={wrapperRef}\n        style={{ gridColumn: '1 / span 2', height: 'calc(100vh - 120px)', border: '1px solid #e5e7eb', borderRadius: 12, position: 'relative', overflow: 'hidden' }}\n        onDrop={onDrop}\n        onDragOver={onDragOver}\n      >\n        <ReactFlow\n          nodes={nodes}\n          edges={edges}\n          nodeTypes={nodeTypes}\n          onInit={(inst) => {\n            rfInstanceRef.current = inst;\n            // Se já for flow existente, ajusta; se for novo, viewport 1 (feito no seed/useEffect)\n            setTimeout(() => {\n              if (flowId) inst.fitView({ padding: 0.2 });\n              else inst.setViewport({ x: 0, y: 0, zoom: 1 }, { duration: 120 });\n            }, 30);\n          }}\n          onNodesChange={onNodesChange}\n          onEdgesChange={onEdgesChange}\n          onConnect={onConnect}\n          onSelectionChange={onSelectionChange}\n          onNodeContextMenu={onNodeContextMenu}\n          fitView={false}\n        >\n          <MiniMap />\n          <Controls />\n          <Background gap={16} />\n        </ReactFlow>\n\n        {/* Context menu vertical */}\n        {ctxMenu && (\n          <div\n            onMouseLeave={closeCtx}\n            style={{\n              position: 'fixed', top: ctxMenu.y, left: ctxMenu.x, transform: 'translateY(-8px)',\n              background: '#fff', border: '1px solid #e5e7eb', borderRadius: 8, boxShadow: '0 8px 24px rgba(0,0,0,.12)', zIndex: 30, overflow: 'hidden'\n            }}\n          >\n            <button className=\"btn secondary\" style={{ width: 180, display: 'block', borderRadius: 0 }} onClick={doRename}>Renomear</button>\n            <button className=\"btn secondary\" style={{ width: 180, display: 'block', borderRadius: 0 }} onClick={doDuplicate}>Duplicar</button>\n            <button className=\"btn secondary\" style={{ width: 180, display: 'block', borderRadius: 0 }} onClick={doReset}>Resetar</button>\n            <button className=\"btn danger\" style={{ width: 180, display: 'block', borderRadius: 0 }} onClick={doDelete}>Deletar</button>\n          </div>\n        )}\n      </div>\n\n      {/* Drawer de propriedades */}\n      <Drawer />\n    </div>\n  );\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}