{"ast":null,"code":"var _jsxFileName = \"/Users/gustsantos/Desktop/initucastt/frontend/src/pages/JourneyBuilder.jsx\",\n  _s = $RefreshSig$();\n// frontend/src/pages/JourneyBuilder.jsx\nimport React, { useCallback, useEffect, useMemo, useState } from 'react';\nimport ReactFlow, { addEdge, Background, Controls, MiniMap, applyNodeChanges, applyEdgeChanges } from 'reactflow';\nimport 'reactflow/dist/style.css';\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst STORAGE_KEY = 'flows_v1';\nconst CURRENT_KEY = 'flows_current';\n\n// ---------- Helpers (iguais/compatíveis com os da JourneysPage) ----------\nconst sanitizeNodes = list => (list || []).filter(Boolean).map((n, idx) => {\n  var _n$position, _n$position2, _n$id;\n  const x = Number(n === null || n === void 0 ? void 0 : (_n$position = n.position) === null || _n$position === void 0 ? void 0 : _n$position.x);\n  const y = Number(n === null || n === void 0 ? void 0 : (_n$position2 = n.position) === null || _n$position2 === void 0 ? void 0 : _n$position2.y);\n  return {\n    id: String((_n$id = n === null || n === void 0 ? void 0 : n.id) !== null && _n$id !== void 0 ? _n$id : `n_${idx}`),\n    type: (n === null || n === void 0 ? void 0 : n.type) || 'default',\n    data: (n === null || n === void 0 ? void 0 : n.data) || {\n      label: ''\n    },\n    position: Number.isFinite(x) && Number.isFinite(y) ? {\n      x,\n      y\n    } : {\n      x: 120 + idx * 60,\n      y: 120\n    },\n    draggable: true\n  };\n});\nconst sanitizeEdges = list => (list || []).filter(Boolean).map((e, idx) => {\n  var _e$id;\n  return {\n    id: String((_e$id = e === null || e === void 0 ? void 0 : e.id) !== null && _e$id !== void 0 ? _e$id : `e_${idx}`),\n    source: String(e === null || e === void 0 ? void 0 : e.source),\n    target: String(e === null || e === void 0 ? void 0 : e.target),\n    label: e === null || e === void 0 ? void 0 : e.label,\n    animated: !!(e !== null && e !== void 0 && e.animated)\n  };\n});\nfunction loadFlows() {\n  try {\n    const raw = localStorage.getItem(STORAGE_KEY);\n    const arr = raw ? JSON.parse(raw) : [];\n    if (!Array.isArray(arr)) return [];\n    return arr.map(f => ({\n      ...f,\n      nodes: sanitizeNodes(f.nodes),\n      edges: sanitizeEdges(f.edges)\n    }));\n  } catch {\n    return [];\n  }\n}\nfunction saveFlows(flows) {\n  const safe = (flows || []).map(f => ({\n    ...f,\n    nodes: sanitizeNodes(f.nodes),\n    edges: sanitizeEdges(f.edges)\n  }));\n  localStorage.setItem(STORAGE_KEY, JSON.stringify(safe));\n  return safe;\n}\n// -----------------------------------------------------------------------\n\nexport default function JourneyBuilder() {\n  _s();\n  var _selectedNode$data2, _selectedNode$data3;\n  // carrega lista de flows\n  const [flows, setFlows] = useState(() => loadFlows());\n\n  // <<< Alteração opcional solicitada: respeitar flows_current >>>\n  const [flowId, setFlowId] = useState(() => {\n    var _list$;\n    const stored = localStorage.getItem(CURRENT_KEY);\n    const list = loadFlows();\n    const ok = stored && list.some(f => f.id === stored);\n    return ok ? stored : ((_list$ = list[0]) === null || _list$ === void 0 ? void 0 : _list$.id) || '';\n  });\n  const currentFlow = useMemo(() => flows.find(f => f.id === flowId), [flows, flowId]);\n  const [nodes, setNodes] = useState(() => sanitizeNodes((currentFlow === null || currentFlow === void 0 ? void 0 : currentFlow.nodes) || []));\n  const [edges, setEdges] = useState(() => sanitizeEdges((currentFlow === null || currentFlow === void 0 ? void 0 : currentFlow.edges) || []));\n  const [selectedNodeId, setSelectedNodeId] = useState(null);\n\n  // --------- Twilio Templates (para o painel de Template/Preview) ---------\n  const [templates, setTemplates] = useState([]);\n  const [templatesLoading, setTemplatesLoading] = useState(false);\n  const [templatesError, setTemplatesError] = useState(null);\n  useEffect(() => {\n    let mounted = true;\n    setTemplatesLoading(true);\n    fetch('/api/templates/list').then(r => r.json()).then(data => {\n      if (!mounted) return;\n      // normaliza: sid, friendly_name, body (pega o primeiro type)\n      const list = ((data === null || data === void 0 ? void 0 : data.contents) || []).map(t => {\n        const firstType = t !== null && t !== void 0 && t.types ? Object.values(t.types)[0] : null;\n        return {\n          sid: t === null || t === void 0 ? void 0 : t.sid,\n          friendlyName: (t === null || t === void 0 ? void 0 : t.friendly_name) || (t === null || t === void 0 ? void 0 : t.friendlyName) || (t === null || t === void 0 ? void 0 : t.sid),\n          body: (firstType === null || firstType === void 0 ? void 0 : firstType.body) || '',\n          type: (firstType === null || firstType === void 0 ? void 0 : firstType.type) || ''\n        };\n      });\n      setTemplates(list);\n      setTemplatesError(null);\n    }).catch(err => setTemplatesError((err === null || err === void 0 ? void 0 : err.message) || 'Erro ao buscar templates')).finally(() => setTemplatesLoading(false));\n    return () => {\n      mounted = false;\n    };\n  }, []);\n  // -----------------------------------------------------------------------\n\n  // quando troca o flow selecionado\n  useEffect(() => {\n    const f = flows.find(x => x.id === flowId);\n    setNodes(sanitizeNodes((f === null || f === void 0 ? void 0 : f.nodes) || []));\n    setEdges(sanitizeEdges((f === null || f === void 0 ? void 0 : f.edges) || []));\n    setSelectedNodeId(null);\n    if (flowId) localStorage.setItem(CURRENT_KEY, flowId);\n  }, [flowId, flows]);\n\n  // aplica mudanças de posição/seleção de nodes\n  const onNodesChange = useCallback(changes => {\n    setNodes(nds => sanitizeNodes(applyNodeChanges(changes, nds)));\n  }, []);\n\n  // aplica mudanças de edges\n  const onEdgesChange = useCallback(changes => {\n    setEdges(eds => sanitizeEdges(applyEdgeChanges(changes, eds)));\n  }, []);\n\n  // cria ligação entre nós\n  const onConnect = useCallback(connection => {\n    setEdges(eds => sanitizeEdges(addEdge({\n      ...connection,\n      id: `e_${Date.now()}`\n    }, eds)));\n  }, []);\n\n  // clique em nó para editar propriedades\n  const onNodeClick = useCallback((_, node) => {\n    setSelectedNodeId((node === null || node === void 0 ? void 0 : node.id) || null);\n  }, []);\n  const selectedNode = useMemo(() => nodes.find(n => n.id === selectedNodeId), [nodes, selectedNodeId]);\n\n  // editar data do nó (label, templateSid etc)\n  const updateSelectedNodeData = patch => {\n    if (!selectedNode) return;\n    const nid = selectedNode.id;\n    setNodes(nds => sanitizeNodes(nds.map(n => n.id === nid ? {\n      ...n,\n      data: {\n        ...n.data,\n        ...patch\n      }\n    } : n)));\n  };\n\n  // adicionar um nó simples (conveniência)\n  const addNode = () => {\n    const id = `n_${Date.now()}`;\n    const baseX = 120 + nodes.length % 5 * 140;\n    const baseY = 120 + Math.floor(nodes.length / 5) * 120;\n    const newNode = {\n      id,\n      type: 'default',\n      position: {\n        x: baseX,\n        y: baseY\n      },\n      data: {\n        label: 'Step'\n      }\n    };\n    setNodes(nds => sanitizeNodes([...nds, newNode]));\n  };\n  const saveCurrentFlow = () => {\n    if (!currentFlow) return;\n    const updated = flows.map(f => f.id === currentFlow.id ? {\n      ...f,\n      nodes: sanitizeNodes(nodes),\n      edges: sanitizeEdges(edges)\n    } : f);\n    const persisted = saveFlows(updated);\n    setFlows(persisted);\n  };\n\n  // painel de preview do template\n  const selectedTemplate = useMemo(() => {\n    var _selectedNode$data;\n    const sid = selectedNode === null || selectedNode === void 0 ? void 0 : (_selectedNode$data = selectedNode.data) === null || _selectedNode$data === void 0 ? void 0 : _selectedNode$data.templateSid;\n    return templates.find(t => t.sid === sid);\n  }, [selectedNode, templates]);\n  if (!flows.length) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        children: \"Journey Builder (MVP)\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 215,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        style: {\n          color: '#6b7280'\n        },\n        children: [\"Nenhum flow encontrado. Crie um em \", /*#__PURE__*/_jsxDEV(\"strong\", {\n          children: \"/journeys\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 217,\n          columnNumber: 46\n        }, this), \".\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 216,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 214,\n      columnNumber: 7\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      children: \"Journey Builder (MVP)\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 225,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        display: 'flex',\n        gap: 8,\n        alignItems: 'center',\n        marginBottom: 12\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          style: {\n            fontSize: 12,\n            color: '#6b7280'\n          },\n          children: \"Flow\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 230,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n          value: flowId,\n          onChange: e => setFlowId(e.target.value),\n          style: {\n            marginLeft: 8,\n            padding: 6\n          },\n          children: flows.map(f => /*#__PURE__*/_jsxDEV(\"option\", {\n            value: f.id,\n            children: [f.name || f.id, \" (\", f.id, \")\"]\n          }, f.id, true, {\n            fileName: _jsxFileName,\n            lineNumber: 237,\n            columnNumber: 15\n          }, this))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 231,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 229,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: addNode,\n        children: \"+ Add Node\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 243,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: saveCurrentFlow,\n        children: \"Salvar Fluxo\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 244,\n        columnNumber: 9\n      }, this), selectedNode && /*#__PURE__*/_jsxDEV(\"span\", {\n        style: {\n          marginLeft: 'auto',\n          fontSize: 12,\n          color: '#6b7280'\n        },\n        children: [\"N\\xF3 selecionado: \", /*#__PURE__*/_jsxDEV(\"strong\", {\n          children: selectedNode.id\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 247,\n          columnNumber: 29\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 246,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 228,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        display: 'grid',\n        gridTemplateColumns: '1fr 340px',\n        gap: 16,\n        minHeight: 560\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          border: '1px solid #e5e7eb',\n          borderRadius: 8,\n          overflow: 'hidden',\n          background: '#fff',\n          minHeight: 560\n        },\n        children: /*#__PURE__*/_jsxDEV(ReactFlow, {\n          nodes: nodes,\n          edges: edges,\n          onNodesChange: onNodesChange,\n          onEdgesChange: onEdgesChange,\n          onConnect: onConnect,\n          onNodeClick: onNodeClick,\n          fitView: true,\n          children: [/*#__PURE__*/_jsxDEV(MiniMap, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 273,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Controls, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 274,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Background, {\n            gap: 16,\n            size: 1\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 275,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 264,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 255,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          border: '1px solid #e5e7eb',\n          borderRadius: 8,\n          padding: 12,\n          background: '#fff'\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n          style: {\n            margin: '4px 0 12px'\n          },\n          children: \"Propriedades do N\\xF3\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 288,\n          columnNumber: 11\n        }, this), !selectedNode ? /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            color: '#6b7280'\n          },\n          children: \"Selecione um n\\xF3 no canvas.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 290,\n          columnNumber: 13\n        }, this) : /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              marginBottom: 12\n            },\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              style: {\n                fontSize: 12,\n                color: '#6b7280'\n              },\n              children: \"Label\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 295,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              value: (selectedNode === null || selectedNode === void 0 ? void 0 : (_selectedNode$data2 = selectedNode.data) === null || _selectedNode$data2 === void 0 ? void 0 : _selectedNode$data2.label) || '',\n              onChange: e => updateSelectedNodeData({\n                label: e.target.value\n              }),\n              style: {\n                width: '100%',\n                padding: 8,\n                marginTop: 6\n              },\n              placeholder: \"Ex.: Send Welcome Message\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 296,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 294,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              marginBottom: 12\n            },\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              style: {\n                fontSize: 12,\n                color: '#6b7280'\n              },\n              children: \"Template (Twilio)\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 306,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n              value: (selectedNode === null || selectedNode === void 0 ? void 0 : (_selectedNode$data3 = selectedNode.data) === null || _selectedNode$data3 === void 0 ? void 0 : _selectedNode$data3.templateSid) || '',\n              onChange: e => updateSelectedNodeData({\n                templateSid: e.target.value\n              }),\n              style: {\n                width: '100%',\n                padding: 8,\n                marginTop: 6\n              },\n              disabled: templatesLoading || !!templatesError,\n              children: [/*#__PURE__*/_jsxDEV(\"option\", {\n                value: \"\",\n                children: \"\\u2014 selecione \\u2014\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 313,\n                columnNumber: 19\n              }, this), templates.map(t => /*#__PURE__*/_jsxDEV(\"option\", {\n                value: t.sid,\n                children: t.friendlyName\n              }, t.sid, false, {\n                fileName: _jsxFileName,\n                lineNumber: 315,\n                columnNumber: 21\n              }, this))]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 307,\n              columnNumber: 17\n            }, this), templatesLoading && /*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                marginTop: 6,\n                fontSize: 12,\n                color: '#6b7280'\n              },\n              children: \"Buscando templates\\u2026\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 321,\n              columnNumber: 19\n            }, this), templatesError && /*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                marginTop: 6,\n                fontSize: 12,\n                color: '#ef4444'\n              },\n              children: templatesError\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 326,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 305,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              style: {\n                fontSize: 12,\n                color: '#6b7280'\n              },\n              children: \"Preview\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 334,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                marginTop: 6,\n                padding: 10,\n                border: '1px solid #e5e7eb',\n                borderRadius: 6,\n                background: '#f8fafc',\n                minHeight: 100,\n                whiteSpace: 'pre-wrap',\n                fontFamily: 'ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace',\n                fontSize: 12,\n                color: '#111827'\n              },\n              children: selectedTemplate ? selectedTemplate.body || '(sem corpo)' : 'Selecione um template para visualizar o preview.'\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 335,\n              columnNumber: 17\n            }, this), (selectedTemplate === null || selectedTemplate === void 0 ? void 0 : selectedTemplate.type) && /*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                marginTop: 6,\n                fontSize: 12,\n                color: '#6b7280'\n              },\n              children: [\"Tipo: \", /*#__PURE__*/_jsxDEV(\"strong\", {\n                children: selectedTemplate.type\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 355,\n                columnNumber: 27\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 354,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 333,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 280,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 253,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 224,\n    columnNumber: 5\n  }, this);\n}\n_s(JourneyBuilder, \"wqRoUfyQqaSItjlWZfgf5O/ktR8=\");\n_c = JourneyBuilder;\nvar _c;\n$RefreshReg$(_c, \"JourneyBuilder\");","map":{"version":3,"names":["React","useCallback","useEffect","useMemo","useState","ReactFlow","addEdge","Background","Controls","MiniMap","applyNodeChanges","applyEdgeChanges","jsxDEV","_jsxDEV","Fragment","_Fragment","STORAGE_KEY","CURRENT_KEY","sanitizeNodes","list","filter","Boolean","map","n","idx","_n$position","_n$position2","_n$id","x","Number","position","y","id","String","type","data","label","isFinite","draggable","sanitizeEdges","e","_e$id","source","target","animated","loadFlows","raw","localStorage","getItem","arr","JSON","parse","Array","isArray","f","nodes","edges","saveFlows","flows","safe","setItem","stringify","JourneyBuilder","_s","_selectedNode$data2","_selectedNode$data3","setFlows","flowId","setFlowId","_list$","stored","ok","some","currentFlow","find","setNodes","setEdges","selectedNodeId","setSelectedNodeId","templates","setTemplates","templatesLoading","setTemplatesLoading","templatesError","setTemplatesError","mounted","fetch","then","r","json","contents","t","firstType","types","Object","values","sid","friendlyName","friendly_name","body","catch","err","message","finally","onNodesChange","changes","nds","onEdgesChange","eds","onConnect","connection","Date","now","onNodeClick","_","node","selectedNode","updateSelectedNodeData","patch","nid","addNode","baseX","length","baseY","Math","floor","newNode","saveCurrentFlow","updated","persisted","selectedTemplate","_selectedNode$data","templateSid","children","fileName","_jsxFileName","lineNumber","columnNumber","style","color","display","gap","alignItems","marginBottom","fontSize","value","onChange","marginLeft","padding","name","onClick","gridTemplateColumns","minHeight","border","borderRadius","overflow","background","fitView","size","margin","width","marginTop","placeholder","disabled","whiteSpace","fontFamily","_c","$RefreshReg$"],"sources":["/Users/gustsantos/Desktop/initucastt/frontend/src/pages/JourneyBuilder.jsx"],"sourcesContent":["// frontend/src/pages/JourneyBuilder.jsx\nimport React, { useCallback, useEffect, useMemo, useState } from 'react';\nimport ReactFlow, {\n  addEdge,\n  Background,\n  Controls,\n  MiniMap,\n  applyNodeChanges,\n  applyEdgeChanges,\n} from 'reactflow';\nimport 'reactflow/dist/style.css';\n\nconst STORAGE_KEY = 'flows_v1';\nconst CURRENT_KEY = 'flows_current';\n\n// ---------- Helpers (iguais/compatíveis com os da JourneysPage) ----------\nconst sanitizeNodes = (list) =>\n  (list || [])\n    .filter(Boolean)\n    .map((n, idx) => {\n      const x = Number(n?.position?.x);\n      const y = Number(n?.position?.y);\n      return {\n        id: String(n?.id ?? `n_${idx}`),\n        type: n?.type || 'default',\n        data: n?.data || { label: '' },\n        position: Number.isFinite(x) && Number.isFinite(y) ? { x, y } : { x: 120 + idx * 60, y: 120 },\n        draggable: true,\n      };\n    });\n\nconst sanitizeEdges = (list) =>\n  (list || [])\n    .filter(Boolean)\n    .map((e, idx) => ({\n      id: String(e?.id ?? `e_${idx}`),\n      source: String(e?.source),\n      target: String(e?.target),\n      label: e?.label,\n      animated: !!e?.animated,\n    }));\n\nfunction loadFlows() {\n  try {\n    const raw = localStorage.getItem(STORAGE_KEY);\n    const arr = raw ? JSON.parse(raw) : [];\n    if (!Array.isArray(arr)) return [];\n    return arr.map((f) => ({\n      ...f,\n      nodes: sanitizeNodes(f.nodes),\n      edges: sanitizeEdges(f.edges),\n    }));\n  } catch {\n    return [];\n  }\n}\n\nfunction saveFlows(flows) {\n  const safe = (flows || []).map((f) => ({\n    ...f,\n    nodes: sanitizeNodes(f.nodes),\n    edges: sanitizeEdges(f.edges),\n  }));\n  localStorage.setItem(STORAGE_KEY, JSON.stringify(safe));\n  return safe;\n}\n// -----------------------------------------------------------------------\n\nexport default function JourneyBuilder() {\n  // carrega lista de flows\n  const [flows, setFlows] = useState(() => loadFlows());\n\n  // <<< Alteração opcional solicitada: respeitar flows_current >>>\n  const [flowId, setFlowId] = useState(() => {\n    const stored = localStorage.getItem(CURRENT_KEY);\n    const list = loadFlows();\n    const ok = stored && list.some((f) => f.id === stored);\n    return ok ? stored : (list[0]?.id || '');\n  });\n\n  const currentFlow = useMemo(\n    () => flows.find((f) => f.id === flowId),\n    [flows, flowId]\n  );\n\n  const [nodes, setNodes] = useState(() => sanitizeNodes(currentFlow?.nodes || []));\n  const [edges, setEdges] = useState(() => sanitizeEdges(currentFlow?.edges || []));\n  const [selectedNodeId, setSelectedNodeId] = useState(null);\n\n  // --------- Twilio Templates (para o painel de Template/Preview) ---------\n  const [templates, setTemplates] = useState([]);\n  const [templatesLoading, setTemplatesLoading] = useState(false);\n  const [templatesError, setTemplatesError] = useState(null);\n\n  useEffect(() => {\n    let mounted = true;\n    setTemplatesLoading(true);\n    fetch('/api/templates/list')\n      .then((r) => r.json())\n      .then((data) => {\n        if (!mounted) return;\n        // normaliza: sid, friendly_name, body (pega o primeiro type)\n        const list = (data?.contents || []).map((t) => {\n          const firstType = t?.types ? Object.values(t.types)[0] : null;\n          return {\n            sid: t?.sid,\n            friendlyName: t?.friendly_name || t?.friendlyName || t?.sid,\n            body: firstType?.body || '',\n            type: firstType?.type || '',\n          };\n        });\n        setTemplates(list);\n        setTemplatesError(null);\n      })\n      .catch((err) => setTemplatesError(err?.message || 'Erro ao buscar templates'))\n      .finally(() => setTemplatesLoading(false));\n    return () => {\n      mounted = false;\n    };\n  }, []);\n  // -----------------------------------------------------------------------\n\n  // quando troca o flow selecionado\n  useEffect(() => {\n    const f = flows.find((x) => x.id === flowId);\n    setNodes(sanitizeNodes(f?.nodes || []));\n    setEdges(sanitizeEdges(f?.edges || []));\n    setSelectedNodeId(null);\n    if (flowId) localStorage.setItem(CURRENT_KEY, flowId);\n  }, [flowId, flows]);\n\n  // aplica mudanças de posição/seleção de nodes\n  const onNodesChange = useCallback(\n    (changes) => {\n      setNodes((nds) => sanitizeNodes(applyNodeChanges(changes, nds)));\n    },\n    []\n  );\n\n  // aplica mudanças de edges\n  const onEdgesChange = useCallback(\n    (changes) => {\n      setEdges((eds) => sanitizeEdges(applyEdgeChanges(changes, eds)));\n    },\n    []\n  );\n\n  // cria ligação entre nós\n  const onConnect = useCallback(\n    (connection) => {\n      setEdges((eds) =>\n        sanitizeEdges(addEdge({ ...connection, id: `e_${Date.now()}` }, eds))\n      );\n    },\n    []\n  );\n\n  // clique em nó para editar propriedades\n  const onNodeClick = useCallback((_, node) => {\n    setSelectedNodeId(node?.id || null);\n  }, []);\n\n  const selectedNode = useMemo(\n    () => nodes.find((n) => n.id === selectedNodeId),\n    [nodes, selectedNodeId]\n  );\n\n  // editar data do nó (label, templateSid etc)\n  const updateSelectedNodeData = (patch) => {\n    if (!selectedNode) return;\n    const nid = selectedNode.id;\n    setNodes((nds) =>\n      sanitizeNodes(\n        nds.map((n) =>\n          n.id === nid ? { ...n, data: { ...n.data, ...patch } } : n\n        )\n      )\n    );\n  };\n\n  // adicionar um nó simples (conveniência)\n  const addNode = () => {\n    const id = `n_${Date.now()}`;\n    const baseX = 120 + (nodes.length % 5) * 140;\n    const baseY = 120 + Math.floor(nodes.length / 5) * 120;\n    const newNode = {\n      id,\n      type: 'default',\n      position: { x: baseX, y: baseY },\n      data: { label: 'Step' },\n    };\n    setNodes((nds) => sanitizeNodes([...nds, newNode]));\n  };\n\n  const saveCurrentFlow = () => {\n    if (!currentFlow) return;\n    const updated = flows.map((f) =>\n      f.id === currentFlow.id\n        ? { ...f, nodes: sanitizeNodes(nodes), edges: sanitizeEdges(edges) }\n        : f\n    );\n    const persisted = saveFlows(updated);\n    setFlows(persisted);\n  };\n\n  // painel de preview do template\n  const selectedTemplate = useMemo(() => {\n    const sid = selectedNode?.data?.templateSid;\n    return templates.find((t) => t.sid === sid);\n  }, [selectedNode, templates]);\n\n  if (!flows.length) {\n    return (\n      <div>\n        <h2>Journey Builder (MVP)</h2>\n        <p style={{ color: '#6b7280' }}>\n          Nenhum flow encontrado. Crie um em <strong>/journeys</strong>.\n        </p>\n      </div>\n    );\n  }\n\n  return (\n    <div>\n      <h2>Journey Builder (MVP)</h2>\n\n      {/* Barra superior */}\n      <div style={{ display: 'flex', gap: 8, alignItems: 'center', marginBottom: 12 }}>\n        <div>\n          <label style={{ fontSize: 12, color: '#6b7280' }}>Flow</label>\n          <select\n            value={flowId}\n            onChange={(e) => setFlowId(e.target.value)}\n            style={{ marginLeft: 8, padding: 6 }}\n          >\n            {flows.map((f) => (\n              <option key={f.id} value={f.id}>\n                {f.name || f.id} ({f.id})\n              </option>\n            ))}\n          </select>\n        </div>\n        <button onClick={addNode}>+ Add Node</button>\n        <button onClick={saveCurrentFlow}>Salvar Fluxo</button>\n        {selectedNode && (\n          <span style={{ marginLeft: 'auto', fontSize: 12, color: '#6b7280' }}>\n            Nó selecionado: <strong>{selectedNode.id}</strong>\n          </span>\n        )}\n      </div>\n\n      {/* Layout principal: canvas + painel lateral */}\n      <div style={{ display: 'grid', gridTemplateColumns: '1fr 340px', gap: 16, minHeight: 560 }}>\n        {/* Canvas do ReactFlow */}\n        <div\n          style={{\n            border: '1px solid #e5e7eb',\n            borderRadius: 8,\n            overflow: 'hidden',\n            background: '#fff',\n            minHeight: 560,\n          }}\n        >\n          <ReactFlow\n            nodes={nodes}\n            edges={edges}\n            onNodesChange={onNodesChange}\n            onEdgesChange={onEdgesChange}\n            onConnect={onConnect}\n            onNodeClick={onNodeClick}\n            fitView\n          >\n            <MiniMap />\n            <Controls />\n            <Background gap={16} size={1} />\n          </ReactFlow>\n        </div>\n\n        {/* Painel lateral: propriedades do nó + template */}\n        <div\n          style={{\n            border: '1px solid #e5e7eb',\n            borderRadius: 8,\n            padding: 12,\n            background: '#fff',\n          }}\n        >\n          <h4 style={{ margin: '4px 0 12px' }}>Propriedades do Nó</h4>\n          {!selectedNode ? (\n            <div style={{ color: '#6b7280' }}>Selecione um nó no canvas.</div>\n          ) : (\n            <>\n              {/* Label do nó */}\n              <div style={{ marginBottom: 12 }}>\n                <label style={{ fontSize: 12, color: '#6b7280' }}>Label</label>\n                <input\n                  value={selectedNode?.data?.label || ''}\n                  onChange={(e) => updateSelectedNodeData({ label: e.target.value })}\n                  style={{ width: '100%', padding: 8, marginTop: 6 }}\n                  placeholder=\"Ex.: Send Welcome Message\"\n                />\n              </div>\n\n              {/* Template selector */}\n              <div style={{ marginBottom: 12 }}>\n                <label style={{ fontSize: 12, color: '#6b7280' }}>Template (Twilio)</label>\n                <select\n                  value={selectedNode?.data?.templateSid || ''}\n                  onChange={(e) => updateSelectedNodeData({ templateSid: e.target.value })}\n                  style={{ width: '100%', padding: 8, marginTop: 6 }}\n                  disabled={templatesLoading || !!templatesError}\n                >\n                  <option value=\"\">— selecione —</option>\n                  {templates.map((t) => (\n                    <option key={t.sid} value={t.sid}>\n                      {t.friendlyName}\n                    </option>\n                  ))}\n                </select>\n                {templatesLoading && (\n                  <div style={{ marginTop: 6, fontSize: 12, color: '#6b7280' }}>\n                    Buscando templates…\n                  </div>\n                )}\n                {templatesError && (\n                  <div style={{ marginTop: 6, fontSize: 12, color: '#ef4444' }}>\n                    {templatesError}\n                  </div>\n                )}\n              </div>\n\n              {/* Preview do template escolhido */}\n              <div>\n                <label style={{ fontSize: 12, color: '#6b7280' }}>Preview</label>\n                <div\n                  style={{\n                    marginTop: 6,\n                    padding: 10,\n                    border: '1px solid #e5e7eb',\n                    borderRadius: 6,\n                    background: '#f8fafc',\n                    minHeight: 100,\n                    whiteSpace: 'pre-wrap',\n                    fontFamily: 'ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace',\n                    fontSize: 12,\n                    color: '#111827',\n                  }}\n                >\n                  {selectedTemplate\n                    ? selectedTemplate.body || '(sem corpo)'\n                    : 'Selecione um template para visualizar o preview.'}\n                </div>\n                {selectedTemplate?.type && (\n                  <div style={{ marginTop: 6, fontSize: 12, color: '#6b7280' }}>\n                    Tipo: <strong>{selectedTemplate.type}</strong>\n                  </div>\n                )}\n              </div>\n            </>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"mappings":";;AAAA;AACA,OAAOA,KAAK,IAAIC,WAAW,EAAEC,SAAS,EAAEC,OAAO,EAAEC,QAAQ,QAAQ,OAAO;AACxE,OAAOC,SAAS,IACdC,OAAO,EACPC,UAAU,EACVC,QAAQ,EACRC,OAAO,EACPC,gBAAgB,EAChBC,gBAAgB,QACX,WAAW;AAClB,OAAO,0BAA0B;AAAC,SAAAC,MAAA,IAAAC,OAAA,EAAAC,QAAA,IAAAC,SAAA;AAElC,MAAMC,WAAW,GAAG,UAAU;AAC9B,MAAMC,WAAW,GAAG,eAAe;;AAEnC;AACA,MAAMC,aAAa,GAAIC,IAAI,IACzB,CAACA,IAAI,IAAI,EAAE,EACRC,MAAM,CAACC,OAAO,CAAC,CACfC,GAAG,CAAC,CAACC,CAAC,EAAEC,GAAG,KAAK;EAAA,IAAAC,WAAA,EAAAC,YAAA,EAAAC,KAAA;EACf,MAAMC,CAAC,GAAGC,MAAM,CAACN,CAAC,aAADA,CAAC,wBAAAE,WAAA,GAADF,CAAC,CAAEO,QAAQ,cAAAL,WAAA,uBAAXA,WAAA,CAAaG,CAAC,CAAC;EAChC,MAAMG,CAAC,GAAGF,MAAM,CAACN,CAAC,aAADA,CAAC,wBAAAG,YAAA,GAADH,CAAC,CAAEO,QAAQ,cAAAJ,YAAA,uBAAXA,YAAA,CAAaK,CAAC,CAAC;EAChC,OAAO;IACLC,EAAE,EAAEC,MAAM,EAAAN,KAAA,GAACJ,CAAC,aAADA,CAAC,uBAADA,CAAC,CAAES,EAAE,cAAAL,KAAA,cAAAA,KAAA,GAAI,KAAKH,GAAG,EAAE,CAAC;IAC/BU,IAAI,EAAE,CAAAX,CAAC,aAADA,CAAC,uBAADA,CAAC,CAAEW,IAAI,KAAI,SAAS;IAC1BC,IAAI,EAAE,CAAAZ,CAAC,aAADA,CAAC,uBAADA,CAAC,CAAEY,IAAI,KAAI;MAAEC,KAAK,EAAE;IAAG,CAAC;IAC9BN,QAAQ,EAAED,MAAM,CAACQ,QAAQ,CAACT,CAAC,CAAC,IAAIC,MAAM,CAACQ,QAAQ,CAACN,CAAC,CAAC,GAAG;MAAEH,CAAC;MAAEG;IAAE,CAAC,GAAG;MAAEH,CAAC,EAAE,GAAG,GAAGJ,GAAG,GAAG,EAAE;MAAEO,CAAC,EAAE;IAAI,CAAC;IAC7FO,SAAS,EAAE;EACb,CAAC;AACH,CAAC,CAAC;AAEN,MAAMC,aAAa,GAAIpB,IAAI,IACzB,CAACA,IAAI,IAAI,EAAE,EACRC,MAAM,CAACC,OAAO,CAAC,CACfC,GAAG,CAAC,CAACkB,CAAC,EAAEhB,GAAG;EAAA,IAAAiB,KAAA;EAAA,OAAM;IAChBT,EAAE,EAAEC,MAAM,EAAAQ,KAAA,GAACD,CAAC,aAADA,CAAC,uBAADA,CAAC,CAAER,EAAE,cAAAS,KAAA,cAAAA,KAAA,GAAI,KAAKjB,GAAG,EAAE,CAAC;IAC/BkB,MAAM,EAAET,MAAM,CAACO,CAAC,aAADA,CAAC,uBAADA,CAAC,CAAEE,MAAM,CAAC;IACzBC,MAAM,EAAEV,MAAM,CAACO,CAAC,aAADA,CAAC,uBAADA,CAAC,CAAEG,MAAM,CAAC;IACzBP,KAAK,EAAEI,CAAC,aAADA,CAAC,uBAADA,CAAC,CAAEJ,KAAK;IACfQ,QAAQ,EAAE,CAAC,EAACJ,CAAC,aAADA,CAAC,eAADA,CAAC,CAAEI,QAAQ;EACzB,CAAC;AAAA,CAAC,CAAC;AAEP,SAASC,SAASA,CAAA,EAAG;EACnB,IAAI;IACF,MAAMC,GAAG,GAAGC,YAAY,CAACC,OAAO,CAAChC,WAAW,CAAC;IAC7C,MAAMiC,GAAG,GAAGH,GAAG,GAAGI,IAAI,CAACC,KAAK,CAACL,GAAG,CAAC,GAAG,EAAE;IACtC,IAAI,CAACM,KAAK,CAACC,OAAO,CAACJ,GAAG,CAAC,EAAE,OAAO,EAAE;IAClC,OAAOA,GAAG,CAAC3B,GAAG,CAAEgC,CAAC,KAAM;MACrB,GAAGA,CAAC;MACJC,KAAK,EAAErC,aAAa,CAACoC,CAAC,CAACC,KAAK,CAAC;MAC7BC,KAAK,EAAEjB,aAAa,CAACe,CAAC,CAACE,KAAK;IAC9B,CAAC,CAAC,CAAC;EACL,CAAC,CAAC,MAAM;IACN,OAAO,EAAE;EACX;AACF;AAEA,SAASC,SAASA,CAACC,KAAK,EAAE;EACxB,MAAMC,IAAI,GAAG,CAACD,KAAK,IAAI,EAAE,EAAEpC,GAAG,CAAEgC,CAAC,KAAM;IACrC,GAAGA,CAAC;IACJC,KAAK,EAAErC,aAAa,CAACoC,CAAC,CAACC,KAAK,CAAC;IAC7BC,KAAK,EAAEjB,aAAa,CAACe,CAAC,CAACE,KAAK;EAC9B,CAAC,CAAC,CAAC;EACHT,YAAY,CAACa,OAAO,CAAC5C,WAAW,EAAEkC,IAAI,CAACW,SAAS,CAACF,IAAI,CAAC,CAAC;EACvD,OAAOA,IAAI;AACb;AACA;;AAEA,eAAe,SAASG,cAAcA,CAAA,EAAG;EAAAC,EAAA;EAAA,IAAAC,mBAAA,EAAAC,mBAAA;EACvC;EACA,MAAM,CAACP,KAAK,EAAEQ,QAAQ,CAAC,GAAG9D,QAAQ,CAAC,MAAMyC,SAAS,CAAC,CAAC,CAAC;;EAErD;EACA,MAAM,CAACsB,MAAM,EAAEC,SAAS,CAAC,GAAGhE,QAAQ,CAAC,MAAM;IAAA,IAAAiE,MAAA;IACzC,MAAMC,MAAM,GAAGvB,YAAY,CAACC,OAAO,CAAC/B,WAAW,CAAC;IAChD,MAAME,IAAI,GAAG0B,SAAS,CAAC,CAAC;IACxB,MAAM0B,EAAE,GAAGD,MAAM,IAAInD,IAAI,CAACqD,IAAI,CAAElB,CAAC,IAAKA,CAAC,CAACtB,EAAE,KAAKsC,MAAM,CAAC;IACtD,OAAOC,EAAE,GAAGD,MAAM,GAAI,EAAAD,MAAA,GAAAlD,IAAI,CAAC,CAAC,CAAC,cAAAkD,MAAA,uBAAPA,MAAA,CAASrC,EAAE,KAAI,EAAG;EAC1C,CAAC,CAAC;EAEF,MAAMyC,WAAW,GAAGtE,OAAO,CACzB,MAAMuD,KAAK,CAACgB,IAAI,CAAEpB,CAAC,IAAKA,CAAC,CAACtB,EAAE,KAAKmC,MAAM,CAAC,EACxC,CAACT,KAAK,EAAES,MAAM,CAChB,CAAC;EAED,MAAM,CAACZ,KAAK,EAAEoB,QAAQ,CAAC,GAAGvE,QAAQ,CAAC,MAAMc,aAAa,CAAC,CAAAuD,WAAW,aAAXA,WAAW,uBAAXA,WAAW,CAAElB,KAAK,KAAI,EAAE,CAAC,CAAC;EACjF,MAAM,CAACC,KAAK,EAAEoB,QAAQ,CAAC,GAAGxE,QAAQ,CAAC,MAAMmC,aAAa,CAAC,CAAAkC,WAAW,aAAXA,WAAW,uBAAXA,WAAW,CAAEjB,KAAK,KAAI,EAAE,CAAC,CAAC;EACjF,MAAM,CAACqB,cAAc,EAAEC,iBAAiB,CAAC,GAAG1E,QAAQ,CAAC,IAAI,CAAC;;EAE1D;EACA,MAAM,CAAC2E,SAAS,EAAEC,YAAY,CAAC,GAAG5E,QAAQ,CAAC,EAAE,CAAC;EAC9C,MAAM,CAAC6E,gBAAgB,EAAEC,mBAAmB,CAAC,GAAG9E,QAAQ,CAAC,KAAK,CAAC;EAC/D,MAAM,CAAC+E,cAAc,EAAEC,iBAAiB,CAAC,GAAGhF,QAAQ,CAAC,IAAI,CAAC;EAE1DF,SAAS,CAAC,MAAM;IACd,IAAImF,OAAO,GAAG,IAAI;IAClBH,mBAAmB,CAAC,IAAI,CAAC;IACzBI,KAAK,CAAC,qBAAqB,CAAC,CACzBC,IAAI,CAAEC,CAAC,IAAKA,CAAC,CAACC,IAAI,CAAC,CAAC,CAAC,CACrBF,IAAI,CAAEpD,IAAI,IAAK;MACd,IAAI,CAACkD,OAAO,EAAE;MACd;MACA,MAAMlE,IAAI,GAAG,CAAC,CAAAgB,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAEuD,QAAQ,KAAI,EAAE,EAAEpE,GAAG,CAAEqE,CAAC,IAAK;QAC7C,MAAMC,SAAS,GAAGD,CAAC,aAADA,CAAC,eAADA,CAAC,CAAEE,KAAK,GAAGC,MAAM,CAACC,MAAM,CAACJ,CAAC,CAACE,KAAK,CAAC,CAAC,CAAC,CAAC,GAAG,IAAI;QAC7D,OAAO;UACLG,GAAG,EAAEL,CAAC,aAADA,CAAC,uBAADA,CAAC,CAAEK,GAAG;UACXC,YAAY,EAAE,CAAAN,CAAC,aAADA,CAAC,uBAADA,CAAC,CAAEO,aAAa,MAAIP,CAAC,aAADA,CAAC,uBAADA,CAAC,CAAEM,YAAY,MAAIN,CAAC,aAADA,CAAC,uBAADA,CAAC,CAAEK,GAAG;UAC3DG,IAAI,EAAE,CAAAP,SAAS,aAATA,SAAS,uBAATA,SAAS,CAAEO,IAAI,KAAI,EAAE;UAC3BjE,IAAI,EAAE,CAAA0D,SAAS,aAATA,SAAS,uBAATA,SAAS,CAAE1D,IAAI,KAAI;QAC3B,CAAC;MACH,CAAC,CAAC;MACF8C,YAAY,CAAC7D,IAAI,CAAC;MAClBiE,iBAAiB,CAAC,IAAI,CAAC;IACzB,CAAC,CAAC,CACDgB,KAAK,CAAEC,GAAG,IAAKjB,iBAAiB,CAAC,CAAAiB,GAAG,aAAHA,GAAG,uBAAHA,GAAG,CAAEC,OAAO,KAAI,0BAA0B,CAAC,CAAC,CAC7EC,OAAO,CAAC,MAAMrB,mBAAmB,CAAC,KAAK,CAAC,CAAC;IAC5C,OAAO,MAAM;MACXG,OAAO,GAAG,KAAK;IACjB,CAAC;EACH,CAAC,EAAE,EAAE,CAAC;EACN;;EAEA;EACAnF,SAAS,CAAC,MAAM;IACd,MAAMoD,CAAC,GAAGI,KAAK,CAACgB,IAAI,CAAE9C,CAAC,IAAKA,CAAC,CAACI,EAAE,KAAKmC,MAAM,CAAC;IAC5CQ,QAAQ,CAACzD,aAAa,CAAC,CAAAoC,CAAC,aAADA,CAAC,uBAADA,CAAC,CAAEC,KAAK,KAAI,EAAE,CAAC,CAAC;IACvCqB,QAAQ,CAACrC,aAAa,CAAC,CAAAe,CAAC,aAADA,CAAC,uBAADA,CAAC,CAAEE,KAAK,KAAI,EAAE,CAAC,CAAC;IACvCsB,iBAAiB,CAAC,IAAI,CAAC;IACvB,IAAIX,MAAM,EAAEpB,YAAY,CAACa,OAAO,CAAC3C,WAAW,EAAEkD,MAAM,CAAC;EACvD,CAAC,EAAE,CAACA,MAAM,EAAET,KAAK,CAAC,CAAC;;EAEnB;EACA,MAAM8C,aAAa,GAAGvG,WAAW,CAC9BwG,OAAO,IAAK;IACX9B,QAAQ,CAAE+B,GAAG,IAAKxF,aAAa,CAACR,gBAAgB,CAAC+F,OAAO,EAAEC,GAAG,CAAC,CAAC,CAAC;EAClE,CAAC,EACD,EACF,CAAC;;EAED;EACA,MAAMC,aAAa,GAAG1G,WAAW,CAC9BwG,OAAO,IAAK;IACX7B,QAAQ,CAAEgC,GAAG,IAAKrE,aAAa,CAAC5B,gBAAgB,CAAC8F,OAAO,EAAEG,GAAG,CAAC,CAAC,CAAC;EAClE,CAAC,EACD,EACF,CAAC;;EAED;EACA,MAAMC,SAAS,GAAG5G,WAAW,CAC1B6G,UAAU,IAAK;IACdlC,QAAQ,CAAEgC,GAAG,IACXrE,aAAa,CAACjC,OAAO,CAAC;MAAE,GAAGwG,UAAU;MAAE9E,EAAE,EAAE,KAAK+E,IAAI,CAACC,GAAG,CAAC,CAAC;IAAG,CAAC,EAAEJ,GAAG,CAAC,CACtE,CAAC;EACH,CAAC,EACD,EACF,CAAC;;EAED;EACA,MAAMK,WAAW,GAAGhH,WAAW,CAAC,CAACiH,CAAC,EAAEC,IAAI,KAAK;IAC3CrC,iBAAiB,CAAC,CAAAqC,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAEnF,EAAE,KAAI,IAAI,CAAC;EACrC,CAAC,EAAE,EAAE,CAAC;EAEN,MAAMoF,YAAY,GAAGjH,OAAO,CAC1B,MAAMoD,KAAK,CAACmB,IAAI,CAAEnD,CAAC,IAAKA,CAAC,CAACS,EAAE,KAAK6C,cAAc,CAAC,EAChD,CAACtB,KAAK,EAAEsB,cAAc,CACxB,CAAC;;EAED;EACA,MAAMwC,sBAAsB,GAAIC,KAAK,IAAK;IACxC,IAAI,CAACF,YAAY,EAAE;IACnB,MAAMG,GAAG,GAAGH,YAAY,CAACpF,EAAE;IAC3B2C,QAAQ,CAAE+B,GAAG,IACXxF,aAAa,CACXwF,GAAG,CAACpF,GAAG,CAAEC,CAAC,IACRA,CAAC,CAACS,EAAE,KAAKuF,GAAG,GAAG;MAAE,GAAGhG,CAAC;MAAEY,IAAI,EAAE;QAAE,GAAGZ,CAAC,CAACY,IAAI;QAAE,GAAGmF;MAAM;IAAE,CAAC,GAAG/F,CAC3D,CACF,CACF,CAAC;EACH,CAAC;;EAED;EACA,MAAMiG,OAAO,GAAGA,CAAA,KAAM;IACpB,MAAMxF,EAAE,GAAG,KAAK+E,IAAI,CAACC,GAAG,CAAC,CAAC,EAAE;IAC5B,MAAMS,KAAK,GAAG,GAAG,GAAIlE,KAAK,CAACmE,MAAM,GAAG,CAAC,GAAI,GAAG;IAC5C,MAAMC,KAAK,GAAG,GAAG,GAAGC,IAAI,CAACC,KAAK,CAACtE,KAAK,CAACmE,MAAM,GAAG,CAAC,CAAC,GAAG,GAAG;IACtD,MAAMI,OAAO,GAAG;MACd9F,EAAE;MACFE,IAAI,EAAE,SAAS;MACfJ,QAAQ,EAAE;QAAEF,CAAC,EAAE6F,KAAK;QAAE1F,CAAC,EAAE4F;MAAM,CAAC;MAChCxF,IAAI,EAAE;QAAEC,KAAK,EAAE;MAAO;IACxB,CAAC;IACDuC,QAAQ,CAAE+B,GAAG,IAAKxF,aAAa,CAAC,CAAC,GAAGwF,GAAG,EAAEoB,OAAO,CAAC,CAAC,CAAC;EACrD,CAAC;EAED,MAAMC,eAAe,GAAGA,CAAA,KAAM;IAC5B,IAAI,CAACtD,WAAW,EAAE;IAClB,MAAMuD,OAAO,GAAGtE,KAAK,CAACpC,GAAG,CAAEgC,CAAC,IAC1BA,CAAC,CAACtB,EAAE,KAAKyC,WAAW,CAACzC,EAAE,GACnB;MAAE,GAAGsB,CAAC;MAAEC,KAAK,EAAErC,aAAa,CAACqC,KAAK,CAAC;MAAEC,KAAK,EAAEjB,aAAa,CAACiB,KAAK;IAAE,CAAC,GAClEF,CACN,CAAC;IACD,MAAM2E,SAAS,GAAGxE,SAAS,CAACuE,OAAO,CAAC;IACpC9D,QAAQ,CAAC+D,SAAS,CAAC;EACrB,CAAC;;EAED;EACA,MAAMC,gBAAgB,GAAG/H,OAAO,CAAC,MAAM;IAAA,IAAAgI,kBAAA;IACrC,MAAMnC,GAAG,GAAGoB,YAAY,aAAZA,YAAY,wBAAAe,kBAAA,GAAZf,YAAY,CAAEjF,IAAI,cAAAgG,kBAAA,uBAAlBA,kBAAA,CAAoBC,WAAW;IAC3C,OAAOrD,SAAS,CAACL,IAAI,CAAEiB,CAAC,IAAKA,CAAC,CAACK,GAAG,KAAKA,GAAG,CAAC;EAC7C,CAAC,EAAE,CAACoB,YAAY,EAAErC,SAAS,CAAC,CAAC;EAE7B,IAAI,CAACrB,KAAK,CAACgE,MAAM,EAAE;IACjB,oBACE7G,OAAA;MAAAwH,QAAA,gBACExH,OAAA;QAAAwH,QAAA,EAAI;MAAqB;QAAAC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAI,CAAC,eAC9B5H,OAAA;QAAG6H,KAAK,EAAE;UAAEC,KAAK,EAAE;QAAU,CAAE;QAAAN,QAAA,GAAC,qCACK,eAAAxH,OAAA;UAAAwH,QAAA,EAAQ;QAAS;UAAAC,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAQ,CAAC,KAC/D;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAG,CAAC;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACD,CAAC;EAEV;EAEA,oBACE5H,OAAA;IAAAwH,QAAA,gBACExH,OAAA;MAAAwH,QAAA,EAAI;IAAqB;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAI,CAAC,eAG9B5H,OAAA;MAAK6H,KAAK,EAAE;QAAEE,OAAO,EAAE,MAAM;QAAEC,GAAG,EAAE,CAAC;QAAEC,UAAU,EAAE,QAAQ;QAAEC,YAAY,EAAE;MAAG,CAAE;MAAAV,QAAA,gBAC9ExH,OAAA;QAAAwH,QAAA,gBACExH,OAAA;UAAO6H,KAAK,EAAE;YAAEM,QAAQ,EAAE,EAAE;YAAEL,KAAK,EAAE;UAAU,CAAE;UAAAN,QAAA,EAAC;QAAI;UAAAC,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAO,CAAC,eAC9D5H,OAAA;UACEoI,KAAK,EAAE9E,MAAO;UACd+E,QAAQ,EAAG1G,CAAC,IAAK4B,SAAS,CAAC5B,CAAC,CAACG,MAAM,CAACsG,KAAK,CAAE;UAC3CP,KAAK,EAAE;YAAES,UAAU,EAAE,CAAC;YAAEC,OAAO,EAAE;UAAE,CAAE;UAAAf,QAAA,EAEpC3E,KAAK,CAACpC,GAAG,CAAEgC,CAAC,iBACXzC,OAAA;YAAmBoI,KAAK,EAAE3F,CAAC,CAACtB,EAAG;YAAAqG,QAAA,GAC5B/E,CAAC,CAAC+F,IAAI,IAAI/F,CAAC,CAACtB,EAAE,EAAC,IAAE,EAACsB,CAAC,CAACtB,EAAE,EAAC,GAC1B;UAAA,GAFasB,CAAC,CAACtB,EAAE;YAAAsG,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAET,CACT;QAAC;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACI,CAAC;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACN,CAAC,eACN5H,OAAA;QAAQyI,OAAO,EAAE9B,OAAQ;QAAAa,QAAA,EAAC;MAAU;QAAAC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAQ,CAAC,eAC7C5H,OAAA;QAAQyI,OAAO,EAAEvB,eAAgB;QAAAM,QAAA,EAAC;MAAY;QAAAC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAQ,CAAC,EACtDrB,YAAY,iBACXvG,OAAA;QAAM6H,KAAK,EAAE;UAAES,UAAU,EAAE,MAAM;UAAEH,QAAQ,EAAE,EAAE;UAAEL,KAAK,EAAE;QAAU,CAAE;QAAAN,QAAA,GAAC,qBACnD,eAAAxH,OAAA;UAAAwH,QAAA,EAASjB,YAAY,CAACpF;QAAE;UAAAsG,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAS,CAAC;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAC9C,CACP;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACE,CAAC,eAGN5H,OAAA;MAAK6H,KAAK,EAAE;QAAEE,OAAO,EAAE,MAAM;QAAEW,mBAAmB,EAAE,WAAW;QAAEV,GAAG,EAAE,EAAE;QAAEW,SAAS,EAAE;MAAI,CAAE;MAAAnB,QAAA,gBAEzFxH,OAAA;QACE6H,KAAK,EAAE;UACLe,MAAM,EAAE,mBAAmB;UAC3BC,YAAY,EAAE,CAAC;UACfC,QAAQ,EAAE,QAAQ;UAClBC,UAAU,EAAE,MAAM;UAClBJ,SAAS,EAAE;QACb,CAAE;QAAAnB,QAAA,eAEFxH,OAAA,CAACR,SAAS;UACRkD,KAAK,EAAEA,KAAM;UACbC,KAAK,EAAEA,KAAM;UACbgD,aAAa,EAAEA,aAAc;UAC7BG,aAAa,EAAEA,aAAc;UAC7BE,SAAS,EAAEA,SAAU;UACrBI,WAAW,EAAEA,WAAY;UACzB4C,OAAO;UAAAxB,QAAA,gBAEPxH,OAAA,CAACJ,OAAO;YAAA6H,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAE,CAAC,eACX5H,OAAA,CAACL,QAAQ;YAAA8H,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAE,CAAC,eACZ5H,OAAA,CAACN,UAAU;YAACsI,GAAG,EAAE,EAAG;YAACiB,IAAI,EAAE;UAAE;YAAAxB,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAE,CAAC;QAAA;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACvB;MAAC;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACT,CAAC,eAGN5H,OAAA;QACE6H,KAAK,EAAE;UACLe,MAAM,EAAE,mBAAmB;UAC3BC,YAAY,EAAE,CAAC;UACfN,OAAO,EAAE,EAAE;UACXQ,UAAU,EAAE;QACd,CAAE;QAAAvB,QAAA,gBAEFxH,OAAA;UAAI6H,KAAK,EAAE;YAAEqB,MAAM,EAAE;UAAa,CAAE;UAAA1B,QAAA,EAAC;QAAkB;UAAAC,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAI,CAAC,EAC3D,CAACrB,YAAY,gBACZvG,OAAA;UAAK6H,KAAK,EAAE;YAAEC,KAAK,EAAE;UAAU,CAAE;UAAAN,QAAA,EAAC;QAA0B;UAAAC,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAK,CAAC,gBAElE5H,OAAA,CAAAE,SAAA;UAAAsH,QAAA,gBAEExH,OAAA;YAAK6H,KAAK,EAAE;cAAEK,YAAY,EAAE;YAAG,CAAE;YAAAV,QAAA,gBAC/BxH,OAAA;cAAO6H,KAAK,EAAE;gBAAEM,QAAQ,EAAE,EAAE;gBAAEL,KAAK,EAAE;cAAU,CAAE;cAAAN,QAAA,EAAC;YAAK;cAAAC,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAO,CAAC,eAC/D5H,OAAA;cACEoI,KAAK,EAAE,CAAA7B,YAAY,aAAZA,YAAY,wBAAApD,mBAAA,GAAZoD,YAAY,CAAEjF,IAAI,cAAA6B,mBAAA,uBAAlBA,mBAAA,CAAoB5B,KAAK,KAAI,EAAG;cACvC8G,QAAQ,EAAG1G,CAAC,IAAK6E,sBAAsB,CAAC;gBAAEjF,KAAK,EAAEI,CAAC,CAACG,MAAM,CAACsG;cAAM,CAAC,CAAE;cACnEP,KAAK,EAAE;gBAAEsB,KAAK,EAAE,MAAM;gBAAEZ,OAAO,EAAE,CAAC;gBAAEa,SAAS,EAAE;cAAE,CAAE;cACnDC,WAAW,EAAC;YAA2B;cAAA5B,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OACxC,CAAC;UAAA;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACC,CAAC,eAGN5H,OAAA;YAAK6H,KAAK,EAAE;cAAEK,YAAY,EAAE;YAAG,CAAE;YAAAV,QAAA,gBAC/BxH,OAAA;cAAO6H,KAAK,EAAE;gBAAEM,QAAQ,EAAE,EAAE;gBAAEL,KAAK,EAAE;cAAU,CAAE;cAAAN,QAAA,EAAC;YAAiB;cAAAC,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAO,CAAC,eAC3E5H,OAAA;cACEoI,KAAK,EAAE,CAAA7B,YAAY,aAAZA,YAAY,wBAAAnD,mBAAA,GAAZmD,YAAY,CAAEjF,IAAI,cAAA8B,mBAAA,uBAAlBA,mBAAA,CAAoBmE,WAAW,KAAI,EAAG;cAC7Cc,QAAQ,EAAG1G,CAAC,IAAK6E,sBAAsB,CAAC;gBAAEe,WAAW,EAAE5F,CAAC,CAACG,MAAM,CAACsG;cAAM,CAAC,CAAE;cACzEP,KAAK,EAAE;gBAAEsB,KAAK,EAAE,MAAM;gBAAEZ,OAAO,EAAE,CAAC;gBAAEa,SAAS,EAAE;cAAE,CAAE;cACnDE,QAAQ,EAAElF,gBAAgB,IAAI,CAAC,CAACE,cAAe;cAAAkD,QAAA,gBAE/CxH,OAAA;gBAAQoI,KAAK,EAAC,EAAE;gBAAAZ,QAAA,EAAC;cAAa;gBAAAC,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAQ,CAAC,EACtC1D,SAAS,CAACzD,GAAG,CAAEqE,CAAC,iBACf9E,OAAA;gBAAoBoI,KAAK,EAAEtD,CAAC,CAACK,GAAI;gBAAAqC,QAAA,EAC9B1C,CAAC,CAACM;cAAY,GADJN,CAAC,CAACK,GAAG;gBAAAsC,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAEV,CACT,CAAC;YAAA;cAAAH,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OACI,CAAC,EACRxD,gBAAgB,iBACfpE,OAAA;cAAK6H,KAAK,EAAE;gBAAEuB,SAAS,EAAE,CAAC;gBAAEjB,QAAQ,EAAE,EAAE;gBAAEL,KAAK,EAAE;cAAU,CAAE;cAAAN,QAAA,EAAC;YAE9D;cAAAC,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAK,CACN,EACAtD,cAAc,iBACbtE,OAAA;cAAK6H,KAAK,EAAE;gBAAEuB,SAAS,EAAE,CAAC;gBAAEjB,QAAQ,EAAE,EAAE;gBAAEL,KAAK,EAAE;cAAU,CAAE;cAAAN,QAAA,EAC1DlD;YAAc;cAAAmD,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OACZ,CACN;UAAA;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACE,CAAC,eAGN5H,OAAA;YAAAwH,QAAA,gBACExH,OAAA;cAAO6H,KAAK,EAAE;gBAAEM,QAAQ,EAAE,EAAE;gBAAEL,KAAK,EAAE;cAAU,CAAE;cAAAN,QAAA,EAAC;YAAO;cAAAC,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAO,CAAC,eACjE5H,OAAA;cACE6H,KAAK,EAAE;gBACLuB,SAAS,EAAE,CAAC;gBACZb,OAAO,EAAE,EAAE;gBACXK,MAAM,EAAE,mBAAmB;gBAC3BC,YAAY,EAAE,CAAC;gBACfE,UAAU,EAAE,SAAS;gBACrBJ,SAAS,EAAE,GAAG;gBACdY,UAAU,EAAE,UAAU;gBACtBC,UAAU,EAAE,oGAAoG;gBAChHrB,QAAQ,EAAE,EAAE;gBACZL,KAAK,EAAE;cACT,CAAE;cAAAN,QAAA,EAEDH,gBAAgB,GACbA,gBAAgB,CAAC/B,IAAI,IAAI,aAAa,GACtC;YAAkD;cAAAmC,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OACnD,CAAC,EACL,CAAAP,gBAAgB,aAAhBA,gBAAgB,uBAAhBA,gBAAgB,CAAEhG,IAAI,kBACrBrB,OAAA;cAAK6H,KAAK,EAAE;gBAAEuB,SAAS,EAAE,CAAC;gBAAEjB,QAAQ,EAAE,EAAE;gBAAEL,KAAK,EAAE;cAAU,CAAE;cAAAN,QAAA,GAAC,QACtD,eAAAxH,OAAA;gBAAAwH,QAAA,EAASH,gBAAgB,CAAChG;cAAI;gBAAAoG,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAS,CAAC;YAAA;cAAAH,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAC3C,CACN;UAAA;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACE,CAAC;QAAA,eACN,CACH;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACE,CAAC;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACH,CAAC;EAAA;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACH,CAAC;AAEV;AAAC1E,EAAA,CAxSuBD,cAAc;AAAAwG,EAAA,GAAdxG,cAAc;AAAA,IAAAwG,EAAA;AAAAC,YAAA,CAAAD,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}