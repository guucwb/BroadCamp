{"ast":null,"code":"var _jsxFileName = \"/Users/gustsantos/Desktop/initucastt/frontend/src/pages/JourneyBuilder.jsx\",\n  _s = $RefreshSig$();\n// frontend/src/pages/JourneyBuilder.jsx\nimport React, { useCallback, useEffect, useMemo, useState } from 'react';\nimport ReactFlow, { addEdge, applyEdgeChanges, applyNodeChanges, Background, Controls, MiniMap, Position, Handle } from 'reactflow';\nimport 'reactflow/dist/style.css';\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst STORAGE_KEY = 'flows_v1';\nconst CURRENT_KEY = 'flows_current';\n\n/* ---------- Utils de persistência/sanitização ---------- */\nconst sanitizeNodes = list => (list || []).filter(Boolean).map((n, idx) => {\n  var _n$position, _n$position2, _n$id;\n  const x = Number(n === null || n === void 0 ? void 0 : (_n$position = n.position) === null || _n$position === void 0 ? void 0 : _n$position.x);\n  const y = Number(n === null || n === void 0 ? void 0 : (_n$position2 = n.position) === null || _n$position2 === void 0 ? void 0 : _n$position2.y);\n  return {\n    id: String((_n$id = n === null || n === void 0 ? void 0 : n.id) !== null && _n$id !== void 0 ? _n$id : `n_${idx}`),\n    type: (n === null || n === void 0 ? void 0 : n.type) || 'step',\n    data: (n === null || n === void 0 ? void 0 : n.data) || {\n      label: 'Step'\n    },\n    position: Number.isFinite(x) && Number.isFinite(y) ? {\n      x,\n      y\n    } : {\n      x: 160 + idx % 4 * 200,\n      y: 140 + Math.floor(idx / 4) * 140\n    },\n    draggable: true,\n    selectable: true\n  };\n});\nconst sanitizeEdges = list => (list || []).filter(Boolean).map((e, idx) => {\n  var _e$id;\n  return {\n    id: String((_e$id = e === null || e === void 0 ? void 0 : e.id) !== null && _e$id !== void 0 ? _e$id : `e_${idx}`),\n    source: String(e === null || e === void 0 ? void 0 : e.source),\n    target: String(e === null || e === void 0 ? void 0 : e.target),\n    label: e === null || e === void 0 ? void 0 : e.label,\n    animated: !!(e !== null && e !== void 0 && e.animated),\n    selectable: true\n  };\n});\nfunction loadFlows() {\n  try {\n    const raw = localStorage.getItem(STORAGE_KEY);\n    const arr = raw ? JSON.parse(raw) : [];\n    if (!Array.isArray(arr)) return [];\n    return arr.map(f => ({\n      ...f,\n      nodes: sanitizeNodes(f.nodes),\n      edges: sanitizeEdges(f.edges)\n    }));\n  } catch {\n    return [];\n  }\n}\nfunction saveFlows(flows) {\n  const safe = (flows || []).map(f => ({\n    ...f,\n    nodes: sanitizeNodes(f.nodes),\n    edges: sanitizeEdges(f.edges)\n  }));\n  localStorage.setItem(STORAGE_KEY, JSON.stringify(safe));\n  return safe;\n}\n/* ------------------------------------------------------- */\n\n/* ---------- Node custom com Handles ---------- */\nfunction StepNode({\n  data\n}) {\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      padding: 10,\n      border: '1px solid #e5e7eb',\n      borderRadius: 8,\n      background: '#fff',\n      minWidth: 180,\n      boxShadow: '0 1px 2px rgba(0,0,0,0.06)'\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        fontWeight: 700,\n        fontSize: 14,\n        marginBottom: 4\n      },\n      children: (data === null || data === void 0 ? void 0 : data.label) || 'Step'\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 76,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        fontSize: 12,\n        color: '#6b7280'\n      },\n      children: data !== null && data !== void 0 && data.templateName ? `Template: ${data.templateName}` : 'Template: —'\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 79,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Handle, {\n      type: \"target\",\n      position: Position.Left,\n      style: {\n        background: '#94a3b8'\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 83,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Handle, {\n      type: \"source\",\n      position: Position.Right,\n      style: {\n        background: '#3b82f6'\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 84,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Handle, {\n      type: \"source\",\n      position: Position.Bottom,\n      id: \"out-bottom\",\n      style: {\n        background: '#3b82f6'\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 86,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Handle, {\n      type: \"target\",\n      position: Position.Top,\n      id: \"in-top\",\n      style: {\n        background: '#94a3b8'\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 87,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 72,\n    columnNumber: 5\n  }, this);\n}\n_c = StepNode;\nconst nodeTypes = {\n  step: StepNode\n};\n/* ------------------------------------------------------- */\n\nexport default function JourneyBuilder() {\n  _s();\n  var _selectedNode$data2, _selectedNode$data3, _selectedNode$data4, _selectedNode$data5;\n  const [flows, setFlows] = useState(() => loadFlows());\n\n  // abre o flow corrente (flows_current) se existir\n  const [flowId, setFlowId] = useState(() => {\n    var _list$;\n    const current = localStorage.getItem(CURRENT_KEY);\n    const list = loadFlows();\n    return current && list.some(f => f.id === current) ? current : ((_list$ = list[0]) === null || _list$ === void 0 ? void 0 : _list$.id) || '';\n  });\n  const currentFlow = useMemo(() => flows.find(f => f.id === flowId), [flows, flowId]);\n  const [nodes, setNodes] = useState(() => sanitizeNodes((currentFlow === null || currentFlow === void 0 ? void 0 : currentFlow.nodes) || []));\n  const [edges, setEdges] = useState(() => sanitizeEdges((currentFlow === null || currentFlow === void 0 ? void 0 : currentFlow.edges) || []));\n  const [selectedNodeId, setSelectedNodeId] = useState(null);\n  const [selection, setSelection] = useState({\n    nodes: [],\n    edges: []\n  });\n\n  // Templates Twilio\n  const [templates, setTemplates] = useState([]);\n  const [templatesLoading, setTemplatesLoading] = useState(false);\n  const [templatesError, setTemplatesError] = useState(null);\n\n  // carrega templates ao montar\n  useEffect(() => {\n    let mounted = true;\n    setTemplatesLoading(true);\n    fetch('/api/templates/list').then(r => r.json()).then(data => {\n      if (!mounted) return;\n      const list = ((data === null || data === void 0 ? void 0 : data.contents) || []).map(t => {\n        const firstType = t !== null && t !== void 0 && t.types ? Object.values(t.types)[0] : null;\n        return {\n          sid: t === null || t === void 0 ? void 0 : t.sid,\n          friendlyName: (t === null || t === void 0 ? void 0 : t.friendly_name) || (t === null || t === void 0 ? void 0 : t.friendlyName) || (t === null || t === void 0 ? void 0 : t.sid),\n          body: (firstType === null || firstType === void 0 ? void 0 : firstType.body) || '',\n          type: (firstType === null || firstType === void 0 ? void 0 : firstType.type) || ''\n        };\n      });\n      setTemplates(list);\n      setTemplatesError(null);\n    }).catch(err => setTemplatesError((err === null || err === void 0 ? void 0 : err.message) || 'Erro ao buscar templates')).finally(() => setTemplatesLoading(false));\n    return () => {\n      mounted = false;\n    };\n  }, []);\n\n  // troca de flow\n  useEffect(() => {\n    const f = flows.find(x => x.id === flowId);\n    setNodes(sanitizeNodes((f === null || f === void 0 ? void 0 : f.nodes) || []));\n    setEdges(sanitizeEdges((f === null || f === void 0 ? void 0 : f.edges) || []));\n    setSelectedNodeId(null);\n    if (flowId) localStorage.setItem(CURRENT_KEY, flowId);\n  }, [flowId, flows]);\n  const onNodesChange = useCallback(changes => setNodes(nds => sanitizeNodes(applyNodeChanges(changes, nds))), []);\n  const onEdgesChange = useCallback(changes => setEdges(eds => sanitizeEdges(applyEdgeChanges(changes, eds))), []);\n  const onConnect = useCallback(connection => setEdges(eds => sanitizeEdges(addEdge({\n    ...connection,\n    id: `e_${Date.now()}`\n  }, eds))), []);\n  const onNodeClick = useCallback((_, node) => {\n    setSelectedNodeId((node === null || node === void 0 ? void 0 : node.id) || null);\n  }, []);\n  const onSelectionChange = useCallback(({\n    nodes: ns,\n    edges: es\n  }) => {\n    setSelection({\n      nodes: ns || [],\n      edges: es || []\n    });\n  }, []);\n  const selectedNode = useMemo(() => nodes.find(n => n.id === selectedNodeId), [nodes, selectedNodeId]);\n  const updateSelectedNodeData = patch => {\n    if (!selectedNode) return;\n    const nid = selectedNode.id;\n    setNodes(nds => sanitizeNodes(nds.map(n => n.id === nid ? {\n      ...n,\n      data: {\n        ...n.data,\n        ...patch\n      }\n    } : n)));\n  };\n\n  // Delete com teclado (nós/arestas)\n  useEffect(() => {\n    const h = e => {\n      if ((e.key === 'Delete' || e.key === 'Backspace') && !/input|textarea|select/i.test(e.target.tagName)) {\n        e.preventDefault();\n        deleteSelected();\n      }\n    };\n    document.addEventListener('keydown', h);\n    return () => document.removeEventListener('keydown', h);\n  }, [selection]);\n  const deleteSelected = () => {\n    if (!selection.nodes.length && !selection.edges.length) return;\n    const nodeIds = new Set(selection.nodes.map(n => n.id));\n    const edgeIds = new Set(selection.edges.map(e => e.id));\n    setNodes(nds => nds.filter(n => !nodeIds.has(n.id)));\n    setEdges(eds => eds.filter(e => !edgeIds.has(e.id) && !nodeIds.has(e.source) && !nodeIds.has(e.target)));\n    if (selectedNodeId && nodeIds.has(selectedNodeId)) {\n      setSelectedNodeId(null);\n    }\n  };\n\n  // Ações topo\n  const addNode = () => {\n    const id = `n_${Date.now()}`;\n    const baseX = 160 + nodes.length % 4 * 200;\n    const baseY = 140 + Math.floor(nodes.length / 4) * 140;\n    setNodes(nds => sanitizeNodes([...nds, {\n      id,\n      type: 'step',\n      position: {\n        x: baseX,\n        y: baseY\n      },\n      data: {\n        label: 'Step'\n      }\n    }]));\n  };\n  const saveCurrentFlow = () => {\n    if (!currentFlow) return;\n    const updated = flows.map(f => f.id === currentFlow.id ? {\n      ...f,\n      nodes: sanitizeNodes(nodes),\n      edges: sanitizeEdges(edges)\n    } : f);\n    setFlows(saveFlows(updated));\n  };\n  const newFlow = () => {\n    const id = `flow_${Date.now()}`;\n    const f = {\n      id,\n      name: 'Novo Flow',\n      nodes: [],\n      edges: []\n    };\n    const updated = [...flows, f];\n    setFlows(saveFlows(updated));\n    setFlowId(id);\n  };\n  const duplicateFlow = () => {\n    if (!currentFlow) return;\n    const id = `copy_${Date.now()}`;\n    const copy = {\n      ...currentFlow,\n      id,\n      name: `${currentFlow.name || currentFlow.id} (copy)`,\n      nodes: sanitizeNodes(nodes),\n      edges: sanitizeEdges(edges)\n    };\n    const updated = [...flows, copy];\n    setFlows(saveFlows(updated));\n    setFlowId(id);\n  };\n  const goToList = () => {\n    // simples navegação\n    window.location.href = '/journeys';\n  };\n  const selectedTemplate = useMemo(() => {\n    var _selectedNode$data;\n    const sid = selectedNode === null || selectedNode === void 0 ? void 0 : (_selectedNode$data = selectedNode.data) === null || _selectedNode$data === void 0 ? void 0 : _selectedNode$data.templateSid;\n    return templates.find(t => t.sid === sid);\n  }, [selectedNode, templates]);\n  if (!flows.length) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        children: \"Journey Builder (MVP)\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 274,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        style: {\n          color: '#6b7280'\n        },\n        children: [\"Nenhum flow cadastrado. Clique em \", /*#__PURE__*/_jsxDEV(\"b\", {\n          children: \"Novo\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 276,\n          columnNumber: 45\n        }, this), \" para criar.\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 275,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: newFlow,\n        children: \"+ Novo\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 278,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 273,\n      columnNumber: 7\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      children: \"Journey Builder (MVP)\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 285,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        display: 'flex',\n        gap: 8,\n        alignItems: 'center',\n        marginBottom: 12,\n        flexWrap: 'wrap'\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          style: {\n            fontSize: 12,\n            color: '#6b7280'\n          },\n          children: \"Flow\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 290,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n          value: flowId,\n          onChange: e => setFlowId(e.target.value),\n          style: {\n            marginLeft: 8,\n            padding: 6\n          },\n          children: flows.map(f => /*#__PURE__*/_jsxDEV(\"option\", {\n            value: f.id,\n            children: [f.name || f.id, \" (\", f.id, \")\"]\n          }, f.id, true, {\n            fileName: _jsxFileName,\n            lineNumber: 297,\n            columnNumber: 15\n          }, this))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 291,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 289,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: newFlow,\n        children: \"+ Novo\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 303,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: duplicateFlow,\n        children: \"Duplicar\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 304,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: addNode,\n        children: \"+ Add Node\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 305,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: saveCurrentFlow,\n        children: \"Salvar\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 306,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: deleteSelected,\n        disabled: !selection.nodes.length && !selection.edges.length,\n        children: \"Delete selected\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 307,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: goToList,\n        style: {\n          marginLeft: 'auto'\n        },\n        children: \"Voltar p/ lista\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 310,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 288,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        fontSize: 12,\n        color: '#6b7280',\n        marginBottom: 10\n      },\n      children: [\"Dica: arraste das \\u201Cbolinhas\\u201D do n\\xF3 para criar conex\\xF5es. Selecione arestas ou n\\xF3s e aperte \", /*#__PURE__*/_jsxDEV(\"b\", {\n        children: \"Delete\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 315,\n        columnNumber: 99\n      }, this), \" para remover.\"]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 314,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        display: 'grid',\n        gridTemplateColumns: '1fr 360px',\n        gap: 16,\n        minHeight: 560\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          border: '1px solid #e5e7eb',\n          borderRadius: 8,\n          overflow: 'hidden',\n          background: '#fff'\n        },\n        children: /*#__PURE__*/_jsxDEV(ReactFlow, {\n          nodes: nodes,\n          edges: edges,\n          nodeTypes: nodeTypes,\n          onNodesChange: onNodesChange,\n          onEdgesChange: onEdgesChange,\n          onConnect: onConnect,\n          onNodeClick: onNodeClick,\n          onSelectionChange: onSelectionChange,\n          fitView: true,\n          children: [/*#__PURE__*/_jsxDEV(MiniMap, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 333,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Controls, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 334,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Background, {\n            gap: 16,\n            size: 1\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 335,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 322,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 321,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          border: '1px solid #e5e7eb',\n          borderRadius: 8,\n          padding: 12,\n          background: '#fff'\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n          style: {\n            margin: '4px 0 12px'\n          },\n          children: \"Propriedades do N\\xF3\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 341,\n          columnNumber: 11\n        }, this), !selectedNode ? /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            color: '#6b7280'\n          },\n          children: \"Selecione um n\\xF3 no canvas.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 343,\n          columnNumber: 13\n        }, this) : /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              marginBottom: 12\n            },\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              style: {\n                fontSize: 12,\n                color: '#6b7280'\n              },\n              children: \"Label\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 348,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              value: (selectedNode === null || selectedNode === void 0 ? void 0 : (_selectedNode$data2 = selectedNode.data) === null || _selectedNode$data2 === void 0 ? void 0 : _selectedNode$data2.label) || '',\n              onChange: e => updateSelectedNodeData({\n                label: e.target.value\n              }),\n              style: {\n                width: '100%',\n                padding: 8,\n                marginTop: 6\n              },\n              placeholder: \"Ex.: Send Welcome Message\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 349,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 347,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              marginBottom: 12\n            },\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              style: {\n                fontSize: 12,\n                color: '#6b7280'\n              },\n              children: \"Template (Twilio)\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 359,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n              value: (selectedNode === null || selectedNode === void 0 ? void 0 : (_selectedNode$data3 = selectedNode.data) === null || _selectedNode$data3 === void 0 ? void 0 : _selectedNode$data3.templateSid) || '',\n              onChange: e => {\n                const sid = e.target.value;\n                const tpl = templates.find(t => t.sid === sid);\n                updateSelectedNodeData({\n                  templateSid: sid || '',\n                  templateName: (tpl === null || tpl === void 0 ? void 0 : tpl.friendlyName) || '',\n                  templateBody: (tpl === null || tpl === void 0 ? void 0 : tpl.body) || '',\n                  templateType: (tpl === null || tpl === void 0 ? void 0 : tpl.type) || ''\n                });\n              },\n              style: {\n                width: '100%',\n                padding: 8,\n                marginTop: 6\n              },\n              disabled: templatesLoading || !!templatesError,\n              children: [/*#__PURE__*/_jsxDEV(\"option\", {\n                value: \"\",\n                children: \"\\u2014 selecione \\u2014\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 375,\n                columnNumber: 19\n              }, this), templates.map(t => /*#__PURE__*/_jsxDEV(\"option\", {\n                value: t.sid,\n                children: t.friendlyName\n              }, t.sid, false, {\n                fileName: _jsxFileName,\n                lineNumber: 377,\n                columnNumber: 21\n              }, this))]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 360,\n              columnNumber: 17\n            }, this), templatesLoading && /*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                marginTop: 6,\n                fontSize: 12,\n                color: '#6b7280'\n              },\n              children: \"Buscando templates\\u2026\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 383,\n              columnNumber: 19\n            }, this), templatesError && /*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                marginTop: 6,\n                fontSize: 12,\n                color: '#ef4444'\n              },\n              children: templatesError\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 388,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 358,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              style: {\n                fontSize: 12,\n                color: '#6b7280'\n              },\n              children: \"Preview\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 396,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                marginTop: 6,\n                padding: 10,\n                border: '1px solid #e5e7eb',\n                borderRadius: 6,\n                background: '#f8fafc',\n                minHeight: 100,\n                whiteSpace: 'pre-wrap',\n                fontFamily: 'ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace',\n                fontSize: 12,\n                color: '#111827'\n              },\n              children: selectedNode !== null && selectedNode !== void 0 && (_selectedNode$data4 = selectedNode.data) !== null && _selectedNode$data4 !== void 0 && _selectedNode$data4.templateBody ? selectedNode.data.templateBody : 'Selecione um template para visualizar o preview.'\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 397,\n              columnNumber: 17\n            }, this), (selectedNode === null || selectedNode === void 0 ? void 0 : (_selectedNode$data5 = selectedNode.data) === null || _selectedNode$data5 === void 0 ? void 0 : _selectedNode$data5.templateType) && /*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                marginTop: 6,\n                fontSize: 12,\n                color: '#6b7280'\n              },\n              children: [\"Tipo: \", /*#__PURE__*/_jsxDEV(\"strong\", {\n                children: selectedNode.data.templateType\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 418,\n                columnNumber: 27\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 417,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 395,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 340,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 319,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 284,\n    columnNumber: 5\n  }, this);\n}\n_s(JourneyBuilder, \"0jv3npqsGabSYAHqPndRdMeFKvA=\");\n_c2 = JourneyBuilder;\nvar _c, _c2;\n$RefreshReg$(_c, \"StepNode\");\n$RefreshReg$(_c2, \"JourneyBuilder\");","map":{"version":3,"names":["React","useCallback","useEffect","useMemo","useState","ReactFlow","addEdge","applyEdgeChanges","applyNodeChanges","Background","Controls","MiniMap","Position","Handle","jsxDEV","_jsxDEV","Fragment","_Fragment","STORAGE_KEY","CURRENT_KEY","sanitizeNodes","list","filter","Boolean","map","n","idx","_n$position","_n$position2","_n$id","x","Number","position","y","id","String","type","data","label","isFinite","Math","floor","draggable","selectable","sanitizeEdges","e","_e$id","source","target","animated","loadFlows","raw","localStorage","getItem","arr","JSON","parse","Array","isArray","f","nodes","edges","saveFlows","flows","safe","setItem","stringify","StepNode","style","padding","border","borderRadius","background","minWidth","boxShadow","children","fontWeight","fontSize","marginBottom","fileName","_jsxFileName","lineNumber","columnNumber","color","templateName","Left","Right","Bottom","Top","_c","nodeTypes","step","JourneyBuilder","_s","_selectedNode$data2","_selectedNode$data3","_selectedNode$data4","_selectedNode$data5","setFlows","flowId","setFlowId","_list$","current","some","currentFlow","find","setNodes","setEdges","selectedNodeId","setSelectedNodeId","selection","setSelection","templates","setTemplates","templatesLoading","setTemplatesLoading","templatesError","setTemplatesError","mounted","fetch","then","r","json","contents","t","firstType","types","Object","values","sid","friendlyName","friendly_name","body","catch","err","message","finally","onNodesChange","changes","nds","onEdgesChange","eds","onConnect","connection","Date","now","onNodeClick","_","node","onSelectionChange","ns","es","selectedNode","updateSelectedNodeData","patch","nid","h","key","test","tagName","preventDefault","deleteSelected","document","addEventListener","removeEventListener","length","nodeIds","Set","edgeIds","has","addNode","baseX","baseY","saveCurrentFlow","updated","newFlow","name","duplicateFlow","copy","goToList","window","location","href","selectedTemplate","_selectedNode$data","templateSid","onClick","display","gap","alignItems","flexWrap","value","onChange","marginLeft","disabled","gridTemplateColumns","minHeight","overflow","fitView","size","margin","width","marginTop","placeholder","tpl","templateBody","templateType","whiteSpace","fontFamily","_c2","$RefreshReg$"],"sources":["/Users/gustsantos/Desktop/initucastt/frontend/src/pages/JourneyBuilder.jsx"],"sourcesContent":["// frontend/src/pages/JourneyBuilder.jsx\nimport React, { useCallback, useEffect, useMemo, useState } from 'react';\nimport ReactFlow, {\n  addEdge,\n  applyEdgeChanges,\n  applyNodeChanges,\n  Background,\n  Controls,\n  MiniMap,\n  Position,\n  Handle,\n} from 'reactflow';\nimport 'reactflow/dist/style.css';\n\nconst STORAGE_KEY = 'flows_v1';\nconst CURRENT_KEY = 'flows_current';\n\n/* ---------- Utils de persistência/sanitização ---------- */\nconst sanitizeNodes = (list) =>\n  (list || []).filter(Boolean).map((n, idx) => {\n    const x = Number(n?.position?.x);\n    const y = Number(n?.position?.y);\n    return {\n      id: String(n?.id ?? `n_${idx}`),\n      type: n?.type || 'step',\n      data: n?.data || { label: 'Step' },\n      position: Number.isFinite(x) && Number.isFinite(y) ? { x, y } : { x: 160 + (idx % 4) * 200, y: 140 + Math.floor(idx / 4) * 140 },\n      draggable: true,\n      selectable: true,\n    };\n  });\n\nconst sanitizeEdges = (list) =>\n  (list || []).filter(Boolean).map((e, idx) => ({\n    id: String(e?.id ?? `e_${idx}`),\n    source: String(e?.source),\n    target: String(e?.target),\n    label: e?.label,\n    animated: !!e?.animated,\n    selectable: true,\n  }));\n\nfunction loadFlows() {\n  try {\n    const raw = localStorage.getItem(STORAGE_KEY);\n    const arr = raw ? JSON.parse(raw) : [];\n    if (!Array.isArray(arr)) return [];\n    return arr.map((f) => ({\n      ...f,\n      nodes: sanitizeNodes(f.nodes),\n      edges: sanitizeEdges(f.edges),\n    }));\n  } catch {\n    return [];\n  }\n}\n\nfunction saveFlows(flows) {\n  const safe = (flows || []).map((f) => ({\n    ...f,\n    nodes: sanitizeNodes(f.nodes),\n    edges: sanitizeEdges(f.edges),\n  }));\n  localStorage.setItem(STORAGE_KEY, JSON.stringify(safe));\n  return safe;\n}\n/* ------------------------------------------------------- */\n\n/* ---------- Node custom com Handles ---------- */\nfunction StepNode({ data }) {\n  return (\n    <div style={{\n      padding: 10, border: '1px solid #e5e7eb', borderRadius: 8, background: '#fff',\n      minWidth: 180, boxShadow: '0 1px 2px rgba(0,0,0,0.06)'\n    }}>\n      <div style={{ fontWeight: 700, fontSize: 14, marginBottom: 4 }}>\n        {data?.label || 'Step'}\n      </div>\n      <div style={{ fontSize: 12, color: '#6b7280' }}>\n        {data?.templateName ? `Template: ${data.templateName}` : 'Template: —'}\n      </div>\n\n      <Handle type=\"target\" position={Position.Left} style={{ background: '#94a3b8' }} />\n      <Handle type=\"source\" position={Position.Right} style={{ background: '#3b82f6' }} />\n      {/* Extras (opcional): topo/baixo pra ramificações */}\n      <Handle type=\"source\" position={Position.Bottom} id=\"out-bottom\" style={{ background: '#3b82f6' }} />\n      <Handle type=\"target\" position={Position.Top} id=\"in-top\" style={{ background: '#94a3b8' }} />\n    </div>\n  );\n}\nconst nodeTypes = { step: StepNode };\n/* ------------------------------------------------------- */\n\nexport default function JourneyBuilder() {\n  const [flows, setFlows] = useState(() => loadFlows());\n\n  // abre o flow corrente (flows_current) se existir\n  const [flowId, setFlowId] = useState(() => {\n    const current = localStorage.getItem(CURRENT_KEY);\n    const list = loadFlows();\n    return current && list.some((f) => f.id === current)\n      ? current\n      : (list[0]?.id || '');\n  });\n\n  const currentFlow = useMemo(\n    () => flows.find((f) => f.id === flowId),\n    [flows, flowId]\n  );\n\n  const [nodes, setNodes] = useState(() => sanitizeNodes(currentFlow?.nodes || []));\n  const [edges, setEdges] = useState(() => sanitizeEdges(currentFlow?.edges || []));\n  const [selectedNodeId, setSelectedNodeId] = useState(null);\n  const [selection, setSelection] = useState({ nodes: [], edges: [] });\n\n  // Templates Twilio\n  const [templates, setTemplates] = useState([]);\n  const [templatesLoading, setTemplatesLoading] = useState(false);\n  const [templatesError, setTemplatesError] = useState(null);\n\n  // carrega templates ao montar\n  useEffect(() => {\n    let mounted = true;\n    setTemplatesLoading(true);\n    fetch('/api/templates/list')\n      .then((r) => r.json())\n      .then((data) => {\n        if (!mounted) return;\n        const list = (data?.contents || []).map((t) => {\n          const firstType = t?.types ? Object.values(t.types)[0] : null;\n          return {\n            sid: t?.sid,\n            friendlyName: t?.friendly_name || t?.friendlyName || t?.sid,\n            body: firstType?.body || '',\n            type: firstType?.type || '',\n          };\n        });\n        setTemplates(list);\n        setTemplatesError(null);\n      })\n      .catch((err) => setTemplatesError(err?.message || 'Erro ao buscar templates'))\n      .finally(() => setTemplatesLoading(false));\n    return () => { mounted = false; };\n  }, []);\n\n  // troca de flow\n  useEffect(() => {\n    const f = flows.find((x) => x.id === flowId);\n    setNodes(sanitizeNodes(f?.nodes || []));\n    setEdges(sanitizeEdges(f?.edges || []));\n    setSelectedNodeId(null);\n    if (flowId) localStorage.setItem(CURRENT_KEY, flowId);\n  }, [flowId, flows]);\n\n  const onNodesChange = useCallback(\n    (changes) => setNodes((nds) => sanitizeNodes(applyNodeChanges(changes, nds))),\n    []\n  );\n  const onEdgesChange = useCallback(\n    (changes) => setEdges((eds) => sanitizeEdges(applyEdgeChanges(changes, eds))),\n    []\n  );\n  const onConnect = useCallback(\n    (connection) => setEdges((eds) => sanitizeEdges(addEdge({ ...connection, id: `e_${Date.now()}` }, eds))),\n    []\n  );\n  const onNodeClick = useCallback((_, node) => {\n    setSelectedNodeId(node?.id || null);\n  }, []);\n  const onSelectionChange = useCallback(({ nodes: ns, edges: es }) => {\n    setSelection({ nodes: ns || [], edges: es || [] });\n  }, []);\n\n  const selectedNode = useMemo(\n    () => nodes.find((n) => n.id === selectedNodeId),\n    [nodes, selectedNodeId]\n  );\n\n  const updateSelectedNodeData = (patch) => {\n    if (!selectedNode) return;\n    const nid = selectedNode.id;\n    setNodes((nds) =>\n      sanitizeNodes(\n        nds.map((n) => (n.id === nid ? { ...n, data: { ...n.data, ...patch } } : n))\n      )\n    );\n  };\n\n  // Delete com teclado (nós/arestas)\n  useEffect(() => {\n    const h = (e) => {\n      if ((e.key === 'Delete' || e.key === 'Backspace') && !/input|textarea|select/i.test(e.target.tagName)) {\n        e.preventDefault();\n        deleteSelected();\n      }\n    };\n    document.addEventListener('keydown', h);\n    return () => document.removeEventListener('keydown', h);\n  }, [selection]);\n\n  const deleteSelected = () => {\n    if (!selection.nodes.length && !selection.edges.length) return;\n    const nodeIds = new Set(selection.nodes.map((n) => n.id));\n    const edgeIds = new Set(selection.edges.map((e) => e.id));\n\n    setNodes((nds) => nds.filter((n) => !nodeIds.has(n.id)));\n    setEdges((eds) =>\n      eds.filter(\n        (e) => !edgeIds.has(e.id) && !nodeIds.has(e.source) && !nodeIds.has(e.target)\n      )\n    );\n    if (selectedNodeId && nodeIds.has(selectedNodeId)) {\n      setSelectedNodeId(null);\n    }\n  };\n\n  // Ações topo\n  const addNode = () => {\n    const id = `n_${Date.now()}`;\n    const baseX = 160 + (nodes.length % 4) * 200;\n    const baseY = 140 + Math.floor(nodes.length / 4) * 140;\n    setNodes((nds) =>\n      sanitizeNodes([\n        ...nds,\n        { id, type: 'step', position: { x: baseX, y: baseY }, data: { label: 'Step' } },\n      ])\n    );\n  };\n\n  const saveCurrentFlow = () => {\n    if (!currentFlow) return;\n    const updated = flows.map((f) =>\n      f.id === currentFlow.id ? { ...f, nodes: sanitizeNodes(nodes), edges: sanitizeEdges(edges) } : f\n    );\n    setFlows(saveFlows(updated));\n  };\n\n  const newFlow = () => {\n    const id = `flow_${Date.now()}`;\n    const f = { id, name: 'Novo Flow', nodes: [], edges: [] };\n    const updated = [...flows, f];\n    setFlows(saveFlows(updated));\n    setFlowId(id);\n  };\n\n  const duplicateFlow = () => {\n    if (!currentFlow) return;\n    const id = `copy_${Date.now()}`;\n    const copy = {\n      ...currentFlow,\n      id,\n      name: `${currentFlow.name || currentFlow.id} (copy)`,\n      nodes: sanitizeNodes(nodes),\n      edges: sanitizeEdges(edges),\n    };\n    const updated = [...flows, copy];\n    setFlows(saveFlows(updated));\n    setFlowId(id);\n  };\n\n  const goToList = () => {\n    // simples navegação\n    window.location.href = '/journeys';\n  };\n\n  const selectedTemplate = useMemo(() => {\n    const sid = selectedNode?.data?.templateSid;\n    return templates.find((t) => t.sid === sid);\n  }, [selectedNode, templates]);\n\n  if (!flows.length) {\n    return (\n      <div>\n        <h2>Journey Builder (MVP)</h2>\n        <p style={{ color: '#6b7280' }}>\n          Nenhum flow cadastrado. Clique em <b>Novo</b> para criar.\n        </p>\n        <button onClick={newFlow}>+ Novo</button>\n      </div>\n    );\n  }\n\n  return (\n    <div>\n      <h2>Journey Builder (MVP)</h2>\n\n      {/* Toolbar */}\n      <div style={{ display: 'flex', gap: 8, alignItems: 'center', marginBottom: 12, flexWrap: 'wrap' }}>\n        <div>\n          <label style={{ fontSize: 12, color: '#6b7280' }}>Flow</label>\n          <select\n            value={flowId}\n            onChange={(e) => setFlowId(e.target.value)}\n            style={{ marginLeft: 8, padding: 6 }}\n          >\n            {flows.map((f) => (\n              <option key={f.id} value={f.id}>\n                {f.name || f.id} ({f.id})\n              </option>\n            ))}\n          </select>\n        </div>\n        <button onClick={newFlow}>+ Novo</button>\n        <button onClick={duplicateFlow}>Duplicar</button>\n        <button onClick={addNode}>+ Add Node</button>\n        <button onClick={saveCurrentFlow}>Salvar</button>\n        <button onClick={deleteSelected} disabled={!selection.nodes.length && !selection.edges.length}>\n          Delete selected\n        </button>\n        <button onClick={goToList} style={{ marginLeft: 'auto' }}>Voltar p/ lista</button>\n      </div>\n\n      {/* Ajuda rápida */}\n      <div style={{ fontSize: 12, color: '#6b7280', marginBottom: 10 }}>\n        Dica: arraste das “bolinhas” do nó para criar conexões. Selecione arestas ou nós e aperte <b>Delete</b> para remover.\n      </div>\n\n      {/* Layout principal */}\n      <div style={{ display: 'grid', gridTemplateColumns: '1fr 360px', gap: 16, minHeight: 560 }}>\n        {/* Canvas */}\n        <div style={{ border: '1px solid #e5e7eb', borderRadius: 8, overflow: 'hidden', background: '#fff' }}>\n          <ReactFlow\n            nodes={nodes}\n            edges={edges}\n            nodeTypes={nodeTypes}\n            onNodesChange={onNodesChange}\n            onEdgesChange={onEdgesChange}\n            onConnect={onConnect}\n            onNodeClick={onNodeClick}\n            onSelectionChange={onSelectionChange}\n            fitView\n          >\n            <MiniMap />\n            <Controls />\n            <Background gap={16} size={1} />\n          </ReactFlow>\n        </div>\n\n        {/* Painel lateral */}\n        <div style={{ border: '1px solid #e5e7eb', borderRadius: 8, padding: 12, background: '#fff' }}>\n          <h4 style={{ margin: '4px 0 12px' }}>Propriedades do Nó</h4>\n          {!selectedNode ? (\n            <div style={{ color: '#6b7280' }}>Selecione um nó no canvas.</div>\n          ) : (\n            <>\n              {/* Label */}\n              <div style={{ marginBottom: 12 }}>\n                <label style={{ fontSize: 12, color: '#6b7280' }}>Label</label>\n                <input\n                  value={selectedNode?.data?.label || ''}\n                  onChange={(e) => updateSelectedNodeData({ label: e.target.value })}\n                  style={{ width: '100%', padding: 8, marginTop: 6 }}\n                  placeholder=\"Ex.: Send Welcome Message\"\n                />\n              </div>\n\n              {/* Template selector */}\n              <div style={{ marginBottom: 12 }}>\n                <label style={{ fontSize: 12, color: '#6b7280' }}>Template (Twilio)</label>\n                <select\n                  value={selectedNode?.data?.templateSid || ''}\n                  onChange={(e) => {\n                    const sid = e.target.value;\n                    const tpl = templates.find((t) => t.sid === sid);\n                    updateSelectedNodeData({\n                      templateSid: sid || '',\n                      templateName: tpl?.friendlyName || '',\n                      templateBody: tpl?.body || '',\n                      templateType: tpl?.type || '',\n                    });\n                  }}\n                  style={{ width: '100%', padding: 8, marginTop: 6 }}\n                  disabled={templatesLoading || !!templatesError}\n                >\n                  <option value=\"\">— selecione —</option>\n                  {templates.map((t) => (\n                    <option key={t.sid} value={t.sid}>\n                      {t.friendlyName}\n                    </option>\n                  ))}\n                </select>\n                {templatesLoading && (\n                  <div style={{ marginTop: 6, fontSize: 12, color: '#6b7280' }}>\n                    Buscando templates…\n                  </div>\n                )}\n                {templatesError && (\n                  <div style={{ marginTop: 6, fontSize: 12, color: '#ef4444' }}>\n                    {templatesError}\n                  </div>\n                )}\n              </div>\n\n              {/* Preview */}\n              <div>\n                <label style={{ fontSize: 12, color: '#6b7280' }}>Preview</label>\n                <div\n                  style={{\n                    marginTop: 6,\n                    padding: 10,\n                    border: '1px solid #e5e7eb',\n                    borderRadius: 6,\n                    background: '#f8fafc',\n                    minHeight: 100,\n                    whiteSpace: 'pre-wrap',\n                    fontFamily:\n                      'ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace',\n                    fontSize: 12,\n                    color: '#111827',\n                  }}\n                >\n                  {selectedNode?.data?.templateBody\n                    ? selectedNode.data.templateBody\n                    : 'Selecione um template para visualizar o preview.'}\n                </div>\n                {selectedNode?.data?.templateType && (\n                  <div style={{ marginTop: 6, fontSize: 12, color: '#6b7280' }}>\n                    Tipo: <strong>{selectedNode.data.templateType}</strong>\n                  </div>\n                )}\n              </div>\n            </>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}